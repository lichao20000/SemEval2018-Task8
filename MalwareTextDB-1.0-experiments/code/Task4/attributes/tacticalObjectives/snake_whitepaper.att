fingerprint 115
it 115

reveal 115
it 115

stay O
persistent O
on O
a O
system O

is 023
encrypted 023
The 023
data 023

saved O
The O
data O

is 023
then 023
further 023
encrypted 023
This 023
file 023

is 050
uploaded 050
This 050
file 050

identify 088
the 088
remote 088
attacker 088

infect O
Snake O

deliver O
the O
generated O
shellcode O

adjusting 091
them 091

delivers 091
the 091
tool 091

exploits 091
the 091
tool 091

replicate 091
it 091

spreading 091
the 091
infection 091

repeating 091
the 091
infection 091
cycle 091

restore 106
Snake 106

taking 116
control 116
over 116
new 116
hosts 116

used 023
Agent.BTZ 023

created O
Log O
files O

using O
for O
evading O
host O
defences O

providing 025
It 025

carry O
out O
all O
of O
the O
communications O

delegate O
the O
network O
communication O
engine O

only O
needs O
When O
most O
of O
the O
infected O
hosts O
are O
cut O
off O
from O
the O
outside O
world O

is 098
then 098
routed 098
The 098
traffic 098

make O
external O
control O

make O
data O
exfiltration O

present O
significant O
challenges O
for O
traditional O
security O
technologies O
to O
detect O

sets O
it O

suggests O
The O
presence O
of O
the O
reconnaissance O
tool O
in O
the O
Snake O
operators’ O
framework O

compromise O
a O
system O

replicate 091
into 091
other 091
hosts 091

infect 091
them 091

spread 091
the 091
infection 091

allow O
the O
backdoor O
commands O

provide 100
Snake 100

staying O
fully O
inactive O

hibernate O

makes O
its O
detection O
during O
that O
time O

hide 023
the 023
presence 023
of 023
the 023
Snake 023
components 023
on 023
the 023
system 023

stay O
unnoticed O

overcome O
account O
restrictions O
of O
the O
browser O
processes O

write O
the O
injected O
module O

creates O
it O

keep 025
its 025
network 025
communications 025

generate 098
malicious 098
traffic 098

‘blend 025
in’ 025
it 025

watches 145
The 145
driver 145

stays O
Snake O

intercepts 098
as 098
soon 098
as 098
the 098
user 098
goes 098
online 098

injects O
the O
driver O

initiates 046
the 046
module 046

establishing O
and O
maintaining O
a O
presence O

blend 025
this 025
behaviour 025

bypassing O
the O
firewalls O

keeping O
a O
low O
profile O

stay O
Snake O
rootkit O

Hiding 025
Snake 025
rootkit 025

injected O
the O
driver O

started 098
producing 098
the 098
following 098
traffic 098

relies 048
on 048
The 048
domain 048
names 048
of 048
the 048
C&C 048
servers 048

resolves 048
the 048
malware 048

fetches O
it O

expects 052
the 052
server 052
to 052
respond 052
with 052
a 052
string 052
“1”, 052
acknowledging 052
it’s 052
active 052

asks 046
it 046

returns 047
the 047
server 047

receives 047
it 047

is 025
encrypted 025
The 025
command 025

calculates 052
and 052
confirms 052
it 052

covertly O
install O
It O

decrypt 052
the 052
malware 052

applies 052
the 052
malware 052

maintain O
They O

decrypts 052
the 052
data 052

makes 052
sure 052
the 052
command 052
is 052
destined 052
to 052
the 052
current 052
host 052

interprets 047
the 047
malware 047

connects 048
the 048
malware 048

asking 046
the 046
malware 046

receives 047
The 047
command 047

uploads 050
it 050

cleans 121
out 121
it 121

hide 023
the 023
presence 023
of 023
its 023
components 023

uploads 050
it 050

store O
configuration O
and O
log O
data O

are O
used O
rootkit O

supports O
3 O
modes O
of O
fetching O
C&C O
commands O

relies O
on O
Windows O
Internet O
(WinINet) O
APIs, O
such O
as O
HttpOpenRequest(), O
HttpSendRequest(), O
InternetReadFile(), O
etc O

uses O
Windows O
Sockets O
2 O
(Winsock) O
APIs, O
such O
as O
WSAStartup(), O
socket(), O
connect(), O
send(), O
etc O

works O
it O

provide O
a O
communication O
mechanism O
with O
its O
C&C O
servers O

passes O
it O

injects O
the O
malicious O
driver O
with O
the O
embedded O
DLL O
module O

function O
the O
DLL O

detects 145
the 145
driver 145

inject O
it O

enable O
an O
effective O
data O
exfiltration O
mechanism O

start O
the O
DLL O

start O
the O
injected O
DLL O

sending O
the O
injected O
DLL O

is O
delegated O
the O
task O
of O
communication O
with O
C&C O

start O
it O

bypassing 123
the 123
host-based 123
firewalls 123
that 123
keep 123
an 123
infected 123
system 123
process 123
in 123
a 123
white-list 123

‘legitimise’ 123
the 123
pipes 123
usage 123

is O
spawned O
a O
dedicated O
thread O

listen 145
for 145
IPC 145
messages 145
received 145
through 145
the 145
pipes 145

are O
carried O
out O
the O
network O
communications O

perform O
GET O

perform O
POST O
requests O

ask O
the O
pipe O
server O

saving O
the O
pipe O
server O

copy O
files O

delete O
files O

save O
configuration O
data O

keep O
This O
delegation O
of O
tasks O

overcome O
account O
restrictions O
imposed O
on O
a O
browser O
process O

write O
into O
files O

write O
into O
registry O

send O
the O
clients O

are O
handled O
the O
network O
communications O

calls O
it O

communicates O
The O
usermode O
component O
of O
Snake O

write O
data O

opens O
it O

are 048
hard-coded 048
the 048
initial 048
set 048
of 048
domain 048
names 048

provide 100
these 100
commands 100

allowing 100
remote 100
attacker 100

depend O
on O
The O
choice O
of O
what O
architecture O
should O
be O
used O

performed 100
the 100
malware 100

update 051
the 051
driver 051

rely O
on O
its O
communication O
capabilities O

is 119
installed 119
via 119
an 119
update 119

is O
the O
kernel-mode O
driver O

be 100
instructed 100
the 100
usermode 100
component 100

copying O
all O
the O
necessary O
logs O

carry O
out O
a O
kernel-mode O
driver O

are O
still O
injected O
The O
usermode O
DLLs O

installed O
a O
kernel O
mode O
driver O

be 092
distributed 092
via 092
a 092
phishing 092
email 092
attachment 092

be 091
delivered 091
via 091
an 091
exploit 091
across 091
the 091
network 091

starts O
Infection O

executed O
the O
dropper O

installs 118
the 118
kernel 118
mode 118
driver 118

install 118
On 118
a 118
32-bit 118
OS 118

install 118
a 118
64-bit 118
driver 118

injected O
a O
usermode O
DLL O

creates 118
The 118
analysed 118
32-bit 118
dropper 118

is O
ensured O
with O
creation O
of O
the O
following O
registry O
entries O

places O
The O
rootkit O

flags O
The O
driver O

hooks O
it O

install 118
it 118

calls O
The O
installed O
hook O
handler O

checks O
if O
the O
name O
of O
the O
device O
is O
netbt O
or O
afd O

hide O
its O
hooks O

hide 023
the 023
driver 023

hooks O
the O
driver O

block 039
the 039
hook 039
handlers 039
of 039
the 039
registry-related 039
APIs 039

load O
the O
Snake O
driver O

blocks 039
the 039
rootkit 039

block 036
The 036
ZwReadFile() 036
hook 036
handler 036

blocked 036
it 036

inject O
The O
ZwClose() O
hook O
handler O

checks O
The O
hook O
handler O
for O
ZwTerminateProcess() O

unloads O
it O

deactivates O
it O

hide 023
The 023
ObOpenObjectByName() 023
hook 023

encrypt 023
data 023
stored 023
on 023
its 023
virtual 023
partitions 023

sets O
the O
driver O

re-infect 104
the 104
rootkit 104

be O
used O
These O
tools O

re-enable 104
the 104
rootkit 104

hooks O
the O
rootkit O

registers 098
it 098

is 098
notified 098
its 098
callout 098
driver 098

use O
the O
Snake O
driver O

triggers O
the O
rootkit O

is 098
intercepted 098
it 098

scanned O
for O
the O
presence O
of O
the O
hidden O
commands O
from O
C&C O

inspects 098
The 098
driver 098

manipulate 098
data 098
streams 098

insert O
Snake O

hooks O
Snake O

hooks O
Snake O

intercepts 098
it 098

inspect 098
it 098

looking O
for O
and O
then O
parsing O
GET/POST O
HTTP O
requests O
and O
also O
SMTP O
communications O

distinguish O
it O

detects 113
the 113
rootkit 113

invoke O
FwpsStreamInjectAsync0() O
API O

creates O
the O
driver O

generate O
outbound O
requests O

‘pulse’ O
the O
TDI O
driver O

intercepts 098
the 098
driver 098

execute 047
the 047
DLL 047
module 047

be 050
delivered 050
the 050
driver 050

installs 118
code 118

is 118
set 118
up 118
This 118
driver 118

hooks O
the O
drivers O

hooks O
the O
following O
exports O

installs 118
code 118

is O
stored O
NDIS O
filter O
driver O
configuration O

hook O
it O

is O
used O
This O
device O

installed O
the O
hooks O

register O
the O
hook O
handlers O

send O
it O

receive O
it O

bypassing 123
it 123

making 026
it 026

invokes O
NDIS O

receives O
the O
underlying O
miniport O
driver O

invoking O
it O

drops O
it O

calling O
NdisSendNetBufferLists() O

defines 062
the 062
protocol 062
driver 062

send O
the O
data O

calls O
NDIS O

manipulate 098
Snake 098

parse 098
all 098
incoming 098
traffic 098

‘inject’ 098
the 098
traffic 098

reach O
out O
to O
external O
components O

detect 098
traffic 098
addressed 098
to 098
itself 098

registered O
Snake O

is O
registered O
The O
driver O

is O
registered O
The O
driver O

registers O
The O
Snake O
rootkit O

intercepts 098
the 098
driver 098

parses 098
it 098

applied O
XOR O
0xAA O

be 052
authenticated 052
it 052

is 052
implemented 052
The 052
authentication 052

decrypting 052
the 052
data 052

making 052
sure 052
it 052
starts 052
with 052
the 052
markers 052
0xDEADBEAF 052
and 052
0xC001BA5E 052
(which 052
appear 052
to 052
derive 052
from 052
‘DEAD 052
BEEF’ 052
and 052
‘COOL 052
BASE’) 052

routing O
the O
driver O

is O
acting O
the O
driver O

respond O
the O
driver O

is 052
authenticated 052
and 052
decrypted 052
the 052
incoming 052
data 052

log O
its O
activity O

writes O
the O
driver O

send O
it O

send O
a O
received O
peer-2-peer O
command O
message O
write_peer_nfo=[IP_ADDRESS:PORT]0frag_no_scrambling=Y0 O

log O
the O
DLL O

is O
dropped O
the O
DLL O

used O
the O
named O
pipes O

submitted O
Messages O

received O
the O
data O

identify O
the O
pipe O
server O

creates 023
The 023
driver 023

are O
mounted O
The O
volumes O

is O
created O
The O
first O
partition O

installed O
The O
hook O

be O
injected O
into O
the O
user-mode O
processes O

provides 023
The 023
hook 023

is O
written O
that O
data O

read O
that O
data O

is 023
based 023
The 023
encryption 023
algorithm 023

be 023
scrambled 023
on-the-fly 023

is O
saved O
the O
data O

reflected O
in O
the O
persistent O
storage O
file O
hotfix.dat O

’s 023
a 023
fully 023
encrypted 023
file 023
with 023
flat 023
entropy 023

is 023
encrypted 023
The 023
data 023
stored 023
in 023
\\.\Hd2 023

be O
set O
up O
Both O
volumes O

keep 023
Snake 023

be O
installed O
as O
a O
service O

uses O
the O
Snake O
driver O

store O
the O
Snake O
driver O

stores O
it O

intercepted 140
keystrokes 140

contain O
other O
log O
files O

load O
its O
unsigned O
64-bit O
driver O

ensure 104
the 104
driver 104
is 104
loaded 104
automatically 104
at 104
startup 104

install 118
the 118
dropper 118

installs 118
it 118

behaves 113
it 113

be O
run O
within O
taskhost.exe O
or O
services.exe O
processes O

is O
created O

copies O
itself O

registers O
The O
dropper O

is O
registered O
the O
dropper O
itself O

ensure 104
The 104
dropper 104

craft 124
an 124
attacker 124

be 124
used 124
the 124
vulnerable 124
driver 124

is 132
disabled 132
Code 132
Integrity 132
verification 132

be O
loaded O
the O
unsigned O
64-bit O
driver O

loads O
the O
Snake O
dropper O

locates O
the O
import O
of O
CI.dll’s O
function O
CiInitialize() O

sets O
up O
the O
driver O

parses O
it O

is O
loaded O
the O
64-bit O
unsigned O
driver O

registers O
Snake O
dropper O

start 104
Snake 104
dropper 104

load O
the O
driver O

install 117
Snake 117
dropper 117

disable 132
Snake 132
dropper 132

obtain O
the O
dropper O

running O
It O

be O
injected O
libraries O

creating O
NTFS O
file O
systems O

is O
written O
the O
initial O
message O
queue O
file O

injected O
The O
usermode O
DLLs O

uses O
The O
rkctl_Win32.dll/rkctl_x64.dll O
module O

receives 047
it 047

control 047
other 047
components 047
of 047
Snake 047

activates O
the O
DLL O

calls O
PsSetCreateProcessNotifyRoutine() O

reads O
it O

creates O
the O
driver O

use O
the O
DLL O

received 047
The 047
remote 047
commands 047

post 050
the 050
data 050

be O
notified O
whenever O
a O
new O
process O
is O
started O

rely O
on O
It O

uses O
it O

be O
Request O
type O

is O
C&C O
server O
resource O
name O

be O
GET O

was O
identified O
as O
a O
network O
reconnaissance O
tool O

been 118
downloaded 118
One 118
of 118
the 118
Snake 118
components 118

enumerates 115
this 115
tool 115

detects O
what O
Windows O
RPC O
services O
are O
enabled O
at O
the O
endpoints O

associated O
a O
list O
of O
interface O
identifiers O

write O
a O
message O

read O
It O

