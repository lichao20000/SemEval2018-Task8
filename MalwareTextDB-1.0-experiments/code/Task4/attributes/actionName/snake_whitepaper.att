fingerprint O
it O

reveal O
it O

stay O
persistent O
on O
a O
system O

is O
encrypted O
The O
data O

saved 043
The 043
data 043

is O
then O
further O
encrypted O
This O
file O

is 097
uploaded 097
This 097
file 097

identify O
the O
remote O
attacker O

infect O
Snake O

deliver 093
the 093
generated 093
shellcode 093

adjusting O
them O

delivers 096
the 096
tool 096

exploits O
the O
tool O

replicate O
it O

spreading O
the O
infection O

repeating O
the O
infection O
cycle O

restore O
Snake O

taking O
control O
over O
new O
hosts O

used O
Agent.BTZ O

created 024
Log 024
files 024

using O
for O
evading O
host O
defences O

providing O
It O

carry O
out O
all O
of O
the O
communications O

delegate O
the O
network O
communication O
engine O

only O
needs O
When O
most O
of O
the O
infected O
hosts O
are O
cut O
off O
from O
the O
outside O
world O

is O
then O
routed O
The O
traffic O

make O
external O
control O

make O
data O
exfiltration O

present O
significant O
challenges O
for O
traditional O
security O
technologies O
to O
detect O

sets 061
it 061

suggests O
The O
presence O
of O
the O
reconnaissance O
tool O
in O
the O
Snake O
operators’ O
framework O

compromise O
a O
system O

replicate O
into O
other O
hosts O

infect O
them O

spread O
the O
infection O

allow O
the O
backdoor O
commands O

provide O
Snake O

staying O
fully O
inactive O

hibernate O

makes O
its O
detection O
during O
that O
time O

hide O
the O
presence O
of O
the O
Snake O
components O
on O
the O
system O

stay O
unnoticed O

overcome O
account O
restrictions O
of O
the O
browser O
processes O

write 043
the 043
injected 043
module 043

creates 024
it 024

keep O
its O
network O
communications O

generate O
malicious O
traffic O

‘blend O
in’ O
it O

watches 106
The 106
driver 106

stays O
Snake O

intercepts O
as O
soon O
as O
the O
user O
goes O
online O

injects 119
the 119
driver 119

initiates O
the O
module O

establishing O
and O
maintaining O
a O
presence O

blend O
this O
behaviour O

bypassing O
the O
firewalls O

keeping O
a O
low O
profile O

stay O
Snake O
rootkit O

Hiding O
Snake O
rootkit O

injected 119
the 119
driver 119

started 096
producing 096
the 096
following 096
traffic 096

relies O
on O
The O
domain O
names O
of O
the O
C&C O
servers O

resolves O
the O
malware O

fetches 054
it 054

expects O
the O
server O
to O
respond O
with O
a O
string O
“1”, O
acknowledging O
it’s O
active O

asks 096
it 096

returns 093
the 093
server 093

receives 093
it 093

is O
encrypted O
The O
command O

calculates O
and O
confirms O
it O

covertly O
install O
It O

decrypt O
the O
malware O

applies O
the O
malware O

maintain O
They O

decrypts O
the O
data O

makes O
sure O
the O
command O
is O
destined O
to O
the O
current O
host O

interprets O
the O
malware O

connects 088
the 088
malware 088

asking 096
the 096
malware 096

receives 093
The 093
command 093

uploads 097
it 097

cleans 028
out 028
it 028

hide O
the O
presence O
of O
its O
components O

uploads 097
it 097

store 043
configuration 043
and 043
log 043
data 043

are 043
used 043
rootkit 043

supports O
3 O
modes O
of O
fetching O
C&C O
commands O

relies O
on O
Windows O
Internet O
(WinINet) O
APIs, O
such O
as O
HttpOpenRequest(), O
HttpSendRequest(), O
InternetReadFile(), O
etc O

uses 158
Windows 158
Sockets 158
2 158
(Winsock) 158
APIs, 158
such 158
as 158
WSAStartup(), 158
socket(), 158
connect(), 158
send(), 158
etc 158

works 064
it 064

provide O
a O
communication O
mechanism O
with O
its O
C&C O
servers O

passes 072
it 072

injects 119
the 119
malicious 119
driver 119
with 119
the 119
embedded 119
DLL 119
module 119

function 064
the 064
DLL 064

detects 106
the 106
driver 106

inject 119
it 119

enable O
an O
effective O
data O
exfiltration O
mechanism O

start O
the O
DLL O

start 064
the 064
injected 064
DLL 064

sending 072
the 072
injected 072
DLL 072

is 064
delegated 064
the 064
task 064
of 064
communication 064
with 064
C&C 064

start O
it O

bypassing O
the O
host-based O
firewalls O
that O
keep O
an O
infected O
system O
process O
in O
a O
white-list O

‘legitimise’ O
the O
pipes O
usage O

is 125
spawned 125
a 125
dedicated 125
thread 125

listen 070
for 070
IPC 070
messages 070
received 070
through 070
the 070
pipes 070

are O
carried O
out O
the O
network O
communications O

perform 054
GET 054

perform 058
POST 058
requests 058

ask 064
the 064
pipe 064
server 064

saving 043
the 043
pipe 043
server 043

copy 023
files 023

delete 028
files 028

save 142
configuration 142
data 142

keep O
This O
delegation O
of O
tasks O

overcome O
account O
restrictions O
imposed O
on O
a O
browser O
process O

write 043
into 043
files 043

write 142
into 142
registry 142

send 072
the 072
clients 072

are O
handled O
the O
network O
communications O

calls 080
it 080

communicates O
The O
usermode O
component O
of O
Snake O

write 043
data 043

opens 036
it 036

are O
hard-coded O
the O
initial O
set O
of O
domain O
names O

provide O
these O
commands O

allowing O
remote O
attacker O

depend O
on O
The O
choice O
of O
what O
architecture O
should O
be O
used O

performed O
the O
malware O

update O
the O
driver O

rely O
on O
its O
communication O
capabilities O

is O
installed O
via O
an O
update O

is O
the O
kernel-mode O
driver O

be O
instructed O
the O
usermode O
component O

copying 023
all 023
the 023
necessary 023
logs 023

carry O
out O
a O
kernel-mode O
driver O

are 119
still 119
injected 119
The 119
usermode 119
DLLs 119

installed 006
a 006
kernel 006
mode 006
driver 006

be O
distributed O
via O
a O
phishing O
email O
attachment O

be O
delivered O
via O
an O
exploit O
across O
the O
network O

starts O
Infection O

executed 029
the 029
dropper 029

installs O
the O
kernel O
mode O
driver O

install O
On O
a O
32-bit O
OS O

install O
a O
64-bit O
driver O

injected 119
a 119
usermode 119
DLL 119

creates 024
The 024
analysed 024
32-bit 024
dropper 024

is 135
ensured 135
with 135
creation 135
of 135
the 135
following 135
registry 135
entries 135

places 061
The 061
rootkit 061

flags 196
The 196
driver 196

hooks 061
it 061

install O
it O

calls 080
The 080
installed 080
hook 080
handler 080

checks 031
if 031
the 031
name 031
of 031
the 031
device 031
is 031
netbt 031
or 031
afd 031

hide O
its O
hooks O

hide O
the O
driver O

hooks 061
the 061
driver 061

block O
the O
hook O
handlers O
of O
the O
registry-related O
APIs O

load 119
the 119
Snake 119
driver 119

blocks O
the O
rootkit O

block O
The O
ZwReadFile() O
hook O
handler O

blocked O
it O

inject 119
The 119
ZwClose() 119
hook 119
handler 119

checks 106
The 106
hook 106
handler 106
for 106
ZwTerminateProcess() 106

unloads 082
it 082

deactivates 007
it 007

hide O
The O
ObOpenObjectByName() O
hook O

encrypt O
data O
stored O
on O
its O
virtual O
partitions O

sets 061
the 061
driver 061

re-infect O
the O
rootkit O

be O
used O
These O
tools O

re-enable O
the O
rootkit O

hooks 061
the 061
rootkit 061

registers O
it O

is O
notified O
its O
callout O
driver O

use O
the O
Snake O
driver O

triggers 168
the 168
rootkit 168

is O
intercepted O
it O

scanned O
for O
the O
presence O
of O
the O
hidden O
commands O
from O
C&C O

inspects O
The O
driver O

manipulate O
data O
streams O

insert 096
Snake 096

hooks 061
Snake 061

hooks 061
Snake 061

intercepts O
it O

inspect O
it O

looking O
for O
and O
then O
parsing O
GET/POST O
HTTP O
requests O
and O
also O
SMTP O
communications O

distinguish O
it O

detects O
the O
rootkit O

invoke 080
FwpsStreamInjectAsync0() 080
API 080

creates 024
the 024
driver 024

generate 096
outbound 096
requests 096

‘pulse’ 168
the 168
TDI 168
driver 168

intercepts O
the O
driver O

execute O
the O
DLL O
module O

be 096
delivered 096
the 096
driver 096

installs O
code O

is O
set O
up O
This O
driver O

hooks 061
the 061
drivers 061

hooks 061
the 061
following 061
exports 061

installs O
code O

is 135
stored 135
NDIS 135
filter 135
driver 135
configuration 135

hook 061
it 061

is O
used O
This O
device O

installed 061
the 061
hooks 061

register 147
the 147
hook 147
handlers 147

send 096
it 096

receive 093
it 093

bypassing O
it O

making O
it O

invokes 080
NDIS 080

receives 093
the 093
underlying 093
miniport 093
driver 093

invoking 080
it 080

drops 084
it 084

calling 080
NdisSendNetBufferLists() 080

defines O
the O
protocol O
driver O

send O
the O
data O

calls 080
NDIS 080

manipulate O
Snake O

parse O
all O
incoming O
traffic O

‘inject’ O
the O
traffic O

reach O
out O
to O
external O
components O

detect O
traffic O
addressed O
to O
itself O

registered 147
Snake 147

is 147
registered 147
The 147
driver 147

is 147
registered 147
The 147
driver 147

registers 147
The 147
Snake 147
rootkit 147

intercepts O
the O
driver O

parses O
it O

applied O
XOR O
0xAA O

be O
authenticated O
it O

is O
implemented O
The O
authentication O

decrypting O
the O
data O

making O
sure O
it O
starts O
with O
the O
markers O
0xDEADBEAF O
and O
0xC001BA5E O
(which O
appear O
to O
derive O
from O
‘DEAD O
BEEF’ O
and O
‘COOL O
BASE’) O

routing O
the O
driver O

is O
acting O
the O
driver O

respond 096
the 096
driver 096

is O
authenticated O
and O
decrypted O
the O
incoming O
data O

log O
its O
activity O

writes 072
the 072
driver 072

send 072
it 072

send 072
a 072
received 072
peer-2-peer 072
command 072
message 072
write_peer_nfo=[IP_ADDRESS:PORT]0frag_no_scrambling=Y0 072

log 043
the 043
DLL 043

is 084
dropped 084
the 084
DLL 084

used 064
the 064
named 064
pipes 064

submitted 072
Messages 072

received 070
the 070
data 070

identify 070
the 070
pipe 070
server 070

creates 116
The 116
driver 116

are 017
mounted 017
The 017
volumes 017

is 116
created 116
The 116
first 116
partition 116

installed 061
The 061
hook 061

be 119
injected 119
into 119
the 119
user-mode 119
processes 119

provides O
The O
hook O

is 043
written 043
that 043
data 043

read 038
that 038
data 038

is O
based O
The O
encryption O
algorithm O

be O
scrambled O
on-the-fly O

is 043
saved 043
the 043
data 043

reflected O
in O
the O
persistent O
storage O
file O
hotfix.dat O

’s O
a O
fully O
encrypted O
file O
with O
flat O
entropy O

is O
encrypted O
The O
data O
stored O
in O
\\.\Hd2 O

be 116
set 116
up 116
Both 116
volumes 116

keep O
Snake O

be 147
installed 147
as 147
a 147
service 147

uses 116
the 116
Snake 116
driver 116

store 043
the 043
Snake 043
driver 043

stores 043
it 043

intercepted O
keystrokes O

contain O
other O
log O
files O

load 006
its 006
unsigned 006
64-bit 006
driver 006

ensure O
the O
driver O
is O
loaded O
automatically O
at O
startup O

install O
the O
dropper O

installs O
it O

behaves O
it O

be 153
run 153
within 153
taskhost.exe 153
or 153
services.exe 153
processes 153

is 024
created 024

copies 023
itself 023

registers 147
The 147
dropper 147

is 147
registered 147
the 147
dropper 147
itself 147

ensure O
The O
dropper O

craft O
an O
attacker O

be O
used O
the O
vulnerable O
driver O

is O
disabled O
Code O
Integrity O
verification O

be 006
loaded 006
the 006
unsigned 006
64-bit 006
driver 006

loads 036
the 036
Snake 036
dropper 036

locates 038
the 038
import 038
of 038
CI.dll’s 038
function 038
CiInitialize() 038

sets 061
up 061
the 061
driver 061

parses 038
it 038

is 006
loaded 006
the 006
64-bit 006
unsigned 006
driver 006

registers 147
Snake 147
dropper 147

start O
Snake O
dropper O

load 006
the 006
driver 006

install O
Snake O
dropper O

disable O
Snake O
dropper O

obtain O
the O
dropper O

running 029
It 029

be 119
injected 119
libraries 119

creating 116
NTFS 116
file 116
systems 116

is 043
written 043
the 043
initial 043
message 043
queue 043
file 043

injected 119
The 119
usermode 119
DLLs 119

uses 064
The 064
rkctl_Win32.dll/rkctl_x64.dll 064
module 064

receives O
it O

control O
other O
components O
of O
Snake O

activates 084
the 084
DLL 084

calls 080
PsSetCreateProcessNotifyRoutine() 080

reads 038
it 038

creates 024
the 024
driver 024

use 064
the 064
DLL 064

received 093
The 093
remote 093
commands 093

post 096
the 096
data 096

be 106
notified 106
whenever 106
a 106
new 106
process 106
is 106
started 106

rely O
on O
It O

uses O
it O

be 058
Request 058
type 058

is O
C&C O
server O
resource O
name O

be 054
GET 054

was O
identified O
as O
a O
network O
reconnaissance O
tool O

been 090
downloaded 090
One 090
of 090
the 090
Snake 090
components 090

enumerates O
this O
tool O

detects O
what O
Windows O
RPC O
services O
are O
enabled O
at O
the O
endpoints O

associated 064
a 064
list 064
of 064
interface 064
identifiers 064

write 072
a 072
message 072

read 070
It 070

