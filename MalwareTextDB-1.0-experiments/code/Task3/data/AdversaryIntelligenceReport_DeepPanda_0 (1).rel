In IN O O
late JJ O O
December NNP O O
2011 CD O O
, , O O
CrowdStrike NNP O O
, , O O
Inc. NNP O O
received VBD O O
three CD O O
binary JJ O O
executable JJ O O
files NNS O O
that WDT O O
were VBD O O
suspected VBN O O
of IN O O
having VBG O O
been VBN O O
involved VBN O O
in IN O O
a DT O O
sophisticted JJ O O
attack NN O O
against IN O O
a DT O O
large JJ O O
Fortune NN O O
500 CD O O
company NN O O
. . O O

The DT O O
files NNS O O
were VBD O O
analyzed VBN O O
to TO O O
understand VB O O
first RB O O
if IN O O
they PRP O O
were VBD O O
in IN O O
fact NN O O
malicious JJ O O
, , O O
and CC O O
the DT O O
level NN O O
of IN O O
sophistication NN O O
of IN O O
the DT O O
samples NNS O O
. . O O

The DT O O
samples NNS O O
were VBD O O
clearly RB O O
malicious JJ O O
and CC O O
varied JJ O O
in IN O O
sophistication NN O O
. . O O

All DT B-Entity 1
three CD I-Entity O
samples NNS I-Entity O
provided VBD B-Action 2
remote JJ B-Entity 3
access NN I-Entity O
to TO B-Modifier 4
the DT B-Entity 5
attacker NN I-Entity O
, , O O
via IN B-Modifier 6
two CD B-Entity 7
Command NN I-Entity O
and CC I-Entity O
Control NN I-Entity O
( NN I-Entity O
C2 NN I-Entity O
) NN I-Entity O
servers NNS I-Entity O
. . O O

One CD B-Entity 1
sample NN I-Entity O
is VBZ O O
typical JJ O O
of IN O O
what WP O O
is VBZ O O
commonly RB O O
referred VBN O O
to TO O O
as IN O O
a DT O O
'dropper NN O O
' '' O O
because IN O O
its PRP$ O O
primary JJ O O
purpose NN O O
is VBZ O O
to TO O O
write VB B-Action 2
a DT B-Entity 3
malicious JJ I-Entity O
component NN I-Entity O
to TO B-Modifier 4
disk NN B-Entity 5
and CC O O
connect VB O O
it PRP O O
to TO O O
the DT O O
targeted VBN O O
hosts NNS O O
operating VBG O O
system NN O O
. . O O

The DT O O
malicious JJ O O
component NN O O
in IN O O
this DT O O
case NN O O
is VBZ O O
what WP O O
is VBZ O O
commonly RB O O
referred VBN O O
to TO O O
as IN O O
a DT O O
Remote JJ O O
Access NN O O
Tool NNP O O
( NNP O O
RAT NNP O O
) NNP O O
, , O O
this DT O O
RAT NN O O
is VBZ O O
manifested VBN O O
as IN O O
a DT B-Entity 1
Dynamic NNP I-Entity O
Link NNP I-Entity O
Library NNP I-Entity O
( FW I-Entity O
DLL FW I-Entity O
) FW I-Entity O
installed VBN B-Action 2
as IN B-Modifier 3
a DT B-Entity 4
service NN I-Entity O
. . O O

The DT O O
second JJ O O
sample NN O O
analyzed VBN O O
is VBZ O O
a DT O O
dual JJ O O
use NN O O
tool NN O O
that WDT O O
can MD O O
function VB O O
both DT O O
as IN O O
a DT B-Entity 1
post NN I-Entity O
exploitation NN I-Entity O
tool NN I-Entity O
used VBN O O
to TO O O
infect VB B-Action 2
other JJ B-Entity 3
systems NNS I-Entity O
, , O O
download VB B-Action 4
additional JJ B-Entity 5
tools NNS I-Entity O
, , O O
remove VB B-Action 6
log NN B-Entity 7
data NNS I-Entity O
, , O O
and CC O O
itself PRP B-Entity 8
be VB B-Action 9
used VBN I-Action O
as IN B-Modifier 10
a DT B-Entity 11
backdoor NN I-Entity O
. . O O

The DT B-Entity 1
third JJ I-Entity O
sample NN I-Entity O
was VBD O O
a DT O O
sophisticated JJ O O
implant VBP O O
that IN O O
in IN O O
addition NN O O
to TO O O
having VBG B-Action 2
multiple JJ B-Entity 3
communication NN I-Entity O
capabilities NNS I-Entity O
, , O O
and CC O O
the DT O O
ability NN O O
to TO O O
act VB B-Action 4
as IN B-Modifier 5
a DT B-Entity 6
relay NN I-Entity O
for IN I-Entity O
other JJ I-Entity O
infected JJ I-Entity O
hosts NNS I-Entity O
, , O O
utilized VBD B-Action 7
a DT B-Entity 8
kernel NN I-Entity O
mode NN I-Entity O
driver NN I-Entity O
that WDT O O
can MD O O
hide VB B-Action 9
aspects NNS B-Entity 10
of IN I-Entity O
the DT I-Entity O
tool NN I-Entity O
from IN B-Modifier 11
user-mode JJ B-Entity 12
tools NNS I-Entity O
. . O O

This DT B-Entity 1
third JJ I-Entity O
component NN I-Entity O
is VBZ B-Action 2
likely RB I-Action O
used VBN I-Action O
for IN B-Modifier 3
long-term JJ O O
implantation NN O O
and CC O O
intelligence NN B-Entity 4
gathering NN I-Entity O
. . O O

Some DT O O
AV NNP O O
engines NNS O O
occasionally RB O O
identify VBP O O
this DT O O
sample NN O O
as IN O O
Derusbi NNP O O
Trojan NNP O O
. . O O

CrowdStrike NNP O O
Intelligence NNP O O
Team NNP O O
has VBZ O O
seen VBN O O
Trojans NNPS O O
from IN O O
8 CD O O
different JJ O O
builder NN O O
variants NNS O O
of IN O O
this DT O O
RAT NN O O
, , O O
including VBG O O
64-bit JJ O O
versions NNS O O
, , O O
used VBN O O
in IN O O
targeted VBN O O
attacks NNS O O
in IN O O
2011 CD O O
against IN O O
Defense NNP O O
, , O O
Energy/Power NNP O O
, , O O
and CC O O
Chemical NNP O O
Industries NNPS O O
in IN O O
US NNP O O
and CC O O
Japan NNP O O
. . O O

All DT O O
of IN O O
these DT O O
samples NNS O O
reflect VBP O O
common JJ O O
toolmarks NNS O O
and CC O O
tradecraft NN O O
consistent JJ O O
with IN O O
Chinese JJ O O
based JJ O O
actors NNS O O
who WP O O
target VBP O O
various JJ O O
strategic JJ O O
interests NNS O O
of IN O O
the DT O O
United NNP O O
States NNPS O O
including VBG O O
High NNP O O
Tech/Heavy NNP O O
Industry NNP O O
, , O O
Non-Governmental NNP O O
Organizations NNP O O
( NNP O O
NGOs NNP O O
) NNP O O
, , O O
State/Federal NNP O O
Government NNP O O
, , O O
Defense NNP O O
Industrial NNP O O
Base NNP O O
( NNP O O
DIB NNP O O
) NNP O O
, , O O
and CC O O
organizations NNS O O
with IN O O
vast JJ O O
economic JJ O O
interests NNS O O
. . O O

This DT O O
report NN O O
contains VBZ O O
an DT O O
in-depth JJ O O
technical JJ O O
analysis NN O O
of IN O O
the DT O O
samples NNS O O
, , O O
detection/remediation/mitigation NN O O
information NN O O
, , O O
attribution NN O O
intelligence NN O O
, , O O
and CC O O
a DT O O
conclusion NN O O
aimed VBN O O
at IN O O
providing VBG O O
the DT O O
reader NN O O
with IN O O
a DT O O
synopsis NN O O
of IN O O
the DT O O
report NN O O
. . O O

The DT B-Entity 1
executable JJ I-Entity O
14c04f88dc97aef3e9b516ef208a2bf5 NN I-Entity O
is VBZ O O
commonly RB O O
referred VBN O O
to TO O O
as IN O O
a DT O O
'dropper NN O O
' '' O O
, , O O
which WDT O O
is VBZ O O
designed VBN O O
with IN O O
the DT O O
purpose NN O O
of IN O O
extracting VBG B-Action 2
from IN B-Modifier 3
itself PRP B-Entity 4
a DT B-Entity 5
malicious JJ I-Entity O
payload NN I-Entity O
and CC O O
to TO O O
initialize VB B-Action 6
and CC I-Action O
install VB I-Action O
it PRP B-Entity 7
into IN B-Modifier 8
a DT B-Entity 9
targeted VBN I-Entity O
system NN I-Entity O
. . O O

In IN O O
this DT O O
case NN O O
, , O O
the DT B-Entity 1
malicious JJ I-Entity O
payload NN I-Entity O
is VBZ O O
a DT O O
Dynamic-Link NNP O O
Library NNP O O
( NNP O O
DLL NNP O O
) NNP O O
, , O O
which WDT O O
enables VBZ B-Action 2
an DT B-Entity 3
attacker NN I-Entity O
to TO B-Modifier 4
have VB B-Entity 5
full JJ I-Entity O
control NN I-Entity O
of IN I-Entity O
the DT I-Entity O
system NN I-Entity O
. . O O

This DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Wednesday NNP O O
May NNP O O
4th JJ O O
, , O O
2011 CD O O
at IN O O
11:04:24 CD O O
A.M. NNP O O
UTC NNP O O
( NN O O
equivalent JJ O O
to TO O O
early JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

Note VB O O
that IN O O
the DT O O
timestamp NN O O
is VBZ O O
in IN O O
UTC NNP O O
, , O O
however RB O O
the DT O O
relative JJ O O
time NN O O
of IN O O
day NN O O
in IN O O
China NNP O O
is VBZ O O
provided VBN O O
for IN O O
the DT O O
benefit NN O O
of IN O O
the DT O O
reader NN O O
. . O O

The DT B-Entity 1
sample NN I-Entity O
first RB O O
resolves VBZ B-Action 2
several JJ B-Entity 3
library NN I-Entity O
functions NNS I-Entity O
provided VBN I-Entity O
by IN I-Entity O
Microsoft NNP I-Entity O
using VBG B-Modifier 4
the DT B-Entity 5
LoadLibrary NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
and CC I-Entity O
GetProcAddress NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
Application NN I-Entity O
Programming NNP I-Entity O
Interfaces NNPS I-Entity O
( FW I-Entity O
APIs FW I-Entity O
) FW I-Entity O
. . O O

The DT O O
imported VBN O O
function NN O O
names NNS O O
are VBP O O
not RB O O
encrypted VBN O O
; : O O
however RB O O
, , O O
the DT O O
function NN O O
name NN O O
is VBZ O O
minutely RB O O
obfuscated VBN O O
by IN O O
a DT O O
simple JJ O O
single JJ O O
character NN O O
substitution NN O O
: : O O
The DT B-Entity 1
dropper NN I-Entity O
invokes VBZ B-Action 2
the DT B-Entity 3
SHGetSpecialFolderPath NN I-Entity O
( FW I-Entity O
) FW I-Entity O
API NN I-Entity O
supplying VBG O O
a DT O O
Constant JJ O O
Special JJ O O
Item NN O O
ID NN O O
List NN O O
( FW O O
CSIDL FW O O
) NN O O
of IN O O
'CSIDLCOMMONDOCUMENTS NN O O
' '' O O
to TO O O
identify VB O O
the DT O O
destination NN O O
folder NN O O
for IN O O
the DT O O
malicious JJ O O
DLL NNP O O
payload NN O O
. . O O

The DT O O
CSIDL NN O O
in IN O O
this DT O O
case NN O O
pints NNS O O
to TO O O
: : O O
'' '' O O
The DT O O
file NN O O
system NN O O
directory NN O O
that WDT O O
contains VBZ O O
documents NNS O O
that WDT O O
are VBP O O
common JJ O O
to TO O O
all DT O O
users NNS O O
. . O O

A DT O O
typical JJ O O
path NN O O
is VBZ O O
C NN O O
: : O O
\Documents NNS O O
and CC O O
Settings\All FW O O
Users\Documents FW O O
. . O O

'' '' O O
The DT B-Entity 1
dropper NN I-Entity O
attempts VBZ O O
to TO O O
write VB B-Action 2
the DT B-Entity 3
malicious JJ I-Entity O
payload NN I-Entity O
to TO B-Modifier 4
one CD B-Entity 5
of IN I-Entity O
the DT I-Entity O
following JJ I-Entity O
names NNS I-Entity O
, , O O
using VBG B-Modifier 6
the DT B-Entity 7
first JJ I-Entity O
available JJ I-Entity O
name NN I-Entity O
in IN I-Entity O
this DT I-Entity O
set NN I-Entity O
: : O O
The DT B-Entity 8
dropper NN I-Entity O
sets VBZ B-Action 9
the DT B-Entity 10
creation NN I-Entity O
and CC I-Entity O
last JJ I-Entity O
written JJ I-Entity O
timestamp NN I-Entity O
of IN I-Entity O
the DT I-Entity O
newly RB I-Entity O
created VBN I-Entity O
file NN I-Entity O
to TO B-Modifier 11
the DT B-Entity 12
date NN I-Entity O
2007-03-07 CD I-Entity O
00:00:00 CD I-Entity O
; : O O
this DT O O
allows VBZ O O
the DT B-Entity 13
newly RB I-Entity O
created VBN I-Entity O
malicious JJ I-Entity O
DLL NNP I-Entity O
to TO O O
blend VB B-Action 14
in RP I-Action O
with IN B-Modifier 15
other JJ B-Entity 16
system NN I-Entity O
files NNS I-Entity O
. . O O

This DT B-Entity 1
is VBZ O O
meant VBN O O
to TO O O
prevent VB B-Action 2
identification NN B-Entity 3
during IN B-Modifier 4
disk NN B-Entity 5
forensics NNS I-Entity O
using VBG O O
a DT O O
common JJ O O
investigative JJ O O
technique NN O O
called VBD O O
a DT O O
forensic JJ O O
analysis NN O O
timeline NN O O
. . O O

This DT O O
date NN O O
is VBZ O O
specified VBN O O
in IN O O
the DT O O
dropper NN O O
code NN O O
and CC O O
does VBZ O O
not RB O O
change VB O O
across IN O O
multiple JJ O O
infections NNS O O
. . O O

The DT B-Entity 1
malicious JJ I-Entity O
DLL NNP I-Entity O
file NN I-Entity O
that WDT I-Entity O
is VBZ I-Entity O
dropped VBN I-Entity O
is VBZ B-Action 2
hidden VBN I-Action O
in IN B-Modifier 3
a DT B-Entity 4
resource NN I-Entity O
of IN I-Entity O
the DT I-Entity O
dropper NN I-Entity O
binary JJ I-Entity O
. . O O

This DT O O
is VBZ O O
a DT O O
relatively RB O O
common JJ O O
technique NN O O
used VBN O O
by IN O O
malware NN O O
dropper NN O O
files NNS O O
to TO O O
optimize VB O O
the DT O O
number NN O O
of IN O O
files NNS O O
required VBN O O
to TO O O
infect VB O O
a DT O O
machine NN O O
. . O O

The DT O O
resource NN O O
language NN O O
of IN O O
the DT O O
malicious JJ O O
DLL NNP O O
is VBZ O O
set VBN O O
to TO O O
'' '' O O
Chinese NNP O O
( NNP O O
Simplified NNP O O
) NNP O O
'' '' O O
, , O O
this DT O O
is VBZ O O
a DT O O
compiler NN O O
artifact NN O O
which WDT O O
indicates VBZ O O
the DT O O
language NN O O
setting VBG O O
on IN O O
the DT O O
compiler NN O O
used VBN O O
by IN O O
the DT O O
person NN O O
who WP O O
built VBD O O
the DT O O
binary JJ O O
was VBD O O
set VBN O O
to TO O O
'' '' O O
Chinese NNP O O
( NNP O O
Simplified NNP O O
) NNP O O
'' '' O O
at IN O O
the DT O O
time NN O O
the DT O O
dropper NN O O
was VBD O O
compiled VBN O O
. . O O

The DT O O
'MZ NN O O
' POS O O
header NN O O
which WDT O O
denotes VBZ O O
a DT O O
binary JJ O O
executable JJ O O
file NN O O
of IN O O
the DT O O
dropped VBN O O
DLL NNP O O
is VBZ O O
initially RB O O
obfuscated VBN O O
. . O O

When WRB O O
the DT B-Entity 1
dropper NN I-Entity O
writes VBZ B-Action 2
the DT B-Entity 3
file NN I-Entity O
to TO B-Modifier 4
disk NN B-Entity 5
, , O O
the DT B-Entity 6
first JJ I-Entity O
byte NN I-Entity O
of IN I-Entity O
the DT I-Entity O
file NN I-Entity O
is VBZ I-Entity O
'Z NN I-Entity O
' '' I-Entity O
which WDT O O
prevents VBZ B-Action 7
the DT B-Entity 8
file NN I-Entity O
from IN B-Modifier 9
executing VBG O O
or CC O O
being VBG B-Entity 10
detected VBN I-Entity O
as IN I-Entity O
an DT I-Entity O
executable JJ I-Entity O
by IN I-Entity O
many JJ I-Entity O
defensive JJ I-Entity O
tools NNS I-Entity O
. . O O

The DT B-Entity 1
dropper NN I-Entity O
subsequently RB O O
opens VBZ B-Action 2
the DT B-Entity 3
dropped VBN I-Entity O
file NN I-Entity O
and CC O O
corrects VBZ B-Action 4
the DT B-Entity 5
header NN I-Entity O
by IN B-Modifier 6
writing VBG B-Entity 7
the DT I-Entity O
'M VBP I-Entity O
' '' I-Entity O
over IN I-Entity O
the DT I-Entity O
first JJ I-Entity O
byte NN I-Entity O
, , O O
allowing VBG O O
the DT O O
file NN O O
to TO O O
be VB O O
executed VBN O O
. . O O

A DT O O
subroutine NN O O
to TO O O
decompress VB O O
the DT O O
dropped VBN O O
file NN O O
is VBZ O O
present JJ O O
as IN O O
'dead NN O O
code NN O O
' POS O O
( NN O O
code NN O O
that WDT O O
is VBZ O O
not RB O O
used VBN O O
) NN O O
in IN O O
the DT O O
binary JJ O O
. . O O

This DT O O
subroutine NN O O
will MD O O
be VB O O
invoked VBN O O
on IN O O
the DT O O
already RB O O
closed VBN O O
file NN O O
handle VB O O
of IN O O
the DT O O
dropped VBN O O
file NN O O
in IN O O
the DT O O
present JJ O O
code NN O O
version NN O O
. . O O

Since IN O O
the DT O O
dropped VBN O O
resource NN O O
is VBZ O O
not RB O O
compressed VBN O O
, , O O
the DT O O
routine NN O O
fails VBZ O O
. . O O

This DT O O
indicates VBZ O O
a DT O O
low JJ O O
sophistication NN O O
modification NN O O
to TO O O
the DT O O
original JJ O O
dropper NN O O
code NN O O
to TO O O
make VB O O
it PRP O O
work VB O O
with IN O O
an DT O O
uncompressed JJ O O
source NN O O
. . O O

The DT O O
final JJ O O
step NN O O
the DT B-Entity 1
dropper NN I-Entity O
performs VBZ O O
is VBZ O O
to TO O O
load VB B-Action 2
the DT B-Entity 3
dropped VBN I-Entity O
DLL NNP I-Entity O
into IN B-Modifier 4
its PRP$ B-Entity 5
own JJ I-Entity O
process NN I-Entity O
space NN I-Entity O
; : O O
it PRP O O
then RB O O
resolves VBZ O O
the DT O O
export NN O O
'OpenINFOPerformanceData NN O O
' '' O O
from IN O O
the DT O O
DLL NNP O O
and CC O O
invokes VBZ O O
it PRP O O
with IN O O
the DT O O
dropped VBN O O
DLL NNP O O
's POS O O
filename NN O O
as IN O O
parameter NN O O
. . O O

This DT B-Entity 1
export NN I-Entity O
then RB O O
implements VBZ B-Action 2
the DT B-Entity 3
actual JJ I-Entity O
install VBP I-Entity O
logic NN I-Entity O
to TO B-Modifier 4
maintain VB B-Entity 5
persistence NN I-Entity O
and CC O O
invoke VB O O
the DT O O
main JJ O O
routine NN O O
. . O O

The DT O O
dropper NN O O
binary JJ O O
contains VBZ O O
an DT O O
icon NN O O
resource NN O O
that WDT O O
resembles VBZ O O
the DT O O
'Google NNP O O
Chrome NNP O O
' POS O O
browser NN O O
icon NN O O
, , O O
the DT O O
re- NN O O
source NN O O
language NN O O
is VBZ O O
set VBN O O
to TO O O
'' '' O O
Chinese NNP O O
( NNP O O
Simplified NNP O O
) NNP O O
'' '' O O
, , O O
which WDT O O
is VBZ O O
consistent JJ O O
with IN O O
the DT O O
builder NN O O
of IN O O
the DT O O
tool NN O O
systems NNS O O
language NN O O
set VBN O O
to TO O O
Chinese NNP O O
. . O O

The DT B-Entity 1
use NN I-Entity O
of IN I-Entity O
the DT I-Entity O
Chrome NNP I-Entity O
icon NN I-Entity O
may MD O O
indicate VB O O
a DT O O
possible JJ O O
attempt NN O O
to TO O O
socially RB B-Action 2
engineer VB I-Action O
the DT B-Entity 3
intended JJ I-Entity O
victim NN I-Entity O
into IN B-Modifier 4
thinking VBG B-Entity 5
the DT I-Entity O
dropper NN I-Entity O
was VBD I-Entity O
a DT I-Entity O
legitimate JJ I-Entity O
file NN I-Entity O
associated VBN I-Entity O
with IN I-Entity O
Google NNP I-Entity O
. . O O

This DT B-Entity 1
sample NN I-Entity O
is VBZ B-Action 2
a DT B-Entity 3
'backdoor NN I-Entity O
' '' I-Entity O
which WDT O O
is VBZ O O
the DT B-Entity 4
DLL NNP I-Entity O
dropped VBD B-Action 5
by IN O O
the DT B-Entity 6
dropper NN I-Entity O
sample NN I-Entity O
file NN I-Entity O
with IN O O
an DT O O
MD5 NN O O
of IN O O
14c04f88dc97aef3e9b516ef208a2bf5 NN O O
. . O O

This DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Wednesday NNP O O
May NNP O O
4th JJ O O
, , O O
2011 CD O O
at IN O O
10:48:19 CD O O
A.M. NNP O O
UTC NNP O O
( NN O O
equivalent JJ O O
to TO O O
early JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

It PRP O O
is VBZ O O
instantiated VBN O O
when WRB O O
it PRP B-Entity 1
is VBZ B-Action 2
mapped VBN I-Action O
into IN B-Modifier 3
the DT B-Entity 4
process NN I-Entity O
space NN I-Entity O
of IN I-Entity O
its PRP$ I-Entity O
dropped VBN I-Entity O
file NN I-Entity O
, , O O
and CC O O
its PRP$ O O
' POS O O
export NN O O
named VBD O O
'OpenINFOPerformanceData NN O O
' '' O O
is VBZ O O
called VBN O O
. . O O

This DT O O
export NN O O
first RB O O
attempts VBZ O O
to TO O O
stop VB O O
a DT O O
service NN O O
called VBN O O
'' '' O O
msupdate NN O O
'' '' O O
, , O O
which WDT O O
is VBZ O O
not RB O O
a DT O O
known JJ O O
Microsoft NNP O O
Windows NNP O O
service NN O O
despite IN O O
the DT O O
appearance NN O O
. . O O

If IN O O
the DT O O
service NN O O
is VBZ O O
present JJ O O
, , O O
the DT B-Entity 1
malware NN I-Entity O
replaces VBZ B-Action 2
its PRP$ B-Entity 3
previous JJ I-Entity O
instances NNS I-Entity O
or CC I-Entity O
versions NNS I-Entity O
of IN I-Entity O
this DT I-Entity O
backdoor NN I-Entity O
. . O O

After IN O O
attempting VBG O O
to TO O O
disable VB O O
the DT O O
existing VBG O O
service NN O O
, , O O
the DT B-Entity 1
malware NN I-Entity O
tries VBZ O O
to TO O O
install VB B-Action 2
itself PRP B-Entity 3
as IN B-Modifier 4
a DT B-Entity 5
service NN I-Entity O
with IN I-Entity O
that DT I-Entity O
same JJ I-Entity O
name NN I-Entity O
. . O O

During IN O O
installation NN O O
, , O O
the DT B-Entity 1
sample NN I-Entity O
attempts VBZ O O
to TO O O
use VB B-Action 2
documented JJ B-Entity 3
APIs NNS I-Entity O
such JJ I-Entity O
as IN I-Entity O
OpenSCManager NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
and CC I-Entity O
CreateService NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
to TO B-Modifier 4
initialize VB B-Entity 5
itself PRP I-Entity O
as IN I-Entity O
a DT I-Entity O
persistent JJ I-Entity O
Windows NNP I-Entity O
service NN I-Entity O
. . O O

As IN O O
a DT O O
precaution NN O O
, , O O
the DT B-Entity 1
sample NN I-Entity O
writes VBZ B-Action 2
settings NNS B-Entity 3
directly RB B-Modifier 4
to TO I-Modifier O
the DT B-Entity 5
Windows NNP I-Entity O
Registry NNP I-Entity O
to TO O O
accomplish VB O O
the DT O O
same JJ O O
goal NN O O
if IN O O
installing VBG O O
the DT O O
service NN O O
with IN O O
the DT O O
documented VBN O O
APIs NNS O O
fails VBZ O O
. . O O

The DT B-Entity 1
registry NN I-Entity O
change NN I-Entity O
creates VBZ B-Action 2
the DT B-Entity 3
following JJ I-Entity O
key NN I-Entity O
: : O O
Following VBG O O
this DT O O
, , O O
the DT B-Entity 4
subroutine NN I-Entity O
will MD O O
set VB B-Action 5
the DT B-Entity 6
value NN I-Entity O
of IN I-Entity O
the DT I-Entity O
'ServiceDLL NN I-Entity O
' '' I-Entity O
to TO B-Modifier 7
the DT B-Entity 8
module NN I-Entity O
handle VB I-Entity O
of IN I-Entity O
the DT I-Entity O
DLL NNP I-Entity O
. . O O

The DT B-Entity 1
next JJ I-Entity O
key NN I-Entity O
to TO O O
be VB B-Action 2
changed VBN I-Action O
is VBZ O O
: : O O
HKEYLOCALMACHINE\\SOFTWARE\\Microsoft\\Windows FW O O
NT\\CurrentVersion\\Svchost FW O O
, , O O
which WDT O O
will MD O O
have VB O O
the DT B-Entity 3
'msupdate NN I-Entity O
' POS I-Entity O
key JJ I-Entity O
set NN B-Action 4
to TO B-Modifier 5
'msupdate NN B-Entity 6
' '' I-Entity O
. . O O

The DT B-Entity 1
export NN I-Entity O
'CollectW3PerfData NN I-Entity O
' '' I-Entity O
is VBZ B-Action 2
registered VBN I-Action O
as IN B-Modifier 3
the DT B-Entity 4
main JJ I-Entity O
function NN I-Entity O
of IN I-Entity O
the DT I-Entity O
DLL NNP I-Entity O
. . O O

If IN O O
the DT O O
installation NN O O
of IN O O
the DT O O
new JJ O O
service NN O O
is VBZ O O
successful JJ O O
, , O O
the DT B-Entity 1
sample NN I-Entity O
then RB O O
starts VBZ B-Action 2
the DT B-Entity 3
new JJ I-Entity O
service NN I-Entity O
and CC O O
exits NNS O O
. . O O

If IN O O
the DT O O
installation NN O O
fails VBZ O O
, , O O
the DT B-Entity 1
sample NN I-Entity O
spawns VBZ B-Action 2
a DT B-Entity 3
new JJ I-Entity O
process NN I-Entity O
using VBG B-Modifier 4
rundll32.exe NN B-Entity 5
, , O O
this DT O O
executable JJ O O
will MD O O
instantiate VB O O
the DT O O
DLL NNP O O
and CC O O
can MD O O
call VB O O
a DT O O
specific JJ O O
exported VBN O O
function NN O O
. . O O

In IN O O
the DT O O
case NN O O
of IN O O
installation NN O O
failure NN O O
, , O O
rundll32.exe NN O O
calls VBZ O O
the DT O O
main JJ O O
functions NNS O O
export NN O O
'CollectW3PerfData NN O O
' '' O O
. . O O

The DT O O
rundll32.exe NN O O
is VBZ O O
instantiated VBN O O
with IN O O
a DT O O
new JJ O O
NULL NNP O O
Security NNP O O
Identifier NNP O O
( FW O O
SID FW O O
) FW O O
( FW O O
S-1-0-0 FW O O
) FW O O
with IN O O
permissions NNS B-Entity 1
set VBN B-Action 2
to TO B-Modifier 3
grant VB B-Entity 4
all DT I-Entity O
access NN I-Entity O
to TO I-Entity O
the DT I-Entity O
file NN I-Entity O
. . O O

This DT B-Entity 1
allows VBZ B-Action 2
any DT B-Entity 3
user NN I-Entity O
to TO B-Modifier 4
have VB B-Entity 5
complete JJ I-Entity O
control NN I-Entity O
over IN I-Entity O
the DT I-Entity O
machine NN I-Entity O
, , O O
as IN O O
rundll32.exe NN O O
is VBZ O O
frequently RB O O
launched VBN O O
by IN O O
tasks NNS O O
such JJ O O
as IN O O
changing VBG O O
the DT O O
time NN O O
, , O O
wallpaper NN O O
, , O O
or CC O O
other JJ O O
system NN O O
settings NNS O O
. . O O

This DT O O
means VBZ O O
that IN O O
after IN O O
cleaning VBG B-Action 1
up RP I-Action O
the DT B-Entity 2
components NNS I-Entity O
dropped VBN I-Entity O
by IN I-Entity O
the DT I-Entity O
malware NN I-Entity O
, , O O
the DT B-Entity 3
system NN I-Entity O
remains VBZ B-Action 4
vulnerable JJ B-Entity 5
to TO I-Entity O
local JJ I-Entity O
attacks NNS I-Entity O
by IN O O
simply RB O O
overwriting VBG O O
the DT O O
legitimate JJ O O
rundll32.exe NN O O
executable JJ O O
with IN O O
a DT O O
malicious JJ O O
version NN O O
and CC O O
await VB O O
it PRP O O
's POS O O
automatic JJ O O
execution NN O O
by IN O O
the DT O O
Operating NNP O O
System NNP O O
. . O O

The DT O O
main JJ O O
entry NN O O
point NN O O
to TO O O
the DT O O
DLL NNP O O
is VBZ O O
named VBN O O
'CollectW3PerfData NN O O
' '' O O
, , O O
as IN O O
it PRP O O
first RB O O
creates VBZ O O
and CC O O
displays VBZ O O
a DT O O
fake JJ O O
Window NN O O
with IN O O
class NN O O
'' '' O O
NOD32 CD O O
% NN O O
d NN O O
'' '' O O
where WRB O O
% NN O O
d NN O O
is VBZ O O
replaced VBN O O
with IN O O
a DT O O
pseudo-random JJ O O
number NN O O
. . O O

This DT O O
may MD O O
be VB O O
an DT O O
attempt NN O O
to TO O O
fool VB B-Action 1
some DT B-Entity 2
automated JJ I-Entity O
dynamic JJ I-Entity O
analysis NN I-Entity O
or CC I-Entity O
anti-malware JJ I-Entity O
software NN I-Entity O
into IN B-Modifier 3
believing VBG B-Entity 4
this DT I-Entity O
is VBZ I-Entity O
the DT I-Entity O
legitimate JJ I-Entity O
ESET NN I-Entity O
AV NN I-Entity O
software NN I-Entity O
. . O O

The DT O O
window NN O O
is VBZ O O
however RB O O
not RB O O
visible JJ O O
and CC O O
implements VBZ O O
no DT O O
specific JJ O O
functionality NN O O
. . O O

After IN O O
creating VBG O O
this DT O O
window NN O O
, , O O
the DT B-Entity 1
routine NN I-Entity O
starts VBZ O O
the DT O O
main JJ O O
thread NN O O
that WDT O O
eventually RB O O
initiates VBZ B-Action 2
calling VBG B-Entity 3
out RP I-Entity O
to TO I-Entity O
the DT I-Entity O
Command NN I-Entity O
and CC I-Entity O
Control NN I-Entity O
( NN I-Entity O
C2 NN I-Entity O
) NN I-Entity O
. . O O

In IN O O
order NN O O
to TO O O
accomplish VB O O
this DT O O
task NN O O
, , O O
the DT O O
newly RB O O
created VBN O O
thread NN O O
initializes NNS O O
networking VBG O O
APIs NNS O O
using VBG O O
WSAStartup NN O O
( FW O O
) FW O O
and CC O O
resolves VBZ O O
some DT O O
other JJ O O
APIs NNS O O
dynamically RB O O
using VBG O O
LoadLibrary NNP O O
( NNP O O
) NNP O O
and CC O O
GetProcAddress NNP O O
( NNP O O
) NNP O O
. . O O

Once RB O O
the DT O O
proper JJ O O
API NNP O O
's POS O O
have VBP O O
been VBN O O
resolved VBN O O
, , O O
the DT O O
sample NN O O
then RB O O
assigns VBZ O O
a DT O O
NULL NNP O O
SID NNP O O
to TO O O
the DT O O
rundll32.exe NN O O
executable JJ O O
and CC O O
sets VBZ O O
the DT O O
current JJ O O
process NN O O
' '' O O
Window NNP O O
Station NNP O O
to TO O O
'' '' O O
winsta0 NN O O
'' '' O O
, , O O
which WDT O O
enables VBZ O O
the DT B-Entity 1
sample NN I-Entity O
to TO O O
access VB B-Action 2
the DT B-Entity 3
real JJ I-Entity O
user NN I-Entity O
's POS I-Entity O
desktop NN I-Entity O
if IN B-Modifier 4
started VBN B-Entity 5
as IN I-Entity O
service NN I-Entity O
. . O O

The DT B-Entity 1
communication NN I-Entity O
to TO I-Entity O
the DT I-Entity O
C2 NN I-Entity O
is VBZ B-Action 2
handled VBN I-Action O
by IN B-Modifier 3
a DT B-Entity 4
while NN I-Entity O
( FW I-Entity O
) FW I-Entity O
loop NN I-Entity O
, , O O
with IN O O
each DT O O
successive JJ O O
connection NN O O
attempt NN O O
causing VBG O O
the DT O O
loop NN O O
to TO O O
invoke VB O O
the DT O O
Windows NNP O O
Sleep NNP O O
( NNP O O
) NNP O O
API NNP O O
for IN O O
a DT O O
time NN O O
interval NN O O
of IN O O
2 CD O O
seconds NNS O O
, , O O
exponentially RB O O
increasing VBG O O
in IN O O
length NN O O
up IN O O
to TO O O
1024 CD O O
seconds NNS O O
( CD O O
17 CD O O
minutes NNS O O
) NN O O
and CC O O
then RB O O
restarting VBG O O
back RB O O
to TO O O
2 CD O O
seconds NNS O O
. . O O

The DT O O
C2 NN O O
location NN O O
in IN O O
this DT O O
sample NN O O
is VBZ O O
statically RB O O
defined VBN O O
as IN O O
1.9.5.38:443 NNP O O
( NNP O O
Malaysia NNP O O
: : O O
Tmnet NNP O O
, , O O
Telekom NNP O O
Malaysia NNP O O
Bhd NNP O O
) NNP O O
. . O O

While IN O O
ther NN O O
is VBZ O O
'dead JJ O O
code NN O O
' '' O O
that WDT O O
will MD O O
download VB O O
the DT O O
C2 NN O O
location NN O O
from IN O O
an DT O O
HTTP NN O O
URL NN O O
that WDT O O
could MD O O
be VB O O
defined VBN O O
in IN O O
the DT O O
binary JJ O O
, , O O
using VBG O O
the DT O O
User-Agent JJ O O
string NN O O
'' '' O O
Google NNP O O
'' '' O O
, , O O
this DT O O
code NN O O
is VBZ O O
not RB O O
activated VBN O O
due JJ O O
to TO O O
the DT O O
format NN O O
of IN O O
the DT O O
stat- NN O O
ically RB O O
defined VBN O O
C2 NN O O
location NN O O
using VBG O O
an DT O O
IP NNP O O
address NN O O
. . O O

Thus RB O O
the DT B-Entity 1
sample NN I-Entity O
will MD O O
only RB O O
attempt VB O O
to TO O O
connect VB B-Action 2
directly RB O O
using VBG B-Modifier 3
a DT B-Entity 4
raw JJ I-Entity O
socket NN I-Entity O
to TO B-Modifier 5
the DT B-Entity 6
C2 NN I-Entity O
located JJ I-Entity O
at IN I-Entity O
1.9.5.38:443 CD I-Entity O
. . O O

This DT O O
indicates VBZ O O
the DT O O
use NN O O
of IN O O
a DT O O
'boiler NN O O
plate NN O O
code NN O O
' '' O O
or CC O O
a DT O O
builder NN O O
software NN O O
package NN O O
that WDT O O
automates VBZ O O
the DT O O
creation NN O O
of IN O O
the DT O O
malicious JJ O O
sample NN O O
. . O O

The DT B-Entity 1
malicious JJ I-Entity O
sample NN I-Entity O
sends VBZ B-Action 2
an DT B-Entity 3
initial JJ I-Entity O
beacon NN I-Entity O
to TO B-Modifier 4
the DT B-Entity 5
C2 NN I-Entity O
that WDT O O
includes VBZ O O
the DT O O
following JJ O O
information NN O O
: : O O
The DT B-Entity 6
beacon NN I-Entity O
is VBZ B-Action 7
encrypted VBN I-Action O
using VBG B-Modifier 8
an DT B-Entity 9
XOR/ADD NN I-Entity O
loop NN I-Entity O
using VBG I-Entity O
the DT I-Entity O
statically RB I-Entity O
defined VBN I-Entity O
key JJ I-Entity O
0x1C NN I-Entity O
and CC O O
sent VBN B-Action 10
to TO B-Modifier 11
the DT B-Entity 12
C2 NN I-Entity O
. . O O

The DT O O
following VBG O O
python NN O O
function NN O O
can MD O O
be VB O O
used VBN O O
to TO O O
decode VB O O
the DT O O
beacon NN O O
stings VBZ O O
: : O O
After IN O O
sending VBG B-Action 1
the DT B-Entity 2
initial JJ I-Entity O
beacon NN I-Entity O
, , O O
the DT B-Entity 3
routine JJ I-Entity O
loops NNS O O
receiving VBG B-Action 4
incoming JJ B-Entity 5
commands NNS I-Entity O
and CC O O
executes VBZ B-Action 6
them PRP B-Entity 7
in IN O O
sequence NN O O
. . O O

When WRB O O
a DT O O
connection NN O O
can MD O O
successfully RB O O
be VB O O
established VBN O O
to TO O O
the DT O O
C2 NN O O
server NN O O
, , O O
the DT O O
sleep NN O O
timer NN O O
is VBZ O O
reset JJ O O
to TO O O
two CD O O
seconds NNS O O
for IN O O
the DT O O
next JJ O O
attempt NN O O
. . O O

The DT O O
network NN O O
protocol NN O O
used VBN O O
by IN O O
this DT O O
sample NN O O
resembles VBZ O O
a DT O O
'Type-Length-Value NN O O
' POS O O
layout NN O O
in IN O O
both DT O O
directions NNS O O
. . O O

Each DT O O
16 CD O O
byte NN O O
request NN O O
header NN O O
consists VBZ O O
of IN O O
: : O O
Zero NNP O O
or CC O O
more JJR O O
of IN O O
specified JJ O O
bytes NNS O O
of IN O O
additional JJ O O
payload NN O O
then RB O O
follows VBZ O O
the DT O O
header NN O O
. . O O

This DT B-Entity 1
inbound JJ I-Entity O
payload NN I-Entity O
is VBZ B-Action 2
received VBN I-Action O
unconditionally RB O O
and CC O O
regardless RB O O
of IN O O
command NN O O
type NN O O
into IN O O
a DT O O
fixed-size NN O O
stack VB O O
buffer NN O O
of IN O O
408 CD O O
bytes NNS O O
size NN O O
. . O O

Providing VBG O O
additional JJ O O
payload NN O O
of IN O O
any DT O O
larger JJR O O
size NN O O
will MD O O
result VB O O
in IN O O
a DT O O
trivial JJ O O
exploitable JJ O O
stack VBP O O
buffer NN O O
overflow NN O O
that WDT O O
allows VBZ O O
arbitrary JJ O O
code NN O O
execution NN O O
due JJ O O
to TO O O
the DT O O
absence NN O O
of IN O O
any DT O O
security NN O O
features NNS O O
. . O O

However RB O O
, , O O
exploitation NN O O
of IN O O
this DT O O
vulnerability NN O O
is VBZ O O
unnecessary JJ O O
due JJ O O
to TO O O
the DT O O
already RB O O
available JJ O O
unauthenticated JJ O O
command NN O O
execution NN O O
capabilities NNS O O
of IN O O
this DT O O
backdoor NN O O
. . O O

Certain JJ O O
commands NNS O O
initiate VBP O O
a DT O O
second JJ O O
connection NN O O
to TO O O
the DT O O
C2 NN O O
in IN O O
a DT O O
separate JJ O O
thread NN O O
using VBG O O
the DT O O
same JJ O O
network NN O O
protocol NN O O
but CC O O
providing VBG O O
a DT O O
different JJ O O
request NN O O
command NN O O
identifier NN O O
than IN O O
for IN O O
the DT O O
initial JJ O O
beacon NN O O
. . O O

The DT B-Entity 1
primary JJ I-Entity O
aim NN I-Entity O
of IN I-Entity O
this DT I-Entity O
backdoor NN I-Entity O
is VBZ B-Action 2
remote JJ B-Entity 3
desktop NN I-Entity O
control NN I-Entity O
functionality NN I-Entity O
comparable JJ I-Entity O
to TO I-Entity O
VNC NNP I-Entity O
or CC I-Entity O
Remote NNP I-Entity O
Desktop NNP I-Entity O
over IN I-Entity O
a DT I-Entity O
custom NN I-Entity O
protocol NN I-Entity O
. . O O

It PRP O O
allows VBZ O O
the DT B-Entity 1
adversary NN I-Entity O
to TO O O
view VB B-Action 2
the DT B-Entity 3
main JJ I-Entity O
desktop NN I-Entity O
graphically RB B-Entity 4
and CC O O
control VBP B-Action 5
the DT B-Entity 6
keyboard NN I-Entity O
and CC O O
mouse NN B-Entity 7
. . O O

This DT B-Entity 1
remote JJ I-Entity O
control NN I-Entity O
functionality NN I-Entity O
is VBZ B-Action 2
implemented VBN I-Action O
as IN B-Modifier 3
separate JJ B-Entity 4
messages NNS I-Entity O
for IN I-Entity O
mouse NN I-Entity O
clicks NNS I-Entity O
, , I-Entity O
pressed VBN I-Entity O
keys NNS I-Entity O
, , I-Entity O
etc FW I-Entity O
. . I-Entity O

using VBG B-Modifier 1
command NN B-Entity 2
identifiers NNS I-Entity O
0x20000002 CD I-Entity O
to TO I-Entity O
0x20000019 CD I-Entity O
. . O O

The DT B-Entity 1
command NN I-Entity O
0x22000001 NN I-Entity O
initiates VBZ B-Action 2
continuous JJ B-Entity 3
transmission NN I-Entity O
of IN I-Entity O
screen NN I-Entity O
captures VBZ I-Entity O
to TO I-Entity O
the DT I-Entity O
C2 NN I-Entity O
. . O O

The DT B-Entity 1
screen NN I-Entity O
captures VBZ I-Entity O
are VBP B-Action 2
created VBN I-Action O
using VBG B-Modifier 3
a DT B-Entity 4
series NN I-Entity O
of IN I-Entity O
Microsoft NNP I-Entity O
Windows NNP I-Entity O
Graphic NNP I-Entity O
Device NNP I-Entity O
Interface NNP I-Entity O
( NNP I-Entity O
GDI NNP I-Entity O
) NNP I-Entity O
API NNP I-Entity O
calls VBZ I-Entity O
culminating VBG I-Entity O
in IN I-Entity O
a DT I-Entity O
call NN I-Entity O
to TO I-Entity O
GetDIBits NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
. . O O

Command NN O O
0x20000001 NN O O
exits NNS O O
the DT O O
backdoor NN O O
and CC O O
0x20000000 NN B-Entity 1
is VBZ O O
issued VBN O O
to TO O O
completely RB O O
remove VB B-Action 2
the DT B-Entity 3
backdoor NN I-Entity O
from IN B-Modifier 4
the DT B-Entity 5
system NN I-Entity O
. . O O

When WRB O O
command NN O O
0x23000004 NN O O
is VBZ O O
received VBN O O
, , O O
a DT B-Entity 1
temporary JJ I-Entity O
new JJ I-Entity O
user NN I-Entity O
'' '' I-Entity O
DomainUser NN I-Entity O
'' '' I-Entity O
with IN I-Entity O
password NN I-Entity O
'' '' I-Entity O
Dom4 NN I-Entity O
! . I-Entity O
nU- FW I-Entity O
serP4ss FW I-Entity O
'' '' I-Entity O
is VBZ B-Action 2
created VBN I-Action O
and CC O O
added VBN B-Action 3
to TO B-Modifier 4
the DT B-Entity 5
local JJ I-Entity O
Administrators NNPS I-Entity O
group NN I-Entity O
. . O O

The DT B-Entity 1
backdoor NN I-Entity O
is VBZ B-Action 2
then RB I-Action O
started VBN I-Action O
under IN B-Modifier 3
that DT B-Entity 4
account NN I-Entity O
and CC O O
the DT B-Entity 5
user NN I-Entity O
is VBZ B-Action 6
deleted VBN I-Action O
. . O O

It PRP O O
would MD O O
appear VB O O
this DT B-Entity 1
technique NN I-Entity O
is VBZ O O
meant VBN O O
to TO O O
obfuscate VB B-Action 2
the DT B-Entity 3
activities NNS I-Entity O
of IN I-Entity O
the DT I-Entity O
malicious JJ I-Entity O
sample NN I-Entity O
by IN B-Modifier 4
masking VBG B-Entity 5
the DT I-Entity O
process NN I-Entity O
creator NN I-Entity O
's POS I-Entity O
user NN I-Entity O
name NN I-Entity O
to TO I-Entity O
appear VB I-Entity O
to TO I-Entity O
be VB I-Entity O
a DT I-Entity O
generic JJ I-Entity O
domain NN I-Entity O
user NN I-Entity O
. . O O

Note VB O O
that IN O O
such PDT O O
an DT O O
account NN O O
does VBZ O O
not RB O O
normally RB O O
exist VB O O
in IN O O
an DT O O
Active JJ O O
Directory NNP O O
environment NN O O
. . O O

Additionally RB O O
, , O O
the DT O O
primary JJ O O
C2 NN O O
connection NN O O
allows VBZ O O
for IN O O
requests NNS O O
to TO O O
start VB O O
additional JJ O O
connections NNS O O
to TO O O
the DT O O
C2 NN O O
imple- NN O O
menting VBG O O
the DT O O
following JJ O O
functionality NN O O
: : O O
This DT O O
sample NN O O
is VBZ O O
typical JJ O O
of IN O O
a DT O O
post NN O O
exploitation NN O O
tool NN O O
; : O O
it PRP O O
is VBZ O O
written VBN O O
in IN O O
.NET NN O O

2.0 CD O O
. . O O

This DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Thursday NNP O O
May NNP O O
26th JJ O O
, , O O
2011 CD O O
at IN O O
10:21:44 CD O O
A.M. NNP O O
UTC NNP O O
( NNP O O
early JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

The DT O O
backdoor JJ O O
functionality NN O O
can MD O O
be VB O O
instantiated VBN O O
either CC O O
directly RB O O
from IN O O
the DT O O
command NN O O
line NN O O
or CC O O
through IN O O
commands NNS B-Entity 1
issued VBN B-Action 2
over IN B-Modifier 3
a DT B-Entity 4
network NN I-Entity O
based JJ I-Entity O
protocol NN I-Entity O
via IN B-Modifier 5
the DT B-Entity 6
C2 NN I-Entity O
. . O O

If IN O O
no DT O O
arguments NNS O O
are VBP O O
given VBN O O
, , O O
a DT B-Entity 1
connection NN I-Entity O
to TO I-Entity O
the DT I-Entity O
C2 NN I-Entity O
is VBZ B-Action 2
initiated VBN I-Action O
to TO B-Modifier 3
the DT B-Entity 4
stati- NN I-Entity O
cally RB I-Entity O
defined VBN I-Entity O
IP NNP I-Entity O
address NN I-Entity O
. . O O

The DT B-Entity 1
command NN I-Entity O
line NN I-Entity O
options NNS I-Entity O
support VBP B-Action 2
post NN O O
exploitation NN O O
capabilities NNS O O
such JJ O O
as IN O O
changing VBG B-Entity 3
file NN I-Entity O
timestamps NNS I-Entity O
, , O O
forensic JJ B-Entity 4
mitigation NN I-Entity O
, , O O
privilege NN B-Entity 5
escalation NN I-Entity O
, , O O
launching VBG B-Entity 6
the DT I-Entity O
executable JJ I-Entity O
, , O O
and CC O O
specifying VBG B-Entity 7
a DT I-Entity O
specific JJ I-Entity O
C2 NN I-Entity O
. . O O

One CD O O
interesting JJ O O
command NN O O
line NN O O
option NN O O
allows VBZ O O
the DT B-Entity 1
backdoor NN I-Entity O
to TO O O
filter NN B-Action 2
the DT B-Entity 3
contents NNS I-Entity O
of IN I-Entity O
specified JJ I-Entity O
files NNS I-Entity O
to TO O O
remove VB B-Action 4
content NN B-Entity 5
using VBG B-Modifier 6
a DT B-Entity 7
regular JJ I-Entity O
expression NN I-Entity O
( NN I-Entity O
regex NN I-Entity O
) NN I-Entity O
. . O O

This DT B-Entity 1
command NN I-Entity O
then RB O O
modifies VBZ B-Action 2
the DT B-Entity 3
creation NN I-Entity O
, , I-Entity O
modification NN I-Entity O
, , I-Entity O
and CC I-Entity O
last JJ I-Entity O
access NN I-Entity O
timestamps NNS I-Entity O
of IN I-Entity O
the DT I-Entity O
modified VBN I-Entity O
file NN I-Entity O
to TO B-Modifier 4
conceal VB B-Entity 5
the DT I-Entity O
content NN I-Entity O
modifications NNS I-Entity O
. . O O

A DT O O
detailed JJ O O
listing NN O O
of IN O O
command NN O O
line NN O O
arguments NNS O O
can MD O O
be VB O O
viewed VBN O O
in IN O O
Appendix NN O O
A NN O O
. . O O

This DT B-Entity 1
activity NN I-Entity O
is VBZ B-Action 2
generally RB I-Action O
associated VBN I-Action O
with IN B-Modifier 3
log NN B-Entity 4
cleaning NN I-Entity O
to TO I-Entity O
com- FW I-Entity O
plicate FW I-Entity O
a DT I-Entity O
forensic JJ I-Entity O
investigation NN I-Entity O
. . O O

The DT O O
sample NN O O
contains VBZ O O
an DT O O
embedded JJ O O
IP NNP O O
address NN O O
for IN O O
C2 NN O O
that WDT O O
is VBZ O O
stored VBN O O
in IN O O
an DT O O
encrypted JJ O O
format NN O O
as IN O O
a DT O O
string NN O O
re- NN O O
source NN O O
: : O O
The DT O O
first JJ O O
two CD O O
bytes NNS O O
of IN O O
this DT O O
string NN O O
represent VBP O O
the DT O O
base NN O O
16 CD O O
length NN O O
of IN O O
the DT O O
encrypted JJ O O
string NN O O
, , O O
in IN O O
this DT O O
case NN O O
, , O O
'' '' O O
0x14 NN O O
'' '' O O
. . O O

Following VBG O O
this DT O O
is VBZ O O
a DT O O
base64 NN O O
encoded VBN O O
string NN O O
of IN O O
the DT O O
specified VBN O O
length NN O O
. . O O

Once RB O O
this DT O O
string NN O O
has VBZ O O
been VBN O O
decoded VBN O O
using VBG O O
base64 NN O O
, , O O
the DT O O
result NN O O
is VBZ O O
then RB O O
XOR NNP O O
'd NNP O O
with IN O O
the DT O O
fixed JJ O O
value NN O O
of IN O O
0xAA NN O O
yielding VBG O O
the DT O O
decoded VBN O O
IP NNP O O
address NN O O
202.86.190.3:80 NNP O O
( NNP O O
Hong NNP O O
Kong NNP O O
: : O O
TeleOne NNP O O
( NNP O O
HK NNP O O
) NNP O O
Limited NNP O O
) NNP O O
. . O O

There EX O O
are VBP O O
three CD O O
components NNS O O
to TO O O
the DT O O
protocol NN O O
: : O O
Authentication NN B-Entity 1
is VBZ B-Action 2
accomplished VBN I-Action O
using VBG B-Modifier 3
a DT B-Entity 4
32 CD I-Entity O
byte NN I-Entity O
packet NN I-Entity O
, , O O
this DT O O
packet NN O O
consists VBZ O O
of IN O O
: : O O
An DT B-Entity 5
example NN I-Entity O
authentication NN I-Entity O
packet NN I-Entity O
sent VBN B-Action 6
to TO B-Modifier 7
the DT B-Entity 8
C2 NN I-Entity O
is VBZ O O
located JJ O O
in IN O O
Appendix NNP O O
E. NNP O O
After IN O O
sending VBG B-Action 9
the DT B-Entity 10
initial JJ I-Entity O
authentication NN I-Entity O
packet NN I-Entity O
, , O O
the DT B-Entity 11
sample NN I-Entity O
verifies VBZ B-Action 12
that IN B-Modifier 13
the DT B-Entity 14
first JJ I-Entity O
four CD I-Entity O
bytes NNS I-Entity O
of IN I-Entity O
the DT I-Entity O
response NN I-Entity O
is VBZ I-Entity O
equal JJ I-Entity O
to TO I-Entity O
a DT I-Entity O
statically RB I-Entity O
defined VBN I-Entity O
value NN I-Entity O
, , O O
in IN O O
this DT O O
sample NN O O
the DT O O
value NN O O
is VBZ O O
: : O O
0x16030100 NN O O
. . O O

In IN O O
addition NN O O
, , O O
an DT B-Entity 1
8 CD I-Entity O
byte NN I-Entity O
key NN I-Entity O
is VBZ B-Action 2
sent VBN I-Action O
to TO B-Modifier 3
the DT B-Entity 4
client NN I-Entity O
which WDT O O
is VBZ O O
then RB O O
RC4 NN O O
encrypted VBD O O
using VBG O O
the DT O O
random JJ O O
number NN O O
generated VBN O O
in IN O O
step NN O O
2 CD O O
from IN O O
above RB O O
as IN O O
the DT O O
password NN O O
. . O O

This DT O O
value NN O O
is VBZ O O
then RB O O
transformed VBN O O
using VBG O O
a DT O O
simple JJ O O
algorithm NN O O
in IN O O
Appendix NN O O
F NN O O
into IN O O
a DT O O
32 CD O O
byte NN O O
array NN O O
. . O O

The DT O O
first JJ O O
16 CD O O
bytes NNS O O
of IN O O
this DT O O
array NN O O
are VBP O O
then RB O O
used VBN O O
as IN O O
the DT O O
KEY NNP O O
and CC O O
the DT O O
second JJ O O
16 CD O O
bytes NNS O O
are VBP O O
used VBN O O
as IN O O
the DT O O
IV NNP O O
for IN O O
setting VBG O O
up RP O O
AES NN B-Entity 1
encryption NN I-Entity O
which WDT O O
is VBZ O O
then RB O O
used VBN O O
to TO O O
encrypt VB B-Action 2
and CC I-Action O
decrypt VB I-Action O
any DT B-Entity 3
further JJ I-Entity O
communications NNS I-Entity O
. . O O

Beacon NNP O O
, , O O
this DT O O
is VBZ O O
typical JJ O O
of IN O O
this DT O O
type NN O O
of IN O O
malicious JJ O O
sample NN O O
, , O O
it PRP O O
allows VBZ O O
the DT O O
operator NN O O
to TO O O
separate VB O O
various JJ O O
infected JJ O O
hosts NNS O O
in IN O O
a DT O O
targeted VBN O O
campaign NN O O
. . O O

The DT O O
beacon NN O O
for IN O O
this DT O O
sample NN O O
is VBZ O O
formatted VBN O O
as IN O O
XML NN O O
and CC O O
consists VBZ O O
of IN O O
: : O O
An DT O O
example NN O O
of IN O O
an DT O O
unencrypted JJ O O
beacon NN O O
: : O O
Command NN B-Entity 1
handling NN I-Entity O
loop NN I-Entity O
, , O O
this DT O O
is VBZ O O
a DT O O
loop NN O O
structure NN O O
that WDT O O
will MD O O
process VB B-Action 2
and CC I-Action O
execute VB I-Action O
commands NNS B-Entity 3
sent VBN I-Entity O
by IN I-Entity O
the DT I-Entity O
C2 NN I-Entity O
. . O O

The DT B-Entity 1
malware NN I-Entity O
sends VBZ B-Action 2
and CC O O
receives VBZ B-Action 3
a DT B-Entity 4
heartbeat/keepalive JJ I-Entity O
packet NN I-Entity O
every DT B-Modifier 5
2 CD B-Entity 6
minutes NNS I-Entity O
. . O O

The DT O O
command NN O O
format NN O O
is VBZ O O
derived VBN O O
from IN O O
a DT O O
structure NN O O
consisting VBG O O
of IN O O
: : O O
These DT O O
fields NNS O O
are VBP O O
received VBN O O
as IN O O
a DT O O
sequence NN O O
of IN O O
serialized FW O O
.NET FW O O

objects NNS O O
in IN O O
the DT O O
order NN O O
specified VBN O O
. . O O

A DT O O
detailed JJ O O
description NN O O
of IN O O
the DT O O
possible JJ O O
values NNS O O
for IN O O
commands NNS O O
is VBZ O O
in IN O O
Appendix NNP O O
D. NNP O O
It PRP O O
is VBZ O O
important JJ O O
to TO O O
note VB O O
that IN O O
the DT O O
order NN O O
in IN O O
which WDT O O
the DT O O
application NN O O
defines VBZ O O
them PRP O O
is VBZ O O
not RB O O
the DT O O
same JJ O O
order NN O O
as IN O O
they PRP O O
appear VBP O O
to TO O O
be VB O O
coming VBG O O
over IN O O
the DT O O
network NN O O
. . O O

Examples NNS O O
of IN O O
implemented VBN O O
commands NNS O O
include VBP O O
download NN B-Action 1
and CC O O
upload NN B-Action 2
files NNS B-Entity 3
, , O O
installing VBG B-Action 4
new JJ B-Entity 5
.NET NNP I-Entity O
assemblies NNS I-Entity O
, , O O
calling VBG B-Action 6
methods NNS B-Entity 7
on IN B-Modifier 8
those DT B-Entity 9
assemblies NNS I-Entity O
, , O O
connecting VBG B-Action 10
to TO B-Modifier 11
new JJ B-Entity 12
C2 NN I-Entity O
servers NNS I-Entity O
and CC O O
executing VBG B-Action 13
processes NNS B-Entity 14
. . O O

This DT B-Entity 1
sample NN I-Entity O
is VBZ B-Action 2
a DT B-Entity 3
sophisticated JJ I-Entity O
backdoor NN I-Entity O
which WDT O O
implements VBZ B-Action 4
several JJ B-Entity 5
communications NNS I-Entity O
protocols NNS I-Entity O
and CC O O
was VBD O O
developed VBN O O
in IN O O
C++ NNP O O
. . O O

This DT O O
binary JJ O O
is VBZ O O
compiled VBN O O
with IN O O
the DT O O
/GS NN O O
flag NN O O
using VBG O O
Visual JJ O O
Studio NN O O
2010 CD O O
, , O O
enabling VBG O O
stack VBP O O
buffer NN O O
overflow NN O O
detection NN O O
. . O O

This DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Sunday NNP O O
October NNP O O
30 CD O O
, , O O
2011 CD O O
at IN O O
12:43:33 CD O O
P.M. NNP O O
UTC NNP O O
( NNP O O
late JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

The DT O O
code NN O O
contains VBZ O O
several JJ O O
Run NNP O O
Time NNP O O
Type NN O O
Information NNP O O
( NNP O O
RTTI NNP O O
) NN O O
artifacts NNS O O
that WDT O O
indicate VBP O O
most JJS O O
of IN O O
the DT O O
C++ NNP O O
class NN O O
names NNS O O
were VBD O O
prefixed VBN O O
with IN O O
the DT O O
string NN O O
'' '' O O
PCC NN O O
'' '' O O
in IN O O
the DT O O
original JJ O O
source NN O O
code NN O O
. . O O

Variants NNS O O
of IN O O
this DT O O
Trojan NNP O O
are VBP O O
sometimes RB O O
detected VBN O O
under IN O O
the DT O O
name NN O O
'Derusbi NN O O
' '' O O
by IN O O
Microsoft NNP O O
, , O O
Trend NNP O O
, , O O
Sophos NNP O O
and CC O O
Symantec NNP O O
AV NNP O O
engines NNS O O
. . O O

This DT B-Entity 1
sample NN I-Entity O
is VBZ O O
a DT B-Entity 2
DLL NN I-Entity O
which WDT O O
can MD O O
be VB B-Action 3
registered VBN I-Action O
as IN B-Modifier 4
a DT B-Entity 5
service NN I-Entity O
and CC O O
is VBZ O O
used VBN O O
to TO O O
drop VB B-Action 6
a DT B-Entity 7
kernel NN I-Entity O
driver NN I-Entity O
and CC O O
provide VB B-Action 8
an DT B-Entity 9
interactive JJ I-Entity O
command NN I-Entity O
line NN I-Entity O
shell NN I-Entity O
to TO B-Modifier 10
the DT B-Entity 11
C2 NN I-Entity O
. . O O

It PRP B-Entity 1
also RB O O
is VBZ O O
able JJ O O
to TO O O
bypass VB B-Action 2
User NN B-Entity 3
Account NNP I-Entity O
Control NNP I-Entity O
( NNP I-Entity O
UAC NNP I-Entity O
) NNP I-Entity O
to TO B-Modifier 4
install VB B-Entity 5
itself PRP I-Entity O
by IN I-Entity O
using VBG I-Entity O
the DT I-Entity O
'sysprep.exe NN I-Entity O
' '' I-Entity O
Microsoft NNP I-Entity O
Windows NNP I-Entity O
executable JJ I-Entity O
provided VBN I-Entity O
by IN I-Entity O
the DT I-Entity O
targeted VBN I-Entity O
system NN I-Entity O
. . O O

The DT O O
steps NNS O O
it PRP O O
takes VBZ O O
to TO O O
install VB O O
itself PRP O O
onto IN O O
a DT O O
system NN O O
are VBP O O
as IN O O
follows VBZ O O
: : O O
2 CD O O
. . O O

After IN O O
it PRP B-Entity 1
copies NNS B-Action 2
itself PRP B-Entity 3
, , O O
it PRP B-Entity 4
will MD O O
modify VB B-Action 5
the DT B-Entity 6
creation NN I-Entity O
time NN I-Entity O
, , I-Entity O
last JJ I-Entity O
access NN I-Entity O
time NN I-Entity O
and CC I-Entity O
last JJ I-Entity O
modification NN I-Entity O
time NN I-Entity O
to TO B-Modifier 7
the DT B-Entity 8
current JJ I-Entity O
system NN I-Entity O
time NN I-Entity O
when WRB I-Entity O
the DT I-Entity O
copy NN I-Entity O
was VBD I-Entity O
made VBN I-Entity O
but CC I-Entity O
with IN I-Entity O
the DT I-Entity O
year NN I-Entity O
changed VBD I-Entity O
to TO I-Entity O
2005 CD I-Entity O
. . O O

3 CD O O
. . O O

Adds NNP B-Action 1
itself PRP B-Entity 2
as IN B-Modifier 3
a DT B-Entity 4
service NN I-Entity O
name NN I-Entity O
from IN B-Modifier 5
the DT B-Entity 6
backdoor NN I-Entity O
's POS I-Entity O
configuration NN I-Entity O
under IN B-Modifier 7
HKEYLOCAL FW B-Entity 8
MACHINE\\SYSTEM\\CurrentControlSet\\Services\\ FW I-Entity O
< JJR I-Entity O
service NN I-Entity O
> JJR I-Entity O
'' '' I-Entity O
This DT O O
defaults NNS O O
to TO O O
'' '' O O
wuauserv NN O O
'' '' O O
, , O O
the DT O O
legitimate JJ O O
Windows NNP O O
Update NNP O O
service NN O O
, , O O
in IN O O
the DT O O
given VBN O O
binary JJ O O
's POS O O
default NN O O
configuration NN O O
. . O O

4 CD O O
. . O O

Adds NNP B-Action 1
itself PRP B-Entity 2
to TO B-Modifier 3
list NN B-Entity 4
of IN I-Entity O
services NNS I-Entity O
started VBN I-Entity O
by IN I-Entity O
'netsvc NN I-Entity O
' '' I-Entity O
using VBG B-Modifier 5
the DT B-Entity 6
service NN I-Entity O
name NN I-Entity O
'helpsvc NN I-Entity O
' '' I-Entity O
. . O O

5 CD O O
. . O O

If IN O O
McAfee NNP O O
AV NNP O O
is VBZ O O
installed VBN O O
, , O O
creates VBZ B-Action 1
a DT B-Entity 2
copy NN I-Entity O
of IN I-Entity O
regsvr32.exe NN I-Entity O
named VBN I-Entity O
Update.exe NN I-Entity O
and CC O O
then RB O O
schedules NNS B-Action 3
the DT B-Entity 4
copy NN I-Entity O
to TO B-Modifier 5
be VB B-Entity 6
deleted VBN I-Entity O
on IN I-Entity O
reboot NN I-Entity O
using VBG B-Modifier 7
the DT B-Entity 8
well RB I-Entity O
documented VBN I-Entity O
MoveFileExA NN I-Entity O
API NN I-Entity O
. . O O

6 CD O O
. . O O

It PRP O O
then RB O O
calls VBZ O O
either CC O O
the DT O O
original JJ O O
or CC O O
copy NN O O
of IN O O
regsvr32.exe NN O O
with IN O O
the DT O O
parameters NNS O O
/s FW O O
/u FW O O
and CC O O
the DT O O
path NN O O
to TO O O
the DT O O
copy NN O O
of IN O O
itself PRP O O
it PRP O O
made VBD O O
in IN O O
Step NN O O
1 CD O O
. . O O

The DT O O
/u NN O O
parameter NN O O
means VBZ O O
'' '' O O
uninstall JJ O O
'' '' O O
, , O O
which WDT O O
calls VBZ O O
DllUnregisterServer NNP O O
, , O O
this DT O O
is VBZ O O
an DT O O
unsophisticated JJ O O
method NN O O
of IN O O
DLL NNP O O
entry NN O O
point NN O O
obfuscation NN O O
. . O O

7 CD O O
. . O O

DllUnregisterServer NNP O O
installs VBZ O O
the DT O O
driver NN O O
and CC O O
initiates VBZ O O
the DT O O
backdoor JJ O O
component NN O O
. . O O

The DT B-Entity 1
sample NN I-Entity O
is VBZ O O
capable JJ O O
of IN O O
'dropping VBG B-Action 2
' '' I-Action O
an DT B-Entity 3
embedded/encrypted JJ I-Entity O
kernel NN I-Entity O
driver NN I-Entity O
. . O O

If IN O O
the DT O O
process NN O O
'' '' O O
ZhuDongFangYu NN O O
. . O O

exe NN O O
'' '' O O
is VBZ O O
running VBG O O
( FW O O
AntiVirus360 FW O O
program NN O O
from IN O O
the DT O O
Chinese JJ O O
'Quihoo NN O O
360 CD O O
Technology NNP O O
Co. NNP O O
, , O O
LTD NNP O O
' POS O O
360 CD O O
) CD O O
, , O O
or CC O O
the DT O O
username NN O O
of IN O O
the DT O O
DLL NNP O O
's POS O O
host NN O O
process NN O O
context NN O O
is VBZ O O
not RB O O
'SYSTEM NN O O
' '' O O
, , O O
the DT O O
driver NN O O
is VBZ O O
not RB O O
written VBN O O
to TO O O
disk NN O O
. . O O

Barring VBG O O
the DT O O
two CD O O
aforementioned JJ O O
conditions NNS O O
, , O O
the DT O O
sample NN O O
decrypts VBZ O O
the DT O O
kernel NN O O
driver NN O O
to TO O O
: : O O
Following VBG O O
the DT O O
decryption NN O O
and CC O O
writing NN B-Action 1
of IN O O
the DT B-Entity 2
driver NN I-Entity O
to TO B-Modifier 3
disk NN B-Entity 4
, , O O
it PRP B-Entity 5
is VBZ B-Action 6
loaded VBN I-Action O
using VBG B-Modifier 7
the DT B-Entity 8
ZwLoadDriver NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
API NNP I-Entity O
. . O O

The DT B-Entity 1
driv- FW I-Entity O
er FW I-Entity O
is VBZ B-Action 2
encrypted VBN I-Action O
with IN B-Modifier 3
a DT B-Entity 4
simple JJ I-Entity O
four CD I-Entity O
byte NN I-Entity O
XOR NN I-Entity O
key JJ I-Entity O
value NN I-Entity O
of IN I-Entity O
0x2E885Df3 NN I-Entity O
; : O O
after IN O O
decryption NN O O
the DT O O
file NN O O
has VBZ O O
the DT O O
MD5 NN O O
hash NN O O
of IN O O
dae6b9b3b8e39b08b10a51a6457444d8 NN O O
. . O O

The DT O O
malware NN O O
contains VBZ O O
a DT O O
dynamic JJ O O
configuration NN O O
stored VBN O O
in IN O O
the DT O O
Registry NNP O O
under IN O O
and CC O O
loads NNS O O
a DT O O
default NN O O
configuration NN O O
embedded VBD O O
into IN O O
the DT O O
binary JJ O O
if IN O O
such PDT O O
a DT O O
configuration NN O O
is VBZ O O
not RB O O
found VBN O O
. . O O

The DT O O
way NN O O
this DT O O
default NN O O
configuration NN O O
is VBZ O O
loaded VBN O O
and CC O O
parsed VBN O O
indicates VBZ O O
that IN O O
this DT O O
malware NN O O
has VBZ O O
been VBN O O
built VBN O O
with IN O O
a DT O O
'builder NN O O
' '' O O
that WDT O O
takes VBZ O O
a DT O O
template NN O O
sample NN O O
and CC O O
lets VBZ O O
an DT O O
unsophisticated JJ O O
user NN O O
specify VB O O
a DT O O
configuration NN O O
without IN O O
recompiling VBG O O
any DT O O
code NN O O
. . O O

If IN O O
the DT O O
current JJ O O
service NN O O
name NN O O
matches VBZ O O
a DT O O
set NN O O
of IN O O
pre-defined JJ O O
service NN O O
names NNS O O
that WDT O O
legitimately RB O O
exist VBP O O
in IN O O
Windows NNP O O
, , O O
the DT B-Entity 1
backdoor NN I-Entity O
then RB O O
loads NNS B-Action 2
the DT B-Entity 3
original JJ I-Entity O
service NN I-Entity O
's POS I-Entity O
DLL NNP I-Entity O
into IN B-Modifier 4
the DT B-Entity 5
address NN I-Entity O
space NN I-Entity O
with IN B-Modifier 6
LoadLibrary NN B-Entity 7
and CC O O
invokes VBZ O O
the DT O O
ServiceMain NNP O O
export NN O O
. . O O

This DT O O
effectively RB O O
hijacks VBZ O O
the DT O O
original JJ O O
service NN O O
's POS O O
entry NN O O
while IN O O
retaining VBG O O
its PRP$ O O
functionality NN O O
. . O O

While IN O O
there EX O O
is VBZ O O
code NN O O
in IN O O
the DT O O
binary JJ O O
that WDT O O
allows VBZ O O
downloading VBG B-Action 1
a DT B-Entity 2
list NN I-Entity O
of IN I-Entity O
C2 NN I-Entity O
servers NNS I-Entity O
from IN B-Modifier 3
an DT B-Entity 4
HTTP NN I-Entity O
URL NN I-Entity O
, , O O
the DT B-Entity 5
default NN I-Entity O
configuration NN I-Entity O
present NN I-Entity O
specifies VBZ B-Action 6
202.86.190.3:80 CD B-Entity 7
as IN B-Modifier 8
a DT B-Entity 9
C2 NN I-Entity O
to TO B-Modifier 10
use VB B-Entity 11
, , O O
this DT O O
is VBZ O O
the DT O O
same JJ O O
Hong NNP O O
Kong NNP O O
C2 NN O O
server NN O O
as IN O O
the DT O O
one CD O O
used VBN O O
by IN O O
the DT O O
post NN O O
exploitation NN O O
.NET NN O O

tool NN O O
. . O O

The DT B-Entity 1
malware NN I-Entity O
has VBZ B-Action 2
three CD B-Entity 3
distinct JJ I-Entity O
C2 NN I-Entity O
protocols NNS I-Entity O
two CD O O
of IN O O
which WDT O O
can MD O O
be VB O O
transmitted VBN O O
over IN O O
HTTP NN O O
proxies NNS O O
and CC O O
one PRP O O
can MD O O
be VB O O
bundled VBN O O
in IN O O
two CD O O
different JJ O O
'dual NN O O
' '' O O
modes NNS O O
( RB O O
see VBP O O
3 CD O O
. . O O

) NN O O
, , O O
totaling VBG O O
7 CD O O
distinct JJ O O
supported VBN O O
C2 NN O O
mechanisms NNS O O
. . O O

The DT B-Entity 1
con- NN I-Entity O
figuration NN I-Entity O
contains VBZ B-Action 2
the DT B-Entity 3
C2 NN I-Entity O
protocol NN I-Entity O
to TO I-Entity O
be VB I-Entity O
used VBN I-Entity O
or CC O O
optionally RB O O
a DT O O
self-configuration NN O O
mode NN O O
in IN O O
which WDT O O
the DT B-Entity 4
malware NN I-Entity O
attempts VBZ B-Action 5
the DT B-Entity 6
different JJ I-Entity O
C2 NN I-Entity O
protocols NNS I-Entity O
in IN B-Modifier 7
a DT B-Entity 8
pre-defined JJ I-Entity O
order NN I-Entity O
. . O O

In IN O O
self-configuration NN O O
, , O O
a DT O O
connection NN O O
via IN O O
a DT O O
proxy NN O O
is VBZ O O
attempted VBN O O
if IN O O
the DT O O
system NN O O
wide JJ O O
Internet NNP O O
Explorer NNP O O
settings NNS O O
specify VBP O O
such JJ O O
a DT O O
proxy NN O O
. . O O

The DT O O
configuration NN O O
found VBN O O
in IN O O
this DT O O
sample NN O O
is VBZ O O
set VBN O O
to TO O O
automatic JJ O O
self-configuration NN O O
, , O O
resulting VBG O O
in IN O O
the DT O O
following JJ O O
mechanisms NNS O O
being VBG O O
tried VBN O O
in IN O O
this DT O O
order NN O O
: : O O
1 CD O O
. . O O

Proprietary JJ O O
binary JJ O O
header NN O O
( NN O O
optionally RB O O
over IN O O
an DT O O
HTTP NNP O O
Proxy NNP O O
using VBG O O
CONNECT NNP O O
mechanism NN O O
) NN O O
; : O O
this DT O O
protocol NN O O
consists VBZ O O
of IN O O
64 CD B-Entity 1
random JJ I-Entity O
bytes NNS I-Entity O
being VBG B-Action 2
sent VBN I-Action O
to TO B-Modifier 3
the DT B-Entity 4
C2 NN I-Entity O
. . O O

The DT O O
C2 NN O O
then RB O O
responds VBZ O O
with IN O O
64 CD O O
bytes NNS O O
where WRB O O
the DT O O
first JJ O O
four CD O O
bytes NNS O O
must MD O O
match VB O O
the DT O O
first JJ O O
four CD O O
sent VBN O O
bytes NNS O O
to TO O O
establish VB O O
a DT O O
connection NN O O
successfully RB O O
. . O O

The DT O O
remaining VBG O O
bytes NNS O O
are VBP O O
discarded VBN O O
. . O O

Interestingly RB O O
, , O O
the DT O O
malware NN O O
stores NNS O O
the DT O O
first JJ O O
four CD O O
bytes NNS O O
rotated VBN O O
right RB O O
by IN O O
seven CD O O
bits NNS O O
and CC O O
compares VBZ O O
that IN O O
value NN O O
to TO O O
the DT O O
seven CD O O
bits NNS O O
rotated VBD O O
right JJ O O
version NN O O
of IN O O
the DT O O
server NN O O
's POS O O
response NN O O
, , O O
effectively RB O O
neutralizing VBG O O
the DT O O
rotation NN O O
's POS O O
effect NN O O
; : O O
the DT O O
purpose NN O O
of IN O O
this DT O O
is VBZ O O
unclear JJ O O
. . O O

2 CD O O
. . O O

A DT O O
long-running JJ O O
HTTP NN O O
POST NN O O
request NN O O
to TO O O
the DT O O
path NN O O
'' '' O O
/forum/login.cgi NN O O
'' '' O O
with IN O O
a DT O O
statically RB O O
defined VBN O O
HTTP NN O O
request NN O O
string NN O O
including VBG O O
HTTP NN O O
headers NNS O O
( VBP O O
optionally RB O O
over IN O O
a DT O O
HTTP NNP O O
Proxy NNP O O
using VBG O O
CONNECT NNP O O
) NNP O O
. . O O

The DT O O
malware NN O O
requires VBZ O O
the DT O O
response NN O O
to TO O O
start VB O O
with IN O O
'' '' O O
HTTP/1.0 NN O O
200 CD O O
'' '' O O
or CC O O
'' '' O O
HTTP/1.1 NN O O
200 CD O O
'' '' O O
and CC O O
an DT O O
absence NN O O
of IN O O
a DT O O
'' '' O O
Connection NN O O
: : O O
close JJ O O
'' '' O O
header NN O O
. . O O

This DT O O
one CD O O
HTTP NNP O O
connection NN O O
will MD O O
be VB O O
used VBN O O
for IN O O
bi-directional JJ O O
communications NNS O O
, , O O
sending VBG B-Action 1
chunks NNS B-Entity 2
of IN I-Entity O
POST NN I-Entity O
payload NN I-Entity O
and CC O O
receiving VBG B-Action 3
chunks NNS B-Entity 4
of IN I-Entity O
the DT I-Entity O
response NN I-Entity O
, , O O
interleaved VBN O O
. . O O

3 CD O O
. . O O

Two CD O O
long-running JJ O O
HTTP NN O O
requests NNS O O
to TO O O
the DT O O
same JJ O O
C2 NN O O
( NN O O
optionally RB O O
over IN O O
an DT O O
HTTP NNP O O
Proxy NNP O O
with IN O O
original JJ O O
request NN O O
verb VBP O O
) CD O O
, , O O
one CD O O
GET VBP O O
request NN O O
to TO O O
'' '' O O
/Photos/Query.cgi VB O O
? . O O
loginid= NN O O
'' '' O O
followed VBN O O
by IN O O
a DT O O
random JJ O O
number NN O O
and CC O O
one CD O O
POST NN O O
request NN O O
to TO O O
'' '' O O
/Catelog/login1.cgi NN O O
'' '' O O
. . O O

The DT B-Entity 1
GET VBP I-Entity O
request NN I-Entity O
serves VBZ B-Action 2
as IN B-Modifier 3
a DT B-Entity 4
down-stream NN I-Entity O
channel NN I-Entity O
while IN O O
the DT B-Entity 5
POST NN I-Entity O
request NN I-Entity O
serves VBZ B-Action 6
as IN B-Modifier 7
a DT B-Entity 8
upstream JJ I-Entity O
channel NN I-Entity O
. . O O

This DT O O
demonstrates VBZ O O
an DT O O
attempt NN O O
to TO O O
use VB O O
the DT O O
most RBS O O
efficient JJ O O
communication NN O O
channel NN O O
first RB O O
, , O O
falling VBG O O
back RB O O
to TO O O
more RBR O O
legitimate JJ O O
appearing VBG O O
channels NNS O O
as IN O O
required VBN O O
in IN O O
order NN O O
to TO O O
appear VB O O
Request NNP O O
For IN O O
Comment NN O O
( NN O O
RFC NN O O
) NN O O
compliant JJ O O
with IN O O
the DT O O
HTTP NN O O
protocol NN O O
. . O O

Additionally RB O O
, , O O
the DT B-Entity 1
malware NN I-Entity O
contains VBZ B-Action 2
a DT B-Entity 3
custom NN I-Entity O
DNS NN I-Entity O
client NN I-Entity O
implementation NN I-Entity O
that WDT O O
will MD O O
use VB B-Action 4
the DT B-Entity 5
system NN I-Entity O
's POS I-Entity O
configured VBN I-Entity O
DNS NN I-Entity O
server NN I-Entity O
to TO O O
tunnel NN B-Action 6
C2 NN B-Entity 7
traffic NN I-Entity O
over IN B-Modifier 8
legitimate JJ B-Entity 9
DNS NNS I-Entity O
. . O O

Since IN O O
this DT O O
C2 NN O O
mechanism NN O O
is VBZ O O
not RB O O
attempted VBN O O
in IN O O
self-configuration NN O O
and CC O O
was VBD O O
not RB O O
configured VBN O O
for IN O O
this DT O O
binary JJ O O
, , O O
analysis NN O O
was VBD O O
left VBN O O
out RP O O
due JJ O O
to TO O O
time NN O O
constraints NNS O O
. . O O

After IN O O
establishing VBG O O
any DT O O
of IN O O
the DT O O
aforementioned JJ O O
channels NNS O O
for IN O O
arbitrary JJ O O
binary JJ O O
data NNS O O
exchange NN O O
, , O O
the DT B-Entity 1
malware NN I-Entity O
will MD O O
start VB O O
sending VBG B-Action 2
and CC O O
receiving VBG B-Action 3
compressed VBN B-Entity 4
binary JJ I-Entity O
blobs NNS I-Entity O
via IN B-Modifier 5
the DT B-Entity 6
channel NN I-Entity O
of IN I-Entity O
choice NN I-Entity O
. . O O

The DT O O
C2 NN O O
's POS O O
binary JJ O O
data NN O O
blobs NNS O O
are VBP O O
compressed VBN O O
. . O O

No DT O O
further JJ O O
encryption NN O O
of IN O O
the DT O O
data NN O O
takes VBZ O O
place NN O O
. . O O

All DT O O
C2 NN O O
transport NN O O
implementations NNS O O
contain VBP O O
code NN O O
for IN O O
accepting VBG O O
and CC O O
handling VBG O O
server-side JJ O O
connections NNS O O
of IN O O
the DT O O
respective JJ O O
protocols NNS O O
. . O O

However RB O O
, , O O
this DT O O
code NN O O
does VBZ O O
not RB O O
appear VB O O
to TO O O
be VB O O
invoked VBN O O
. . O O

It PRP O O
appears VBZ O O
that IN O O
the DT O O
author NN O O
of IN O O
this DT O O
code NN O O
shares VBZ O O
the DT O O
library NN O O
that WDT O O
implements VBZ O O
these DT O O
transports NNS O O
for IN O O
the DT O O
client NN O O
with IN O O
the DT O O
C2 NN O O
server NN O O
. . O O

The DT B-Entity 1
main JJ I-Entity O
backdoor JJ I-Entity O
thread NN I-Entity O
then RB O O
reads VBZ B-Action 2
commands NNS B-Entity 3
from IN B-Modifier 4
the DT B-Entity 5
chosen VBN I-Entity O
C2 NN I-Entity O
protocol NN I-Entity O
and CC O O
passes VBZ O O
them PRP O O
on RP O O
to TO O O
any DT O O
of IN O O
the DT O O
following JJ O O
registered JJ O O
handler NN O O
classes NNS O O
based VBN O O
upon IN O O
a DT O O
command NN O O
ID NN O O
. . O O

The DT O O
handler NN O O
class NN O O
is VBZ O O
responsible JJ O O
for IN O O
parsing VBG O O
the DT O O
remainder NN O O
of IN O O
the DT O O
command NN O O
. . O O

This DT B-Entity 1
handler NN I-Entity O
class NN I-Entity O
for IN I-Entity O
command NN I-Entity O
ID NN I-Entity O
8 CD I-Entity O
implements VBZ B-Action 2
generic JJ B-Entity 3
directory NN I-Entity O
and CC I-Entity O
file NN I-Entity O
browsing NN I-Entity O
using VBG B-Modifier 4
FindFirstFileW FW B-Entity 5
( FW I-Entity O
) NN I-Entity O
and CC I-Entity O
FindNextFileW NN I-Entity O
( FW I-Entity O
) FW I-Entity O
APIs NNS I-Entity O
, , O O
as RB O O
well RB O O
as IN O O
reading VBG B-Action 6
and CC O O
writing VBG B-Action 7
arbitrary JJ B-Entity 8
files NNS I-Entity O
via IN B-Modifier 9
C2 NN B-Entity 10
commands NNS I-Entity O
, , O O
thus RB O O
enabling VBG O O
upload NN B-Action 11
and CC O O
download NN B-Action 12
of IN O O
arbitrary JJ B-Entity 13
files NNS I-Entity O
. . O O

This DT O O
is VBZ O O
typically RB O O
seen VBN O O
in IN O O
RATs NNS B-Entity 1
for IN O O
searching VBG B-Action 2
specific JJ B-Entity 3
files NNS I-Entity O
to TO O O
exfiltrate VB B-Action 4
. . O O

Additionally RB O O
, , O O
this DT B-Entity 1
class NN I-Entity O
implements VBZ O O
launching NN B-Action 2
of IN O O
specified JJ B-Entity 3
executable JJ I-Entity O
files NNS I-Entity O
via IN B-Modifier 4
the DT B-Entity 5
CreateProcess NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
API NNP I-Entity O
. . O O

This DT B-Entity 1
handler NN I-Entity O
class NN I-Entity O
implements VBZ B-Action 2
a DT B-Entity 3
generic JJ I-Entity O
TCP NN I-Entity O
proxy NN I-Entity O
. . O O

It PRP B-Entity 1
supports VBZ O O
establishing VBG B-Action 2
TCP NNP B-Entity 3
connections NNS I-Entity O
to TO B-Modifier 4
other JJ B-Entity 5
hosts NNS I-Entity O
and CC O O
also RB O O
listening VBG B-Action 6
for IN B-Modifier 7
incoming JJ B-Entity 8
connections NNS I-Entity O
. . O O

The DT B-Entity 1
incoming JJ I-Entity O
connection NN I-Entity O
contents NNS I-Entity O
are VBP B-Action 2
forwarded VBN I-Action O
to TO B-Modifier 3
the DT B-Entity 4
C2 NN I-Entity O
and CC O O
data NNS B-Entity 5
from IN I-Entity O
the DT I-Entity O
C2 NN I-Entity O
is VBZ B-Action 6
passed VBN I-Action O
on RP B-Modifier 7
to TO I-Modifier O
connections NNS B-Entity 8
. . O O

It PRP O O
supports VBZ O O
up IN O O
to TO O O
1024 CD O O
parallel JJ O O
connections NNS O O
. . O O

The DT B-Entity 1
malware NN I-Entity O
is VBZ O O
capable JJ O O
of IN O O
gathering VBG B-Action 2
various JJ B-Entity 3
pieces NNS I-Entity O
of IN I-Entity O
information NN I-Entity O
from IN B-Modifier 4
the DT B-Entity 5
system NN I-Entity O
, , O O
triggered VBN O O
by IN O O
a DT O O
command NN O O
ID NN O O
10 CD O O
. . O O

The DT O O
capabilities NNS O O
include VBP O O
recovering VBG B-Action 1
authentication NN B-Entity 2
credentials NNS I-Entity O
from IN B-Modifier 3
various JJ B-Entity 4
system NN I-Entity O
and CC I-Entity O
client NN I-Entity O
storage NN I-Entity O
such JJ I-Entity O
as IN I-Entity O
Mozilla NNP I-Entity O
Firefox NNP I-Entity O
, , I-Entity O
Internet NNP I-Entity O
Explorer NNP I-Entity O
, , I-Entity O
and CC I-Entity O
Remote JJ I-Entity O
Access NN I-Entity O
Service NNP I-Entity O
( NNP I-Entity O
RAS NNP I-Entity O
) NNP I-Entity O
. . O O

This DT B-Entity 1
class NN I-Entity O
also RB O O
supports VBZ O O
gathering NN B-Action 2
intelligence NN B-Entity 3
on IN I-Entity O
the DT I-Entity O
infected JJ I-Entity O
system NN I-Entity O
including VBG O O
identifying VBG B-Action 4
security NN B-Entity 5
tools NNS I-Entity O
by IN B-Modifier 6
their PRP$ B-Entity 7
process NN I-Entity O
name NN I-Entity O
, , O O
proxy NN B-Entity 8
accounts NNS I-Entity O
, , O O
and CC O O
version NN B-Entity 9
numbers NNS I-Entity O
for IN I-Entity O
the DT I-Entity O
Operating NNP I-Entity O
System NNP I-Entity O
( NNP I-Entity O
OS NNP I-Entity O
) NNP I-Entity O
and CC O O
Internet NNP B-Entity 10
Explorer NNP I-Entity O
. . O O

This DT B-Entity 1
handler NN I-Entity O
class NN I-Entity O
provides VBZ O O
the DT O O
attacker NN O O
with IN O O
the DT O O
ability NN O O
to TO O O
manage VB B-Action 2
system NN B-Entity 3
components NNS I-Entity O
including VBG O O
start VB B-Action 4
/ / O O
stop VB B-Action 5
/ / O O
delete VB B-Action 6
system NN B-Entity 7
services NNS I-Entity O
, , O O
enumerate VB B-Action 8
/ / O O
alter VB B-Action 9
registry NN B-Entity 10
keys NNS I-Entity O
, , O O
and CC O O
manage VB B-Action 11
running VBG B-Entity 12
processes NNS I-Entity O
. . O O

This DT B-Entity 1
class NN I-Entity O
also RB O O
provides VBZ O O
the DT O O
ability NN O O
for IN O O
the DT O O
attacker NN O O
to TO O O
take VB B-Action 2
a DT B-Entity 3
screen NN I-Entity O
shot NN I-Entity O
of IN I-Entity O
the DT I-Entity O
users NNS I-Entity O
desktop NN I-Entity O
. . O O

This DT B-Entity 1
handler NN I-Entity O
class NN I-Entity O
uses VBZ O O
the DT O O
command NN O O
ID NN O O
5 CD O O
and CC O O
implements VBZ B-Action 2
an DT B-Entity 3
interactive JJ I-Entity O
command NN I-Entity O
line NN I-Entity O
shell NN I-Entity O
accessible JJ I-Entity O
from IN I-Entity O
the DT I-Entity O
C2 NN I-Entity O
server NN I-Entity O
, , O O
containing VBG O O
a DT O O
series NN O O
of IN O O
built-in JJ O O
commands NNS O O
. . O O

If IN O O
the DT O O
input NN O O
is VBZ O O
not RB O O
in IN O O
this DT O O
list NN O O
of IN O O
built-in JJ O O
commands NNS O O
, , O O
the DT B-Entity 1
malware NN I-Entity O
attempts VBZ O O
to TO O O
invoke VB B-Action 2
cmd.exe NN B-Entity 3
in IN B-Modifier 4
the DT B-Entity 5
background NN I-Entity O
, , O O
launching VBG B-Action 6
a DT B-Entity 7
command NN I-Entity O
or CC I-Entity O
command NN I-Entity O
line NN I-Entity O
utility NN I-Entity O
already RB I-Entity O
present JJ I-Entity O
on IN I-Entity O
the DT I-Entity O
system NN I-Entity O
. . O O

The DT B-Entity 1
standard JJ I-Entity O
output NN I-Entity O
channel NN I-Entity O
of IN I-Entity O
that DT I-Entity O
command NN I-Entity O
is VBZ B-Action 2
provided VBN I-Action O
back RB B-Modifier 3
to TO I-Modifier O
the DT B-Entity 4
C2 NN I-Entity O
. . O O

The DT O O
supported VBN O O
built-in JJ O O
commands NNS O O
are VBP O O
: : O O
The DT O O
only JJ O O
command NN O O
that WDT O O
is VBZ O O
implemented VBN O O
directly RB O O
in IN O O
the DT O O
main JJ O O
backdoor JJ O O
thread NN O O
as IN O O
a DT O O
subprocedure NN O O
call NN O O
and CC O O
not RB O O
via IN O O
a DT O O
generic JJ O O
command NN O O
handler NN O O
class NN O O
is VBZ O O
command NN O O
ID NN O O
256 CD O O
. . O O

This DT O O
command NN O O
results VBZ O O
in IN O O
the DT B-Entity 1
DLL NNP I-Entity O
deleting VBG B-Action 2
itself PRP B-Entity 3
and CC O O
terminating VBG B-Action 4
the DT B-Entity 5
backdoor JJ I-Entity O
process NN I-Entity O
. . O O

This DT O O
sample NN O O
is VBZ O O
a DT O O
packed JJ O O
32-bit JJ O O
kernel NN O O
driver NN O O
extracted VBN O O
by IN O O
the DT O O
aforementioned JJ O O
DLL NN O O
with IN O O
an DT O O
MD5 NN O O
hash NN O O
of IN O O
: : O O
de7500fc1065a081180841f32f06a537 NN O O
, , O O
this DT O O
sample NN O O
will MD O O
only RB O O
function VB O O
on IN O O
a DT O O
Windows NNP O O
32-bit JJ O O
kernel NN O O
. . O O

This DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Sunday NNP O O
October NNP O O
9 CD O O
, , O O
2011 CD O O
at IN O O
4:50:31 CD O O
P.M. NNP O O
UTC NNP O O
( NNP O O
very RB O O
early JJ O O
morning NN O O
time NN O O
of IN O O
Monday NNP O O
, , O O
October NNP O O
10 CD O O
in IN O O
China NNP O O
) NNP O O
. . O O

This DT O O
section NN O O
describes VBZ O O
how WRB O O
the DT O O
driver NN O O
performs VBZ O O
its PRP$ O O
initialization NN O O
routine NN O O
. . O O

The DT B-Entity 1
driver NN I-Entity O
begins VBZ O O
by IN O O
opening VBG B-Action 2
a DT B-Entity 3
named VBN I-Entity O
event NN I-Entity O
in IN B-Modifier 4
the DT B-Entity 5
BaseNamedObjects NNS I-Entity O
object VBP I-Entity O
directory NN I-Entity O
with IN B-Modifier 6
the DT B-Entity 7
name NN I-Entity O
{ NNP I-Entity O
8CB2ff21-0166-4cf1-BD8F-E190BC7902DC NNP I-Entity O
} NNP I-Entity O
using VBG B-Modifier 8
the DT B-Entity 9
Windows NNP I-Entity O
API NNP I-Entity O
ZwOpenEvent NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
. . O O

If IN O O
the DT O O
event NN O O
already RB O O
exists VBZ O O
, , O O
the DT B-Entity 1
driver NN I-Entity O
fails VBZ O O
to TO O O
load VB O O
, , O O
presumably RB O O
to TO O O
avoid VB B-Action 2
a DT O O
multiple JJ B-Entity 3
instances NNS I-Entity O
of IN I-Entity O
itself PRP I-Entity O
. . O O

If IN O O
the DT O O
event NN O O
does VBZ O O
not RB O O
exist VB O O
, , O O
the DT B-Entity 1
driver NN I-Entity O
then RB O O
creates VBZ B-Action 2
it PRP B-Entity 3
using VBG B-Modifier 4
the DT B-Entity 5
Windows NNP I-Entity O
API NNP I-Entity O
ZwCreateEvent NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
. . O O

The DT O O
Windows NNP O O
API NNP O O
for IN O O
creating VBG O O
events NNS O O
( NNP O O
ZwCreateEvent NNP O O
( NNP O O
) NNP O O
, , O O
or CC O O
CreateEvent FW O O
( FW O O
) NN O O
in IN O O
user NN O O
mode NN O O
) NN O O
already RB O O
provides VBZ O O
the DT O O
ability NN O O
to TO O O
'' '' O O
create-or-open JJ O O
'' '' O O
an DT O O
event NN O O
, , O O
so IN O O
the DT O O
use NN O O
of IN O O
an DT O O
initial JJ O O
ZwOpenEvent NN O O
is VBZ O O
superfluous JJ O O
and CC O O
indicative JJ O O
of IN O O
relatively RB O O
limited JJ O O
Windows NNP O O
API NNP O O
knowledge NN O O
of IN O O
the DT O O
author NN O O
of IN O O
that DT O O
part NN O O
of IN O O
the DT O O
code NN O O
. . O O

It PRP O O
is VBZ O O
interesting JJ O O
to TO O O
note VB O O
that IN O O
some DT O O
of IN O O
the DT O O
hex NN O O
digits NNS O O
in IN O O
the DT O O
object NN O O
name NN O O
are VBP O O
mixed JJ O O
case NN O O
which WDT O O
is VBZ O O
potentially RB O O
indicative JJ O O
of IN O O
the DT O O
code NN O O
being VBG O O
re-appropriated JJ O O
from IN O O
another DT O O
source NN O O
. . O O

The DT B-Entity 1
second JJ I-Entity O
component NN I-Entity O
of IN I-Entity O
the DT I-Entity O
entry NN I-Entity O
point NN I-Entity O
performs VBZ B-Action 2
an DT B-Entity 3
anti-debugging JJ I-Entity O
technique NN I-Entity O
, , O O
calling VBG B-Action 4
the DT B-Entity 5
function NN I-Entity O
KdDisableDebugger NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
, , O O
which WDT O O
allows VBZ O O
the DT B-Entity 6
driver NN I-Entity O
to TO O O
disable VB B-Action 7
usage NN B-Entity 8
of IN I-Entity O
the DT I-Entity O
built-in JJ I-Entity O
Windows NNP I-Entity O
kernel NN I-Entity O
debugging NN I-Entity O
facility NN I-Entity O
that WDT I-Entity O
is VBZ I-Entity O
used VBN I-Entity O
by IN I-Entity O
popular JJ I-Entity O
kernel NN I-Entity O
debuggers NNS I-Entity O
KD NN I-Entity O
and CC I-Entity O
WinDbg NNP I-Entity O
. . O O

Tools NNS O O
such JJ O O
as IN O O
Syser NNP O O
Debugger NNP O O
, , O O
or CC O O
debugging VBG O O
through IN O O
a DT O O
virtual JJ O O
machine NN O O
are VBP O O
unaffected JJ O O
by IN O O
this DT O O
technique NN O O
. . O O

The DT O O
sample NN O O
, , O O
rather RB O O
than IN O O
importing VBG O O
the DT O O
KdDisableDebugger NNP O O
( NNP O O
) NNP O O
API NNP O O
using VBG O O
conventional JJ O O
methods NNS O O
, , O O
looks VBZ O O
up RP O O
the DT O O
API NNP O O
through IN O O
MmGetSystemRoutineAddress NNP O O
( NNP O O
) NNP O O
instead RB O O
. . O O

All DT O O
of IN O O
the DT O O
other JJ O O
APIs NNS O O
used VBN O O
by IN O O
the DT O O
driver NN O O
are VBP O O
imported VBN O O
normally RB O O
, , O O
so IN O O
this DT O O
is VBZ O O
not RB O O
a DT O O
technique NN O O
to TO O O
hide VB O O
import NN O O
APIs NNS O O
used VBN O O
throughout IN O O
the DT O O
driver NN O O
. . O O

Searching NN O O
Google NNP O O
for IN O O
'' '' O O
MmGetSystemRoutineAddress NNP O O
'' '' O O
and CC O O
'' '' O O
KdDisableDebugger NNP O O
'' '' O O
results VBZ O O
in IN O O
dozens NNS O O
of IN O O
Chinese JJ O O
language NN O O
blogs NNS O O
which WDT O O
explain VBP O O
how WRB O O
to TO O O
use VB O O
this DT O O
technique NN O O
to TO O O
'' '' O O
Disable NNP O O
WinDbg NNP O O
'' '' O O
. . O O

The DT B-Entity 1
final JJ I-Entity O
step NN I-Entity O
of IN I-Entity O
the DT I-Entity O
entry NN I-Entity O
point NN I-Entity O
is VBZ O O
to TO O O
begin VB O O
hooking VBG B-Action 2
the DT B-Entity 3
system NN I-Entity O
, , O O
which WDT O O
is VBZ O O
done VBN O O
by IN O O
two CD O O
helper NN O O
functions NNS O O
- : O O
one CD B-Entity 4
is VBZ O O
designed VBN O O
to TO O O
hook NN B-Action 5
the DT B-Entity 6
system NN I-Entity O
call NN I-Entity O
table NN I-Entity O
, , O O
while IN O O
the DT B-Entity 7
other JJ I-Entity O
hooks NNS B-Action 8
the DT B-Entity 9
network NN I-Entity O
stack VB I-Entity O
. . O O

The DT B-Entity 1
network NN I-Entity O
stack VBP I-Entity O
hooking VBG I-Entity O
first RB O O
queries VBZ B-Action 2
the DT B-Entity 3
OS NN I-Entity O
version NN I-Entity O
using VBG B-Modifier 4
RtlGetVersion NNP B-Entity 5
( NNP I-Entity O
) NNP I-Entity O
or CC I-Entity O
PsGetVersion NNP I-Entity O
( FW I-Entity O
) FW I-Entity O
. . O O

Checking VBG O O
the DT O O
version NN O O
is VBZ O O
necessary JJ O O
because IN O O
Windows NNP O O
versions NNS O O
beginning VBG O O
with IN O O
Vista NNP O O
utilize VBP O O
a DT O O
redesigned VBN O O
TCP/IP NN O O
net- NN O O
work NN O O
stack VBP O O
, , O O
most JJS O O
hooking VBG O O
operations NNS O O
will MD O O
require VB O O
a DT O O
different JJ O O
implementation NN O O
for IN O O
these DT O O
versions NNS O O
. . O O

On IN O O
versions NNS O O
prior RB O O
to TO O O
Windows NNP O O
Vista NNP O O
, , O O
the DT O O
TCP/IP NN O O
driver NN O O
creates VBZ O O
a DT O O
\Device\Tcp NN O O
device NN O O
object NN O O
through IN O O
which WDT O O
most JJS O O
network NN O O
requests NNS O O
are VBP O O
piped VBN O O
through IN O O
. . O O

On IN O O
Vista NNP O O
and CC O O
later RB O O
, , O O
TCP/IP NN O O
has VBZ O O
been VBN O O
split VBN O O
up RP O O
into IN O O
multiple JJ O O
components NNS O O
, , O O
and CC O O
IP NNP O O
connection NN O O
enumeration NN O O
, , O O
which WDT O O
this DT O O
driver NN O O
is VBZ O O
targeting VBG O O
, , O O
is VBZ O O
managed VBN O O
by IN O O
\Device\nsiproxy NN O O
instead RB O O
. . O O

In IN O O
either DT O O
case NN O O
, , O O
the DT B-Entity 1
driver NN I-Entity O
obtains VBZ O O
the DT O O
device NN O O
object NN O O
by IN O O
using VBG O O
IoGetDeviceObjectPointer NNP O O
( FW O O
) FW O O
and CC O O
hooks VBZ B-Action 2
Major JJ B-Entity 3
Function NN I-Entity O
14 CD I-Entity O
the DT I-Entity O
IRPMJDEVICECONTROL NN I-Entity O
, , O O
as IN O O
this DT O O
is VBZ O O
the DT O O
function NN O O
through IN O O
which WDT O O
all DT O O
Input NNP O O
Output NN O O
ConTroLls NNP O O
( NNP O O
IOCTLs NNP O O
) NNP O O
are VBP O O
sent VBN O O
, , O O
such JJ O O
as IN O O
the DT O O
IOCTL NN O O
for IN O O
querying VBG O O
active JJ O O
IP NNP O O
connections NNS O O
. . O O

The DT O O
NSI NNP O O
hook NN O O
, , O O
targets VBZ O O
IOCTL NNP O O
0x12001B NNP O O
, , O O
which WDT O O
is VBZ O O
used VBN O O
by IN O O
NsiGetObjectAllParameters NNP O O
( NNP O O
) NNP O O
in IN O O
nsi.dll NNP O O
when WRB O O
users NNS O O
typically RB O O
run VBP O O
commands NNS O O
such JJ O O
as IN O O
netstat.exe NN O O
or CC O O
use VB O O
any DT O O
of IN O O
the DT O O
IP NNP O O
Helper NNP O O
APIs NNPS O O
in IN O O
iphlpapi.dll NNP O O
. . O O

The DT O O
purpose NN O O
of IN O O
the DT B-Entity 1
hook NN I-Entity O
is VBZ O O
to TO O O
scan VB B-Action 2
the DT B-Entity 3
list NN I-Entity O
of IN I-Entity O
active JJ I-Entity O
connections NNS I-Entity O
returned VBD I-Entity O
to TO I-Entity O
the DT I-Entity O
user NN I-Entity O
, , O O
and CC O O
hide VB B-Action 4
any DT B-Entity 5
such JJ I-Entity O
connection NN I-Entity O
currently RB I-Entity O
bound VBD I-Entity O
to TO I-Entity O
a DT I-Entity O
local JJ I-Entity O
TCP NN I-Entity O
port NN I-Entity O
in IN I-Entity O
the DT I-Entity O
range NN I-Entity O
between IN I-Entity O
40000 CD I-Entity O
and CC I-Entity O
45000 CD I-Entity O
. . O O

The DT B-Entity 1
hooking VBG I-Entity O
is VBZ B-Action 2
performed VBN I-Action O
by IN B-Modifier 3
creating VBG B-Entity 4
a DT I-Entity O
new JJ I-Entity O
completion NN I-Entity O
routine NN I-Entity O
associated VBN I-Entity O
with IN I-Entity O
any DT I-Entity O
IRPMJDEVICECONTROL NN I-Entity O
IRP NN I-Entity O
that WDT I-Entity O
matches VBZ I-Entity O
the DT I-Entity O
IOCTL NNP I-Entity O
, , I-Entity O
attaching VBG I-Entity O
to TO I-Entity O
the DT I-Entity O
target NN I-Entity O
process NN I-Entity O
, , I-Entity O
performing VBG I-Entity O
several JJ I-Entity O
memory NN I-Entity O
copies NNS I-Entity O
to TO I-Entity O
hide VB I-Entity O
the DT I-Entity O
entry NN I-Entity O
, , I-Entity O
and CC I-Entity O
detaching VBG I-Entity O
. . O O

This DT O O
functionality NN O O
is VBZ O O
nearly RB O O
identical JJ O O
to TO O O
the DT O O
code NN O O
posted VBN O O
by IN O O
Edward NNP O O
Sun NNP O O
( FW O O
aka FW O O
cardmagic NN O O
, , O O
sunmy1 NN O O
@ SYM O O
sina.com NNP O O
, , O O
onlyonejazz NN O O
@ IN O O
hotmail.com NN O O
, , O O
cardcian NN O O
@ IN O O
mail.ustc.edu.cn NNP O O
, , O O
QQ NNP O O
# # O O
28025945 CD O O
) CD O O
from IN O O
Hefei NNP O O
, , O O
Anhui NNP O O
province NN O O
( NNP O O
Nanjing NNP O O
Military NNP O O
District NNP O O
) NNP O O
on IN O O
July NNP O O
8 CD O O
, , O O
2007 CD O O
, , O O
then RB O O
a DT O O
China-based JJ O O
researcher NN O O
at IN O O
Trend NNP O O
Micro NNP O O
( NNP O O
now RB O O
working VBG O O
at IN O O
Kingsoft NNP O O
Chinese NNP O O
AV NNP O O
Company NNP O O
; : O O
LinkedIn NN O O
profile NN O O
page NN O O
: : O O
http NN O O
: : O O
//www.linkedin.com/profile/view NN O O
? . O O
id=84082731 FW O O
) FW O O
at IN O O
http NN O O
: : O O
//forum.eviloctal.com/viewthread.php NN O O
? . O O
action=printable NNP O O
& CC O O
tid=29604 NNP O O
( NNP O O
See NNP O O
Appendix NNP O O
G NNP O O
) NNP O O
. . O O

CrowdStrike NNP O O
has VBZ O O
no DT O O
information NN O O
connecting VBG O O
Mr. NNP O O
Sun NNP O O
to TO O O
this DT O O
intrusion NN O O
activity NN O O
, , O O
his PRP$ O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
appropriated VBN O O
by IN O O
the DT O O
actor NN O O
to TO O O
add VB O O
similar JJ O O
functionality NN O O
to TO O O
their PRP$ O O
code NN O O
. . O O

The DT B-Entity 1
TCP NN I-Entity O
hook NN I-Entity O
works VBZ O O
almost RB O O
identically RB O O
to TO O O
the DT O O
NSI NNP O O
hook NN O O
, , O O
though IN O O
instead RB O O
hooking VBG B-Action 2
IOCTL NNP B-Entity 3
0x120003 NNP I-Entity O
( NNP I-Entity O
IOCTL NNP I-Entity O
TCPQUERYINFORMATIONEX NNP I-Entity O
) NNP I-Entity O
. . O O

This NNP O O
IOCTL NNP O O
has VBZ O O
the DT O O
exact JJ O O
same JJ O O
functionality NN O O
as IN O O
the DT O O
NSI NNP O O
specific JJ O O
IOCTL NN O O
. . O O

This DT O O
IOCTL NN O O
was VBD O O
the DT O O
mechanism NN O O
used VBN O O
on IN O O
Windows NNP O O
versions NNS O O
prior RB O O
to TO O O
Windows NNP O O
Vista NNP O O
. . O O

This DT B-Entity 1
hook NN I-Entity O
also RB O O
filters VBZ B-Action 2
any DT B-Entity 3
connections NNS I-Entity O
listening VBG I-Entity O
on IN I-Entity O
TCP NNP I-Entity O
ports NNS I-Entity O
in IN I-Entity O
the DT I-Entity O
range NN I-Entity O
between IN I-Entity O
40000 CD I-Entity O
and CC I-Entity O
45000 CD I-Entity O
. . O O

The DT O O
system NN O O
call NN O O
hooking VBG O O
targets NNS O O
three CD O O
functions NNS O O
: : O O
ZwSaveKey NNP O O
( NNP O O
) NNP O O
, , O O
ZwQueryValueKey NNP O O
( NNP O O
) NNP O O
, , O O
and CC O O
ZwEnumerateValueKey NNP O O
( NNP O O
) NNP O O
. . O O

The DT B-Entity 1
unpacked JJ I-Entity O
kernel NN I-Entity O
driver NN I-Entity O
sample NN I-Entity O
hooks VBZ B-Action 2
these DT B-Entity 3
functions NNS I-Entity O
by IN B-Modifier 4
reading VBG B-Entity 5
the DT I-Entity O
second JJ I-Entity O
DWORD NN I-Entity O
at IN I-Entity O
each DT I-Entity O
of IN I-Entity O
these DT I-Entity O
exported VBN I-Entity O
functions NNS I-Entity O
. . O O

Because IN O O
the DT O O
system NN O O
call NN O O
stub NN O O
uses VBZ O O
the DT O O
EAX NN O O
register NN O O
as IN O O
an DT O O
index NN O O
for IN O O
the DT O O
system NN O O
call NN O O
ID NN O O
, , O O
and CC O O
a DT O O
'' '' O O
mov NN O O
eax NN O O
, , O O
imm32 NN O O
'' '' O O
instruction NN O O
'' '' O O
instruction NN O O
is VBZ O O
used VBN O O
, , O O
this DT O O
second JJ O O
DWORD NNP O O
will MD O O
match VB O O
the DT O O
system NN O O
call NN O O
ID NN O O
. . O O

It PRP O O
then RB O O
adds VBZ O O
this DT O O
index NN O O
to TO O O
the DT O O
value NN O O
of IN O O
KeServiceDescriptorTable.Base NN O O
, , O O
which WDT O O
is VBZ O O
the DT O O
exported VBN O O
kernel NN O O
variable JJ O O
( NN O O
on IN O O
32-bit JJ O O
Windows NNP O O
only RB O O
) CD O O
which WDT O O
directly RB O O
points VBZ O O
to TO O O
the DT O O
system NN O O
call NN O O
table NN O O
. . O O

This DT O O
is VBZ O O
one CD O O
of IN O O
the DT O O
simplest JJS O O
ways NNS O O
to TO O O
do VB O O
a DT O O
system NN O O
call NN O O
hook NN O O
, , O O
but CC O O
will MD O O
not RB O O
work VB O O
on IN O O
64-bit JJ O O
Windows NNP O O
as IN O O
this DT O O
variable NN O O
is VBZ O O
not RB O O
exported VBN O O
in IN O O
addition NN O O
to TO O O
the DT O O
protection NN O O
provided VBN O O
by IN O O
Microsoft NNP O O
PatchGuard NNP O O
. . O O

The DT B-Entity 1
system NN I-Entity O
call NN I-Entity O
hook NN I-Entity O
is VBZ B-Action 2
then RB I-Action O
performed VBN I-Action O
by IN B-Modifier 3
first RB B-Entity 4
allocating VBG I-Entity O
a DT I-Entity O
Memory NN I-Entity O
Descriptor NN I-Entity O
List NN I-Entity O
( CD I-Entity O
MDL NN I-Entity O
) NN I-Entity O
using VBG I-Entity O
the DT I-Entity O
Windows NNP I-Entity O
API NNP I-Entity O
IoAllocateMdl NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
, , I-Entity O
and CC I-Entity O
associating VBG I-Entity O
the DT I-Entity O
MDL NN I-Entity O
to TO I-Entity O
a DT I-Entity O
non-paged JJ I-Entity O
buffer NN I-Entity O
using VBG I-Entity O
MmBuildMdlForNonPagedPool NNP I-Entity O
( NNP I-Entity O
) NNP I-Entity O
. . O O

Once RB O O
the DT O O
MDL NN O O
is VBZ O O
associated VBN O O
to TO O O
the DT O O
non-paged JJ O O
buffer NN O O
, , O O
the DT O O
sample NN O O
locks VBZ O O
the DT O O
underlying VBG O O
pages NNS O O
using VBG O O
the DT O O
Windows NNP O O
API NNP O O
MmProbeAndLockPages NNP O O
( NNP O O
) NNP O O
. . O O

Instead RB O O
of IN O O
hooking VBG O O
the DT O O
entry NN O O
in IN O O
the DT O O
table NN O O
directly RB O O
, , O O
which WDT O O
is VBZ O O
easily RB O O
detectable JJ O O
, , O O
the DT B-Entity 1
driver NN I-Entity O
uses VBZ O O
the DT O O
LDASM FW O O
open-source FW O O
disassembly NN O O
engine NN O O
to TO O O
analyze VB O O
the DT O O
function NN O O
that WDT O O
is VBZ O O
being VBG O O
pointed VBN O O
to TO O O
by IN O O
the DT O O
table NN O O
, , O O
and CC O O
applying VBG B-Action 2
a DT B-Entity 3
Detours-style JJ I-Entity O
hook NN I-Entity O
directly RB B-Modifier 4
in IN I-Modifier O
the DT B-Entity 5
code NN I-Entity O
. . O O

It PRP O O
uses VBZ O O
the DT O O
standard NN O O
'' '' O O
mov FW O O
cr0 FW O O
, , O O
eax NN O O
'' '' O O
technique NN O O
, , O O
turning VBG O O
off RP O O
the DT O O
Write NNP O O
Protect NNP O O
( NNP O O
WP NNP O O
) NNP O O
bit VBD O O
as IN O O
it PRP O O
does VBZ O O
this DT O O
. . O O

When WRB O O
the DT O O
hook NN O O
is VBZ O O
installed VBN O O
, , O O
it PRP O O
writes VBZ O O
a DT O O
special JJ O O
DWORD NN O O
value NN O O
, , O O
'KDTR NN O O
' '' O O
, , O O
which WDT O O
allows VBZ O O
it PRP O O
to TO O O
prevent VB O O
double-hooking JJ O O
or CC O O
badly-hooking JJ O O
the DT O O
system NN O O
call NN O O
, , O O
during IN O O
unhooking NN O O
, , O O
this DT O O
value NN O O
is VBZ O O
also RB O O
checked VBN O O
. . O O

In IN O O
the DT O O
ZwSaveKey NN O O
( FW O O
) FW O O
hook NN O O
, , O O
access NN O O
to TO O O
\\REGISTRY\\MACHINE\\SYSTEM NN O O
is VBZ O O
blocked VBN O O
. . O O

RegSaveKey FW O O
( FW O O
) NN O O
which WDT O O
is VBZ O O
the DT O O
user-mode JJ O O
implementation NN O O
of IN O O
the DT O O
kernel NN O O
ZwSaveKey NNP O O
( NNP O O
) NNP O O
API NNP O O
, , O O
is VBZ O O
typically RB O O
used VBN O O
when WRB O O
performing VBG O O
an DT O O
offline JJ O O
backup NN O O
of IN O O
a DT O O
particular JJ O O
registry NN O O
key NN O O
. . O O

hook NN O O
is VBZ O O
the DT O O
ZwQueryValueValue NNP O O
( NNP O O
) NNP O O
hook NN O O
, , O O
which WDT O O
looks VBZ O O
for IN O O
'' '' O O
Parameters NNS O O
'' '' O O
key NN O O
of IN O O
a DT O O
service NN O O
within IN O O
the DT O O
registry NN O O
at IN O O
\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\ NN O O
. . O O

It PRP B-Entity 1
then RB O O
checks VBZ B-Action 2
for IN B-Modifier 3
the DT B-Entity 4
values NNS I-Entity O
of IN I-Entity O
the DT I-Entity O
'' '' I-Entity O
ServiceDll NNP I-Entity O
'' '' I-Entity O
and CC I-Entity O
'' '' I-Entity O
Security NNP I-Entity O
'' '' I-Entity O
keys NNS I-Entity O
, , O O
in IN O O
the DT O O
latter JJ O O
case NN O O
it PRP B-Entity 5
applies VBZ B-Action 6
an DT B-Entity 7
XOR NN I-Entity O
on IN B-Modifier 8
the DT B-Entity 9
data NNS I-Entity O
with IN B-Modifier 10
the DT B-Entity 11
value NN I-Entity O
127 CD I-Entity O
. . O O

The DT O O
user-mode JJ O O
component NN O O
of IN O O
this DT O O
malware NN O O
is VBZ O O
a DT O O
service NN O O
called VBN O O
'' '' O O
msupdate NN O O
'' '' O O
, , O O
this DT B-Entity 1
driver NN I-Entity O
is VBZ O O
attempting VBG O O
to TO O O
hide VB B-Action 2
the DT B-Entity 3
service NN I-Entity O
. . O O

The DT O O
user-mode JJ O O
service NN O O
stores NNS O O
configuration NN O O
data NNS O O
in IN O O
the DT O O
'' '' O O
Security NNP O O
'' '' O O
subkey NN O O
of IN O O
the DT O O
RPC NNP O O
registry NN O O
key NN O O
, , O O
this DT O O
component NN O O
will MD O O
obfuscate VB O O
the DT O O
user-mode JJ O O
configuration NN O O
data NNS O O
. . O O

The DT O O
driver NN O O
does VBZ O O
not RB O O
make VB O O
any DT O O
efforts NNS O O
to TO O O
hide VB O O
its PRP$ O O
own JJ O O
key NN O O
, , O O
nor CC O O
does VBZ O O
it PRP O O
specifically RB O O
check VB O O
for IN O O
'' '' O O
RPC NNP O O
'' '' O O
before IN O O
'' '' O O
Security NNP O O
'' '' O O
, , O O
which WDT O O
can MD O O
lead VB O O
to TO O O
random JJ O O
data NNS O O
being VBG O O
obfuscated VBN O O
. . O O

The DT O O
final JJ O O
hook NN O O
, , O O
ZwEnumerateValueKey NNP O O
( NNP O O
) NNP O O
, , O O
is VBZ O O
similar JJ O O
in IN O O
structure NN O O
to TO O O
the DT O O
ZwQueryValueHook NNP O O
key NN O O
, , O O
due JJ O O
to TO O O
the DT O O
fact NN O O
that IN O O
these DT O O
APIs NNS O O
provide VBP O O
almost RB O O
identical JJ O O
functionality NN O O
when WRB O O
it PRP O O
comes VBZ O O
to TO O O
reading VBG O O
registry NN O O
values NNS O O
. . O O

In IN B-Modifier 1
the DT B-Entity 2
registry NN I-Entity O
hooking VBG I-Entity O
code NN I-Entity O
of IN I-Entity O
the DT I-Entity O
driver NN I-Entity O
, , O O
a DT B-Entity 3
call NN I-Entity O
is VBZ B-Action 4
made VBN I-Action O
to TO B-Modifier 5
ObReferenceObjectByHandle NNP B-Entity 6
( NNP I-Entity O
) NNP I-Entity O
. . O O

This DT O O
allows VBZ O O
the DT O O
driver NN O O
to TO O O
receive VB O O
the DT O O
'CMKEYOBJECT NN O O
' '' O O
which WDT O O
is VBZ O O
then RB O O
used VBN O O
with IN O O
ObQueryNameString NNP O O
( NNP O O
) NNP O O
to TO O O
get VB O O
the DT O O
key/value JJ O O
path NN O O
. . O O

However RB O O
, , O O
no DT O O
call NN O O
to TO O O
ObDereferenceObject NNP O O
( NNP O O
) NNP O O
is VBZ O O
ever RB O O
made VBN O O
, , O O
which WDT O O
means VBZ O O
that IN O O
all DT O O
registry NN O O
objects NNS O O
being VBG O O
sent VBN O O
to TO O O
these DT O O
APIs NNS O O
are VBP O O
eventually RB O O
leaked VBN O O
. . O O

In IN O O
the DT O O
registry NN O O
hook NN O O
, , O O
it PRP O O
was VBD O O
noticed VBN O O
that IN O O
'' '' O O
CurrentControlSet001 NN O O
'' '' O O
was VBD O O
used VBN O O
as IN O O
the DT O O
target NN O O
, , O O
if IN O O
the DT O O
target NN O O
machine NN O O
was VBD O O
using VBG O O
a DT O O
'' '' O O
last JJ O O
known JJ O O
good JJ O O
'' '' O O
configuration NN O O
, , O O
or CC O O
a DT O O
roaming VBG O O
hardware NN O O
profile NN O O
, , O O
the DT O O
registry NN O O
hook NN O O
would MD O O
not RB O O
function VB O O
as IN O O
intended VBN O O
. . O O

This DT O O
is VBZ O O
the DT O O
reason NN O O
the DT O O
Microsoft NNP O O
implemented VBD O O
a DT O O
symbolic JJ O O
link NN O O
to TO O O
\\CurrentControlSet NN O O
which WDT O O
ensures VBZ O O
that IN O O
regardless RB O O
of IN O O
the DT O O
machines NNS O O
configuration NN O O
any DT O O
request NN O O
will MD O O
access VB O O
the DT O O
correct JJ O O
registry NN O O
key NN O O
. . O O

This DT O O
threat NN O O
actor NN O O
leaves VBZ O O
several JJ O O
key JJ O O
fingerprints NNS O O
which WDT O O
can MD O O
be VB O O
used VBN O O
to TO O O
identify VB O O
compromised VBN O O
systems NNS O O
. . O O

These DT O O
digital JJ O O
fingerprints NNS O O
are VBP O O
unique JJ O O
to TO O O
this DT O O
adversary NN O O
for IN O O
this DT O O
campaign NN O O
. . O O

The DT O O
following VBG O O
network NN O O
signatures NNS O O
are VBP O O
designed VBN O O
for IN O O
the DT O O
popular JJ O O
Open NNP O O
Source NNP O O
IDS NNP O O
called VBD O O
Snort NNP O O
. . O O

These DT O O
signature NN O O
can MD O O
be VB O O
ported VBN O O
to TO O O
other JJ O O
formats NNS O O
upon IN O O
request NN O O
. . O O

The DT O O
following VBG O O
file NN O O
system NN O O
artifacts NNS O O
are VBP O O
indicative JJ O O
of IN O O
a DT O O
compromised VBN O O
host NN O O
: : O O
The DT O O
following VBG O O
Windows NNP O O
Registry NNP O O
artifacts NNS O O
are VBP O O
indicative JJ O O
of IN O O
a DT O O
compromised VBN O O
host NN O O
: : O O
The DT O O
backdoor NN O O
may MD O O
be VB O O
detected VBN O O
by IN O O
several JJ O O
different JJ O O
Anti-Virus NNP O O
products NNS O O
under IN O O
a DT O O
signature NN O O
with IN O O
the DT O O
name NN O O
: : O O
Attribution NN O O
in IN O O
the DT O O
cyber NN O O
domain NN O O
is VBZ O O
always RB O O
a DT O O
tricky JJ O O
subject NN O O
when WRB O O
relying VBG O O
solely RB O O
on IN O O
malicious JJ O O
samples NNS O O
. . O O

Compiler NNP O O
artifacts NNS O O
and CC O O
language NN O O
settings NNS O O
can MD O O
of IN O O
course NN O O
be VB O O
deliberately RB O O
masked VBN O O
or CC O O
spoofed VBN O O
. . O O

CrowdStrike NNP O O
uses VBZ O O
a DT O O
unique JJ O O
approach NN O O
of IN O O
comprehensive JJ O O
threat NN O O
analysis NN O O
in IN O O
order NN O O
to TO O O
decipher VB O O
attributable JJ O O
components NNS O O
. . O O

Based VBN O O
on IN O O
the DT O O
corroborating JJ O O
evidence NN O O
discovered VBN O O
in IN O O
the DT O O
course NN O O
of IN O O
this DT O O
analysis NN O O
, , O O
it PRP O O
appears VBZ O O
there EX O O
are VBP O O
numerous JJ O O
indications NNS O O
that IN O O
this DT O O
is VBZ O O
a DT O O
Chinese-speaking JJ O O
actor NN O O
. . O O

ZhuDongFangYu.exe NN O O
is VBZ O O
a DT O O
component NN O O
of IN O O
360 CD O O
360􀆔􀆔􀆔􀆔 CD O O
, , O O
a DT O O
Chinese JJ O O
security NN O O
product NN O O
available JJ O O
from IN O O
http NN O O
: : O O
//www.360.cn/ NN O O
. . O O

This DT O O
is VBZ O O
particularly RB O O
relevant JJ O O
in IN O O
this DT O O
case NN O O
because IN O O
the DT B-Entity 1
backdoor JJ I-Entity O
DLL NNP I-Entity O
sample NN I-Entity O
with IN I-Entity O
an DT I-Entity O
MD5 NN I-Entity O
of IN I-Entity O
de7500fc1065a081180841f32f06a537 NN I-Entity O
specifically RB O O
avoids VBZ B-Action 2
installing VBG B-Entity 3
the DT I-Entity O
kernel NN I-Entity O
driver NN I-Entity O
on IN I-Entity O
a DT I-Entity O
system NN I-Entity O
running VBG I-Entity O
this DT I-Entity O
tool NN I-Entity O
. . O O

Speculatively RB O O
this DT O O
may MD O O
be VB O O
because IN O O
this DT O O
security NN O O
product NN O O
detects VBZ O O
this DT O O
rootkit NN O O
, , O O
or CC O O
the DT O O
author NN O O
was VBD O O
attempting VBG O O
to TO O O
prevent VB O O
accidental JJ O O
infection NN O O
on IN O O
systems NNS O O
running VBG O O
this DT O O
Anti-Virus NNP O O
product NN O O
. . O O

The DT O O
obfuscation NN O O
of IN O O
the DT O O
KdDisableDebugger NN O O
( FW O O
) FW O O
function NN O O
call NN O O
is VBZ O O
seen VBN O O
on IN O O
several JJ O O
Chinese JJ O O
language NN O O
forums NNS O O
, , O O
and CC O O
can MD O O
be VB O O
seen VBN O O
being VBG O O
reused VBN O O
in IN O O
several JJ O O
code NN O O
samples NNS O O
on IN O O
those DT O O
forums NNS O O
. . O O

As IN O O
previously RB O O
mentioned VBN O O
there EX O O
is VBZ O O
no DT O O
advantage NN O O
associated VBN O O
with IN O O
using VBG O O
this DT O O
call NN O O
obfuscation NN O O
, , O O
and CC O O
appears VBZ O O
to TO O O
be VB O O
reused VBN O O
for IN O O
no DT O O
apparent JJ O O
reason NN O O
other JJ O O
than IN O O
the DT O O
attackers NNS O O
have VBP O O
copied VBN O O
code NN O O
directly RB O O
from IN O O
forum NN O O
code NN O O
. . O O

While IN O O
the DT B-Entity 1
various JJ I-Entity O
network NN I-Entity O
hooking VBG I-Entity O
techniques NNS I-Entity O
used VBN B-Action 2
in IN B-Modifier 3
the DT B-Entity 4
kernel NN I-Entity O
driver NN I-Entity O
may MD O O
appear VB O O
novel JJ O O
or CC O O
well RB O O
researched VBN O O
, , O O
upon IN O O
close JJ O O
inspection NN O O
it PRP O O
is VBZ O O
actually RB O O
a DT O O
line-for-line JJ O O
copy NN O O
of IN O O
an DT O O
existing VBG O O
post NN O O
from IN O O
the DT O O
now-offline JJ O O
'rootkit.com NN O O
' '' O O
by IN O O
a DT O O
Chinese JJ O O
language NN O O
developer NN O O
. . O O

This DT O O
post NN O O
is VBZ O O
currently RB O O
mirrored VBN O O
on IN O O
dozens NNS O O
of IN O O
Chinese JJ O O
hacking NN O O
websites NNS O O
. . O O

Similarly RB O O
the DT O O
system NN O O
call NN O O
hooking VBG O O
is VBZ O O
less RBR O O
impressive JJ O O
after IN O O
searching VBG O O
for IN O O
'' '' O O
IoAllocateMdl NNP O O
'' '' O O
and CC O O
'' '' O O
cr0 NN O O
'' '' O O
( FW O O
bbs.pediy FW O O
. . O O

com/showthread.php NN O O
? . O O
t=77467 NN O O
perform VBP B-Action 1
system NN B-Entity 2
call NN I-Entity O
hooking VBG I-Entity O
through IN B-Modifier 3
MDLs NNS B-Entity 4
. . O O

The DT O O
ldasm NN O O
inline NN O O
hooking VBG O O
is VBZ O O
also RB O O
repeated VBN O O
in IN O O
numerous JJ O O
postings NNS O O
to TO O O
Chinese JJ O O
forums NNS O O
. . O O

One CD O O
particular JJ O O
website NN O O
( FW O O
http FW O O
: : O O
//read.pudn.com/downloads197/sourcecode/windows/sys- JJ O O
tem/927802/CCRootkit/RootkitSys/HookSSDT.c.htm NN O O
) NN O O
had VBD O O
an DT O O
almost RB O O
identical JJ O O
ldasm NN O O
loop NN O O
that WDT O O
tried VBD O O
to TO O O
identify VB O O
the DT O O
exact JJ O O
same JJ O O
code NN O O
sequences NNS O O
. . O O

Open NNP O O
source NN O O
research NN O O
of IN O O
the DT O O
4 CD O O
innocuous JJ O O
kernel NN O O
APIs NNS O O
'' '' O O
ZwSaveKey NNP O O
ZwQueryValueKey NNP O O
ZwEnumerateValueKey NNP O O
IoAllocateMdl NNP O O
'' '' O O
, , O O
in IN O O
concert NN O O
leads VBZ O O
directly RB O O
to TO O O
a DT O O
Chinese JJ O O
website NN O O
that WDT O O
has VBZ O O
a DT B-Entity 1
cached VBN I-Entity O
rootkit NN I-Entity O
performing VBG B-Action 2
similar JJ B-Entity 3
hooks NNS I-Entity O
on IN B-Modifier 4
the DT B-Entity 5
same JJ I-Entity O
3 CD I-Entity O
registry NN I-Entity O
related JJ I-Entity O
APIs NNS I-Entity O
. . O O

While IN O O
the DT O O
driver NN O O
does VBZ O O
not RB O O
use VB O O
pool NN O O
tags NNS O O
for IN O O
most JJS O O
of IN O O
its PRP$ O O
allocations NNS O O
, , O O
it PRP O O
does VBZ O O
utilize VB O O
them PRP O O
in IN O O
the DT O O
networking NN O O
hooking VBG O O
code NN O O
, , O O
much RB O O
like IN O O
the DT O O
examples NNS O O
found VBN O O
on IN O O
the DT O O
Chinese JJ O O
language NN O O
forums NNS O O
. . O O

This DT O O
sample NN O O
uses VBZ O O
pool NN O O
tags NNS O O
: : O O
'tnet NN O O
, , O O
' '' O O
and CC O O
'KDTR NN O O
' '' O O
. . O O

Although IN O O
the DT O O
meaning NN O O
of IN O O
the DT O O
KDTR NN O O
tag NN O O
is VBZ O O
not RB O O
obvious JJ O O
, , O O
we PRP O O
assess VBP O O
with IN O O
high JJ O O
confidence NN O O
that IN O O
this DT O O
is VBZ O O
a DT O O
shortened VBN O O
version NN O O
of IN O O
: : O O
'' '' O O
Kernel NNP O O
DeTouR NN O O
'' '' O O
, , O O
which WDT O O
coincides VBZ O O
with IN O O
the DT O O
matching JJ O O
functionality NN O O
of IN O O
the DT O O
detour-style JJ O O
inline NN O O
hook NN O O
. . O O

The DT O O
driver NN O O
code NN O O
( CD O O
MD5 NN O O
: : O O
dae6b9b3b8e39b08b10a51a6457444d8 FW O O
) FW O O
appears VBZ O O
to TO O O
be VB O O
a DT O O
combination NN O O
of IN O O
various JJ O O
code NN O O
that WDT O O
is VBZ O O
easily RB O O
searchable JJ O O
on IN O O
the DT O O
Internet NN O O
, , O O
and CC O O
almost RB O O
always RB O O
attributed VBN O O
to TO O O
Chinese JJ O O
language NN O O
forums NNS O O
and CC O O
websites NNS O O
. . O O

The DT O O
system NN O O
call NN O O
hooking VBG O O
parts NNS O O
of IN O O
the DT O O
code NN O O
appear VBP O O
to TO O O
be VB O O
identical JJ O O
to TO O O
the DT O O
HookSSDT.c NN O O
code NN O O
authored VBN O O
by IN O O
Steven NNP O O
Lai NNP O O
'embedlinux NN O O
' '' O O
and CC O O
utilized VBN O O
in IN O O
what WP O O
the DT O O
author NN O O
titled VBN O O
'CC NNP O O
Rootkit NNP O O
' '' O O
on IN O O
on IN O O
August NNP O O
4 CD O O
, , O O
2008 CD O O
who WP O O
's VBZ O O
email NN O O
address NN O O
is VBZ O O
hqulyc JJ O O
@ IN O O
126.com NNP O O
. . O O

This DT O O
user NN O O
has VBZ O O
a DT O O
QQ NN O O
identity NN O O
of IN O O
: : O O
5054-3533 CD O O
, , O O
QQ NNP O O
is VBZ O O
a DT O O
popular JJ O O
instant NN O O
messaging VBG O O
chat NN O O
client NN O O
used VBD O O
almost RB O O
exclusively RB O O
in IN O O
China NNP O O
. . O O

His PRP$ O O
real JJ O O
name NN O O
according VBG O O
to TO O O
his PRP$ O O
QQ NN O O
profile NN O O
( FW O O
http FW O O
: : O O
//user.qzone.qq.com/50543533 FW O O
) FW O O
appears VBZ O O
to TO O O
be VB O O
Steven NNP O O
Lai NNP O O
. . O O

He PRP O O
was VBD O O
is VBZ O O
28 CD O O
years NNS O O
old JJ O O
( NN O O
born VBN O O
September NNP O O
5 CD O O
, , O O
1983 CD O O
) NN O O
and CC O O
lives NNS O O
in IN O O
Xiamen NNP O O
, , O O
Fujian NNP O O
province NN O O
( NNP O O
Nanjing NNP O O
Military NNP O O
Region NNP O O
) NNP O O
. . O O

According VBG O O
to TO O O
his PRP$ O O
profile NN O O
, , O O
he PRP O O
has VBZ O O
worked VBN O O
at IN O O
Xiamen NNP O O
XOCECO NNP O O
New NNP O O
Technic NNP O O
Co. NNP O O
, , O O
Ltd. NNP O O
( CD O O
http NN O O
: : O O
//www.likego.com/en/about.asp FW O O
) FW O O
, , O O
a DT O O
company NN O O
that WDT O O
builds VBZ O O
audio/video NN O O
systems NNS O O
for IN O O
transportation NN O O
systems NNS O O
. . O O

Mr. NNP O O
Lai NNP O O
is VBZ O O
not RB O O
being VBG O O
identified VBN O O
as IN O O
the DT O O
actor NN O O
, , O O
his PRP$ O O
code NN O O
however RB O O
was VBD O O
used VBN O O
by IN O O
whomever NN O O
built VBD O O
the DT O O
kernel NN O O
driver NN O O
utilized VBN O O
by IN O O
the DT O O
backdoor NN O O
and CC O O
for IN O O
this DT O O
reason NN O O
we PRP O O
are VBP O O
providing VBG O O
the DT O O
background NN O O
on IN O O
this DT O O
individual NN O O
. . O O

The DT O O
samples NNS O O
involved VBN O O
in IN O O
this DT O O
incident NN O O
are VBP O O
typical JJ O O
of IN O O
attacks NNS O O
commonly RB O O
associated VBN O O
with IN O O
the DT O O
People's NNP O O
Republic NNP O O
of IN O O
China NNP O O
( FW O O
PRC FW O O
) FW O O
. . O O

These DT O O
code NN O O
samples NNS O O
have VBP O O
a DT O O
variety NN O O
of IN O O
Tools NNS O O
, , O O
Techniques NNS O O
, , O O
and CC O O
Procedures NNS O O
( FW O O
TTPs FW O O
) NN O O
that WDT O O
are VBP O O
used VBN O O
to TO O O
track VB O O
and CC O O
identify VB O O
specific JJ O O
adversary NN O O
groups NNS O O
. . O O

The DT O O
sophistication NN O O
of IN O O
the DT O O
actor NN O O
responsible JJ O O
this DT O O
incident NN O O
is VBZ O O
difficult JJ O O
to TO O O
quantify VB O O
without IN O O
visibility NN O O
into IN O O
the DT O O
activities NNS O O
that WDT O O
transpired VBD O O
on IN O O
the DT O O
victims NNS O O
network NN O O
. . O O

The DT O O
ability NN O O
to TO O O
conduct VB O O
Incident NNP O O
Response NNP O O
( NNP O O
IR NNP O O
) NNP O O
including VBG O O
forensics NNS O O
, , O O
and CC O O
log NN O O
analysis NN O O
, , O O
greatly RB O O
augments VBZ O O
this DT O O
visibility NN O O
into IN O O
these DT O O
aspects NNS O O
of IN O O
the DT O O
incident NN O O
. . O O

Some DT O O
indications NNS O O
as IN O O
to TO O O
the DT O O
adversaries NNS O O
' POS O O
capabilities NNS O O
can MD O O
be VB O O
derived VBN O O
from IN O O
the DT O O
captured VBN O O
samples NNS O O
alone RB O O
. . O O

The DT O O
dropper NN O O
code NN O O
( CD O O
MD5 NN O O
: : O O
14c04f88dc97aef3e9b516ef208a2bf5 FW O O
) FW O O
does VBZ O O
not RB O O
utilize VB O O
any DT O O
techniques NNS O O
that WDT O O
are VBP O O
unique JJ O O
or CC O O
unusual JJ O O
, , O O
and CC O O
is VBZ O O
consistent JJ O O
with IN O O
tools NNS O O
, , O O
techniques NNS O O
, , O O
and CC O O
procedures NNS O O
of IN O O
attacks NNS O O
targeting VBG O O
proprietary JJ O O
information NN O O
and CC O O
generally RB O O
attributed VBN O O
to TO O O
the DT O O
PRC NNP O O
. . O O

The DT O O
presence NN O O
of IN O O
dead JJ O O
code NN O O
and CC O O
its PRP$ O O
replacement NN O O
by IN O O
a DT O O
more RBR O O
simple JJ O O
obfuscation NN O O
method NN O O
to TO O O
hide VB O O
the DT O O
to-be-dropped JJ O O
dll NN O O
binary JJ O O
file NN O O
indicates VBZ O O
code NN O O
reuse NN O O
on IN O O
the DT O O
attacker NN O O
side NN O O
. . O O

The DT O O
'dead NN O O
code NN O O
' '' O O
utilizes VBZ O O
a DT O O
more RBR O O
sophisticated JJ O O
compression NN O O
algorithm NN O O
provided VBN O O
by IN O O
a DT O O
third JJ O O
party NN O O
which WDT O O
was VBD O O
rendered VBN O O
useless JJ O O
for IN O O
some DT O O
reason NN O O
. . O O

This DT O O
may MD O O
have VB O O
been VBN O O
a DT O O
result NN O O
of IN O O
the DT O O
attacker NN O O
modifying VBG O O
an DT O O
existing VBG O O
tool NN O O
, , O O
or CC O O
unknowingly RB O O
using VBG O O
a DT O O
re-purposed JJ O O
tool NN O O
. . O O

The DT O O
dropper NN O O
resources NNS O O
indicate VBP O O
the DT O O
compiler NN O O
used VBN O O
to TO O O
build VB O O
the DT O O
tool NN O O
was VBD O O
running VBG O O
on IN O O
a DT O O
system NN O O
that WDT O O
utilized VBD O O
the DT O O
Chinese NNPS O O
'' '' O O
Simple JJ O O
'' '' O O
language NN O O
pack NN O O
and CC O O
was VBD O O
built VBN O O
on IN O O
Wednesday NNP O O
May NNP O O
4th JJ O O
, , O O
2011 CD O O
at IN O O
11:04:24 CD O O
A.M. NNP O O
UTC NNP O O
( NNP O O
early JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

While IN O O
this DT O O
can MD O O
be VB O O
deliberately RB O O
spoofed VBN O O
as IN O O
a DT O O
'false JJ O O
flag NN O O
' '' O O
other JJ O O
indicators NNS O O
including VBG O O
the DT O O
C2 NN O O
are VBP O O
consistent JJ O O
with IN O O
this DT O O
having VBG O O
been VBN O O
the DT O O
work NN O O
of IN O O
a DT O O
Chinese JJ O O
speaking NN O O
actor NN O O
. . O O

The DT B-Entity 1
dropped VBD I-Entity O
DLL NNP I-Entity O
( NNP I-Entity O
MD5 NN I-Entity O
: : I-Entity O
47619fca20895abc83807321cbb80a3d FW I-Entity O
) FW I-Entity O
itself PRP I-Entity O
contains VBZ B-Action 2
functionality NN B-Entity 3
that WDT I-Entity O
is VBZ I-Entity O
typical JJ I-Entity O
of IN I-Entity O
a DT I-Entity O
Remote JJ I-Entity O
Access NN I-Entity O
Tool NNP I-Entity O
( CD I-Entity O
RAT NN I-Entity O
) NN I-Entity O
which WDT O O
are VBP O O
commonly RB O O
used VBN B-Action 4
by IN O O
PRC NNP B-Entity 5
based VBN I-Entity O
actors NNS I-Entity O
in IN B-Modifier 6
data NN B-Entity 7
exfiltration NN I-Entity O
attacks NNS I-Entity O
. . O O

The DT O O
code NN O O
quality NN O O
is VBZ O O
not RB O O
impressive JJ O O
, , O O
and CC O O
contains VBZ O O
a DT O O
trivial JJ O O
stack VB O O
buffer NN O O
overflow NN O O
vulnerability NN O O
. . O O

Despite IN O O
the DT O O
buf- FW O O
fer FW O O
overflow NN O O
, , O O
the DT O O
C2 NN O O
channel NN O O
lacks VBZ O O
any DT O O
command NN O O
authenication NN O O
or CC O O
encryption NN O O
, , O O
apart RB O O
from IN O O
the DT O O
initial JJ O O
beacon NN O O
encryption/obfuscation NN O O
using VBG O O
a DT O O
statically RB O O
compiled VBN O O
XOR NN O O
key NN O O
. . O O

The DT O O
sample NN O O
uses VBZ O O
TCP NN O O
port NN O O
443 CD O O
for IN O O
commu- FW O O
nication FW O O
, , O O
but CC O O
makes VBZ O O
no DT O O
attempt NN O O
to TO O O
mimic VB O O
the DT O O
SSL NNP O O
protocol NN O O
typically RB O O
used VBN O O
on IN O O
that DT O O
port JJ O O
number NN O O
, , O O
which WDT O O
would MD O O
provide VB O O
enhanced VBN O O
Operational NNP O O
Security NNP O O
( FW O O
OPSEC FW O O
) FW O O
. . O O

This DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Wednes- JJ O O
day NN O O
May NNP O O
4th JJ O O
, , O O
2011 CD O O
at IN O O
10:48:19 CD O O
A.M. NNP O O
UTC NNP O O
( NNP O O
early JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

The DT O O
post NN O O
exploitation NN O O
tool NN O O
( CD O O
MD5 NN O O
: : O O
2dce7fc3f52a692d8a84a0c182519133 FW O O
) FW O O
is VBZ O O
a DT O O
dual-use JJ O O
tool NN O O
, , O O
it PRP B-Entity 1
can MD O O
be VB B-Action 2
dropped VBN I-Action O
and CC O O
executed VBN B-Action 3
by IN O O
a DT B-Entity 4
client-side NN I-Entity O
exploit VB I-Entity O
, , O O
or CC O O
the DT B-Entity 5
adversary NN I-Entity O
can MD O O
launch VB B-Action 6
it PRP B-Entity 7
using VBG B-Modifier 8
a DT B-Entity 9
variety NN I-Entity O
of IN I-Entity O
command NN I-Entity O
line NN I-Entity O
options NNS I-Entity O
. . O O

This DT O O
tool NN O O
is VBZ O O
built VBN O O
in IN O O
Microsoft NNP O O
.NET NNP O O

framework NN O O
, , O O
which WDT O O
is VBZ O O
typically RB O O
an DT O O
indication NN O O
of IN O O
a DT O O
less RBR O O
sophis- JJ O O
ticated JJ O O
attacker NN O O
, , O O
because IN O O
.NET NN O O

is VBZ O O
easier JJR O O
to TO O O
develop VB O O
in IN O O
but CC O O
requires VBZ O O
the DT O O
.NET NN O O

framework NN O O
be VB O O
present JJ O O
on IN O O
the DT O O
victim NN O O
machine NN O O
. . O O

The DT O O
tool NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Thursday NNP O O
May NNP O O
26th JJ O O
, , O O
2011 CD O O
at IN O O
10:21:44 CD O O
A.M. NNP O O
UTC NNP O O
( NNP O O
early JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

The DT B-Entity 1
sample NN I-Entity O
utilizes VBZ B-Action 2
the DT B-Entity 3
AES NN I-Entity O
cryptographic JJ I-Entity O
algorithm NN I-Entity O
to TO B-Modifier 4
protect VB B-Entity 5
its PRP$ I-Entity O
C2 NN I-Entity O
communications NNS I-Entity O
. . O O

This DT B-Entity 1
DLL NNP I-Entity O
is VBZ B-Action 2
a DT B-Entity 3
moderately RB I-Entity O
sophisticated JJ I-Entity O
backdoor NN I-Entity O
with IN O O
several JJ O O
well RB O O
designed VBN O O
communication NN O O
mechanisms NNS O O
not RB O O
typically RB O O
seen VBN O O
in IN O O
these DT O O
types NNS O O
of IN O O
implants NNS O O
. . O O

The DT O O
code NN O O
base NN O O
for IN O O
the DT O O
sample NN O O
was VBD O O
developed VBN O O
in IN O O
C++ NNP O O
. . O O

The DT O O
code NN O O
appears VBZ O O
to TO O O
have VB O O
been VBN O O
compiled VBN O O
on IN O O
Sunday NNP O O
October NNP O O
30 CD O O
, , O O
2011 CD O O
at IN O O
12:43:33 CD O O
P.M. NNP O O
UTC NNP O O
( NNP O O
late JJ O O
evening NN O O
time NN O O
in IN O O
China NNP O O
) NNP O O
. . O O

This DT B-Entity 1
sample NN I-Entity O
has VBZ B-Action 2
multiple JJ B-Entity 3
communication NN I-Entity O
capabilities NNS I-Entity O
available JJ I-Entity O
that WDT O O
makes VBZ O O
it PRP O O
far RB O O
more RBR O O
versatile JJ O O
and CC O O
stealthy JJ O O
. . O O

It PRP B-Entity 1
implements VBZ B-Action 2
relatively RB B-Entity 3
well RB I-Entity O
thought VBN I-Entity O
out RP I-Entity O
protocols NNS I-Entity O
including VBG I-Entity O
HTTP NNP I-Entity O
and CC I-Entity O
DNS NNP I-Entity O
. . O O

The DT B-Entity 1
tool NN I-Entity O
has VBZ O O
the DT O O
ability NN O O
to TO O O
automatically RB O O
down RB O O
select VB B-Action 2
the DT B-Entity 3
most RBS I-Entity O
effective JJ I-Entity O
communication NN I-Entity O
channel NN I-Entity O
once IN B-Modifier 4
it PRP B-Entity 5
has VBZ I-Entity O
been VBN I-Entity O
instantiated VBN I-Entity O
, , O O
which WDT O O
can MD O O
help VB O O
avoid VB B-Action 6
detection NN B-Entity 7
from IN I-Entity O
solutions NNS I-Entity O
like IN I-Entity O
DNS NN I-Entity O
blacklisting NN I-Entity O
and CC I-Entity O
RFC NN I-Entity O
protocol NN I-Entity O
enforcement NN I-Entity O
. . O O

The DT O O
DLL NNP O O
itself PRP O O
contains VBZ O O
traces NNS O O
of IN O O
the DT O O
original JJ O O
C++ NNP O O
class NN O O
names NNS O O
that WDT O O
were VBD O O
utilized VBN O O
in IN O O
the DT O O
source NN O O
code NN O O
, , O O
which WDT O O
in IN O O
general JJ O O
were VBD O O
prefixed VBN O O
with IN O O
'PCC NN O O
' '' O O
. . O O

The DT B-Entity 1
sample NN I-Entity O
supports VBZ O O
the DT O O
ability NN O O
to TO O O
act VB B-Action 2
as IN B-Modifier 3
a DT B-Entity 4
generic JJ I-Entity O
proxy NN I-Entity O
, , O O
this DT O O
may MD O O
be VB O O
intended VBN O O
to TO O O
proxy NN B-Action 5
C2 NN B-Entity 6
traffic NN I-Entity O
for IN B-Modifier 7
other JJ B-Entity 8
infected JJ I-Entity O
machines NNS I-Entity O
in IN B-Modifier 9
order NN I-Modifier O
to TO I-Modifier O
minimize VB B-Entity 10
the DT I-Entity O
number NN I-Entity O
of IN I-Entity O
systems NNS I-Entity O
communicating VBG I-Entity O
to TO I-Entity O
the DT I-Entity O
C2 NN I-Entity O
, , O O
thus RB O O
enhancing VBG O O
OPSEC NNP O O
. . O O

The DT O O
sample NN O O
contains VBZ O O
'dead NN O O
code NN O O
' '' O O
which WDT O O
appears VBZ O O
to TO O O
be VB O O
command NN O O
and CC O O
control NN O O
server NN O O
classes NNS O O
, , O O
this DT O O
is VBZ O O
likely RB O O
an DT O O
indicator NN O O
that IN O O
the DT B-Entity 1
C2 NN I-Entity O
client NN I-Entity O
which WDT I-Entity O
would MD I-Entity O
communicate VB I-Entity O
with IN I-Entity O
this DT I-Entity O
sample NN I-Entity O
shares VBZ B-Action 2
the DT B-Entity 3
same JJ I-Entity O
communications NNS I-Entity O
library NN I-Entity O
which WDT I-Entity O
was VBD I-Entity O
compiled VBN I-Entity O
into IN I-Entity O
this DT I-Entity O
sample NN I-Entity O
. . O O

The DT B-Entity 1
kernel NN I-Entity O
driver NN I-Entity O
component NN I-Entity O
dropped VBN B-Action 2
by IN O O
the DT B-Entity 3
Backdoor NNP I-Entity O
DLL NNP I-Entity O
bears VBZ O O
many JJ O O
tool NN O O
marks NNS O O
associating VBG O O
it PRP O O
with IN O O
the DT O O
CCRootkit NN O O
package NN O O
publicly RB O O
by IN O O
Steven NNP O O
Lai NNP O O
( NNP O O
a/k/a IN O O
embedlinux FW O O
) FW O O
. . O O

This DT B-Entity 1
kernel NN I-Entity O
mode NN I-Entity O
rootkit NN I-Entity O
implements VBZ B-Action 2
several JJ B-Entity 3
hooking VBG I-Entity O
techniques NNS I-Entity O
that WDT O O
are VBP O O
aimed VBN O O
at IN O O
preventing VBG B-Action 4
a DT B-Entity 5
system NN I-Entity O
administrator NN I-Entity O
from IN B-Modifier 6
detecting VBG B-Entity 7
the DT I-Entity O
backdoor JJ I-Entity O
DLL NNP I-Entity O
. . O O

The DT O O
implementation NN O O
of IN O O
these DT O O
techniques NNS O O
has VBZ O O
some DT O O
unique JJ O O
idiosyncrasies NNS O O
that WDT O O
permit VBP O O
direct JJ O O
attribution NN O O
to TO O O
the DT O O
source NN O O
code NN O O
Steven NNP O O
Lai NNP O O
posted VBD O O
. . O O

This DT B-Entity 1
driver NN I-Entity O
attempts VBZ O O
to TO O O
hide VB B-Action 2
a DT B-Entity 3
wide JJ I-Entity O
swath NN I-Entity O
of IN I-Entity O
TCP NN I-Entity O
ports NNS I-Entity O
( VBP I-Entity O
40000-45000 CD I-Entity O
) NN I-Entity O
for IN B-Modifier 4
an DT B-Entity 5
unknown JJ I-Entity O
reason NN I-Entity O
, , O O
however RB O O
it PRP O O
is VBZ O O
suspected VBN O O
that IN O O
this DT O O
may MD O O
relate VB O O
to TO O O
the DT O O
potential JJ O O
network NN O O
relaying VBG O O
capability NN O O
alluded VBD O O
to TO O O
for IN O O
the DT O O
backdoor JJ O O
dll NN O O
. . O O

The DT B-Entity 1
kernel NN I-Entity O
driver NN I-Entity O
component NN I-Entity O
dropped VBN B-Action 2
by IN O O
the DT B-Entity 3
Backdoor NNP I-Entity O
DLL NNP I-Entity O
bears VBZ O O
many JJ O O
tool NN O O
marks NNS O O
associating VBG O O
it PRP O O
with IN O O
the DT O O
CCRootkit NN O O
package NN O O
publicly RB O O
by IN O O
Steven NNP O O
Lai NNP O O
( NNP O O
a/k/a IN O O
embedlinux FW O O
) FW O O
. . O O

This DT B-Entity 1
kernel NN I-Entity O
mode NN I-Entity O
rootkit NN I-Entity O
implements VBZ B-Action 2
several JJ B-Entity 3
hooking VBG I-Entity O
techniques NNS I-Entity O
that WDT O O
are VBP O O
aimed VBN O O
at IN O O
preventing VBG B-Action 4
a DT B-Entity 5
system NN I-Entity O
administrator NN I-Entity O
from IN B-Modifier 6
detecting VBG B-Entity 7
the DT I-Entity O
backdoor JJ I-Entity O
DLL NNP I-Entity O
. . O O

The DT O O
implementation NN O O
of IN O O
these DT O O
techniques NNS O O
has VBZ O O
some DT O O
unique JJ O O
idiosyncrasies NNS O O
that WDT O O
permit VBP O O
direct JJ O O
attribution NN O O
to TO O O
the DT O O
source NN O O
code NN O O
Steven NNP O O
Lai NNP O O
posted VBD O O
. . O O

This DT B-Entity 1
driver NN I-Entity O
attempts VBZ O O
to TO O O
hide VB B-Action 2
a DT B-Entity 3
wide JJ I-Entity O
swath NN I-Entity O
of IN I-Entity O
TCP NN I-Entity O
ports NNS I-Entity O
( VBP I-Entity O
40000-45000 CD I-Entity O
) NN I-Entity O
for IN B-Modifier 4
an DT B-Entity 5
unknown JJ I-Entity O
reason NN I-Entity O
, , O O
however RB O O
it PRP O O
is VBZ O O
suspected VBN O O
that IN O O
this DT O O
may MD O O
relate VB O O
to TO O O
the DT O O
potential JJ O O
network NN O O
relaying VBG O O
capability NN O O
alluded VBD O O
to TO O O
for IN O O
the DT O O
backdoor JJ O O
dll NN O O
. . O O

Implemented VBN O O
values NNS O O
for IN O O
cmdID NN O O
are VBP O O
as IN O O
follows VBZ O O
: : O O
cmdType NN O O
can MD O O
be VB O O
one CD O O
of IN O O
the DT O O
following VBG O O
( NNP O O
Interesting NNP O O
commands NNS O O
explained VBD O O
in IN O O
detail NN O O
) NN O O
: : O O
string0 NN O O
can MD O O
have VB O O
one CD O O
of IN O O
the DT O O
following JJ O O
values NNS O O
dependant JJ O O
upon IN O O
command NN O O
id NN O O
and CC O O
type NN O O
. . O O

cardmagic JJ O O
writes VBZ O O
: : O O
Windows NNP O O
Vista NNP O O
has VBZ O O
changed VBN O O
alot NN O O
on IN O O
network NN O O
module NN O O
, , O O
many JJ O O
old JJ O O
port NN O O
hiding NN O O
materials NNS O O
are VBP O O
no RB O O
longer RB O O
usable JJ O O
. . O O

In IN O O
this DT O O
post NN O O
, , O O
I PRP O O
will MD O O
share VB O O
with IN O O
you PRP O O
a DT O O
simple JJ O O
code NN O O
to TO O O
hide VB O O
port NN O O
under IN O O
Vista NNP O O
, , O O
hope VBP O O
it PRP O O
is VBZ O O
useful JJ O O
for IN O O
some DT O O
guys NNS O O
. . O O

Actually RB O O
under IN O O
Windows NNP O O
Vista NNP O O
, , O O
netstat.exe NNP O O
will MD O O
call VB O O
InternalGetTcpTable2 NN O O
which WDT O O
is VBZ O O
exported VBN O O
by IN O O
Iphlpapi.dll NN O O
to TO O O
list VB O O
all DT O O
open JJ O O
ports NNS O O
, , O O
then RB O O
InternalGetTcpTable2 NN O O
will MD O O
transfer VB O O
control NN O O
to TO O O
NsiAllocateAndGetTable NNP O O
which WDT O O
is VBZ O O
exported VBN O O
by IN O O
nsi.dll NN O O
, , O O
and CC O O
finally RB O O
nsi.dll NN O O
involve VBP O O
NsiEnumerateObjectsAllParametersEx NN O O
to TO O O
interact VB O O
with IN O O
kernel NN O O
mode NN O O
module NN O O
of IN O O
NSI NNP O O
-- : O O
nsiproxy.sys NNS O O
. . O O

nsiproxy.sys NNS O O
is VBZ O O
almost RB O O
like IN O O
a DT O O
wrapper NN O O
of IN O O
netio.sys NNS O O
, , O O
it PRP O O
will MD O O
then RB O O
call VB O O
internal JJ O O
subroutines NNS O O
of IN O O
netio.sys NNS O O
. . O O

Here RB O O
, , O O
we PRP O O
will MD O O
use VB O O
a DT O O
relatively RB O O
easy JJ O O
way NN O O
-- : O O
'' '' O O
NSI NNP O O
Kernel NNP O O
Module NNP O O
Dispatch NNP O O
Routine NNP O O
Hook NNP O O
'' '' O O
to TO O O
demonstrate VB O O
the DT O O
specified VBN O O
port NN O O
hiding VBG O O
uner JJ O O
Vista NNP O O
. . O O

Dispatch VB O O
routine JJ O O
hook NN O O
is VBZ O O
an DT O O
old JJ O O
topic NN O O
, , O O
this DT O O
time NN O O
, , O O
we PRP O O
will MD O O
apply VB O O
this DT O O
method NN O O
to TO O O
nsiproxy.sys NNS O O
. . O O

Please VB O O
focus NN O O
on IN O O
how WRB O O
to TO O O
handle VB O O
the DT O O
content NN O O
filtering VBG O O
of IN O O
NSI NNP O O
: : O O
) CD O O
Check VB O O
the DT O O
following JJ O O
code NN O O
( NNP O O
Notice NNP O O
: : O O
I PRP O O
only RB O O
tested VBD O O
it PRP O O
under IN O O
Windows NNP O O
Vista NNP O O
RTM NNP O O
32bit NNP O O
) NNP O O
: : O O
