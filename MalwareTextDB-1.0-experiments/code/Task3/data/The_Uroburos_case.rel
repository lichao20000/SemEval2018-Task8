In IN O O
February NNP O O
2014 CD O O
, , O O
the DT O O
experts NNS O O
of IN O O
the DT O O
G NNP O O
DATA NNP O O
SecurityLabs NNP O O
published VBD O O
an DT O O
analysis NN O O
of IN O O
Uroburos NNP O O
, , O O
the DT O O
rootkit NN O O
with IN O O
Russian JJ O O
roots NNS O O
. . O O

We PRP O O
explained VBD O O
that IN O O
a DT O O
link NN O O
exists VBZ O O
between IN O O
Uroburos NNP O O
and CC O O
the DT O O
Agent.BTZ NN O O
malware NN O O
, , O O
which WDT O O
was VBD O O
responsible JJ O O
for IN O O
'' '' O O
the DT O O
most RBS O O
significant JJ O O
breach NN O O
of IN O O
U.S. NNP O O
military JJ O O
computers NNS O O
ever RB O O
. . O O

'' '' O O
Nine CD O O
months NNS O O
later RB O O
, , O O
after IN O O
the DT O O
buzz NN O O
around IN O O
Uroburos NNP O O
, , O O
aka NNP O O
Snake NNP O O
or CC O O
Turla NNP O O
, , O O
we PRP O O
now RB O O
identified VBD O O
a DT O O
new JJ O O
generation NN O O
of IN O O
Agent.BTZ NN O O
. . O O

We PRP O O
dubbed VBD O O
it PRP O O
ComRAT NN O O
and CC O O
, , O O
by IN O O
now RB O O
, , O O
analyzed VBD O O
two CD O O
versions NNS O O
of IN O O
the DT O O
threat NN O O
( FW O O
v3.25 FW O O
and CC O O
v3.26 FW O O
) FW O O
. . O O

As IN O O
reported VBN O O
earlier RBR O O
this DT O O
year NN O O
, , O O
Agent.BTZ NN O O
used VBD O O
the DT O O
same JJ O O
encoding NN O O
key NN O O
and CC O O
the DT O O
installation NN O O
log NN O O
file NN O O
name NN O O
as IN O O
Uroburos NNP O O
. . O O

ComRAT NN O O
, , O O
in IN O O
its PRP$ O O
version NN O O
3.25 CD O O
, , O O
shows VBZ O O
the DT O O
same JJ O O
behavior NN O O
. . O O

Furthermore RB O O
, , O O
the DT B-Entity 1
attackers NNS I-Entity O
also RB O O
shared VBD B-Action 2
a DT B-Entity 3
C NN I-Entity O
& CC I-Entity O
C NN I-Entity O
domain NN I-Entity O
. . O O

The DT O O
latest JJS O O
version NN O O
of IN O O
ComRAT NN B-Entity 1
known VBN O O
to TO O O
us PRP O O
( FW O O
v3.26 FW O O
) FW O O
uses VBZ O O
a DT O O
new JJ O O
key NN O O
and CC O O
does VBZ O O
not RB O O
create VB O O
the DT O O
installation NN O O
log NN O O
file NN O O
, , O O
in IN O O
order NN O O
to TO O O
complicate VB B-Action 2
the DT B-Entity 3
analysis NN I-Entity O
and CC O O
to TO O O
disguise VB O O
the DT O O
link NN O O
between IN O O
the DT O O
two CD O O
cases NNS O O
. . O O

Another DT O O
very RB O O
interesting JJ O O
fact NN O O
: : O O
the DT B-Entity 1
attackers NNS I-Entity O
use VBP B-Action 2
COM NNP O O
Object NNP O O
hijacking NN O O
, , O O
the DT B-Entity 3
same JJ I-Entity O
persistence NN I-Entity O
mechanism NN I-Entity O
as IN O O
COMpfun NN O O
, , O O
which WDT O O
we PRP O O
described VBD O O
recently RB O O
. . O O

Taken VBN O O
everything NN O O
into IN O O
consideration NN O O
, , O O
the DT O O
indications NNS O O
we PRP O O
saw VBD O O
during IN O O
our PRP$ O O
analyzes NNS O O
lead VBP O O
to TO O O
the DT O O
supposition NN O O
that IN O O
the DT O O
group NN O O
behind IN O O
Agent.BTZ NNP O O
and CC O O
Uroburos NNP O O
is VBZ O O
still RB O O
active JJ O O
and CC O O
is VBZ O O
pursuing VBG O O
the DT O O
Agent.BTZ NN O O
path NN O O
once RB O O
more JJR O O
to TO O O
improve VB O O
and CC O O
change VB O O
the DT O O
RAT NN O O
. . O O

The DT O O
analyzed JJ O O
file NN O O
is VBZ O O
the DT O O
latest JJS O O
version NN O O
we PRP O O
identified VBD O O
: : O O
v3.26 NN O O
. . O O

The DT O O
version NN O O
identification NN O O
is VBZ O O
described VBN O O
in IN O O
the DT O O
chapter NN O O
'' '' O O
Log NN O O
files NNS O O
'' '' O O
. . O O

The DT O O
major JJ O O
difference NN O O
between IN O O
this DT O O
version NN O O
and CC O O
the DT O O
older JJR O O
version NN O O
( CD O O
s NN O O
) NN O O
will MD O O
be VB O O
described VBN O O
there RB O O
. . O O

The DT O O
first JJ O O
task NN O O
of IN O O
the DT B-Entity 1
malware NN I-Entity O
is VBZ O O
to TO O O
install VB B-Action 2
the DT B-Entity 3
file NN I-Entity O
credprov.tlb NN I-Entity O
in IN B-Modifier 4
% NN B-Entity 5
APPDATA CD I-Entity O
% NN I-Entity O
\Microsoft\ NN I-Entity O
. . O O

This DT O O
file NN O O
is VBZ O O
the DT O O
main JJ O O
payload NN O O
of IN O O
the DT O O
malware NN O O
. . O O

The DT B-Entity 1
dropper NN I-Entity O
executes VBZ O O
the DT O O
following JJ O O
command NN O O
in IN O O
order NN O O
to TO O O
install VB B-Action 2
a DT B-Entity 3
second JJ I-Entity O
file NN I-Entity O
: : O O
The DT O O
second JJ O O
file NN O O
is VBZ O O
shdocw.tlp NNP O O
. . O O

The DT O O
two CD O O
files NNS O O
are VBP O O
Microsoft NNP O O
Windows NNP O O
dynamic JJ O O
libraries NNS O O
. . O O

To TO O O
be VB O O
started VBN B-Action 1
during IN B-Modifier 2
the DT B-Entity 3
boot NN I-Entity O
process NN I-Entity O
of IN I-Entity O
the DT I-Entity O
infected JJ I-Entity O
machine NN I-Entity O
, , O O
the DT B-Entity 4
malware NN I-Entity O
creates VBZ B-Action 5
the DT B-Entity 6
following JJ I-Entity O
registry NN I-Entity O
key NN I-Entity O
: : O O
This DT O O
registry NN O O
key NN O O
is VBZ O O
used VBN O O
to TO O O
associate VB O O
the DT O O
library NN O O
shdocvw.tlp NN O O
to TO O O
the DT O O
object NN O O
42aedc87-2188-41fd-b9a3-0c966feabec1 NN O O
as IN O O
previously RB O O
explained VBN O O
in IN O O
the DT O O
article NN O O
about IN O O
COMpfun NN O O
. . O O

The DT O O
purpose NN O O
is VBZ O O
to TO O O
load VB B-Action 1
the DT B-Entity 2
library NN I-Entity O
into IN B-Modifier 3
each DT B-Entity 4
and CC I-Entity O
every DT I-Entity O
process NN I-Entity O
executed VBN I-Entity O
on IN I-Entity O
the DT I-Entity O
infected JJ I-Entity O
system NN I-Entity O
. . O O

If IN O O
the DT O O
version NN O O
of IN O O
the DT O O
malware NN O O
is VBZ O O
older JJR O O
than IN O O
3.26 CD O O
, , O O
the DT B-Entity 1
dropper NN I-Entity O
creates VBZ B-Action 2
an DT B-Entity 3
additional JJ I-Entity O
file NN I-Entity O
called VBN I-Entity O
winview.ocx NN I-Entity O
. . O O

We PRP O O
noticed VBD O O
that IN O O
the DT O O
file NN O O
name NN O O
is VBZ O O
still RB O O
the DT O O
same JJ O O
as IN O O
the DT O O
file NN O O
name NN O O
used VBN O O
by IN O O
Agent.BTZ NN O O
in IN O O
the DT O O
past NN O O
. . O O

The DT B-Entity 1
file NN I-Entity O
is VBZ B-Action 2
xored VBN I-Action O
with IN B-Modifier 3
the DT B-Entity 4
following VBG I-Entity O
obfuscation NN I-Entity O
key JJ I-Entity O
( NN O O
used VBN O O
by IN O O
both DT O O
, , O O
Uroburos NNP O O
and CC O O
Agent.BTZ NNP O O
) NNP O O
: : O O
Here RB O O
is VBZ O O
the DT O O
decoded VBN O O
log NN O O
file NN O O
content NN O O
: : O O
We PRP O O
can MD O O
notice VB O O
that IN O O
the DT B-Entity 5
malware NN I-Entity O
checks NNS B-Action 6
if IN B-Entity 7
an DT I-Entity O
older JJR I-Entity O
version NN I-Entity O
is VBZ I-Entity O
installed VBN I-Entity O
on IN I-Entity O
the DT I-Entity O
system NN I-Entity O
and CC O O
if IN O O
this DT O O
is VBZ O O
the DT O O
case NN O O
, , O O
the DT B-Entity 8
dropper NN I-Entity O
removes VBZ B-Action 9
the DT B-Entity 10
older JJR I-Entity O
version NN I-Entity O
. . O O

In IN O O
contrast NN O O
to TO O O
this DT O O
, , O O
in IN O O
our PRP$ O O
Uroburos NNP O O
analysis NN O O
, , O O
we PRP O O
found VBD O O
out RP O O
that IN O O
Uroburos NNP B-Entity 1
does VBZ B-Action 2
not RB I-Action O
install VB I-Action O
itself PRP B-Entity 3
in IN O O
case NN O O
a DT B-Entity 4
version NN I-Entity O
of IN I-Entity O
Agent.BTZ NN I-Entity O
was VBD B-Action 5
found VBN I-Action O
on IN B-Modifier 6
a DT B-Entity 7
system NN I-Entity O
. . O O

During IN O O
the DT O O
startup NN O O
of IN O O
the DT O O
infected JJ O O
machine NN O O
, , O O
the DT B-Entity 1
shdocvw.tlp NN I-Entity O
library NN I-Entity O
is VBZ B-Action 2
loaded VBN I-Action O
into IN B-Modifier 3
all DT B-Entity 4
processes NNS I-Entity O
. . O O

If IN O O
the DT O O
process NN O O
is VBZ O O
explorer.exe NN O O
, , O O
this DT B-Entity 1
library NN I-Entity O
will MD B-Action 2
load VB I-Action O
the DT B-Entity 3
other JJ I-Entity O
library NN I-Entity O
called VBN I-Entity O
credprov.tlb NN I-Entity O
. . O O

This DT O O
library NN O O
is VBZ O O
the DT O O
real JJ O O
payload NN O O
. . O O

Its PRP$ O O
features NNS O O
are VBP O O
common JJ O O
for IN O O
a DT O O
Remote NNP O O
Administration NNP O O
Tool NNP O O
( NNP O O
RAT NNP O O
) NNP O O
: : O O
ComRAT NN B-Entity 1
's POS I-Entity O
communication NN I-Entity O
to TO I-Entity O
the DT I-Entity O
command NN I-Entity O
and CC I-Entity O
control NN I-Entity O
server NN I-Entity O
is VBZ B-Action 2
performed VBN I-Action O
by IN O O
the DT B-Entity 3
browser NN I-Entity O
process NN I-Entity O
and CC O O
not RB O O
by IN O O
explorer.exe NN O O
in IN O O
order NN O O
to TO O O
avoid VB B-Action 4
being VBG B-Entity 5
blocked VBN I-Entity O
by IN I-Entity O
a DT I-Entity O
firewall NN I-Entity O
on IN I-Entity O
the DT I-Entity O
system NN I-Entity O
or CC I-Entity O
any DT I-Entity O
additional JJ I-Entity O
security NN I-Entity O
products NNS I-Entity O
. . O O

The DT B-Entity 1
communication NN I-Entity O
between IN I-Entity O
the DT I-Entity O
processes NNS I-Entity O
is VBZ B-Action 2
performed VBN I-Action O
by IN O O
named VBN B-Entity 3
pipe NN I-Entity O
. . O O

Two CD B-Entity 1
log NN I-Entity O
files NNS I-Entity O
are VBP B-Action 2
created VBN I-Action O
during IN B-Modifier 3
the DT B-Entity 4
malware NN I-Entity O
execution NN I-Entity O
: : O O
mskfp32.ocx NN B-Entity 5
and CC I-Entity O
msvcrtd.tlb NN I-Entity O
. . O O

If IN O O
the DT O O
malware NN O O
version NN O O
is VBZ O O
older JJR O O
than IN O O
3.26 CD O O
, , O O
the DT O O
xored JJ O O
key NN O O
is VBZ O O
the DT O O
same JJ O O
as IN O O
the DT O O
dropper NN O O
key NN O O
. . O O

Concerning VBG O O
the DT O O
version NN O O
3.26 CD O O
, , O O
the DT O O
malware NN O O
uses VBZ O O
a DT O O
new JJ O O
non-ASCII JJ O O
key NN O O
. . O O

Here RB O O
is VBZ O O
an DT O O
example NN O O
of IN O O
decoded VBN O O
log NN O O
file NN O O
for IN O O
the DT O O
version NN O O
3.26 CD O O
: : O O
We PRP O O
can MD O O
identify VB O O
the DT O O
version NN O O
of IN O O
the DT O O
malware NN O O
thanks NNS O O
to TO O O
the DT O O
PVer NN O O
flag NN O O
. . O O

The DT B-Entity 1
command NN I-Entity O
and CC I-Entity O
control NN I-Entity O
server NN I-Entity O
information NN I-Entity O
is VBZ B-Action 2
stored VBN I-Action O
in IN B-Modifier 3
the DT B-Entity 4
registry NN I-Entity O
, , O O
not RB O O
in IN O O
an DT O O
XML NN O O
, , O O
and CC O O
encoded VBN O O
: : O O
For IN O O
example NN O O
, , O O
in IN O O
the DT O O
analyzed JJ O O
sample NN O O
the DT O O
CC NN O O
is VBZ O O
: : O O
weather-online.hopto.org NN O O
. . O O

This DT O O
domain NN O O
is VBZ O O
far RB O O
from IN O O
unknown JJ O O
, , O O
as IN O O
it PRP O O
has VBZ O O
been VBN O O
mentioned VBN O O
in IN O O
BAE NNP O O
System NNP O O
's POS O O
Uroburos NNPS O O
( FW O O
aka FW O O
Snake NNP O O
) NN O O
analysis NN O O
paper NN O O
as IN O O
C NN O O
& CC O O
C NN O O
server NN O O
domain NN O O
for IN O O
the DT O O
Uroburos NNP O O
malware NN O O
. . O O

Another DT O O
connection NN O O
between IN O O
the DT O O
cases NNS O O
. . O O

If IN O O
the DT O O
malware NN O O
version NN O O
in IN O O
lower JJR O O
than IN O O
3.26 CD O O
, , O O
the DT B-Entity 1
XML NN I-Entity O
log NN I-Entity O
file NN I-Entity O
contains VBZ B-Action 2
the DT B-Entity 3
command NN I-Entity O
and CC I-Entity O
control NN I-Entity O
server NN I-Entity O
information NN I-Entity O
: : O O
Let VB O O
us PRP O O
summarize VB O O
the DT O O
similarities NNS O O
and CC O O
differences NNS O O
between IN O O
Agent.BTZ NNP O O
, , O O
Uroburos NNP O O
and CC O O
ComRAT NNP O O
as RB O O
far RB O O
as IN O O
we PRP O O
can MD O O
: : O O
Some DT O O
parts NNS O O
of IN O O
the DT O O
code NN O O
are VBP O O
exactly RB O O
the DT O O
same JJ O O
( NN O O
appears VBZ O O
to TO O O
be VB O O
copy VB O O
& CC O O
paste VB O O
) NN O O
. . O O

That DT O O
is VBZ O O
the DT O O
reason NN O O
why WRB O O
the DT O O
sample NN O O
is VBZ O O
detected VBN O O
as IN O O
Uroburos FW O O
( FW O O
aka FW O O
Turla FW O O
) FW O O
. . O O

The DT O O
same JJ O O
code NN O O
was VBD O O
used VBN O O
by IN O O
Agent.BTZ NN O O
and CC O O
also RB O O
the DT O O
dll NN O O
loaded VBN O O
into IN O O
userland NN O O
during IN O O
the DT O O
Uroburos NNP O O
analysis NN O O
. . O O

Command NN B-Entity 1
and CC I-Entity O
control NN I-Entity O
server NN I-Entity O
domains NNS I-Entity O
are VBP B-Action 2
shared VBN I-Action O
between IN B-Modifier 3
Uroburos NNP B-Entity 4
and CC I-Entity O
ComRAT NNP I-Entity O
. . O O

In IN O O
version NN O O
3.26 CD O O
, , O O
the DT O O
author NN O O
changed VBD O O
the DT O O
key NN O O
and CC O O
remove VB O O
the DT O O
known JJ O O
file NN O O
name NN O O
. . O O

This DT O O
action NN O O
can MD O O
be VB O O
an DT O O
indication NN O O
for IN O O
the DT O O
developer NN O O
's POS O O
effort NN O O
to TO O O
hide VB O O
this DT O O
connection NN O O
. . O O

The DT O O
main JJ O O
difference NN O O
is VBZ O O
the DT O O
design NN O O
. . O O

Agent.BTZ NN B-Entity 1
is VBZ B-Action 2
a DT B-Entity 3
common JJ I-Entity O
RAT NN I-Entity O
, , O O
a DT O O
simple JJ O O
library NN O O
executed VBN O O
on IN O O
an DT O O
infected JJ O O
machine NN O O
. . O O

ComRAT NN O O
is VBZ O O
more RBR O O
complex JJ O O
and CC O O
cleverer JJR O O
. . O O

The DT B-Entity 1
malware NN I-Entity O
is VBZ B-Action 2
loaded VBN I-Action O
into IN B-Modifier 3
each DT B-Entity 4
and CC I-Entity O
every DT I-Entity O
process NN I-Entity O
of IN I-Entity O
the DT I-Entity O
infected JJ I-Entity O
machine NN I-Entity O
and CC O O
the DT B-Entity 5
main JJ I-Entity O
part NN I-Entity O
( FW I-Entity O
payload FW I-Entity O
) NN I-Entity O
of IN I-Entity O
the DT I-Entity O
malware NN I-Entity O
is VBZ B-Action 6
only RB I-Action O
executed VBN I-Action O
in IN B-Modifier 7
explorer.exe NN B-Entity 8
. . O O

Furthermore RB O O
, , O O
the DT B-Entity 1
C NN I-Entity O
& CC I-Entity O
C NN I-Entity O
communication NN I-Entity O
blends VBZ B-Action 2
into IN B-Modifier 3
the DT B-Entity 4
usual JJ I-Entity O
browser NN I-Entity O
traffic NN I-Entity O
and CC O O
the DT B-Entity 5
malware NN I-Entity O
communicates VBZ B-Action 6
to TO B-Modifier 7
the DT B-Entity 8
browser NN I-Entity O
by IN B-Modifier 9
named VBN B-Entity 10
pipe NN I-Entity O
. . O O

It PRP O O
is VBZ O O
by IN O O
far RB O O
a DT O O
more RBR O O
complex JJ O O
userland NN O O
design NN O O
than IN O O
Agent.BTZ NN O O
. . O O

These DT O O
differences NNS O O
, , O O
mainly RB O O
the DT O O
more RBR O O
complex JJ O O
design NN O O
, , O O
lead VB O O
us PRP O O
to TO O O
give VB O O
this DT O O
malware NN O O
a DT O O
new JJ O O
name NN O O
. . O O

The DT O O
analyzed JJ O O
dropper NN O O
of IN O O
v3.25 NN O O
has VBZ O O
a DT O O
compilation NN O O
date NN O O
of IN O O
February NNP O O
6th JJ O O
2014 CD O O
. . O O

The DT O O
more RBR O O
recent JJ O O
dropper NN O O
of IN O O
v3.26 NN O O
, , O O
which WDT O O
has VBZ O O
all PDT O O
the DT O O
mentioned VBN O O
changes NNS O O
implemented VBD O O
, , O O
reveals VBZ O O
a DT O O
compilation NN O O
date NN O O
of IN O O
January NNP O O
3rd JJ O O
2013 CD O O
. . O O

We PRP O O
suspect VBP O O
that IN O O
this DT B-Entity 1
date NN I-Entity O
is VBZ B-Action 2
spoofed VBN I-Action O
in IN O O
order NN O O
to TO O O
disguise VB O O
that IN O O
this DT O O
is VBZ O O
in IN O O
fact NN O O
a DT O O
newer JJR O O
version NN O O
. . O O

This DT O O
analysis NN O O
shows VBZ O O
that IN O O
even RB O O
after IN O O
the DT O O
Uroburos NNP O O
publication NN O O
in IN O O
February NNP O O
2014 CD O O
, , O O
the DT O O
group NN O O
behind IN O O
this DT O O
piece NN O O
of IN O O
malware NN O O
seems VBZ O O
to TO O O
be VB O O
still RB O O
active JJ O O
. . O O

In IN O O
any DT O O
case NN O O
, , O O
the DT O O
ComRAT NN O O
developers NNS O O
implemented VBD O O
new JJ O O
mechanisms NNS O O
, , O O
changed VBD O O
keys NNS O O
, , O O
removed VBD O O
log NN O O
files NNS O O
to TO O O
hide VB O O
their PRP$ O O
activities NNS O O
and CC O O
tried VBD O O
to TO O O
disguise VB O O
the DT O O
connections NNS O O
between IN O O
the DT O O
RAT NN O O
ComRAT NN O O
, , O O
the DT O O
rootkit NN O O
Uroburos NNP O O
and CC O O
the DT O O
RAT NN O O
Agent.BTZ NN O O
as RB O O
much JJ O O
as IN O O
possible JJ O O
. . O O

However RB O O
, , O O
we PRP O O
can MD O O
still RB O O
follow VB O O
the DT O O
evolution NN O O
of IN O O
the DT O O
malware NN O O
by IN O O
comparing VBG O O
the DT O O
versions NNS O O
. . O O

The DT O O
persistence NN O O
mechanism NN O O
discovered VBN O O
in IN O O
October NNP O O
2014 CD O O
makes VBZ O O
it PRP O O
possible JJ O O
to TO O O
intrude VB O O
into IN O O
a DT O O
system NN O O
in IN O O
a DT O O
really RB O O
discreet JJ O O
manner NN O O
and CC O O
we PRP O O
estimate VBP O O
that IN O O
other JJ O O
actors NNS O O
will MD O O
use VB O O
the DT O O
same JJ O O
persistence NN O O
mechanism NN O O
in IN O O
the DT O O
near JJ O O
future NN O O
. . O O

We PRP O O
will MD O O
definitely RB O O
keep VB O O
our PRP$ O O
ears NNS O O
and CC O O
eyes NNS O O
open VBP O O
and CC O O
continue VBP O O
analyzing NN O O
. . O O

