3	O
In	O
the	O
'pipe	O
mode	O
'	O
of	O
operation	O
,	O
the	O
injected	O
DLL	O
will	O
start	O
communicating	O
with	O
the	O
pipe	O
server	O
by	O
sending	B-Action
messages	B-Entity
into	B-Modifier
the	B-Entity
established	I-Entity
inter-process	I-Entity
communication	I-Entity
pipes	I-Entity
.	O
4	O
Once	O
the	O
task	O
of	O
communication	O
with	O
C	O
&	O
C	O
is	O
delegated	O
to	O
the	O
pipe	O
server	O
,	O
it	O
will	O
start	O
communicating	O
with	O
the	O
C	O
&	O
C	O
,	O
bypassing	B-Action
the	B-Entity
host-based	I-Entity
firewalls	I-Entity
that	I-Entity
keep	B-Action
an	B-Entity
infected	I-Entity
system	I-Entity
process	I-Entity
in	O
a	O
white-list	O
.	O
The	O
reason	O
behind	O
the	O
pipes	O
usage	O
is	O
to	O
'legitimise	O
'	O
the	O
outbound	O
web	O
requests	O
,	O
forcing	O
them	O
to	O
originate	B-Action
from	B-Modifier
the	B-Entity
host	I-Entity
firewall-	I-Entity
friendly	I-Entity
system	I-Entity
services	I-Entity
.	O
Pipe	O
server	O
is	O
a	O
special	O
mode	O
of	O
the	O
injected	O
DLL	O
.	O
In	O
order	O
to	O
switch	O
into	O
that	O
mode	O
,	O
a	O
dedicated	O
thread	O
is	O
spawned	O
to	O
listen	O
for	O
IPC	O
messages	O
received	O
through	O
the	O
pipes	O
.	O
The	O
memory	O
pipes	O
used	O
by	O
Snake	O
are	O
named	O
as	O
:	O
Apart	O
from	O
GET	O
/	O
POST	O
requests	O
,	O
the	O
pipe	O
clients	O
(	O
infected	O
usermode	O
processes	O
)	O
may	O
also	O
ask	O
the	O
pipe	O
server	O
to	O
perform	O
other	O
operations	O
on	O
their	O
behalf	O
,	O
such	O
as	O
saving	O
data	O
into	O
a	O
temporary	O
file	O
,	O
copy	O
/	O
delete	B-Action
files	B-Entity
,	I-Entity
save	I-Entity
configuration	I-Entity
data	I-Entity
into	B-Modifier
the	B-Entity
registry	I-Entity
under	I-Entity
the	I-Entity
aforementioned	I-Entity
ShellCore	I-Entity
value	I-Entity
.	O
This	O
delegation	O
of	O
tasks	O
is	O
designed	O
to	O
keep	B-Action
infected	I-Action
processes	B-Entity
under	B-Modifier
the	B-Entity
radar	I-Entity
of	I-Entity
the	I-Entity
behavioural	I-Entity
analysis	I-Entity
tools	I-Entity
for	O
as	O
long	O
as	O
possible	O
.	O
Another	O
reason	O
is	O
to	O
overcome	O
account	O
restrictions	O
imposed	O
on	O
a	O
browser	O
process	O
in	O
order	O
to	O
be	O
able	O
to	O
write	O
into	O
files	O
/	O
registry	O
.	O
To	O
delegate	O
different	O
types	O
of	O
tasks	O
,	O
the	O
clients	O
send	O
messages	O
to	O
the	O
pipe	O
server	O
using	O
the	O
following	O
task	O
identification	O
headers	O
:	O
The	O
usermode	O
component	O
of	O
Snake	O
communicates	B-Action
with	B-Modifier
its	B-Entity
kernel-mode	I-Entity
driver	I-Entity
via	B-Modifier
a	B-Entity
device	I-Entity
called	I-Entity
\\.\vstor32	I-Entity
(	I-Entity
created	I-Entity
under	I-Entity
kernel	I-Entity
as	I-Entity
\Device\vstor32	I-Entity
)	I-Entity
.	O
In	B-Modifier
its	B-Entity
communication	I-Entity
protocol	I-Entity
with	B-Modifier
the	B-Entity
driver	I-Entity
it	I-Entity
uses	B-Action
the	B-Entity
IOCTL	I-Entity
code	I-Entity
of	I-Entity
0x222038	I-Entity
.	O
To	O
write	O
data	O
,	O
it	O
opens	O
the	O
device	O
with	O
CreateFile	O
(	O
''	O
\\.\vstor32	O
''	O
)	O
,	O
then	O
calls	O
DeviceIoControl	O
(	O
)	O
API	O
on	O
its	O
handle	O
with	O
IOCTL	O
code	O
of	O
0x222038	O
.	O
Configuration	O
parameters	O
along	O
with	O
the	O
initial	O
set	O
of	O
domain	O
names	O
are	O
hard-coded	O
within	O
the	O
body	O
of	O
the	O
DLL	O
.	O
However	O
,	O
the	O
data	O
appears	O
to	O
be	O
defined	O
in	O
the	O
structures	O
,	O
so	O
it	O
is	O
very	O
likely	O
the	O
DLL	O
could	O
be	O
generated	O
by	O
a	O
stand-alone	O
builder	O
that	O
'patches	O
'	O
the	O
DLL	O
with	O
the	O
new/updated	O
list	O
of	O
C	O
&	O
C	O
.	O
Analysis	O
of	O
the	O
commands	O
performed	O
by	O
the	O
malware	O
suggests	O
the	O
following	O
capabilities	O
:	O
Together	O
,	O
these	O
commands	O
provide	O
complete	O
backdoor	O
functionality	O
,	O
allowing	B-Action
remote	B-Entity
attacker	I-Entity
full	I-Entity
control	I-Entity
over	I-Entity
the	I-Entity
compromised	I-Entity
system	I-Entity
.	O
The	O
ability	O
to	O
update	O
the	O
driver	O
and	O
then	O
rely	O
on	O
its	O
communication	O
capabilities	O
means	O
that	O
the	O
components	O
of	O
Snake	O
are	O
flexible	O
,	O
making	O
possible	O
the	O
existence	O
of	O
the	O
hybrid	O
(	O
kernel-centric	O
and	O
usermode-centric	O
)	O
architectures	O
.	O
For	O
example	O
,	O
the	O
virtual	O
partitions	O
are	O
used	O
by	O
kernel-centric	O
Snake	O
variants	O
,	O
where	O
the	O
kernel-mode	O
driver	O
is	O
responsible	O
for	O
the	O
communications	O
.	O
If	O
such	O
a	O
driver	O
is	O
installed	O
via	O
an	O
update	O
,	O
the	O
usermode	O
component	O
can	O
be	O
instructed	O
to	O
delegate	B-Action
the	B-Entity
file	I-Entity
upload	I-Entity
task	I-Entity
to	B-Modifier
the	B-Entity
driver	I-Entity
by	O
copying	O
all	O
the	O
necessary	O
logs	O
into	O
the	O
shared	O
virtual	O
partition	O
,	O
physically	O
located	O
on	O
the	O
compromised	O
host	O
and	O
thus	O
,	O
accessible	O
from	O
kernel	O
.	O
This	B-Entity
particular	I-Entity
architecture	I-Entity
relies	B-Action
on	B-Modifier
a	B-Entity
kernel-mode	I-Entity
driver	I-Entity
to	O
carry	O
out	O
the	O
network	O
communications	O
.	O
The	O
usermode	O
DLLs	O
are	O
still	O
injected	O
into	O
the	O
system	O
processes	O
to	O
perform	O
high-level	O
tasks	O
.	O
The	O
delivery	O
mechanism	O
is	O
not	O
known	O
:	O
it	O
may	O
be	O
distributed	O
via	O
a	O
thumb-drive	O
,	O
a	B-Entity
phishing	I-Entity
email	I-Entity
attachment	I-Entity
,	O
or	O
be	B-Action
delivered	I-Action
via	B-Modifier
an	B-Entity
exploit	I-Entity
across	I-Entity
the	I-Entity
network	I-Entity
(	I-Entity
e.g	I-Entity
.	O
by	O
using	O
the	O
reconnaissance	O
tool	O
that	O
is	O
explained	O
later	O
)	O
.	O
Infection	O
starts	O
from	O
a	O
dropper	O
penetrating	O
into	O
the	O
compromised	O
system	O
where	O
it	O
is	O
allowed	O
to	O
run	O
.	O
Once	O
executed	O
,	O
the	B-Entity
dropper	I-Entity
installs	B-Action
the	B-Entity
kernel	I-Entity
mode	I-Entity
driver	I-Entity
in	O
a	O
pre-defined	O
location	O
.	O
The	B-Entity
dropper	I-Entity
itself	I-Entity
is	O
32-bit	O
,	O
so	O
it	O
will	O
run	O
both	O
on	O
32-bit	O
and	O
64-bit	O
Windows	O
OS	O
(	O
in	O
WoW64	O
mode	O
)	O
.	O
On	O
a	O
32-bit	O
OS	O
,	O
it	O
will	O
install	B-Action
a	B-Entity
32-bit	I-Entity
driver	I-Entity
.	O
On	O
a	O
64-bit	O
OS	O
,	O
it	O
will	O
install	B-Action
a	B-Entity
64-bit	I-Entity
driver	I-Entity
.	O
The	B-Entity
analysed	I-Entity
32-bit	I-Entity
dropper	I-Entity
creates	B-Action
a	B-Entity
driver	I-Entity
in	O
the	O
following	O
location	O
:	O
However	O
,	O
different	O
samples	O
may	O
use	B-Action
a	B-Entity
different	I-Entity
path	I-Entity
and	I-Entity
driver	I-Entity
file	I-Entity
name	I-Entity
.	O
For	O
example	O
,	O
some	O
samples	O
exposed	O
these	O
filenames	O
:	O
fdisk32.sys	O
,	O
A0009547.sys	O
,	O
or	O
Ultra3.sys	O
.	O
The	O
filename	O
of	O
the	O
dropper	O
could	O
be	O
rknginst.exe	O
or	O
fdiskmon.exe	O
.	O
Once	O
executed	O
,	O
the	O
driver	O
first	O
makes	O
sure	O
it	O
is	O
registered	O
under	O
a	O
pre-defined	O
name	O
,	O
such	O
as	O
Ultra3	O
.	O
Other	O
samples	O
may	O
have	O
a	O
different	O
registration	O
name	O
,	O
such	O
as	O
~ROOT	O
.	O
The	O
registration	O
is	O
ensured	O
with	O
creation	O
of	O
the	O
following	O
registry	O
entries	O
:	O
The	O
driver	O
then	O
flags	O
the	O
following	O
events	O
with	O
the	O
notification	O
purposes	O
:	O
The	O
rootkit	O
then	O
places	O
a	O
number	O
of	O
the	O
hooks	O
.	O
The	B-Entity
first	I-Entity
API	I-Entity
it	I-Entity
hooks	B-Action
is	O
IoCreateDevice	O
(	O
)	O
.	O
The	B-Entity
installed	I-Entity
hook	I-Entity
handler	I-Entity
calls	B-Action
the	B-Entity
original	I-Entity
API	I-Entity
and	O
then	O
checks	O
if	O
the	O
name	O
of	O
the	O
device	O
is	O
netbt	O
or	O
afd	O
.	O
If	O
so	O
,	O
it	O
will	O
install	B-Action
a	B-Entity
TDI	I-Entity
filter	I-Entity
driver	I-Entity
.	O
If	O
the	O
device	O
name	O
is	O
Null	O
,	O
Beep	O
,	O
tcpip	O
or	O
Nsiproxy	O
,	O
it	O
will	O
activate	O
itself	O
by	O
enabling	O
its	O
hooks	O
designed	O
to	O
hide	B-Action
the	B-Entity
presence	I-Entity
of	I-Entity
Snake	I-Entity
on	I-Entity
a	I-Entity
system	I-Entity
,	I-Entity
set	I-Entity
up	I-Entity
its	I-Entity
access	I-Entity
control	I-Entity
lists	I-Entity
and	I-Entity
the	I-Entity
messaging	I-Entity
system	I-Entity
.	O
In	O
order	O
to	O
hide	B-Action
its	B-Entity
components	I-Entity
,	I-Entity
the	I-Entity
driver	I-Entity
hooks	B-Action
the	B-Entity
following	I-Entity
APIs	I-Entity
:	O
For	O
example	O
,	O
the	O
hook	O
handlers	O
of	O
the	O
registry-related	O
APIs	O
will	O
block	O
access	O
to	O
the	O
registry	O
entries	O
that	O
contain	O
the	O
name	O
of	O
the	O
driver	O
.	O
In	O
one	O
example	O
,	O
the	O
rootkit	O
blocks	O
access	O
to	O
registry	O
entries	O
that	O
contain	O
the	O
strings	O
''	O
Ultra3	O
''	O
and	O
''	O
~ROOT	O
''	O
.	O
The	O
ZwReadFile	O
(	O
)	O
hook	O
handler	O
will	O
block	O
access	O
to	O
the	O
home	O
directory	O
where	O
the	O
rootkit	O
keeps	O
its	O
file	O
.	O
In	O
one	O
of	O
the	O
analysed	O
kernel-centric	O
Snake	O
samples	O
the	O
home	O
directory	O
was	O
hard-coded	O
as	O
%	O
windows	O
%	O
\	O
$	O
NtUninstallQ817473	O
$	O
,	O
so	O
it	O
blocked	O
file	O
read	O
access	O
from	O
that	O
directory	O
.	O
The	O
ZwClose	O
(	O
)	O
hook	O
handler	O
is	O
used	O
to	O
inject	B-Action
the	B-Entity
DLL	I-Entity
module	I-Entity
into	B-Modifier
the	B-Entity
userland	I-Entity
processes	I-Entity
.	O
The	B-Entity
hook	I-Entity
handler	I-Entity
for	I-Entity
ZwTerminateProcess	I-Entity
(	I-Entity
)	I-Entity
checks	I-Entity
if	B-Modifier
the	B-Entity
process	I-Entity
being	I-Entity
shut	I-Entity
down	I-Entity
is	I-Entity
svchost.exe	I-Entity
.	O
If	O
so	O
,	O
it	O
considers	O
it	O
to	O
be	O
a	O
system	O
shutdown	O
,	O
so	O
it	B-Entity
unloads	B-Action
its	B-Entity
usermode	I-Entity
DLL	I-Entity
and	O
deactivates	O
its	O
own	O
network	O
drivers	O
,	O
just	O
like	O
it	O
does	O
when	O
its	O
ZwShutdownSystem	O
(	O
)	O
hook	O
handler	O
gets	O
invoked	O
.	O
The	O
ObOpenObjectByName	O
(	O
)	O
hook	O
is	O
designed	O
to	O
hide	O
the	O
presence	O
of	O
its	O
virtual	O
partitions	O
(	O
described	O
later	O
)	O
.	O
To	O
encrypt	B-Action
data	B-Entity
stored	I-Entity
on	I-Entity
its	I-Entity
virtual	I-Entity
partitions	I-Entity
,	I-Entity
the	I-Entity
driver	I-Entity
sets	B-Action
a	B-Entity
hook	I-Entity
for	B-Modifier
another	B-Entity
API	I-Entity
:	O
To	O
re-infect	B-Action
the	B-Entity
usermode	I-Entity
process	I-Entity
svchost.exe	I-Entity
and	O
to	O
re-enable	O
its	O
network	O
drivers	O
,	O
the	O
rootkit	O
hooks	B-Action
these	B-Entity
APIs	I-Entity
:	O
Snake	O
then	O
proceeds	O
to	O
the	O
task	O
of	O
deep	O
packet	O
inspection	O
and	O
modification	O
.	O
In	O
order	O
to	O
accomplish	O
it	O
,	O
it	O
registers	O
a	O
callout	O
driver	O
for	O
Windows	O
Filtering	O
Platform	O
(	O
WFP	O
)	O
,	O
an	O
architecture	O
first	O
introduced	O
with	O
Windows	O
Vista	O
and	O
nowadays	O
normally	O
used	O
by	O
antivirus	O
and/or	O
intrusion	O
detection	B-Entity
systems	I-Entity
to	I-Entity
inspect/block	I-Entity
malicious	I-Entity
traffic	I-Entity
.	O
Snake	O
sets	O
filters	O
at	O
the	O
layers	O
FWPMLAYERSTREAMV4	O
and	O
FWPMLAYERALEFLOWESTABLISHEDV4	O
in	O
the	O
TCP/	O
IP	O
stack	O
,	O
so	O
that	O
its	B-Entity
callout	I-Entity
driver	I-Entity
is	B-Action
notified	I-Action
whenever	B-Modifier
a	B-Entity
TCP	I-Entity
connection	I-Entity
is	O
established	O
by	O
a	O
browser	O
.	O
When	O
that	O
happens	O
,	O
the	O
rootkit	O
triggers	O
an	O
event	O
named	O
\BaseNamedObjects\wininetactivate	O
.	O
When	O
the	O
data	O
arrives	O
,	O
it	O
is	O
intercepted	O
with	O
the	O
FwpsCopyStreamDataToBuffer0	O
(	O
)	O
API	O
,	O
and	O
then	O
scanned	O
for	O
the	O
presence	O
of	O
the	O
hidden	O
commands	O
from	O
C	O
&	O
C	O
.	O
The	B-Entity
driver	I-Entity
inspects	B-Action
bidirectional	B-Entity
network	I-Entity
data	I-Entity
on	O
a	O
per	O
stream	O
basis	O
,	O
as	O
it	O
's	O
located	O
right	O
on	O
the	O
stream	O
data	O
path	O
.	O
An	O
ability	O
to	O
manipulate	B-Action
data	B-Entity
streams	I-Entity
is	B-Action
provided	I-Action
with	B-Modifier
the	B-Entity
packet	I-Entity
injection	I-Entity
logic	I-Entity
below	I-Entity
,	O
allowing	O
Snake	O
to	O
covertly	O
insert	B-Action
traffic	B-Entity
destined	I-Entity
to	I-Entity
its	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
servers	I-Entity
:	O
In	O
order	O
to	O
qualify	O
as	O
a	O
browser	O
,	O
the	O
usermode	O
process	O
must	O
have	O
any	O
of	O
the	O
following	O
names	O
:	O
In	O
addition	O
to	O
WFP	O
,	O
Snake	O
also	O
hooks	B-Action
the	B-Entity
Transport	I-Entity
Driver	I-Entity
Interface	I-Entity
(	I-Entity
TDI	I-Entity
)	I-Entity
network	I-Entity
routines	I-Entity
by	I-Entity
setting	I-Entity
itself	I-Entity
up	I-Entity
as	I-Entity
a	I-Entity
TDI	I-Entity
filter	I-Entity
driver	I-Entity
.	O
TDI	O
is	O
considered	O
deprecated	O
and	O
will	O
be	O
removed	O
in	O
future	O
versions	O
of	O
Microsoft	O
Windows	O
,	O
but	O
it	O
's	O
still	O
supported	O
on	O
Windows	O
7	O
.	O
Being	B-Action
registered	I-Action
as	B-Modifier
a	B-Entity
TDI	I-Entity
driver	I-Entity
on	O
the	O
device	O
stack	O
,	O
Snake	O
hooks	B-Action
TCP	B-Entity
calls	I-Entity
.	O
This	O
way	O
it	B-Entity
intercepts	B-Action
all	B-Entity
requests	I-Entity
along	B-Modifier
with	I-Modifier
their	B-Entity
parameters	I-Entity
via	I-Entity
IRP	I-Entity
(	I-Entity
IO	I-Entity
request	I-Entity
package	I-Entity
)	I-Entity
hooks	I-Entity
.	O
By	O
'sniffing	O
'	O
all	O
the	O
requests	O
,	O
it	O
can	O
now	O
inspect	O
the	O
traffic	O
,	O
looking	O
for	O
and	O
then	O
parsing	O
GET	O
/	O
POST	O
HTTP	O
requests	O
and	O
also	O
SMTP	O
communications	O
,	O
in	O
order	O
to	O
distinguish	O
commands	O
addressed	O
to	O
itself	O
.	O
If	O
the	O
rootkit	O
detects	O
that	O
the	O
OS	O
version	O
is	O
pre-Vista	O
(	O
e.g	O
.	O
Windows	O
XP	O
)	O
or	O
Windows	O
Server	O
2008	O
(	O
e.g	O
.	O
Windows	O
Server	O
2003	O
)	O
,	O
it	O
will	O
invoke	O
FwpsStreamInjectAsync0	O
(	O
)	O
API	O
in	O
order	O
to	O
generate	O
outbound	O
requests	O
.	O
Whenever	O
the	O
client	O
establishes	O
connections	O
,	O
the	O
TDI	O
driver	O
will	O
also	O
'pulse	O
'	O
the	O
\BaseNamedObjects\wininetactivate	O
event	O
,	O
just	O
like	O
the	O
WPF	O
driver	O
's	O
component	O
of	O
it	O
,	O
in	O
order	O
to	O
notify	O
the	O
userland	O
service	O
about	O
the	O
event	O
.	O
The	O
data	O
that	O
the	O
driver	O
intercepts	O
,	O
along	O
with	O
the	O
important	O
notifications	O
,	O
is	B-Action
passed	I-Action
to	B-Modifier
the	B-Entity
userland	I-Entity
DLL	I-Entity
to	O
be	O
processed	O
.	O
If	O
the	O
data	O
contains	O
commands	O
from	O
C	O
&	O
C	O
,	O
the	O
DLL	O
module	O
is	O
expected	O
to	O
execute	B-Action
them	B-Entity
and	I-Entity
report	I-Entity
results	I-Entity
back	B-Modifier
to	I-Modifier
the	B-Entity
driver	I-Entity
to	O
be	O
delivered	O
back	O
to	O
C	O
&	O
C	O
.	O
For	O
NDIS	O
versions	O
5.X	O
,	O
Snake	O
rootkit	O
contains	O
code	O
that	O
installs	O
NDIS	O
filter	O
intermediate	O
driver	O
.	O
This	B-Entity
driver	I-Entity
is	I-Entity
set	I-Entity
up	I-Entity
above	I-Entity
a	I-Entity
miniport	I-Entity
driver	I-Entity
(	I-Entity
a	I-Entity
driver	I-Entity
that	I-Entity
communicates	B-Action
with	B-Modifier
the	B-Entity
physical	I-Entity
device	I-Entity
)	I-Entity
and	I-Entity
below	I-Entity
a	I-Entity
protocol	I-Entity
driver	I-Entity
(	I-Entity
a	I-Entity
driver	I-Entity
that	I-Entity
implements	B-Action
a	B-Entity
protocol	I-Entity
,	I-Entity
e.g	I-Entity
.	O
TCP/IP	O
)	O
.	O
The	O
driver	O
is	O
registered	O
with	O
NdisIMRegisterLayeredMiniport	O
(	O
)	O
API	O
.	O
After	O
that	O
,	O
the	B-Entity
drivers	I-Entity
hooks	B-Action
the	B-Entity
following	I-Entity
exports	O
within	O
ndis.sys	O
:	O
The	O
rootkit	O
contains	O
code	O
that	O
installs	B-Action
NDIS	B-Entity
filter	I-Entity
driver	I-Entity
for	I-Entity
NDIS	I-Entity
6.0	I-Entity
and	O
above	O
:	O
NDIS	O
filter	O
driver	O
configuration	O
is	O
stored	O
in	O
the	O
registry	O
entry	O
:	O
The	O
driver	O
is	O
registered	O
with	O
NdisFRegisterFilterDriver	O
(	O
)	O
API	O
.	O
After	O
that	O
,	O
the	B-Entity
drivers	I-Entity
hooks	B-Action
the	B-Entity
following	I-Entity
exports	O
within	O
ndis.sys	O
(	O
for	O
NDIS	O
6.0	O
)	O
:	O
Another	O
set	O
of	O
exports	O
it	O
attempts	O
to	O
hook	O
in	O
ndis.sys	O
(	O
for	O
NDIS	O
6.0	O
)	O
is	O
:	O
With	O
the	O
hooks	B-Action
installed	I-Action
,	I-Action
whenever	B-Modifier
the	B-Entity
network	I-Entity
adapter	I-Entity
driver	I-Entity
attempts	O
to	O
register	O
to	O
NDIS	O
,	O
or	O
whenever	O
there	O
is	O
an	O
attempt	O
to	O
install	B-Action
NDIS	B-Entity
intermediate	I-Entity
driver	I-Entity
or	I-Entity
NDIS	I-Entity
filter	I-Entity
driver	I-Entity
,	O
the	O
hook	O
handlers	O
will	O
register	O
Snake	O
's	O
own	O
MiniportXxx	O
functions	O
with	O
the	O
NDIS	O
library	O
.	O
With	O
its	O
own	O
miniport	O
handler	O
functions	O
,	O
it	O
can	O
send	O
/	O
receive	O
data	O
by	O
using	O
a	O
private	O
TCP/IP	O
stack	O
,	O
bypassing	B-Action
all	B-Entity
firewall	I-Entity
hooks	I-Entity
,	O
and	O
making	O
its	O
open	O
ports	O
invisible	O
to	O
scanners	O
.	O
The	O
Snake	O
rootkit	O
registers	O
itself	O
as	O
Network	O
Driver	O
Interface	O
Specification	O
(	O
NDIS	O
)	O
protocol	O
driver	O
.	O
Whenever	O
the	O
underlying	O
miniport	O
driver	O
receives	O
data	O
from	O
the	O
network	O
,	O
it	O
calls	O
NDIS	O
by	O
invoking	O
a	O
data	O
receive	O
indication	O
function	O
NdisMIndicateReceiveNetBufferLists	O
(	O
)	O
.	O
When	O
that	O
happens	O
,	O
NDIS	O
invokes	O
Snake	O
's	O
hook	O
function	O
(	O
ProtocolReceiveNetBufferLists	O
)	O
to	O
process	O
the	O
received	O
data	O
.	O
To	O
send	O
the	O
data	O
back	O
,	O
the	O
protocol	O
driver	O
defines	O
the	O
data	O
in	O
a	O
list	O
of	O
NETBUFFERLIST	O
structures	O
,	O
and	O
then	O
passes	O
them	O
to	O
NDIS	O
by	O
calling	O
NdisSendNetBufferLists	O
(	O
)	O
.	O
NDIS	O
,	O
in	O
turn	O
,	O
calls	O
the	O
miniport	O
driver's	O
MiniportSendNetBufferLists	O
(	O
)	O
function	O
to	O
forward	O
the	O
data	O
to	O
an	O
underlying	O
miniport	O
driver	O
.	O
Being	O
able	O
to	O
fully	O
manipulate	O
traffic	O
at	O
3	O
different	O
levels	O
(	O
NDIS	O
protocol	O
driver	O
,	O
TDI	O
Driver	O
,	O
and	O
WPF	O
callout	O
driver	O
)	O
,	O
Snake	O
is	O
able	O
to	O
'inject	O
'	O
the	O
traffic	O
into	O
existing	O
communications	O
to	O
reach	O
out	O
to	O
external	O
components	O
,	O
and	O
at	O
the	O
same	O
time	O
parse	O
all	O
incoming	O
traffic	O
to	O
detect	O
traffic	O
addressed	O
to	O
itself	O
:	O
As	O
the	B-Entity
driver	I-Entity
intercepts	B-Action
all	B-Entity
connections	I-Entity
(	I-Entity
e.g	I-Entity
.	O
on	O
TDIRECEIVE	O
TDI	O
event	O
or	O
ClientEventReceive	O
(	O
)	O
event	O
notification	O
triggered	O
through	O
its	O
TDI	O
Filter	O
Driver	O
)	O
,	O
it	B-Entity
parses	B-Action
all	B-Entity
incoming	I-Entity
HTTP	I-Entity
and	I-Entity
SMTP	I-Entity
traffic	I-Entity
to	O
see	O
if	O
it	O
can	O
be	O
authenticated	O
as	O
Snake	O
traffic	O
.	O
The	O
authentication	O
is	O
implemented	O
by	O
decrypting	O
the	O
data	O
and	O
making	O
sure	O
it	O
starts	O
with	O
the	O
markers	O
0xDEADBEAF	O
and	O
0xC001BA5E	O
(	O
which	O
appear	O
to	O
derive	O
from	O
'DEAD	O
BEEF	O
'	O
and	O
'COOL	O
BASE	O
'	O
)	O
.	O
Here	O
are	O
specific	O
steps	O
:	O
By	O
observing	O
such	O
behaviour	O
,	O
one	O
might	O
wonder	O
why	O
the	O
driver	O
is	O
expecting	O
HTTP	O
or	O
SMTP	O
clients	O
?	O
Why	O
does	O
it	B-Entity
act	I-Entity
like	I-Entity
HTTP/SMTP	I-Entity
server	I-Entity
processing	I-Entity
client	I-Entity
traffic	I-Entity
,	O
and	O
serving	O
back	O
normal	O
responses	O
as	O
per	O
the	O
protocol	O
?	O
For	O
example	O
,	O
in	O
HTTP	B-Entity
the	I-Entity
driver	I-Entity
will	I-Entity
respond	I-Entity
with	I-Entity
messages	I-Entity
like	I-Entity
''	I-Entity
HTTP/1.1	I-Entity
200	I-Entity
OK	I-Entity
''	I-Entity
or	I-Entity
''	I-Entity
HTTP/1.1	I-Entity
500	I-Entity
Server	I-Entity
Error	I-Entity
''	I-Entity
.	O
For	O
SMTP	O
traffic	O
,	O
it	O
communicates	O
back	O
normal	O
SMTP	O
server	O
responses	O
,	O
such	O
as	O
''	O
250	O
Sender	O
OK	O
''	O
,	O
''	O
503	O
Bad	O
sequence	O
of	O
commands	O
''	O
,	O
etc	O
.	O
The	B-Entity
reason	I-Entity
behind	I-Entity
such	I-Entity
behaviour	I-Entity
is	O
that	O
the	O
driver	O
is	O
acting	O
in	O
this	O
mode	O
like	O
a	O
proxy	O
,	O
routing	B-Action
requests	B-Entity
from	I-Entity
other	I-Entity
infected	I-Entity
hosts	I-Entity
to	B-Modifier
a	B-Entity
remote	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
.	O
Another	O
opportunity	O
this	O
mode	O
unlocks	O
is	O
a	O
peer-to-peer	O
network	O
mode	O
with	O
no	O
centralised	O
C	O
&	O
C	O
.	O
The	O
infected	O
hosts	O
are	O
capable	O
of	O
transferring	O
the	O
following	O
peer-2-peer	O
commands	O
defining	O
fragment	O
size	O
,	O
reliability	O
parameters	O
,	O
new	O
peer	O
information	O
,	O
peer	O
impersonation	O
flags	O
,	O
etc	O
.	O
:	O
Once	O
the	O
incoming	O
data	O
is	O
authenticated	O
and	O
decrypted	O
,	O
the	O
driver	O
passes	O
it	O
to	O
the	O
DLL	O
by	O
using	O
memory	O
pipes	O
.	O
For	O
example	O
,	O
on	O
HTTP	O
traffic	O
arrival	O
it	O
may	O
send	B-Entity
traffic	I-Entity
data	I-Entity
into	B-Modifier
a	B-Entity
memory	I-Entity
pipe	I-Entity
\Device\NamedPipe\isapihttp	I-Entity
,	O
and	O
then	O
,	O
send	B-Action
a	B-Entity
received	I-Entity
peer-2-peer	I-Entity
command	I-Entity
message	I-Entity
writepeernfo=	I-Entity
[	I-Entity
IPADDRESS	I-Entity
:	I-Entity
PORT	I-Entity
]	I-Entity
0fragnoscrambling=Y0	I-Entity
into	B-Modifier
another	B-Entity
memory	I-Entity
pipe	I-Entity
called	I-Entity
\Device\NamedPipe\isapidg	I-Entity
.	O
In	O
order	O
to	O
log	O
its	O
activity	O
,	O
the	B-Entity
driver	I-Entity
writes	B-Action
log	B-Entity
data	I-Entity
into	O
the	O
pipe	O
\Device\NamedPipe\isapilog	O
,	O
so	O
that	O
the	O
DLL	O
could	O
log	O
the	O
data	O
into	O
the	O
log	O
files	O
.	O
Full	O
list	O
of	O
the	O
named	O
pipes	O
used	O
for	O
communications	O
is	O
provided	O
below	O
:	O
Messages	O
submitted	O
into	O
the	O
pipes	O
are	O
wrapped	O
into	O
the	O
structures	O
.	O
The	O
structures	O
appear	O
to	O
contain	O
headers	O
to	O
allow	O
the	O
pipe	O
server	O
,	O
that	O
runs	B-Action
within	B-Modifier
an	B-Entity
infected	I-Entity
userland	I-Entity
module	I-Entity
,	O
to	O
identify	O
the	O
messages	O
first	O
and	O
then	O
unwrap	O
the	O
structures	O
accordingly	O
.	O
For	O
example	O
,	O
the	O
message	O
headers	O
could	O
be	O
:	O
Once	O
received	O
from	O
the	O
pipes	O
and	O
unwrapped/decoded	O
,	O
the	O
data	O
is	B-Action
then	I-Action
handled	I-Action
by	B-Modifier
the	B-Entity
usermode	I-Entity
DLL	I-Entity
as	I-Entity
per	I-Entity
the	I-Entity
data	I-Entity
intention	I-Entity
-	I-Entity
whether	I-Entity
it	I-Entity
's	I-Entity
a	I-Entity
traffic	I-Entity
sniffing	I-Entity
task	I-Entity
,	I-Entity
a	I-Entity
peer-2-peer	I-Entity
client	I-Entity
logic	I-Entity
,	O
a	O
logging	O
task	O
,	O
or	O
a	O
task	O
of	O
saving	O
received	O
files	O
into	O
the	O
virtual	O
volumes	O
.	O
The	B-Entity
driver	I-Entity
creates	B-Action
virtual	B-Entity
file	I-Entity
volumes	I-Entity
for	B-Modifier
encrypted	B-Entity
storage	I-Entity
of	I-Entity
its	I-Entity
files	I-Entity
and	I-Entity
configuration	I-Entity
data	I-Entity
:	O
The	O
volumes	O
are	O
mounted	O
from	O
the	O
virtual	O
file	O
systems	O
RawDisk1	O
and	O
RawDisk2	O
.	O
The	O
first	O
partition	O
is	O
created	O
with	O
the	O
following	O
steps	O
:	O
The	O
hook	B-Action
installed	I-Action
by	O
the	O
rootkit	O
on	O
IofCallDriver	O
(	O
)	O
API	O
provides	O
on-the-fly	O
data	O
encryption/decryption	O
whenever	O
that	O
data	O
is	O
written	O
to	O
or	O
read	O
from	O
the	O
volume	O
.	O
The	O
encryption	O
algorithm	O
is	O
based	O
on	O
CAST-128	O
,	O
with	O
the	O
hard-coded	O
key	O
stored	O
in	O
the	O
rootkit	O
body	O
.	O
As	O
a	O
result	O
,	O
whenever	O
the	O
data	O
is	O
saved	O
into	O
the	O
volume	O
Hd1	O
,	O
it	O
will	O
be	O
scrambled	O
on-the-fly	O
,	O
and	O
reflected	O
in	O
the	O
persistent	B-Entity
storage	I-Entity
file	I-Entity
hotfix.dat	I-Entity
,	O
which	O
is	O
physically	O
located	O
within	O
the	O
rootkit	O
's	O
'home	O
'	O
directory	O
:	O
Analysis	O
of	O
the	B-Entity
hotfix.dat	I-Entity
file	I-Entity
contents	I-Entity
reveals	O
it	O
's	O
a	O
fully	O
encrypted	O
file	O
with	O
flat	O
entropy	O
.	O
Thus	O
,	O
it	O
is	O
not	O
possible	O
to	O
reveal	O
the	O
contents	O
of	O
the	O
Snake	O
's	O
volume	O
by	O
accessing	O
the	O
contents	O
of	O
this	O
file	O
(	O
unless	O
the	O
encryption	O
is	O
broken	O
,	O
that	O
is	O
)	O
.	O
Enlisting	O
the	O
contents	O
of	O
the	O
created	O
volume	O
is	O
possible	O
,	O
along	O
with	O
creating	O
files	O
on	O
it	O
:	O
However	O
,	O
as	O
soon	O
as	O
IofCallDriver	O
(	O
)	O
hook	O
is	O
removed	O
,	O
the	O
same	O
'dir	O
'	O
command	O
will	O
fail	O
,	O
as	O
with	O
no	O
hook	O
the	O
rootkit	O
can	O
not	O
decrypt	O
the	O
scrambled	O
volume	O
:	O
The	O
second	O
volume	O
\\.\Hd2	O
is	O
not	O
mapped	O
to	O
a	O
file	O
,	O
so	O
when	O
a	O
computer	O
is	O
switched	O
off	O
,	O
its	O
contents	O
is	O
lost	O
.	O
Thus	O
,	O
it	O
could	O
be	B-Action
used	I-Action
as	B-Modifier
a	B-Entity
temporary	I-Entity
or	I-Entity
a	I-Entity
cache	I-Entity
storage	I-Entity
.	O
The	B-Entity
data	I-Entity
stored	I-Entity
in	I-Entity
\\.\Hd2	I-Entity
is	B-Action
encrypted	I-Action
the	O
same	O
way	O
the	O
first	O
volume	O
's	O
data	O
.	O
Both	O
volumes	O
appear	O
to	O
be	O
set	O
up	O
as	O
FAT	O
volumes	O
.	O
An	O
attempt	O
to	O
read	O
the	O
data	O
from	O
these	O
volumes	O
with	O
the	O
code	O
below	O
:	O
This	O
will	O
produce	B-Action
the	B-Entity
following	I-Entity
results	I-Entity
:	O
For	O
\\.\Hd1	O
:	O
For	O
\\.\Hd2	O
:	O
The	O
ability	O
to	O
keep	O
its	O
data	O
on	O
TrueCrypt-like	O
volumes	O
provides	O
Snake	O
with	O
a	O
powerful	O
ability	O
to	O
exchange	O
data	O
with	O
the	O
usermode	O
DLL	O
,	O
as	O
these	O
volumes	O
are	O
accessible	O
both	O
from	O
usermode	O
and	O
kernel	O
mode	O
.	O
Static	O
analysis	O
of	O
the	O
code	O
reveals	O
that	O
the	O
Snake	O
driver	O
uses	O
virtual	O
volumes	O
to	O
store	O
its	O
data	O
and	O
additional	O
files	O
on	O
it	O
.	O
For	O
example	O
,	O
it	O
stores	O
its	O
message	O
queue	O
in	O
a	O
file	O
called	O
:	O
The	O
message	O
queue	O
indicates	O
an	O
asynchronous	O
communication	O
model	O
between	O
kernel	O
mode	O
driver	O
and	O
a	O
usermode	O
DLL	O
,	O
e.g	O
.	O
to	O
pass	O
commands	O
,	O
configuration	O
parameters	O
,	O
binary	O
images	O
of	O
additional	O
Snake	O
components	O
.	O
Other	O
files	O
that	O
may	O
also	O
be	O
found	O
on	O
the	O
virtual	O
volume	O
are	O
:	O
klog	O
,	O
conlog	O
,	O
dump	O
,	O
rknginst.exe	O
,	O
where	O
rknginst.exe	O
could	O
be	B-Action
the	B-Entity
name	I-Entity
of	I-Entity
the	I-Entity
original	I-Entity
dropper	I-Entity
,	I-Entity
and	I-Entity
other	I-Entity
log	I-Entity
files	I-Entity
could	I-Entity
potentially	I-Entity
contain	I-Entity
executed	I-Entity
command	I-Entity
outputs	I-Entity
,	I-Entity
intercepted	I-Entity
keystrokes	I-Entity
,	O
and	O
other	O
output	O
logs	O
.	O
The	O
64-bit	O
version	O
of	O
Snake	O
must	O
deal	O
with	O
a	O
number	O
of	O
additional	O
security	O
protections	O
implemented	O
in	O
64-bit	O
editions	O
of	O
Microsoft	O
Windows	O
,	O
the	O
most	O
significant	O
of	O
which	O
are	O
kernel	O
driver	O
signature	O
validation	O
and	O
Kernel	O
Patch	O
Protection	O
(	O
more	O
commonly	O
known	O
as	O
PatchGuard	O
)	O
.	O
PatchGuard	O
is	O
a	O
feature	O
of	O
64-bit	O
Windows	O
which	O
aims	O
to	O
prevent	O
modification	O
of	O
the	O
Windows	O
kernel	O
,	O
something	O
that	O
is	O
often	O
performed	O
by	O
malware	O
attempting	O
to	O
hide	B-Action
itself	B-Entity
on	B-Modifier
an	B-Entity
infected	I-Entity
system	I-Entity
.	O
Although	O
PatchGuard	O
is	O
successful	O
at	O
preventing	O
kernel	O
patching	O
once	O
initialised	O
,	O
several	O
published	O
bypass	O
approaches	O
exist	O
,	O
.	O
The	O
technique	O
used	O
by	O
Snake	O
appears	O
to	O
be	O
similar	O
to	O
these	O
approaches	O
.	O
The	B-Entity
driver	I-Entity
signing	I-Entity
policy	I-Entity
enforced	I-Entity
by	I-Entity
all	I-Entity
64-bit	I-Entity
versions	I-Entity
of	I-Entity
Windows	I-Entity
from	I-Entity
Vista	I-Entity
onwards	I-Entity
requires	B-Action
all	B-Entity
kernel-mode	I-Entity
drivers	I-Entity
to	O
be	O
signed	O
with	O
a	O
valid	O
digital	O
signature	O
.	O
The	B-Entity
Snake	I-Entity
dropper	I-Entity
contains	O
both	O
32-bit	O
and	O
64-bit	O
unsigned	O
drivers	O
,	O
and	O
it	O
can	O
successfully	O
load	B-Action
its	B-Entity
unsigned	I-Entity
64-bit	I-Entity
driver	I-Entity
on	I-Entity
a	I-Entity
64-bit	I-Entity
version	I-Entity
of	I-Entity
Windows	I-Entity
XP	I-Entity
–	I-Entity
as	I-Entity
driver	I-Entity
signing	I-Entity
is	O
not	O
enforced	O
it	O
does	O
not	O
have	O
to	O
resort	O
to	O
any	O
tricks	O
under	O
this	O
OS	O
version	O
.	O
In	O
this	O
case	O
,	O
in	O
order	O
to	O
ensure	B-Action
the	B-Entity
driver	I-Entity
is	B-Action
loaded	I-Action
automatically	O
at	O
startup	O
,	O
the	O
dropper	O
can	O
install	B-Action
the	B-Entity
64-bit	I-Entity
driver	I-Entity
on	I-Entity
64-bit	I-Entity
Windows	I-Entity
XP	I-Entity
in	I-Entity
the	I-Entity
same	I-Entity
way	I-Entity
it	I-Entity
installs	B-Action
a	B-Entity
32-bit	I-Entity
driver	I-Entity
on	I-Entity
a	I-Entity
32-bit	I-Entity
version	I-Entity
of	I-Entity
Windows	I-Entity
XP	I-Entity
.	O
On	O
64-bit	O
versions	O
of	O
Windows	O
Vista	O
and	O
above	O
it	O
behaves	O
differently	O
.	O
Firstly	O
,	O
the	O
64-bit	O
unsigned	O
driver	O
file	O
is	O
created	O
as	O
usual	O
:	O
However	O
,	O
the	O
driver	O
is	O
not	O
registered	O
;	O
what	O
is	O
registered	O
instead	O
is	O
the	O
dropper	O
itself	O
.	O
To	O
do	O
that	O
,	O
the	B-Entity
dropper	I-Entity
first	I-Entity
copies	I-Entity
itself	I-Entity
as	O
:	O
The	O
dropper	O
then	O
registers	O
itself	O
as	O
a	O
service	O
to	O
ensure	B-Action
it	B-Entity
starts	O
every	O
time	O
Windows	O
is	O
booted	O
,	O
by	O
creating	O
the	O
values	O
:	O
Now	O
comes	O
the	O
most	O
interesting	O
part	O
:	O
does	O
the	O
dropper	O
manage	O
to	O
load	B-Action
its	B-Entity
64-bit	I-Entity
unsigned	I-Entity
driver	I-Entity
under	I-Entity
64-bit	I-Entity
versions	I-Entity
of	I-Entity
Windows	I-Entity
Vista	I-Entity
and	I-Entity
later	I-Entity
versions	I-Entity
,	O
such	O
as	O
64-bit	O
Windows	O
7/8	O
?	O
The	O
answer	O
:	O
Yes	O
,	O
it	O
does	O
.	O
Does	B-Action
it	B-Entity
resort	I-Entity
to	I-Entity
using	B-Modifier
bootkit	B-Entity
technology	O
,	O
which	O
has	O
been	O
used	O
in	O
the	O
past	O
to	O
bypass	O
protections	O
to	O
load	B-Action
unsigned	B-Entity
64-bit	I-Entity
drivers	I-Entity
?	O
The	O
answer	O
:	O
No	O
.	O
Bootkits	O
must	O
overwrite	B-Action
the	B-Entity
Master	I-Entity
Boot	I-Entity
Record	I-Entity
(	I-Entity
MBR	I-Entity
)	I-Entity
and	I-Entity
antivirus	I-Entity
products	I-Entity
are	O
well	O
trained	O
to	O
catch	O
that	O
kind	O
of	O
bad	O
behavior	O
.	O
The	O
masterminds	O
behind	O
Snake	O
rootkit	O
seem	O
to	O
be	O
well	O
aware	O
of	O
this	O
so	O
what	O
they	O
resorted	O
to	O
instead	O
is	O
leveraging	O
a	O
vulnerability	O
in	O
a	O
well-known	O
virtualization	O
product	O
called	O
VirtualBox	O
,	O
a	O
product	O
made	O
by	O
Oracle	O
which	O
is	O
widely	O
used	O
by	O
researchers	O
to	O
analyse	O
malware	O
.	O
VirtualBox	I-Entity
driver	I-Entity
version	I-Entity
1.6.2	O
was	O
released	O
in	O
June	O
2	O
,	O
2008	O
.	O
Two	O
months	O
later	O
,	O
in	O
August	O
2008	O
,	O
security	O
researchers	O
reported	O
that	O
its	O
main	O
driver	O
component	O
,	O
which	O
is	O
signed	O
under	O
the	O
entity	O
''	O
innotek	O
Gmbh	O
''	O
,	O
contained	B-Action
a	B-Entity
privilege	I-Entity
escalation	I-Entity
vulnerability	I-Entity
.	O
In	O
a	O
nutshell	O
,	O
the	O
VirtualBox	O
software	O
installs	B-Action
a	B-Entity
driver	I-Entity
called	O
VBoxDrv	O
.	O
The	O
driver	O
is	O
controlled	O
with	O
the	O
Input/Ouput	O
Control	O
Codes	O
(	O
32-bit	O
values	O
called	O
IOCTL	O
)	O
passed	O
along	O
DeviceIoControl	O
(	O
)	O
API	O
.	O
One	O
of	O
the	O
documented	O
transfer	O
methods	O
that	O
the	O
system	O
uses	O
to	O
pass	B-Action
data	B-Entity
between	I-Entity
the	I-Entity
caller	I-Entity
of	I-Entity
DeviceIoControl	I-Entity
(	I-Entity
)	I-Entity
API	I-Entity
and	I-Entity
the	I-Entity
driver	I-Entity
itself	I-Entity
is	O
called	O
METHODNEITHER	O
.	O
As	O
per	O
MSDN	O
documentation	O
,	O
METHODNEITHER	O
is	O
a	O
special	O
transfer	O
type	O
when	O
Input/Output	B-Entity
Request	I-Entity
Packet	I-Entity
(	I-Entity
IRP	I-Entity
)	I-Entity
supplies	O
the	O
user-mode	O
virtual	O
addresses	O
of	O
the	O
input	O
and	O
output	O
buffers	O
,	O
without	O
validating	O
or	O
mapping	O
them	O
.	O
It	O
is	O
the	O
responsibility	O
of	O
the	O
driver	O
to	O
validate	B-Action
the	B-Entity
addresses	I-Entity
sent	I-Entity
from	I-Entity
user	I-Entity
mode	I-Entity
in	B-Modifier
order	I-Modifier
to	I-Modifier
make	B-Entity
sure	I-Entity
those	I-Entity
addresses	I-Entity
are	O
valid	O
usermode	O
addresses	O
.	O
The	O
source	O
code	O
of	O
the	O
vulnerable	O
driver	O
(	O
shown	O
below	O
)	O
demonstrates	O
how	O
the	O
integer	O
value	O
of	O
the	O
rc	O
variable	O
is	O
first	O
derived	O
from	O
the	O
input	B-Entity
parameters	I-Entity
pDevObj	I-Entity
(	I-Entity
device	I-Entity
object	I-Entity
)	I-Entity
and	I-Entity
pIrp	I-Entity
(	I-Entity
request	I-Entity
packet	I-Entity
)	I-Entity
.	O
Next	O
,	O
that	O
integer	O
value	O
is	O
written	O
into	O
the	O
UserBuffer	O
-	O
an	O
arbitrary	O
address	O
,	O
pointed	O
by	O
the	O
input	B-Entity
parameter	I-Entity
pIrp	I-Entity
(	I-Entity
request	I-Entity
packet	I-Entity
)	I-Entity
.	O
As	O
there	O
are	O
no	O
validations	O
made	O
for	O
the	O
UserBuffer	O
an	O
attacker	O
can	O
craft	O
such	O
input	O
parameters	O
that	O
will	O
define	O
address	O
within	O
kernel	O
memory	O
to	O
patch	O
and	O
the	O
data	O
to	O
patch	O
it	O
with	O
:	O
Now	O
that	O
the	O
vulnerable	O
driver	O
can	O
be	O
used	O
as	O
a	O
weapon	O
to	O
patch	O
kernel	O
memory	O
,	O
all	O
the	O
malware	O
needs	O
to	O
do	O
is	O
to	O
patch	O
the	B-Entity
content	I-Entity
of	I-Entity
the	I-Entity
variable	I-Entity
nt	I-Entity
!	I-Entity
gCiEnabled	I-Entity
,	I-Entity
a	I-Entity
boolean	I-Entity
variable	I-Entity
''	I-Entity
Code	I-Entity
Integrity	I-Entity
Enabled	I-Entity
''	I-Entity
that	O
marks	O
whether	O
the	O
system	O
was	O
booted	O
in	O
WinPE	O
mode	O
.	O
When	O
running	O
in	O
WinPE	O
mode	O
there	O
is	O
no	O
Code	O
Integrity	O
control	O
,	O
therefore	O
by	O
enabling	O
this	O
mode	O
by	O
patching	O
only	O
one	O
bit	O
,	O
Code	O
Integrity	O
verification	O
is	O
disabled	O
so	O
that	O
the	O
unsigned	O
64-bit	O
driver	O
can	O
be	O
loaded	O
.	O
This	O
variable	O
is	O
used	O
within	O
the	O
function	O
SepInitializeCodeIntegrity	O
(	O
)	O
,	O
implemented	O
within	O
CI.dll	O
's	O
function	O
CiInitialize	O
(	O
)	O
and	O
imported	O
by	O
the	O
NT	O
core	O
(	O
ntoskrnl.exe	O
)	O
.	O
In	O
order	O
to	O
find	O
the	O
variable	O
in	O
kernel	O
memory	O
,	O
the	O
Snake	B-Entity
dropper	I-Entity
loads	B-Action
a	B-Entity
copy	I-Entity
of	I-Entity
the	I-Entity
NT	I-Entity
core	I-Entity
image	I-Entity
(	I-Entity
ntoskrnl.exe	I-Entity
)	I-Entity
,	O
locates	O
the	O
import	O
of	O
CI.dll	O
's	O
function	O
CiInitialize	O
(	O
)	O
,	O
and	O
then	O
SepInitializeCodeIntegrity	O
(	O
)	O
within	O
it	O
.	O
Then	O
it	O
parses	O
the	O
function	O
's	O
code	O
to	O
locate	O
the	O
offset	O
of	O
the	O
variable	O
.	O
Once	O
located	O
,	O
the	O
content	O
of	O
the	O
variable	O
nt	O
!	O
gCiEnabled	O
is	O
patched	O
in	O
kernel	O
memory	O
and	O
the	O
64-bit	O
unsigned	O
driver	O
is	O
loaded	O
.	O
This	O
explains	O
why	O
Snake	O
dropper	O
registers	O
itself	O
as	O
a	O
service	O
to	O
start	O
each	O
time	O
Windows	O
starts	O
:	O
in	O
order	O
to	O
install	B-Action
the	B-Entity
vulnerable	I-Entity
VBox	I-Entity
driver	I-Entity
first	O
,	O
then	O
pass	O
it	O
a	O
malformed	O
structure	O
to	O
disable	B-Action
Code	B-Entity
Integrity	I-Entity
control	I-Entity
with	B-Modifier
a	B-Entity
DeviceIoControl	I-Entity
(	I-Entity
)	I-Entity
API	I-Entity
call	I-Entity
,	O
and	O
finally	O
,	O
load	B-Action
the	B-Entity
driver	I-Entity
.	O
In	O
order	O
to	O
be	O
able	O
to	O
perform	O
the	O
steps	O
above	O
,	O
the	O
dropper	O
must	O
first	O
obtain	B-Action
Administrator	B-Entity
privileges	I-Entity
.	O
It	O
attempts	O
to	O
do	O
this	O
by	O
running	O
MS09-025	O
and	O
MS10-015	O
exploits	O
on	O
the	O
target	O
system	O
.	O
These	B-Entity
exploits	I-Entity
are	B-Action
bundled	I-Action
within	B-Modifier
the	B-Entity
dropper	I-Entity
in	B-Modifier
its	B-Entity
resource	I-Entity
section	I-Entity
as	I-Entity
executable	I-Entity
files	I-Entity
.	O
Other	O
resources	O
embedded	O
within	O
the	O
dropper	O
are	O
the	O
32-bit	O
and	O
64-bit	B-Entity
builds	I-Entity
of	I-Entity
its	I-Entity
driver	I-Entity
,	I-Entity
a	I-Entity
tool	I-Entity
for	B-Modifier
creating	B-Entity
NTFS	I-Entity
file	I-Entity
systems	I-Entity
,	I-Entity
and	I-Entity
the	I-Entity
initial	I-Entity
message	I-Entity
queue	I-Entity
file	I-Entity
which	I-Entity
is	B-Action
written	I-Action
into	B-Modifier
the	B-Entity
virtual	I-Entity
volume	I-Entity
.	O
The	O
message	O
queue	O
file	O
contains	O
configuration	O
data	O
and	O
the	O
libraries	O
that	O
will	O
be	B-Action
injected	I-Action
into	B-Modifier
usermode	B-Entity
processes	I-Entity
.	O
The	O
usermode	O
DLLs	O
injected	O
by	O
the	B-Entity
kernel-mode	I-Entity
driver	I-Entity
into	B-Modifier
the	B-Entity
userland	I-Entity
system	I-Entity
process	I-Entity
(	I-Entity
e.g	I-Entity
.	O
explorer.exe	I-Entity
)	I-Entity
are	O
:	O
The	O
rkctlWin32.dll/rkctlx64.dll	O
module	O
uses	O
the	O
following	O
hard-coded	O
named	O
pipe	O
for	O
communications	O
:	O
The	O
remote	O
commands	O
it	O
receives	O
appear	O
to	O
be	O
designed	O
to	O
control	O
other	O
components	O
of	O
Snake	O
:	O
The	O
injsnakeWin32.dll/injsnakex64.dll	O
module	O
exports	O
61	O
functions	O
.	O
It	O
is	O
designed	O
to	O
perform	O
the	O
high-level	O
tasks	O
such	O
as	O
:	O
When	O
the	O
DLL	O
activates	O
,	O
it	O
reads	O
configuration	O
parameters	O
from	O
the	O
configuration	O
queue	O
,	O
that	O
the	O
driver	O
creates	O
on	O
a	O
virtual	O
volume	O
.	O
One	O
of	O
the	O
parameters	O
defines	O
the	O
pipe	O
name	O
(	O
s	O
)	O
that	O
the	O
DLL	O
should	O
use	O
for	O
its	O
communications	O
.	O
The	B-Entity
remote	I-Entity
commands	I-Entity
received	I-Entity
by	I-Entity
this	I-Entity
Snake	I-Entity
DLL	I-Entity
module	I-Entity
are	O
designed	O
to	O
set	O
up	O
various	O
communication	O
parameters	O
:	O
To	O
post	O
the	O
data	O
,	O
the	O
DLL	O
can	O
use	B-Action
the	B-Entity
following	I-Entity
User-Agent	I-Entity
string	I-Entity
''	I-Entity
Mozilla/4.0	I-Entity
(	I-Entity
compatible	I-Entity
;	I-Entity
MSIE	I-Entity
6.0	I-Entity
)	I-Entity
''	I-Entity
.	O
It	O
may	O
rely	B-Action
on	B-Modifier
the	B-Entity
following	I-Entity
Internet	I-Entity
Media	I-Entity
types	I-Entity
(	I-Entity
MIME	I-Entity
types	I-Entity
)	I-Entity
for	B-Modifier
data	B-Entity
exfiltration	I-Entity
:	O
Request	O
type	O
it	O
uses	O
can	O
either	O
be	O
POST	O
of	O
GET	O
,	O
and	O
C	O
&	O
C	O
server	O
resource	O
name	O
is	O
/default.asp	O
.	O
One	O
of	O
the	O
Snake	O
components	O
that	O
could	O
have	O
been	B-Action
downloaded	I-Action
from	B-Modifier
a	B-Entity
remote	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
,	O
was	O
identified	O
as	O
a	O
network	O
reconnaissance	O
tool	O
.	O
When	O
run	O
as	O
a	O
command	O
line	O
tool	O
,	O
with	O
its	O
logic	O
defined	O
with	O
the	O
command	O
line	O
switches	O
,	O
this	O
tool	O
enumerates	B-Action
other	B-Entity
network	I-Entity
hosts	I-Entity
and	I-Entity
detects	B-Action
what	B-Entity
Windows	I-Entity
RPC	I-Entity
services	I-Entity
are	B-Action
enabled	I-Action
at	O
the	O
endpoints	O
.	O
It	O
carries	O
a	O
list	O
of	O
interface	O
identifiers	O
associated	O
with	O
the	O
named	O
pipes	O
.	O
It	O
then	O
uses	O
these	O
identifiers	O
to	O
write	O
a	O
message	O
to	O
and	O
read	O
a	O
message	O
from	O
the	O
associated	O
named	O
pipes	O
.	O
By	O
knowing	O
what	O
RPC	O
services	O
are	O
running	O
,	O
it	O
can	O
successfully	O
fingerprint	O
all	O
network	O
hosts	O
by	O
mimicking	O
the	O
Metasploit	O
's	O
logic	O
of	O
OS	O
fingerprinting	O
via	O
SMB	O
.	O
The	O
fingerprinting	O
allows	O
it	O
to	O
reveal	O
the	O
following	O
characteristics	O
for	O
each	O
host	O
found	O
in	O
the	O
network	O
:	O
The	O
data	O
it	B-Entity
retrieves	B-Action
is	I-Action
encrypted	I-Action
and	I-Action
saved	I-Action
into	B-Modifier
a	B-Entity
configuration	I-Entity
file	I-Entity
%	I-Entity
system	I-Entity
%	I-Entity
\vtmon.bin	I-Entity
.	O
This	O
file	O
is	O
then	O
further	O
encrypted	O
with	O
an	O
NTL-based	O
(	O
Number	O
Theory	O
Library	O
)	O
algorithm	O
and	O
is	O
uploaded	O
by	O
the	O
usermode-centric	O
Snake	O
rootkit	O
to	O
the	O
C	O
&	O
C	O
server	O
,	O
along	O
with	O
other	O
configuration	O
files	O
,	O
such	O
as	O
mtmon.sdb	O
,	O
mtmon32.sdb	O
,	O
gstatsnd.bin	O
,	O
gstat.bin	O
,	O
gstat32.bin	O
,	O
and	O
other	O
log	O
files	O
found	O
in	O
the	O
%	O
windows	O
%	O
\	O
$	O
NtUninstallQ	O
[	O
random	O
]	O
$	O
directory	O
.	O
By	B-Modifier
using	B-Entity
this	I-Entity
function	I-Entity
the	I-Entity
remote	I-Entity
attacker	I-Entity
can	O
identify	O
any	O
potentially	O
exploitable	O
hosts	O
located	O
in	O
the	O
same	O
network	O
as	O
the	O
victim	O
.	O
The	B-Entity
attacker	I-Entity
may	O
then	O
craft	O
an	O
exploit	O
against	O
those	O
hosts	O
,	O
possibly	O
by	O
using	O
the	O
Metasploit	O
framework	O
,	O
and	O
then	O
deliver	B-Action
the	B-Entity
generated	I-Entity
shellcode	I-Entity
back	B-Modifier
to	I-Modifier
the	B-Entity
reconnaissance	I-Entity
tool	I-Entity
to	O
be	O
applied	O
against	O
the	O
identified	O
hosts	O
by	O
running	O
the	O
tool	O
with	O
the	O
'expos	O
'	O
switch	O
.	O
If	O
the	O
tool	O
successfully	O
delivers	O
the	O
payload	O
and	O
exploits	O
the	O
remote	O
host	O
(	O
s	O
)	O
,	O
it	O
will	O
replicate	O
the	O
infection	O
across	O
the	O
network	O
,	O
taking	O
control	O
over	O
new	O
hosts	O
,	O
thus	O
repeating	O
the	O
infection	O
cycle	O
all	O
over	O
again	O
and	O
spreading	O
the	O
infection	O
further	O
.	O
Unlike	O
traditional	O
worm	O
techniques	O
,	O
this	O
process	O
is	O
rather	O
manual	O
,	O
but	O
its	O
danger	O
is	O
in	O
the	O
fact	O
that	O
the	O
attacker	O
can	O
flexibly	O
craft	O
new	O
attack	O
methods	O
,	O
adjusting	O
them	O
to	O
the	O
hosts	O
present	O
within	O
the	O
network	O
,	O
thus	O
preying	O
on	O
the	O
weakest	O
(	O
least	O
updated	O
,	O
most	O
vulnerable	O
)	O
victims	O
along	O
its	O
path	O
.	O
As	O
seen	O
from	O
the	O
check-in	O
logs	O
found	O
within	O
one	O
of	O
the	O
recent	O
samples	O
,	O
the	O
time	O
span	O
covers	O
almost	O
6	O
years	O
from	O
January	O
2007	O
till	O
December	O
2012	O
,	O
which	O
is	O
aligned	O
with	O
the	O
first	O
reports	O
of	O
Agent.BTZ	O
.	O
It	O
's	O
worth	O
noting	O
that	O
Agent.BTZ	O
used	O
the	O
same	O
XOR	O
key	O
for	O
its	O
logs	O
as	O
the	O
most	O
recent	O
variants	O
:	O
Log	O
files	O
created	O
by	O
the	O
latest	O
samples	O
of	O
Snake	O
,	O
compiled	O
in	O
2013	O
and	O
2014	O
,	O
were	O
successfully	O
decrypted	O
with	O
the	O
same	O
XOR	O
key	O
.	O
Other	O
similarities	O
include	O
the	O
usage	O
of	O
the	O
virtual	O
partition	O
\\.\Vd1	O
,	O
the	B-Entity
temporary	I-Entity
file	I-Entity
named	I-Entity
FA.tmp	I-Entity
,	O
usage	O
of	O
files	O
named	O
mswmpdat.tlb	O
,	O
wmcache.nld	O
,	O
winview.ocx	O
.	O
The	O
cyber-espionage	O
operation	O
behind	O
the	O
Snake	O
rootkit	O
is	O
well	O
established	O
,	O
a	O
sample	O
comiled	O
in	O
January	O
2006	O
indicates	O
that	O
the	O
activity	O
would	O
have	O
begun	O
in	O
at	O
least	O
2005	O
.	O
It	O
is	O
also	O
sophisticated	O
,	O
using	O
complex	O
techniques	O
for	O
evading	O
host	O
defences	O
and	O
providing	O
the	B-Entity
attackers	I-Entity
covert	I-Entity
communication	I-Entity
channels	I-Entity
.	O
Toolmarks	O
left	O
behind	O
by	O
the	O
authors	O
'vlad	O
'	O
&	O
'gilg	O
'	O
,	O
leave	O
tantalizing	O
clues	O
as	O
to	O
the	O
personas	O
behind	O
this	O
.	O
From	O
a	O
technical	O
perspective	O
,	O
Snake	O
demonstrates	O
two	O
very	O
different	O
approaches	O
to	O
the	O
task	O
of	O
building	O
a	O
cyber-espionage	O
toolkit	O
.	O
One	O
approach	O
is	O
to	O
delegate	B-Action
the	B-Entity
network	I-Entity
communication	I-Entity
engine	I-Entity
to	O
usermode	O
code	O
,	O
backed	O
up	O
by	O
a	O
usermode	O
rootkit	O
.	O
Another	O
approach	O
is	O
to	O
carry	O
out	O
all	O
of	O
the	O
communications	O
from	O
the	O
kernel-mode	O
driver	O
,	O
which	O
is	O
a	O
very	O
challenging	O
task	O
by	O
itself	O
.	O
The	O
complexity	O
of	O
the	O
usermode-centric	O
approach	O
is	O
on	O
par	O
with	O
Rustock	O
rootkit	O
-	O
it	O
uses	O
similar	O
techniques	O
.	O
It	O
's	O
an	O
old	O
well-polished	O
technology	O
that	O
evolved	O
over	O
the	O
years	O
and	O
demonstrated	O
its	O
resilience	O
and	O
survivability	O
under	O
the	O
stress	O
of	O
security	O
counter-	O
measures	O
.	O
The	O
complexity	O
of	O
the	O
kernel-centric	O
architecture	O
of	O
Snake	O
is	O
quite	O
unique	O
.	O
This	O
architecture	O
is	O
designed	O
to	O
grant	O
Snake	O
as	O
much	O
flexibility	O
as	O
possible	O
.	O
When	O
most	O
of	O
the	O
infected	O
hosts	O
are	O
cut	O
off	O
from	O
the	O
outside	O
world	O
,	O
it	O
only	O
needs	O
one	O
host	O
to	O
be	O
connected	O
online	O
.	O
The	B-Entity
traffic	I-Entity
is	B-Action
then	I-Action
routed	I-Action
through	B-Modifier
that	B-Entity
host	I-Entity
to	B-Modifier
make	B-Entity
external	I-Entity
control	I-Entity
and	I-Entity
data	I-Entity
exfiltration	I-Entity
still	O
possible	O
.	O
The	O
presence	O
of	O
the	O
reconnaissance	O
tool	O
in	O
the	O
Snake	O
operators	O
'	O
framework	O
suggests	O
the	O
existence	O
of	O
an	O
arsenal	O
of	O
infiltration	O
tools	O
,	O
designed	O
to	O
compromise	O
a	O
system	O
,	O
then	O
find	O
a	O
way	O
to	O
replicate	O
into	O
other	O
hosts	O
,	O
infect	O
them	O
,	O
and	O
spread	O
the	O
infection	O
even	O
further	O
.	O
As	O
demonstrated	O
,	O
the	O
backdoor	O
commands	O
allow	O
Snake	O
to	O
provide	B-Action
remote	B-Entity
attackers	I-Entity
with	I-Entity
full	I-Entity
remote	I-Entity
access	I-Entity
to	B-Modifier
the	B-Entity
compromised	I-Entity
system	I-Entity
.	O
Its	O
ability	O
to	O
hibernate	O
,	O
staying	O
fully	O
inactive	O
for	O
a	O
number	O
of	O
days	O
,	O
makes	O
its	O
detection	O
during	O
that	O
time	O
very	O
difficult	O
.	O
The	O
analysed	O
code	O
suggests	O
that	O
even	O
file	O
system	O
and	O
registry	O
operations	O
can	O
be	O
delegated	O
by	O
an	B-Entity
infected	I-Entity
module	I-Entity
to	B-Modifier
another	B-Entity
module	I-Entity
in	O
order	O
to	O
stay	B-Action
unnoticed	B-Entity
by	I-Entity
behaviour	I-Entity
analysis	I-Entity
engines	I-Entity
of	I-Entity
the	I-Entity
antivirus	I-Entity
products	I-Entity
,	O
and	O
to	O
overcome	B-Action
account	B-Entity
restrictions	I-Entity
of	I-Entity
the	I-Entity
browser	I-Entity
processes	I-Entity
so	I-Entity
that	I-Entity
the	I-Entity
injected	I-Entity
module	I-Entity
could	O
still	O
write	O
into	O
files	O
and	O
into	O
the	O
sensitive	O
registry	O
hives	O
.	O
The	O
logs	O
and	O
dumps	O
it	O
creates	O
on	O
the	O
hidden	O
virtual	O
volumes	O
contributes	O
to	O
its	O
stealthiness	O
too	O
.	O
A	O
great	O
deal	O
of	O
attention	O
has	O
also	O
been	O
given	O
to	O
keep	O
its	O
network	O
communications	O
as	O
quiet	O
as	O
possible	O
.	O
Its	O
ability	O
to	O
generate	B-Action
malicious	B-Entity
traffic	I-Entity
whenever	I-Entity
the	I-Entity
user	I-Entity
goes	I-Entity
online	I-Entity
and	I-Entity
start	B-Action
loading	I-Action
the	B-Entity
web	I-Entity
pages	I-Entity
allows	O
it	O
to	O
'blend	O
in	O
'	O
with	O
the	O
legitimate	O
communications	O
.	O
We	O
expect	O
much	O
more	O
will	O
be	O
uncovered	O
by	O
researchers	O
in	O
the	O
coming	O
weeks	O
as	O
the	O
capabilities	O
of	O
this	O
operation	O
are	O
further	O
fleshed	O
out	O
.	O
However	O
,	O
as	O
we	O
implied	O
in	O
the	O
opening	O
section	O
,	O
we	O
view	O
this	O
threat	O
to	O
be	O
a	O
permanent	O
feature	O
of	O
the	O
landscape	O
.	O
Whether	O
they	O
dismantle	O
this	O
toolset	O
and	O
start	O
from	O
scratch	O
,	O
or	O
continue	O
using	O
tools	O
which	O
have	O
been	O
exposed	O
,	O
remains	O
to	O
be	O
seen	O
.	O
For	O
their	O
targets	O
though	O
the	O
considerable	O
challenge	O
of	O
keeping	O
secrets	O
safe	O
on	O
sensitive	O
networks	O
will	O
certainly	O
continue	O
for	O
years	O
to	O
come	O
.	O
Original	O
release	O
date	O
:	O
December	O
19	O
,	O
2014	O
Microsoft	O
Windows	O
US-CERT	O
was	O
recently	O
notified	O
by	O
a	B-Entity
trusted	I-Entity
third	I-Entity
party	I-Entity
of	I-Entity
cyber	I-Entity
threat	I-Entity
actors	I-Entity
using	B-Modifier
a	B-Entity
Server	I-Entity
Message	I-Entity
Block	I-Entity
(	I-Entity
SMB	I-Entity
)	I-Entity
Worm	I-Entity
Tool	O
to	O
conduct	O
cyber	O
exploitation	O
activities	O
recently	O
targeting	O
a	O
major	O
entertainment	O
company	O
.	O
This	B-Entity
SMB	I-Entity
Worm	I-Entity
Tool	O
is	O
equipped	O
with	O
a	O
Listening	O
Implant	O
,	O
Lightweight	O
Backdoor	O
,	O
Proxy	O
Tool	O
,	O
Destructive	O
Hard	O
Drive	O
Tool	O
,	O
and	O
Destructive	O
Target	O
Cleaning	O
Tool	O
.	O
SMB	O
Worm	O
Tool	O
:	O
This	O
worm	O
uses	O
a	O
brute	O
force	O
authentication	O
attack	O
to	O
propagate	O
via	O
Windows	O
SMB	O
shares	O
.	O
It	B-Entity
connects	B-Action
home	B-Entity
every	I-Entity
five	I-Entity
minutes	I-Entity
to	I-Entity
send	B-Action
log	B-Entity
data	I-Entity
back	B-Modifier
to	I-Modifier
command	B-Entity
and	I-Entity
control	I-Entity
(	I-Entity
C2	I-Entity
)	I-Entity
infrastructure	I-Entity
if	B-Modifier
it	B-Entity
has	B-Action
successfully	I-Action
spread	I-Action
to	B-Modifier
other	B-Entity
Windows	I-Entity
hosts	I-Entity
via	I-Entity
SMB	I-Entity
port	I-Entity
445	O
.	O
The	O
tool	O
also	O
accepts	O
new	O
scan	O
tasking	O
when	O
it	O
connects	O
to	O
C2	O
.	O
There	O
are	O
two	O
main	O
threads	O
:	O
the	O
first	O
thread	O
calls	O
home	O
and	O
sends	B-Action
back	B-Modifier
logs	B-Entity
(	I-Entity
a	I-Entity
list	I-Entity
of	I-Entity
successful	I-Entity
SMB	I-Entity
exploitations	I-Entity
)	I-Entity
,	I-Entity
and	I-Entity
the	I-Entity
second	I-Entity
thread	I-Entity
attempts	I-Entity
to	I-Entity
guess	I-Entity
passwords	I-Entity
for	I-Entity
SMB	I-Entity
connections	I-Entity
.	O
If	O
the	O
password	O
is	O
correctly	O
guessed	O
,	O
a	O
file	O
share	O
is	O
established	O
and	O
file	O
is	O
copied	O
and	O
run	O
on	O
the	O
newly-infected	O
host	O
.	O
Listening	O
Implant	O
:	O
During	O
installation	O
of	O
this	O
tool	O
,	O
a	O
portion	O
of	O
the	O
binaries	O
is	O
decrypted	O
using	O
AES	O
,	O
with	O
a	O
key	O
derived	O
from	O
the	O
phrase	O
''	O
National	O
Football	O
League	O
.	O
''	O
Additionally	O
,	O
this	O
implant	O
listens	B-Action
for	B-Modifier
connections	B-Entity
on	I-Entity
TCP	I-Entity
port	I-Entity
195	I-Entity
(	I-Entity
for	I-Entity
''	I-Entity
sensvc.exe	I-Entity
''	I-Entity
and	I-Entity
''	I-Entity
msensvc.exe	I-Entity
''	I-Entity
)	I-Entity
and	I-Entity
TCP	I-Entity
port	I-Entity
444	I-Entity
(	I-Entity
for	I-Entity
''	I-Entity
netcfg.dll	I-Entity
''	I-Entity
)	I-Entity
.	O
Each	O
message	O
sent	O
to	O
and	O
from	O
this	O
implant	O
is	O
preceded	O
with	O
its	O
length	O
,	O
then	O
XOR	O
encoded	O
with	O
the	O
byte	O
0x1F	O
.	O
Upon	O
initial	O
connection	O
,	O
the	O
victim	O
sends	O
the	O
string	O
,	O
''	O
HTTP/1.1	O
GET	O
/dns	O
?	O
\x00	O
.	O
''	O
The	O
controller	O
then	O
responds	B-Action
with	B-Modifier
the	B-Entity
string	I-Entity
''	I-Entity
200	I-Entity
www.yahoo.com	I-Entity
!	I-Entity
\x00	I-Entity
''	I-Entity
(	I-Entity
for	I-Entity
''	I-Entity
sensvc.exe	I-Entity
''	I-Entity
and	I-Entity
''	I-Entity
msensvc.exe	I-Entity
''	I-Entity
)	I-Entity
or	I-Entity
with	I-Entity
the	I-Entity
string	I-Entity
''	I-Entity
RESPONSE	I-Entity
200	I-Entity
OK	I-Entity
!	I-Entity
!	I-Entity
''	I-Entity
(	I-Entity
for	I-Entity
''	I-Entity
netcfg.dll	I-Entity
''	I-Entity
)	I-Entity
.	O
The	B-Entity
controller	I-Entity
sends	B-Action
the	B-Entity
byte	I-Entity
''	I-Entity
!	I-Entity
''	I-Entity
(	I-Entity
0x21	I-Entity
)	I-Entity
to	O
end	O
the	O
network	O
connection	O
.	O
This	O
special	O
message	O
is	O
not	O
preceded	O
with	O
a	O
length	O
or	O
XOR	O
encoded	O
.	O
Lightweight	I-Entity
Backdoor	I-Entity
:	O
This	O
is	O
a	O
backdoor	O
listener	O
that	O
is	O
designed	O
as	O
a	O
service	O
DLL	O
.	O
It	O
includes	O
functionality	O
such	O
as	O
file	O
transfer	O
,	O
system	O
survey	O
,	O
process	O
manipulation	O
,	O
file	O
time	O
matching	O
and	O
proxy	O
capability	O
.	O
The	O
listener	O
can	O
also	O
perform	B-Action
arbitrary	B-Entity
code	I-Entity
execution	I-Entity
and	I-Entity
execute	I-Entity
commands	I-Entity
on	I-Entity
the	I-Entity
command	I-Entity
line	O
.	O
This	B-Entity
tool	I-Entity
includes	I-Entity
functionality	I-Entity
to	I-Entity
open	I-Entity
ports	I-Entity
in	B-Modifier
a	B-Entity
victim	I-Entity
host	I-Entity
's	I-Entity
firewall	I-Entity
and	I-Entity
take	I-Entity
advantage	I-Entity
of	I-Entity
universal	I-Entity
Plug	I-Entity
and	I-Entity
Play	I-Entity
(	I-Entity
UPNP	I-Entity
)	I-Entity
mechanisms	I-Entity
to	B-Modifier
discover	B-Entity
routers	I-Entity
and	I-Entity
gateway	I-Entity
devices	I-Entity
,	O
and	O
add	O
port	O
mappings	O
,	O
allowing	B-Entity
inbound	I-Entity
connections	I-Entity
to	I-Entity
victim	I-Entity
hosts	I-Entity
on	I-Entity
Network	I-Entity
Address	I-Entity
Translated	I-Entity
(	I-Entity
NAT	I-Entity
)	I-Entity
private	I-Entity
networks	I-Entity
.	O
There	O
are	O
no	O
callback	O
domains	O
associated	O
with	O
this	O
malware	O
since	O
connections	O
are	O
inbound	O
only	O
on	O
a	O
specified	O
port	O
number	O
.	O
Proxy	O
Tool	O
:	O
Implants	O
in	O
this	O
malware	O
family	O
are	O
typically	O
loaded	B-Action
via	B-Modifier
a	B-Entity
dropper	I-Entity
installed	I-Entity
as	I-Entity
a	I-Entity
service	I-Entity
,	O
then	O
configured	O
to	O
listen	O
on	O
TCP	O
port	O
443	O
.	O
The	O
implant	O
may	O
have	O
an	O
associated	O
configuration	O
file	O
which	O
can	O
contain	O
a	O
configurable	O
port	O
.	O
This	O
proxy	O
tool	O
has	O
basic	O
backdoor	O
functionality	O
,	O
including	O
the	O
ability	O
to	O
fingerprint	O
the	O
victim	O
machine	O
,	O
run	O
remote	O
commands	O
,	O
perform	O
directory	O
listings	O
,	O
perform	O
process	O
listings	O
,	O
and	O
transfer	O
files	O
.	O
Destructive	O
Hard	O
Drive	O
Tool	O
:	O
This	O
tool	O
is	O
a	O
tailored	O
hard-drive	O
wiping	O
tool	O
that	O
is	O
intended	O
to	O
destroy	O
data	O
past	O
the	O
point	O
of	O
recovery	O
and	O
to	O
complicate	O
the	O
victim	O
machine	O
's	O
recovery	O
.	O
If	O
the	O
CNE	O
operator	O
has	O
administrator-level	O
privileges	O
on	O
the	O
host	O
,	O
the	O
program	O
will	O
over-write	B-Action
portions	B-Entity
of	I-Entity
up-to	I-Entity
the	I-Entity
first	I-Entity
four	I-Entity
physical	I-Entity
drives	I-Entity
attached	I-Entity
,	I-Entity
and	I-Entity
over-write	I-Entity
the	I-Entity
master	I-Entity
boot	I-Entity
record	I-Entity
(	I-Entity
MBR	I-Entity
)	I-Entity
with	O
a	O
program	O
designed	O
to	O
cause	O
further	O
damage	O
if	O
the	O
hard	O
drive	O
is	O
re-booted	O
.	O
This	B-Entity
further	I-Entity
results	I-Entity
in	B-Modifier
the	B-Entity
victim	I-Entity
machine	I-Entity
being	O
non-operational	O
with	O
irrecoverable	O
data	O
.	O
(	O
There	O
is	O
a	O
caveat	O
for	O
machines	O
installed	O
with	O
the	O
windows	O
7	O
operating	O
system	O
:	O
windows	O
7	O
machines	O
will	O
continue	O
to	O
operate	O
in	O
a	O
degraded	O
state	O
with	O
the	O
targeted	O
files	O
destroyed	O
until	O
after	O
reboot	O
,	O
in	O
which	O
the	O
infected	O
MBR	O
then	O
wipes	B-Action
the	B-Entity
drive	I-Entity
.	O
)	O
If	O
the	O
actor	O
has	O
user-level	O
access	O
,	O
the	O
result	O
includes	O
specific	O
files	O
being	O
deleted	O
and	O
practically	O
irrecoverable	O
,	O
but	O
the	O
victim	O
machine	O
would	O
remain	O
usable	O
.	O
Destructive	O
Target	O
Cleaning	O
Tool	O
:	O
This	O
tool	O
renders	O
victim	O
machines	O
inoperable	O
by	O
overwriting	O
the	O
Master	O
Boot	O
Record	O
.	O
The	B-Entity
tool	I-Entity
is	B-Action
dropped	I-Action
and	I-Action
installed	I-Action
by	O
another	O
executable	O
and	O
consists	O
of	O
three	O
parts	O
:	O
an	O
executable	O
and	O
a	O
dll	O
which	O
contain	O
the	O
destructive	O
components	O
,	O
and	O
an	O
encoded	O
command	O
file	O
that	O
contains	O
the	O
actual	O
destruction	O
commands	O
to	O
be	O
executed	O
.	O
Network	O
Propagation	O
Wiper	O
:	O
The	O
malware	O
has	O
the	O
ability	O
to	O
propagate	O
throughout	O
the	O
target	O
network	O
via	O
built-in	O
Windows	O
shares	O
.	O
Based	O
on	O
the	O
username/password	O
provided	O
in	O
the	O
configuration	O
file	O
and	O
the	O
hostname/IP	O
address	O
of	O
target	O
systems	O
,	O
the	O
malware	O
will	O
access	O
remote	O
network	O
shares	O
in	O
order	O
to	O
upload	B-Action
a	B-Entity
copy	I-Entity
of	I-Entity
the	I-Entity
wiper	I-Entity
and	I-Entity
begin	B-Action
the	B-Entity
wiping	I-Entity
process	I-Entity
on	I-Entity
these	I-Entity
remote	I-Entity
systems	I-Entity
.	O
The	O
malware	O
uses	O
several	O
methods	O
to	O
access	O
shares	O
on	O
the	O
remote	O
systems	O
to	O
begin	O
wiping	O
files	O
.	O
Checking	O
for	O
existing	O
shares	O
via	O
''	O
\\hostname\admin	O
$	O
\system32	O
''	O
and	O
''	O
\\hostname\shared	O
$	O
\system32	O
''	O
or	O
create	B-Action
a	B-Entity
new	I-Entity
share	I-Entity
''	I-Entity
cmd.exe	I-Entity
/q	I-Entity
/c	I-Entity
net	I-Entity
share	I-Entity
shared	I-Entity
$	O
=	O
%	O
SystemRoot	O
%	O
/GRANT	O
:	O
everyone	O
,	O
FULL	O
''	O
.	O
Once	O
successful	O
,	O
the	B-Entity
malware	I-Entity
uploads	B-Action
a	B-Entity
copy	I-Entity
of	I-Entity
the	I-Entity
wiper	I-Entity
file	I-Entity
''	I-Entity
taskhostXX.exe	I-Entity
''	I-Entity
,	O
changes	O
the	O
file-time	O
to	O
match	O
that	O
of	O
the	O
built-in	O
file	O
''	O
calc.exe	O
''	O
,	O
and	O
starts	O
the	O
remote	O
process	O
.	O
The	B-Entity
remote	I-Entity
process	I-Entity
is	B-Action
started	I-Action
via	B-Modifier
the	B-Entity
command	I-Entity
''	I-Entity
cmd.exe	I-Entity
/c	I-Entity
wmic.exe	I-Entity
/node	I-Entity
:	O
hostname	O
/user	O
:	O
username	O
/password	O
:	O
pass	O
PROCESS	O
CALL	O
CREATE	O
''	O
.	O
Hostname	O
,	O
username	O
,	O
and	O
password	O
are	O
then	O
obtained	O
from	O
the	O
configuration	O
file	O
.	O
Afterwards	O
,	O
the	O
remote	O
network	O
share	O
is	O
removed	O
via	O
''	O
cmd.exe	O
/q	O
/c	O
net	O
share	O
shared	O
$	O
/delete	O
''	O
.	O
Once	O
the	O
wiper	O
has	O
been	O
uploaded	O
,	O
the	O
malware	O
reports	O
its	O
status	O
back	O
to	O
one	O
of	O
the	O
four	O
C2	O
IP	O
addresses	O
.	O
Technical	O
and	O
strategic	O
mitigation	O
recommendations	O
are	O
included	O
in	O
the	O
Solution	O
section	O
below	O
.	O
US-CERT	O
recommends	O
reviewing	O
the	O
Security	O
Tip	O
Handling	O
Destructive	O
Malware	O
#	O
ST13-003	O
.	O
Cyber	O
threat	O
actors	O
are	O
using	O
an	O
SMB	O
worm	O
to	O
conduct	O
cyber	O
exploitation	O
activities	O
.	O
This	O
tool	O
contains	O
five	O
components	O
–	O
a	O
listening	O
implant	O
,	O
lightweight	O
backdoor	O
,	O
proxy	O
tool	O
,	O
destructive	O
hard	O
drive	O
tool	O
,	O
and	O
destructive	O
target	O
cleaning	O
tool	O
.	O
The	B-Entity
SMB	I-Entity
worm	I-Entity
propagates	B-Action
throughout	B-Modifier
an	B-Entity
infected	I-Entity
network	I-Entity
via	B-Modifier
brute-force	B-Entity
authentication	I-Entity
attacks	I-Entity
,	O
and	O
connects	B-Action
to	B-Modifier
a	B-Entity
C2	I-Entity
infrastructure	I-Entity
.	O
Due	O
to	O
the	O
highly	O
destructive	O
functionality	O
of	O
this	O
malware	O
,	O
an	O
organization	O
infected	O
could	O
experience	O
operational	O
impacts	O
including	O
loss	O
of	O
intellectual	O
property	O
and	O
disruption	O
of	O
critical	O
systems	O
.	O
Users	O
and	O
administrators	O
are	O
recommended	O
to	O
take	O
the	O
following	O
preventive	O
measures	O
to	O
protect	O
their	O
computer	O
networks	O
:	O
Use	O
and	O
maintain	B-Action
anti-virus	B-Entity
software	I-Entity
–	I-Entity
Anti-virus	I-Entity
software	I-Entity
recognizes	O
and	O
protects	O
your	O
computer	O
against	O
most	O
known	O
viruses	O
.	O
It	O
is	O
important	O
to	O
keep	O
your	O
anti-virus	O
software	O
up-to-date	O
(	O
see	O
Understanding	O
Anti-Virus	O
Software	O
for	O
more	O
information	O
)	O
.	O
Keep	O
your	O
operating	O
system	O
and	O
application	O
software	O
up-to-date	O
–	O
Install	O
software	O
patches	O
so	O
that	O
attackers	O
ca	O
n't	O
take	O
advantage	O
of	O
known	O
problems	O
or	O
vulnerabilities	O
.	O
Many	O
operating	O
systems	O
offer	O
automatic	O
updates	O
.	O
If	O
this	O
option	O
is	O
available	O
,	O
you	O
should	O
enable	O
it	O
(	O
see	O
Understanding	O
Patches	O
for	O
more	O
information	O
)	O
.	O
Review	O
Security	O
Tip	O
Handling	O
Destructive	O
Malware	O
#	O
ST13-003	O
and	O
evaluate	O
their	O
capabilities	O
encompassing	O
planning	O
,	O
preparation	O
,	O
detection	O
,	O
and	O
response	O
for	O
such	O
an	O
event	O
.	O
Review	O
Recommended	O
Practices	O
for	O
Control	O
Systems	O
,	O
and	O
Improving	O
Industrial	O
Control	O
Systems	O
Cybersecurity	O
with	O
Defense-in-Depth	O
Strategies	O
(	O
pdf	O
)	O
.	O
The	O
following	O
is	O
a	O
list	O
of	O
the	O
Indicators	O
of	O
Compromise	O
(	O
IOCs	O
)	O
that	O
can	O
be	O
added	O
to	O
network	O
security	O
solutions	O
to	O
determine	O
whether	O
they	O
are	O
present	O
on	O
a	O
network	O
.	O
The	O
malware	O
has	O
the	O
following	O
characteristics	O
:	O
While	O
the	O
original	O
filename	O
of	O
this	O
file	O
is	O
unknown	O
,	O
it	O
was	O
likely	O
''	O
diskpartmg16.exe	O
''	O
.	O
This	B-Entity
file	I-Entity
serves	B-Action
as	B-Modifier
a	B-Entity
dropper	I-Entity
.	O
It	B-Entity
drops	B-Action
destructive	B-Entity
malware	I-Entity
:	O
''	O
igfxtrayex.exe	O
''	O
.	O
When	O
the	O
dropper	O
file	O
was	O
executed	O
,	O
it	O
started	O
a	O
second	O
instance	O
of	O
itself	O
with	O
''	O
-i	O
''	O
as	O
an	O
argument	O
,	O
and	O
then	O
terminated	O
.	O
The	B-Entity
second	I-Entity
instance	I-Entity
of	I-Entity
the	I-Entity
dropper	I-Entity
file	I-Entity
installed	B-Action
itself	B-Entity
as	B-Modifier
the	B-Entity
''	I-Entity
WinsSchMgmt	I-Entity
''	I-Entity
service	I-Entity
with	I-Entity
''	I-Entity
-k	I-Entity
''	I-Entity
as	B-Modifier
a	B-Entity
command	I-Entity
line	O
argument	O
,	O
started	O
the	O
service	O
,	O
and	O
then	O
terminated	O
.	O
The	B-Entity
''	I-Entity
WinsSchMgmt	I-Entity
''	I-Entity
service	I-Entity
executed	B-Action
the	B-Entity
file	I-Entity
with	O
''	O
-k	O
''	O
as	O
an	O
argument	O
,	O
which	O
started	O
another	O
instance	O
of	O
the	O
file	O
using	O
''	O
-s	O
''	O
as	O
an	O
argument	O
.	O
The	O
''	O
-s	O
''	O
instance	O
dropped	O
and	O
executed	O
''	O
igfxtrayex.exe	O
''	O
,	O
created	O
''	O
netver.dat	O
''	O
,	O
and	O
began	O
generating	B-Action
network	B-Entity
traffic	I-Entity
over	I-Entity
TCP	I-Entity
ports	I-Entity
445	I-Entity
and	I-Entity
139	I-Entity
to	I-Entity
victim	I-Entity
IP	I-Entity
addresses	I-Entity
.	O
This	O
is	O
a	O
log	O
file	O
created	O
by	O
the	O
dropper	O
,	O
and	O
appended	O
to	O
as	O
the	O
scans	O
progress	O
.	O
It	O
contains	O
what	O
appear	O
to	O
be	O
hostnames	O
,	O
IP	O
addresses	O
,	O
and	O
the	O
number	O
2	O
.	O
Entries	O
in	O
the	O
file	O
have	O
the	O
structure	O
''	O
HOSTNAME	O
|	O
IP	O
Address	O
|	O
2	O
''	O
.	O
This	O
file	O
is	O
destructive	O
malware	O
:	O
a	O
disk	B-Entity
wiper	I-Entity
with	I-Entity
network	I-Entity
beacon	I-Entity
capabilities	I-Entity
.	O
If	O
''	O
igfxtrayex.exe	O
''	O
is	O
run	O
with	O
no	O
parameters	O
,	O
it	O
creates	O
and	O
starts	O
a	O
copy	O
of	O
itself	O
with	O
the	O
''	O
–i	O
''	O
argument	O
.	O
After	O
10	O
minutes	O
,	O
the	O
''	O
igfxtrayex.exe	O
''	O
makes	O
three	O
copies	O
of	O
itself	O
and	O
places	O
them	O
in	O
the	O
same	O
directory	O
from	O
which	O
it	O
was	O
executed	O
.	O
These	O
copies	O
are	O
named	O
according	O
to	O
the	O
format	O
''	O
taskhostXX.exe	O
''	O
(	O
where	O
X	O
is	O
a	O
randomly	O
generated	O
ASCII	O
character	O
)	O
.	O
These	O
copies	O
are	O
then	O
executed	O
,	O
each	O
with	O
a	O
different	O
argument	O
(	O
one	O
being	O
''	O
-m	O
''	O
,	O
one	O
being	O
''	O
-d	O
''	O
and	O
the	O
other	O
''	O
-w	O
''	O
)	O
.	O
Network	O
connection	O
attempts	O
are	O
made	O
to	O
one	O
of	O
three	O
hard-coded	O
IP	O
addresses	O
in	O
a	O
random	O
order	O
to	O
port	O
8080	O
or	O
8000	O
.	O
If	O
a	O
connection	O
to	O
the	O
IP	O
address	O
can	O
not	O
be	O
made	O
,	O
it	O
attempts	O
to	O
connect	O
to	O
another	O
of	O
the	O
three	O
IP	O
addresses	O
,	O
until	O
connections	O
to	O
all	O
three	O
IP	O
addresses	O
have	O
been	O
attempted	O
.	O
The	O
following	O
command-line	O
string	O
is	O
then	O
executed	O
:	O
''	O
cmd.exe	O
/c	O
net	O
stop	O
MSExchangeIS	O
/y	O
''	O
.	O
A	O
120-minute	O
(	O
2	O
hour	O
)	O
sleep	O
command	O
is	O
issued	O
after	O
which	O
the	O
computer	O
is	B-Action
shut	I-Action
down	I-Action
and	I-Action
rebooted	I-Action
.	O
This	O
file	O
,	O
when	O
executed	O
,	O
starts	O
a	O
listener	O
on	O
localhost	O
port	O
80	O
.	O
It	O
has	O
3	O
files	O
contained	O
in	O
the	O
resource	O
section	O
;	O
all	O
xor	O
'd	O
with	O
0x63	O
.	O
This	B-Entity
SYS	I-Entity
file	I-Entity
is	O
a	O
commercially	O
available	O
tool	O
that	O
allows	O
read/write	O
access	O
to	O
files	O
and	O
raw	O
disk	B-Entity
sectors	I-Entity
for	I-Entity
user	I-Entity
mode	I-Entity
applications	I-Entity
in	I-Entity
Windows	I-Entity
2000	I-Entity
,	O
XP	O
,	O
2003	O
,	O
Vista	O
,	O
2008	O
(	O
32-bit	O
)	O
.	O
It	B-Entity
is	B-Action
dropped	I-Action
from	B-Modifier
resource	B-Entity
ID	I-Entity
0x81	I-Entity
of	I-Entity
''	I-Entity
igfxtrayex.exe	I-Entity
''	I-Entity
.	O
This	B-Entity
SYS	I-Entity
file	I-Entity
is	O
a	O
also	O
a	O
commercially	O
available	O
tool	O
that	O
allows	O
read/write	O
access	O
to	O
files	O
and	O
raw	O
disk	B-Entity
sectors	I-Entity
for	I-Entity
user	I-Entity
mode	I-Entity
applications	I-Entity
in	I-Entity
Windows	I-Entity
2000	I-Entity
,	O
XP	O
,	O
2003	O
,	O
Vista	O
,	O
2008	O
(	O
64-bit	O
)	O
.	O
It	B-Entity
is	B-Action
dropped	I-Action
from	B-Modifier
resource	B-Entity
ID	I-Entity
0x83	I-Entity
of	I-Entity
''	I-Entity
igfxtrayex.exe	I-Entity
''	I-Entity
.	O
A	O
summary	O
of	O
the	O
C2	O
IP	O
addresses	O
:	O
Snort	O
signatures	O
:	O
Listening	O
Implant	O
:	O
Lightweight	O
Backdoor	O
:	O
Proxy	O
Tool	O
:	O
Malware	O
associated	O
with	O
the	O
cyber	O
threat	O
actor	O
:	O
Below	O
are	O
potential	O
YARA	O
signatures	O
to	O
detect	O
malware	O
binaries	O
on	O
host	O
machines	O
:	O
Because	O
of	O
the	B-Entity
highly	I-Entity
destructive	I-Entity
functionality	I-Entity
of	I-Entity
the	I-Entity
malware	I-Entity
,	I-Entity
an	I-Entity
organization	I-Entity
infected	I-Entity
with	I-Entity
the	I-Entity
malware	I-Entity
could	I-Entity
experience	I-Entity
operational	I-Entity
impacts	I-Entity
including	I-Entity
loss	I-Entity
of	I-Entity
intellectual	I-Entity
property	I-Entity
(	I-Entity
IP	I-Entity
)	I-Entity
and	I-Entity
disruption	I-Entity
of	I-Entity
critical	I-Entity
systems	I-Entity
.	O
Actual	O
impact	O
to	O
organizations	O
may	O
vary	O
depending	O
on	O
the	O
type	O
and	O
number	O
of	O
systems	O
impacted	O
.	O
Implement	O
the	O
indicators	O
of	O
compromise	O
within	O
your	O
systems	O
for	O
detection	O
and	O
mitigation	O
purposes	O
.	O
Encourage	O
users	O
to	O
transfer	O
critical	O
files	O
to	O
network	O
shares	O
,	O
to	O
allow	O
for	O
central	O
backed	O
up	O
.	O
Execute	B-Action
daily	B-Entity
backups	I-Entity
of	I-Entity
all	I-Entity
critical	I-Entity
systems	I-Entity
.	O
Periodically	B-Entity
execute	B-Action
an	B-Entity
''	I-Entity
offline	I-Entity
''	I-Entity
backup	I-Entity
of	I-Entity
critical	I-Entity
files	I-Entity
to	B-Modifier
removable	B-Entity
media	I-Entity
.	O
Establish	O
emergency	O
communications	O
plans	O
should	O
network	O
resources	O
become	O
unavailable	O
.	O
Isolate	O
any	O
critical	O
networks	O
(	O
including	O
operations	O
networks	O
)	O
from	O
business	O
systems	O
.	O
Identify	O
critical	O
systems	O
and	O
evaluate	O
the	O
need	O
for	O
having	O
on-hand	O
spares	O
to	O
quickly	O
restore	O
service	O
.	O
Ensure	O
antivirus	O
is	O
up	O
to	O
date	O
.	O
Disable	I-Entity
credential	I-Entity
caching	I-Entity
for	I-Entity
all	I-Entity
desktop	I-Entity
devices	I-Entity
with	I-Entity
particular	I-Entity
importance	I-Entity
on	I-Entity
critical	I-Entity
systems	I-Entity
such	I-Entity
as	I-Entity
servers	I-Entity
and	I-Entity
restrict	I-Entity
the	I-Entity
number	I-Entity
of	I-Entity
cached	I-Entity
credential	I-Entity
for	I-Entity
all	I-Entity
portable	I-Entity
devices	I-Entity
to	O
no	O
more	O
than	O
three	O
if	O
possible	O
.	O
This	O
can	O
be	O
accomplished	O
through	O
a	O
Group	O
Policy	O
Object	O
(	O
GPO	O
)	O
.	O
Disable	O
AutoRun	O
and	O
Autoplay	O
for	O
any	O
removable	O
media	O
device	O
.	O
Prevent	O
or	O
limit	B-Action
the	B-Entity
use	I-Entity
of	I-Entity
all	I-Entity
removable	I-Entity
media	I-Entity
devices	I-Entity
on	I-Entity
systems	I-Entity
to	O
limit	O
the	O
spread	O
or	O
introduction	O
of	O
malicious	O
software	O
and	O
possible	O
exfiltration	O
data	O
,	O
except	O
where	O
there	O
is	O
a	O
valid	O
business	O
case	O
for	O
use	O
.	O
This	O
business	O
case	O
must	O
be	O
approved	O
by	O
the	O
organization	O
Chief	O
IT	O
Security	O
Officer	O
,	O
with	O
policy/guidance	O
on	O
how	O
such	O
media	O
should	O
be	O
used	O
.	O
Consider	O
restricting	O
account	O
privileges	O
.	O
It	O
is	O
our	O
recommendation	O
that	O
all	O
daily	O
operations	O
should	O
be	B-Action
executed	I-Action
using	B-Modifier
standard	B-Entity
user	I-Entity
accounts	I-Entity
unless	I-Entity
administrative	I-Entity
privileges	I-Entity
are	O
required	O
for	O
that	O
specific	O
function	O
.	O
Configure	O
all	O
standard	O
user	O
accounts	O
to	O
prevent	O
the	O
execution	O
and	O
installation	O
of	O
any	O
unknown	O
or	O
unauthorized	O
software	O
.	O
Both	O
standard	O
and	O
administrative	O
accounts	O
should	O
have	O
access	O
only	O
to	O
services	O
required	O
for	O
nominal	O
daily	O
duties	O
,	O
enforcing	O
the	O
concept	O
of	O
separation	O
of	O
duties	O
.	O
Lastly	O
,	O
disable	O
Web	O
and	O
email	O
capabilities	O
on	O
administrative	O
accounts	O
.	O
Compromise	O
of	O
admin	O
accounts	O
is	O
one	O
vector	O
that	O
allows	O
malicious	O
activity	O
to	O
become	O
truly	O
persistent	O
in	O
a	O
network	O
environment	O
.	O
Ensure	B-Action
that	B-Entity
password	I-Entity
policy	I-Entity
rules	I-Entity
are	I-Entity
enforced	I-Entity
and	I-Entity
Admin	I-Entity
password	I-Entity
values	I-Entity
are	B-Action
changed	I-Action
periodically	B-Entity
.	O
Consider	O
prohibiting	O
hosts	O
within	O
the	O
production	O
environment	O
or	O
DMZ	O
from	O
sharing	O
an	O
Active	O
Directory	O
enterprise	O
with	O
hosts	O
on	O
other	O
networks	O
.	O
Each	O
environment	O
should	O
have	O
separate	O
forests	O
within	O
Active	O
Directory	O
,	O
with	O
no	O
trust	O
relationships	O
allowed	O
between	O
the	O
forests	O
if	O
at	O
all	O
possible	O
.	O
If	O
necessary	O
,	O
the	O
trust	O
relationships	O
should	O
be	O
one-way	O
with	O
the	O
low	O
integrity	B-Entity
environment	I-Entity
trusting	I-Entity
the	I-Entity
higher	I-Entity
integrity	I-Entity
environment	I-Entity
.	O
Consider	O
deployment	O
of	O
a	O
coaching	O
page	O
with	O
click	O
through	O
acceptance	O
;	O
these	O
are	O
traditionally	O
deployed	O
in	O
an	O
environment	O
to	O
log	O
the	O
acceptance	O
of	O
network	O
acceptable	O
use	O
policy	O
or	O
to	O
notify	O
users	O
of	O
monitoring	O
.	O
Coaching	O
pages	O
also	O
provide	O
some	O
measure	O
of	O
protection	O
from	O
automated	O
malicious	O
activity	O
.	O
This	O
occurs	O
because	O
automated	O
malware	O
is	O
normally	O
incapable	O
of	O
physically	O
clicking	O
an	O
acceptance	O
radial	O
button	O
.	O
Automated	O
malware	O
is	O
traditionally	O
hardcoded	O
to	O
execute	O
,	O
then	O
retrieve	B-Action
commands	B-Entity
or	I-Entity
additional	I-Entity
executables	I-Entity
from	O
the	O
Internet	O
.	O
If	O
the	O
malware	O
is	O
unable	O
to	O
initiate	O
an	O
active	O
connection	O
,	O
the	O
full	O
train	O
of	O
infection	O
is	O
potentially	O
halted	O
.	O
The	O
danger	O
still	O
exists	O
that	O
the	O
physical	O
user	O
will	O
authorize	O
access	O
,	O
but	O
through	O
the	O
use	O
of	O
coaching	O
pages	O
,	O
infections	O
can	O
be	O
limited	O
or	O
at	O
least	O
the	O
rate	O
of	O
infection	O
reduced	O
.	O
Monitor	O
logs	O
--	O
Maintain	O
and	O
actively	O
monitor	O
a	O
centralized	O
logging	O
solution	O
that	O
keeps	O
track	O
of	O
all	O
anomalous	O
and	O
potentially	O
malicious	O
activity	O
.	O
Ensure	O
that	O
all	O
network	O
operating	O
systems	O
,	O
web	O
browsers	O
,	O
and	O
other	O
related	O
network	O
hardware	O
and	O
software	O
remain	O
updated	O
with	O
all	O
current	O
patches	O
and	O
fixes	O
.	O
Organizations	O
should	O
review	O
Security	O
Tip	O
Handling	O
Destructive	O
Malware	O
#	O
ST13-003	O
and	O
evaluate	O
their	O
capabilities	O
encompassing	O
planning	O
,	O
preparation	O
,	O
detection	O
,	O
and	O
response	O
for	O
such	O
an	O
event	O
.	O
Always	O
keep	O
your	O
patch	O
levels	O
up	O
to	O
date	O
,	O
especially	O
on	O
computers	O
that	O
host	O
public	O
services	O
accessible	O
through	O
the	O
firewall	O
,	O
such	O
as	O
HTTP	O
,	O
FTP	O
,	O
mail	O
,	O
and	O
DNS	O
services	O
.	O
Build	O
host	O
systems	O
,	O
especially	O
critical	O
systems	O
such	O
as	O
servers	O
,	O
with	O
only	O
essential	O
applications	O
and	O
components	O
required	O
to	O
perform	O
the	O
intended	O
function	O
.	O
Any	O
unused	O
applications	O
or	O
functions	O
should	O
be	O
removed	O
or	O
disabled	O
,	O
if	O
possible	O
,	O
to	O
limit	O
the	O
attack	O
surface	O
of	O
the	O
host	O
.	O
Implement	O
network	O
segmentation	O
through	O
V-LANs	O
to	O
limit	O
the	O
spread	O
of	O
malware	O
.	O
Consider	O
the	O
deployment	O
of	O
Software	O
Restriction	O
Policy	O
set	O
to	O
only	O
allow	O
the	O
execution	O
of	O
approved	O
software	O
(	O
application	O
whitelisting	O
)	O
.	O
Recommend	B-Action
the	B-Entity
whitelisting	I-Entity
of	I-Entity
legitimate	I-Entity
executable	I-Entity
directories	I-Entity
to	B-Modifier
prevent	B-Entity
the	I-Entity
execution	I-Entity
of	I-Entity
potentially	I-Entity
malicious	I-Entity
binaries	I-Entity
.	O
Consider	O
the	O
use	O
of	O
two-factor	O
authentication	O
methods	O
for	O
accessing	O
privileged	O
root	O
level	O
accounts	O
or	O
systems	O
.	O
Consider	O
deploying	O
a	O
two-factor	O
authentication	O
through	O
a	O
hardened	O
IPsec/VPN	O
gateway	O
with	O
split-tunneling	O
prohibited	O
for	O
secure	O
remote	O
access	O
.	O
Deny	O
direct	O
Internet	O
access	O
,	O
except	O
through	O
the	O
use	O
of	O
proxies	O
for	O
Enterprise	O
servers	O
and	O
workstations	O
.	O
Perform	O
regular	O
content	O
filtering	O
at	O
the	O
proxies	O
or	O
external	O
firewall	O
points	O
of	O
presence	O
.	O
Also	O
consider	O
the	O
deployment	O
of	O
an	O
explicit	O
versus	O
transparent	O
proxy	O
policy	O
.	O
Implement	B-Action
a	B-Entity
Secure	I-Entity
Socket	I-Entity
Layer	O
(	O
SSL	O
)	O
inspection	O
capability	O
to	O
inspect	O
both	O
ingress	O
and	O
egress	O
encrypted	O
network	O
traffic	O
for	O
potential	O
malicious	O
activity	O
.	O
Isolate	B-Action
network	B-Entity
services	I-Entity
,	O
such	O
as	O
email	O
and	O
Web	O
application	O
servers	O
by	O
utilizing	O
a	O
secure	O
multi-tenant	O
virtualization	O
technology	O
.	O
This	O
will	O
limit	O
the	O
damage	O
sustained	O
from	O
a	O
compromise	O
or	O
attack	O
of	O
a	O
single	O
network	O
component	O
.	O
Implement	O
best	O
practice	O
guidance	O
and	O
policy	O
to	O
restrict	O
the	O
use	O
of	O
non-Foundation	O
assets	O
for	O
processing	O
or	O
accessing	O
Foundation-controlled	O
data	O
or	O
systems	O
(	O
e.g.	O
,	O
working	O
from	O
home	O
,	O
or	O
using	O
a	O
personal	O
device	O
while	O
at	O
the	O
office	O
)	O
.	O
It	O
is	O
difficult	O
to	O
enforce	O
corporate	O
policies	O
,	O
detect	O
intrusions	O
,	O
and	O
conduct	O
forensic	O
analysis	O
or	O
remediate	O
compromises	O
on	O
non-corporate	O
owned	O
devices	O
.	O
Minimize	B-Entity
network	I-Entity
exposure	I-Entity
for	I-Entity
all	I-Entity
control	I-Entity
system	I-Entity
devices	I-Entity
.	O
Control	I-Entity
system	I-Entity
devices	I-Entity
should	O
not	O
directly	O
face	O
the	O
Internet	O
.	O
Place	I-Entity
control	I-Entity
system	I-Entity
networks	I-Entity
behind	I-Entity
firewalls	I-Entity
,	O
and	O
isolate	O
or	O
air	O
gap	O
them	O
from	O
the	O
business	O
network	O
.	O
When	O
remote	O
access	O
is	O
required	O
,	O
use	O
secure	O
methods	O
,	O
such	O
as	O
Virtual	O
Private	O
Networks	O
(	O
VPNs	O
)	O
,	O
recognizing	O
that	O
VPN	O
is	O
only	O
as	O
secure	O
as	O
the	O
connected	O
devices	O
.	O
Industrial	O
Control	O
System	O
(	O
ICS	O
)	O
-CERT	O
and	O
US-CERT	O
remind	O
organizations	O
to	O
perform	O
proper	O
impact	O
analysis	O
and	O
risk	O
assessment	O
prior	O
to	O
taking	O
defensive	O
measures	O
.	O
The	O
energy	O
sector	O
has	O
become	O
a	O
major	O
focus	O
for	O
targeted	O
attacks	O
and	O
is	O
now	O
among	O
the	O
top	O
five	O
most	O
targeted	O
sectors	O
worldwide	O
.	O
Companies	O
in	O
the	O
sector	O
are	O
facing	O
a	O
growing	O
risk	O
of	O
having	O
their	O
services	O
interrupted	O
or	O
losing	O
data	O
.	O
The	O
threat	O
to	O
energy	O
firms	O
is	O
only	O
likely	O
to	O
increase	O
in	O
the	O
coming	O
years	O
as	O
new	O
developments	O
,	O
such	O
as	O
further	O
extensions	O
of	O
smart	O
grids	O
and	O
smart	O
metering	O
expose	O
more	O
infrastructure	O
to	O
the	O
Internet	O
.	O
Equipment	O
that	O
is	O
not	O
connected	O
to	O
the	O
Internet	O
and	O
other	O
networks	O
is	O
not	O
immune	O
to	O
threats	O
and	O
there	O
has	O
already	O
been	O
a	O
number	O
of	O
successful	O
attacks	O
against	O
isolated	O
systems	O
.	O
Operators	O
of	O
critical	O
infrastructure	O
,	O
as	O
well	O
as	O
energy	O
utility	O
companies	O
,	O
need	O
to	O
be	O
aware	O
of	O
these	O
threats	O
and	O
prepare	O
accordingly	O
.	O
The	O
threat	O
to	O
energy	O
firms	O
comes	O
from	O
several	O
different	O
sources	O
.	O
In	O
some	O
cases	O
,	O
espionage	O
from	O
competitors	O
is	O
the	O
primary	O
motive	O
,	O
with	O
data	O
on	O
new	O
projects	O
,	O
exploration	O
and	O
finances	O
being	O
targeted	O
.	O
Disruption	O
and	O
destruction	O
are	O
the	O
goals	O
of	O
other	O
attacks	O
.	O
Some	O
instances	O
appear	O
to	O
be	O
state	O
sponsored	O
,	O
such	O
as	O
the	O
disruption	O
of	O
the	O
Iranian	O
nuclear	O
program	O
by	O
the	O
Stuxnet	O
worm	O
in	O
2010	O
,	O
one	O
of	O
the	O
attacks	O
that	O
began	O
this	O
trend	O
.	O
Others	O
appear	O
to	O
be	O
the	O
work	O
of	O
hacktivists	O
with	O
political	O
or	O
environmental	O
agendas	O
.	O
Internal	I-Entity
attackers	I-Entity
,	O
like	O
disgruntled	O
employees	O
,	O
are	O
also	O
a	O
major	O
source	O
of	O
attacks	O
that	O
often	O
lead	O
to	O
service	O
disruption	O
.	O
The	B-Entity
majority	I-Entity
of	I-Entity
the	I-Entity
actors	I-Entity
behind	I-Entity
these	I-Entity
attacks	I-Entity
have	O
grown	O
more	O
sophisticated	O
in	O
the	O
way	O
they	O
attack	O
.	O
During	O
the	O
monitoring	O
period	O
from	O
July	O
2012	O
to	O
June	O
2013	O
,	O
we	O
observed	O
an	O
average	O
of	O
74	O
targeted	O
attacks	O
per	O
day	O
globally	O
.	O
Of	O
these	O
,	O
nine	O
attacks	O
per	O
day	O
targeted	O
the	O
energy	O
sector	O
.	O
Accounting	O
for	O
16.3	O
percent	O
of	O
all	O
attacks	O
,	O
the	O
energy	O
sector	O
was	O
the	B-Entity
second	I-Entity
most	I-Entity
targeted	I-Entity
vertical	I-Entity
in	I-Entity
the	I-Entity
last	I-Entity
six	I-Entity
months	I-Entity
of	I-Entity
2012	I-Entity
,	O
with	O
only	O
the	O
government/public	O
sector	O
exceeding	O
it	O
with	O
25.4	O
percent	O
of	O
all	O
attacks	O
.	O
The	O
high	O
ranking	O
was	O
mainly	O
due	O
to	O
a	O
major	O
attack	O
against	O
a	O
global	O
oil	O
company	O
,	O
which	O
we	O
observed	O
in	O
September	O
2012	O
.	O
However	O
,	O
in	O
the	O
first	O
half	O
of	O
2013	O
the	O
energy	O
sector	O
continued	O
to	O
attract	O
a	O
high	O
proportion	O
of	O
attacks	O
,	O
ranking	O
in	O
fifth	O
place	O
with	O
7.6	O
percent	O
of	O
targeted	O
attacks	O
.	O
Not	O
all	O
of	O
the	O
attacks	O
analyzed	O
used	O
highly	O
sophisticated	O
tools	O
.	O
Most	O
of	O
them	O
could	O
have	O
been	O
prevented	O
by	O
following	O
best	O
practice	O
guidelines	O
for	O
protecting	O
the	O
IT	O
infrastructure	O
and	O
the	O
industrial	O
components	O
,	O
indicating	O
that	O
despite	O
high	O
revenues	O
and	O
strategic	O
importance	O
,	O
many	O
energy	O
sector	O
companies	O
are	O
not	O
prioritizing	O
cybersecurity	O
.	O
The	O
number	O
of	O
targeted	O
cyberattacks	O
in	O
general	O
has	O
risen	O
in	O
the	O
past	O
few	O
years	O
.	O
In	O
addition	O
to	O
this	O
,	O
the	O
rate	O
of	O
attack	O
exposure	O
has	O
also	O
risen	O
,	O
with	O
more	O
companies	O
becoming	O
aware	O
of	O
attacks	O
,	O
expecting	O
them	O
and	O
searching	O
for	O
indications	O
of	O
compromise	O
.	O
It	O
is	O
not	O
a	O
new	O
phenomenon	O
,	O
but	O
its	O
importance	O
has	O
grown	O
.	O
The	O
Council	O
on	O
Foreign	O
Relations	O
,	O
a	O
US	O
think	O
tank	O
,	O
reported	O
that	O
energy	O
companies	O
,	O
including	O
oil	O
and	O
gas	O
producers	O
,	O
were	O
often	O
the	O
focus	O
of	O
targeted	O
attacks	O
during	O
summer	O
2012	O
.	O
In	O
May	O
2013	O
the	O
US	O
Department	O
of	O
Homeland	O
Security	O
(	O
DHS	O
)	O
warned	O
of	O
an	O
increase	O
in	O
sabotage	O
attacks	O
against	O
US	O
energy	O
companies	O
located	O
in	O
the	O
Middle	O
East	O
.	O
The	O
government	O
had	O
tracked	O
multiple	O
attacks	O
and	O
issued	O
a	O
warning	O
together	O
with	O
the	O
Industrial	O
Control	O
Systems	O
Cyber	O
Emergency	O
Response	O
Team	O
(	O
ICS-CERT	O
)	O
.	O
A	O
report	O
by	O
the	O
US	O
Congress	O
supported	O
this	O
picture	O
,	O
stating	O
that	O
many	O
power	O
utilities	O
companies	O
were	O
under	O
constant	O
or	O
daily	O
attack	O
through	O
cyberspace	O
.	O
Taking	O
into	O
account	O
that	O
successful	O
breaches	O
of	O
critical	O
infrastructures	O
are	O
still	O
rare	O
and	O
that	O
these	O
numbers	O
included	O
generic	O
malware	O
infections	O
,	O
it	O
nevertheless	O
highlights	O
the	O
potential	O
for	O
cyberattacks	O
in	O
the	O
energy	O
sector	O
.	O
As	O
in	O
most	O
sectors	O
,	O
attackers	O
are	O
often	O
after	O
valuable	O
information	O
.	O
For	O
example	O
,	O
we	O
have	O
seen	O
attackers	O
target	O
intellectual	O
property	O
such	O
as	O
technology	O
for	O
photovoltaic	O
research	O
and	O
wind	O
turbines	O
,	O
or	O
data	O
on	O
gas	O
field	O
exploration	O
.	O
Information	O
such	O
as	O
this	O
is	O
of	O
high	O
value	O
and	O
can	O
generate	O
huge	O
profits	O
for	O
attackers	O
or	O
their	O
sponsors	O
.	O
The	O
same	O
information	O
can	O
also	O
be	O
misused	O
for	O
an	O
act	O
of	O
sabotage	O
.	O
Many	O
power	O
utilities	O
companies	O
fear	O
disruptive	O
attacks	O
the	O
most	O
,	O
regardless	O
of	O
whether	O
it	O
is	O
done	O
by	O
internal	O
or	O
external	O
attackers	O
.	O
The	O
energy	O
sector	O
has	O
a	O
high	O
potential	O
for	O
critical	O
disruption	O
through	O
sabotage	O
attacks	O
.	O
Any	O
interruption	O
to	O
the	O
power	O
grid	O
would	O
cause	O
substantial	O
chaos	O
and	O
cascading	O
effects	O
resulting	O
in	O
financial	O
loss	O
.	O
In	O
the	O
past	O
there	O
have	O
been	O
quite	O
a	O
few	O
attacks	O
that	O
included	O
targets	O
in	O
the	O
energy	O
sector	O
.	O
Some	O
of	O
these	O
were	O
more	O
focused	O
,	O
like	O
Stuxnet	O
,	O
Duqu	O
,	O
Shamoon/Disttrack	O
and	O
Night	O
Dragon	O
.	O
Others	O
saw	O
power	O
companies	O
targeted	O
among	O
many	O
other	O
sectors	O
,	O
such	O
as	O
Hidden	O
Lynx	O
,	O
Nitro	O
,	O
Flamer	O
,	O
Net	O
Traveler	O
and	O
Elderwood	O
to	O
name	O
a	O
few	O
.	O
One	O
of	O
the	O
biggest	O
examples	O
,	O
and	O
a	O
game	O
changer	O
for	O
many	O
organizations	O
,	O
was	O
Stuxnet	O
.	O
This	B-Entity
targeted	I-Entity
sabotage	I-Entity
attack	I-Entity
,	O
which	O
is	O
believed	O
to	O
have	O
been	O
aimed	O
against	O
uranium	O
enrichment	O
facilities	O
in	O
Iran	O
,	O
made	O
clear	O
what	O
could	O
be	O
done	O
through	O
cyberattacks	O
.	O
It	O
is	O
also	O
clear	O
that	O
the	O
energy	O
sector	O
is	O
not	O
exempt	O
from	O
the	O
generic	O
attacks	O
that	O
every	O
company	O
faces	O
,	O
such	O
as	O
ransomware	O
that	O
locks	O
PCs	O
or	O
financial	O
Trojans	O
that	O
attempt	O
to	O
steal	O
passwords	O
and	O
credit	O
card	O
details	O
.	O
For	O
example	O
,	O
such	O
a	O
case	O
happened	O
in	O
May	O
2013	O
,	O
when	O
a	O
small	O
fuel	O
distribution	O
company	O
in	O
North	O
Carolina	O
fell	O
victim	O
to	O
a	O
cyberheist	O
that	O
transferred	O
US	O
$	O
800,000	O
from	O
the	O
company	O
's	O
bank	O
account	O
.	O
Such	O
threats	O
spread	O
broadly	O
and	O
might	O
impact	O
any	O
person	O
,	O
regardless	O
of	O
their	O
employer	O
.	O
These	O
attackers	O
aim	O
at	O
infecting	O
as	O
many	O
computers	O
as	O
possible	O
in	O
order	O
to	O
maximize	O
their	O
chances	O
of	O
profits	O
.	O
These	O
attacks	O
can	O
include	O
nonspecific	O
data	O
breaches	O
where	O
employee	O
or	O
customer	O
records	O
get	O
stolen	O
,	O
as	O
happened	O
to	O
the	O
US	O
Department	O
of	O
Energy	O
in	O
July	O
2013	O
.	O
For	O
this	O
paper	O
we	O
focused	O
on	O
email	O
data	O
from	O
targeted	O
attacks	O
between	O
July	O
2012	O
and	O
June	O
2013	O
.	O
Even	O
though	O
watering	O
holes	O
are	O
becoming	O
more	O
frequently	O
used	O
in	O
targeted	O
attacks	O
,	O
it	O
is	O
unfortunately	O
quite	O
difficult	O
to	O
reliably	O
map	O
these	O
to	O
individual	O
campaigns	O
.	O
A	O
blocked	O
drive-by	O
download	O
attempt	O
does	O
not	O
give	O
any	O
indication	O
if	O
it	O
was	O
a	O
targeted	O
attack	O
or	O
just	O
general	O
noise	O
.	O
In	O
quite	O
a	O
few	O
cases	O
we	O
see	O
the	O
same	O
common	O
malware	O
,	O
like	O
Poison	O
Ivy	O
,	O
being	O
used	O
by	O
generic	O
attackers	O
and	O
by	O
targeted	O
attacks	O
.	O
In	O
such	O
cases	O
the	O
sole	O
difference	O
between	O
a	O
sophisticated	O
targeted	O
attack	O
and	O
a	O
generic	O
one	O
lies	O
in	O
the	O
person	O
commanding	O
the	O
malware	O
.	O
Historically	O
most	O
industrial	O
control	O
systems	O
(	O
ICS	O
)	O
and	O
supervisory	O
control	O
and	O
data	O
acquisition	O
(	O
SCADA	O
)	O
systems	O
were	O
in	O
separated	O
networks	O
not	O
connected	O
to	O
the	O
Internet	O
or	O
any	O
other	O
network	O
.	O
Unfortunately	O
this	O
security	O
through	O
segregation	O
approach	O
does	O
not	O
fully	O
protect	O
against	O
cyberattacks	O
.	O
In	O
reality	O
,	O
networks	O
are	O
rarely	O
completely	O
isolated	O
.	O
Often	I-Action
some	B-Entity
configuration	I-Entity
updates	I-Entity
are	B-Action
periodically	B-Entity
installed	I-Entity
or	I-Entity
log	I-Entity
files	I-Entity
are	B-Action
transferred	I-Action
.	O
If	O
systems	O
are	O
not	O
directly	O
connected	O
,	O
the	O
method	O
of	O
choice	O
for	O
these	O
types	O
of	O
interactions	O
is	O
usually	O
through	O
a	O
USB	O
stick	O
or	O
a	O
non-permanent	O
modem	O
connection	O
,	O
which	O
provides	O
a	O
way	O
into	O
the	O
restricted	O
networks	O
.	O
This	O
allows	O
malware	O
to	O
spread	O
into	O
such	O
isolated	O
networks	O
as	O
demonstrated	O
many	O
times	O
by	O
threats	O
such	O
as	O
Stuxnet	O
.	O
If	O
networks	O
are	O
truly	O
segregated	O
,	O
this	O
would	O
mean	O
that	O
there	O
would	O
be	O
no	O
software	O
updates	O
installed	O
,	O
leaving	O
old	O
vulnerabilities	O
open	O
.	O
There	O
are	O
also	O
issues	O
around	O
processes	O
.	O
For	O
example	O
,	O
the	O
revocation	O
lists	O
for	O
digital	O
certificates	O
are	O
seldom	O
updated	O
and	O
therefore	O
certificates	O
which	O
are	O
no	O
longer	O
valid	O
can	O
not	O
be	O
checked	O
properly	O
and	O
would	O
still	O
be	O
accepted	O
.	O
With	O
the	O
increasing	O
desire	O
for	O
connectivity	O
now	O
reaching	O
industrial	O
plants	O
,	O
many	O
operators	O
have	O
started	O
to	O
connect	O
their	O
ICS	O
to	O
the	O
Internet	O
.	O
New	O
adapters	O
can	O
bridge	O
to	O
older	O
technology	O
which	O
was	O
never	O
intended	O
to	O
be	O
controlled	O
over	O
the	O
Internet	O
,	O
allowing	O
it	O
to	O
be	O
connected	O
easily	O
.	O
This	O
allows	O
for	O
efficient	O
centralized	O
monitoring	O
and	O
,	O
to	O
some	O
extent	O
,	O
remote	O
control	O
of	O
equipment	O
.	O
Depending	O
on	O
the	O
type	O
of	O
machinery	O
controlled	O
through	O
the	O
human-machine	O
interface	O
(	O
HMI	O
)	O
of	O
the	O
ICS	O
,	O
not	O
all	O
modifications	O
are	O
possible	O
.	O
Some	O
systems	O
are	O
physically	O
connected	O
in	O
a	O
pure	O
read-only	O
mode	O
for	O
monitoring	O
.	O
And	O
even	O
if	O
they	O
are	O
fully	O
connected	O
,	O
some	O
turbines	O
have	O
physical	O
limitations	O
or	O
emergency	O
systems	O
based	O
on	O
physical	O
effects	O
that	O
can	O
not	O
be	O
overridden	O
by	O
the	O
digital	O
controller	O
.	O
Thus	O
,	O
not	O
all	O
Hollywood	O
scenarios	O
of	O
open	O
flood	O
gates	O
or	O
turbines	O
that	O
fly	O
through	O
the	O
air	O
are	O
possible	O
.	O
However	O
,	O
sabotage	O
attacks	O
that	O
damage	O
equipment	O
are	O
definitely	O
possible	O
,	O
as	O
has	O
already	O
been	O
demonstrated	O
.	O
In	O
the	O
future	O
,	O
more	O
systems	O
are	O
going	O
to	O
implement	O
the	O
failsafe	O
switches	O
in	O
software	O
,	O
opening	O
up	O
the	O
vector	O
for	O
malware	O
attacks	O
.	O
An	O
additional	O
source	O
of	O
concern	O
is	O
that	O
some	O
countries	O
have	O
started	O
to	O
open	O
the	O
energy	O
market	O
for	O
smaller	O
private	O
contributors	O
.	O
This	O
means	O
that	O
almost	O
anyone	O
can	O
use	O
mini	O
power	O
plants	O
like	O
water	O
,	O
wind	O
or	O
photovoltaic	O
sites	O
to	O
feed	O
energy	O
back	O
into	O
the	O
power	O
grid	O
.	O
Often	O
these	O
operators	O
do	O
not	O
have	O
a	O
full	O
IT	O
staff	O
supporting	O
the	O
facilities	O
at	O
hand	O
,	O
which	O
might	O
lead	O
to	O
more	O
vulnerable	O
installations	O
.	O
Furthermore	O
they	O
may	O
deploy	O
new	O
technology	O
which	O
might	O
be	O
untested	O
and	O
contain	O
some	O
unknown	O
vulnerabilities	O
.	O
While	O
these	O
smaller	O
sites	O
make	O
up	O
only	O
a	O
small	O
portion	O
of	O
the	O
grid	O
,	O
new	O
decentralized	O
power	O
input	O
feeds	O
are	O
a	O
challenge	O
for	O
the	O
balance	O
of	O
the	O
power	O
grid	O
as	O
well	O
and	O
need	O
to	O
be	O
carefully	O
monitored	O
.	O
Small	O
outages	O
or	O
changes	O
can	O
have	O
a	O
domino	O
effect	O
for	O
the	O
whole	O
power	O
grid	O
.	O
To	O
increase	O
the	O
exposure	O
of	O
energy	O
firms	O
even	O
further	O
,	O
sites	O
like	O
SHODAN	O
,	O
which	O
is	O
essentially	O
a	O
search	O
engine	O
for	O
devices	O
,	O
enable	O
anyone	O
to	O
easily	O
find	O
exposed	O
controllers	O
on	O
the	O
Internet	O
.	O
Of	O
course	O
not	O
all	O
of	O
the	O
industrial	O
control	O
systems	O
connected	O
to	O
the	O
Internet	O
are	O
critical	O
systems	O
or	O
even	O
real	O
ones	O
.	O
Some	O
researchers	O
have	O
started	O
to	O
create	O
honey	O
pot	O
systems	O
in	O
order	O
to	O
study	O
the	O
attackers	O
,	O
which	O
have	O
apparently	O
already	O
attracted	O
attackers	O
like	O
the	O
Comment	O
Crew/APT1	O
group	O
,	O
who	O
have	O
broken	O
into	O
these	O
decoy	O
systems	O
.	O
Smart	O
grids	O
and	O
smart	O
metering	O
are	O
bringing	O
significant	O
change	O
to	O
the	O
world	O
's	O
power	O
systems	O
.	O
Experts	O
predict	O
that	O
billions	O
of	O
smart	O
meters	O
and	O
sensors	O
will	O
be	O
installed	O
worldwide	O
over	O
the	O
next	O
ten	O
years	O
.	O
They	O
enable	O
utility	O
companies	O
to	O
measure	O
energy	O
consumption	O
at	O
a	O
more	O
granular	O
level	O
,	O
creating	O
better	O
flow	O
patterns	O
and	O
enabling	O
different	O
prices	O
for	O
consumption	O
based	O
on	O
the	O
time	O
of	O
day	O
and	O
location	O
.	O
This	O
development	O
brings	O
new	O
opportunities	O
,	O
as	O
well	O
as	O
new	O
challenges	O
.	O
As	O
with	O
any	O
connected	O
infrastructure	O
,	O
it	O
is	O
important	O
to	O
secure	O
the	O
network	O
and	O
its	O
endpoint	O
on	O
multiple	O
levels	O
.	O
There	O
have	O
already	O
been	O
proof	O
of	O
concept	O
attacks	O
that	O
demonstrate	O
how	O
smart	O
meters	O
could	O
be	O
manipulated	O
to	O
send	O
back	O
false	O
information	O
or	O
report	O
incorrect	O
billing	O
IDs	O
,	O
leading	O
to	O
power	O
theft	O
.	O
In	O
addition	O
to	O
the	O
issue	O
of	O
securing	O
these	O
devices	O
,	O
smart	O
grids	O
will	O
produce	O
a	O
huge	O
amount	O
of	O
data	O
which	O
,	O
depending	O
on	O
regulations	O
,	O
will	O
need	O
to	O
be	O
kept	O
for	O
audits	O
.	O
Some	O
of	O
this	O
data	O
may	O
be	O
sensitive	O
and	O
could	O
raise	O
privacy	O
concerns	O
if	O
not	O
properly	O
protected	O
.	O
This	O
could	O
easily	O
grow	O
to	O
petabytes	O
of	O
data	O
that	O
needs	O
to	O
be	O
safely	O
stored	O
and	O
managed	O
.	O
It	O
is	O
beyond	O
the	O
scope	O
of	O
this	O
paper	O
to	O
address	O
all	O
the	O
challenges	O
associated	O
with	O
smart	O
grids	O
and	O
smart	O
meters	O
.	O
Symantec	O
has	O
created	O
a	O
dedicated	O
whitepaper	O
for	O
this	O
topic	O
:	O
How	O
to	O
protect	O
critical	O
infrastructure	O
,	O
mitigate	O
fraud	O
and	O
guarantee	O
privacy	O
.	O
As	O
a	O
member	O
of	O
the	O
CRISALIS	O
project	O
,	O
Symantec	O
is	O
following	O
these	O
developments	O
closely	O
and	O
is	O
helping	O
to	O
secure	O
critical	O
infrastructure	O
together	O
with	O
partners	O
from	O
academia	O
and	O
different	O
industry	O
sectors	O
.	O
There	O
have	O
been	O
numerous	O
cyberattacks	O
against	O
the	O
energy	O
sector	O
over	O
the	O
past	O
few	O
years	O
.	O
Not	O
all	O
of	O
them	O
were	O
the	O
work	O
of	O
sophisticated	O
attackers	O
;	O
some	O
incidents	O
were	O
just	O
collateral	O
damage	O
caused	O
by	O
malware	O
infections	O
or	O
bad	O
configuration	O
issues	O
.	O
These	O
incidents	O
highlight	O
the	O
fact	O
that	O
such	O
attacks	O
can	O
happen	O
and	O
that	O
they	O
can	O
have	O
real	O
life	O
consequences	O
.	O
In	O
2013	O
part	O
of	O
the	O
Austrian	O
and	O
German	O
power	O
grid	O
nearly	O
broke	B-Action
down	I-Action
after	B-Modifier
a	B-Entity
control	I-Entity
command	I-Entity
was	O
accidentally	O
misdirected	O
.	O
It	O
is	O
believed	O
that	O
a	O
status	O
request	O
command	O
packet	O
,	O
which	O
was	O
broadcast	O
from	O
a	O
German	O
gas	O
company	O
as	O
a	O
test	O
for	O
their	B-Entity
newly	I-Entity
installed	I-Entity
network	I-Entity
branch	I-Entity
,	O
found	O
its	O
way	O
into	B-Modifier
the	B-Entity
systems	I-Entity
of	I-Entity
the	I-Entity
Austrian	I-Entity
energy	I-Entity
power	I-Entity
control	I-Entity
and	I-Entity
monitoring	I-Entity
network	I-Entity
.	O
Once	O
there	O
,	O
the	O
message	O
generated	O
thousands	O
of	O
reply	O
messages	O
,	O
which	O
generated	O
even	O
more	O
data	O
packages	O
,	O
which	O
in	O
turn	O
flooded	O
the	O
control	O
network	O
.	O
To	O
stop	O
this	O
self-inflicted	O
DDoS	O
attack	O
,	O
part	O
of	O
the	O
monitoring	O
and	O
control	O
network	O
had	O
to	O
be	O
isolated	O
and	O
disconnected	O
.	O
Fortunately	O
the	O
situation	O
was	O
resolved	O
without	O
any	O
power	O
outages	O
.	O
In	O
2008	O
,	O
Tom	O
Donahue	O
,	O
a	O
senior	O
Central	O
Intelligence	O
Agency	O
(	O
CIA	O
)	O
official	O
told	O
a	O
meeting	O
of	O
utility	O
company	O
representatives	O
that	O
cyberattacks	O
had	O
taken	O
out	O
power	O
equipment	O
in	O
multiple	O
cities	O
outside	O
the	O
United	O
States	O
.	O
In	O
some	O
cases	O
the	O
attacker	O
tried	O
to	O
extort	O
money	O
from	O
the	O
energy	O
companies	O
,	O
threatening	O
them	O
with	O
further	O
blackouts	O
.	O
In	O
2003	O
the	O
safety	O
monitoring	O
system	O
of	O
the	O
Ohio	O
nuclear	O
power	O
plant	O
apparently	O
went	O
offline	O
for	O
several	O
hours	O
due	O
to	O
a	O
Slammer	O
worm	O
infection	O
.	O
Fortunately	O
the	O
power	O
plant	O
was	O
already	O
offline	O
due	O
to	O
maintenance	O
and	O
the	B-Entity
installed	I-Entity
secondary	I-Entity
backup	I-Entity
monitoring	I-Entity
system	I-Entity
was	O
unaffected	O
by	O
the	O
worm	O
.	O
Nevertheless	O
the	O
incident	O
raised	O
safety	O
concerns	O
.	O
At	O
the	O
beginning	O
of	O
2003	O
a	O
marine	O
terminal	O
in	O
Venezuela	O
was	O
targeted	O
by	O
a	O
sabotage	O
attack	O
.	O
Details	O
of	O
this	O
attack	O
are	O
scarce	O
and	O
vague	O
,	O
but	O
it	O
seems	O
that	O
during	O
a	O
strike	O
an	O
attacking	O
group	O
managed	O
to	O
get	O
access	O
to	O
the	O
SCADA	O
network	O
of	O
the	O
oil	O
tanker	O
loading	O
machinery	O
and	O
overwrote	B-Action
programmable	B-Entity
logic	I-Entity
controllers	I-Entity
(	I-Entity
PLCs	I-Entity
)	I-Entity
with	B-Modifier
an	B-Entity
empty	I-Entity
program	I-Entity
module	I-Entity
.	O
This	O
halted	O
machinery	O
,	O
preventing	O
oil	O
tankers	O
from	O
loading	O
for	O
eight	O
hour	O
till	O
the	O
unaffected	O
backup	O
code	O
was	O
reinstalled	O
on	O
the	O
PLCs	O
.	O
The	O
attack	O
was	O
not	O
too	O
sophisticated	O
as	O
it	O
was	O
easily	O
spotted	O
.	O
A	O
small	O
modification	O
of	O
the	O
PLC	O
code	O
instead	O
would	O
probably	O
have	O
gone	O
unnoticed	O
for	O
a	O
long	O
time	O
.	O
In	O
2001	O
an	O
attack	O
took	O
place	O
against	O
California	O
's	O
power	O
distribution	O
center	O
,	O
which	O
controls	O
the	O
flow	O
of	O
electricity	O
across	O
California	O
.	O
Due	O
to	O
apparently	O
poor	O
security	O
configuration	O
,	O
the	O
attacker	O
was	O
able	O
to	O
compromise	O
two	O
Web	O
servers	O
that	O
were	O
part	O
of	O
a	O
developer	O
network	O
and	O
penetrate	O
further	O
from	O
there	O
.	O
Fortunately	O
the	O
attackers	O
were	O
stopped	O
before	O
they	O
managed	O
to	O
attack	O
any	O
systems	O
which	O
were	O
tied	O
into	O
the	O
transmission	O
grid	O
for	O
the	O
Western	O
United	O
States	O
.	O
According	O
to	O
Russian	O
officials	O
,	O
the	O
largest	O
natural	O
gas	O
extraction	O
company	O
in	O
the	O
country	O
was	O
successfully	O
attacked	O
in	O
2000	O
.	O
The	B-Entity
attackers	I-Entity
used	B-Action
a	B-Entity
Trojan	I-Entity
to	I-Entity
gain	B-Action
access	B-Entity
to	B-Modifier
the	B-Entity
control	I-Entity
for	O
the	O
gas	O
pipelines	O
.	O
Through	O
this	O
switchboard	O
,	O
the	O
flow	O
for	O
individual	O
gas	O
pipelines	O
could	O
have	O
been	O
modified	O
,	O
which	O
would	O
easily	O
have	O
caused	O
widespread	O
disruption	O
.	O
Aside	O
from	O
these	O
incidents	O
,	O
there	O
have	O
also	O
been	O
a	O
number	O
of	O
more	O
serious	O
and	O
well-documented	O
targeted	O
attacks	O
against	O
the	O
energy	O
sector	O
:	O
The	O
Stuxnet	O
incident	O
and	O
its	O
relatives	O
Duqu	O
,	O
Flamer	O
and	O
Gauss	O
are	O
some	O
of	O
the	O
most	O
talked-about	O
cases	O
of	O
targeted	O
attacks	O
.	O
As	O
far	O
as	O
we	O
know	O
today	O
,	O
the	O
Stuxnet	O
operation	O
began	O
in	O
November	O
2005	O
with	O
the	O
registration	O
of	O
the	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
(	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
)	I-Entity
servers	I-Entity
used	I-Entity
in	I-Entity
the	I-Entity
attacks	I-Entity
.	O
The	O
first	O
recorded	O
appearance	O
of	O
what	O
we	O
now	O
call	O
Stuxnet	O
version	O
0.5	O
was	O
in	O
November	O
2007	O
.	O
Since	O
then	O
,	O
a	O
handful	O
of	O
different	O
versions	O
have	O
been	O
found	O
and	O
analyzed	O
.	O
Stuxnet	O
1.x	O
is	O
based	O
on	O
what	O
is	O
now	O
known	O
as	O
the	O
''	O
tilded	O
''	O
platform	O
;	O
whereas	O
Stuxnet	O
0.5	O
is	O
based	O
on	O
the	O
Flamer	O
framework	O
.	O
The	O
code	O
segments	O
and	O
programming	O
style	O
differ	O
,	O
which	O
indicates	O
that	O
two	O
different	O
programming	O
teams	O
were	O
most	O
likely	O
responsible	O
for	O
the	O
different	O
branches	O
of	O
Stuxnet	O
.	O
Thorough	O
investigation	O
into	O
the	O
mechanism	O
and	O
functions	O
of	O
this	O
threat	O
started	O
in	O
July	O
2010	O
.	O
Stuxnet	O
is	O
the	O
first	O
known	O
autonomous	O
threat	O
to	O
target	B-Action
and	I-Action
sabotage	I-Action
industrial	B-Entity
control	I-Entity
systems	I-Entity
to	O
such	O
an	O
extent	O
.	O
Stuxnet	O
is	O
a	O
sophisticated	O
piece	O
of	O
malware	O
,	O
which	O
uses	O
seven	O
vulnerabilities	O
to	O
spread	O
and	O
infect	O
its	O
targets	O
.	O
The	O
most	O
notable	O
vulnerability	O
is	O
the	O
Microsoft	O
Windows	O
Shortcut	O
'LNK/PIF	O
'	O
Files	O
Automatic	O
File	O
Execution	O
Vulnerability	O
(	O
CVE-2010-2568	O
)	O
,	O
which	O
allows	O
it	O
to	O
auto-execute	O
on	O
USB	B-Entity
drives	I-Entity
.	O
Spreading	B-Action
through	B-Modifier
infected	B-Entity
portable	I-Entity
media	I-Entity
drives	I-Entity
allowed	B-Action
it	B-Entity
to	O
also	O
infect	O
networks	O
isolated	O
by	O
air	O
gaps	O
that	O
are	O
unreachable	O
from	O
the	O
Internet	O
.	O
This	O
was	O
most	O
likely	O
the	O
first	O
infection	O
vector	O
used	O
by	O
Stuxnet	O
.	O
In	O
addition	O
,	O
it	O
is	O
able	O
to	O
infect	O
Step7	O
project	O
files	O
,	O
which	O
are	O
used	O
to	O
control	O
Programmable	O
Logic	O
Controllers	O
(	O
PLCs	O
)	O
.	O
This	O
allowed	O
the	O
worm	B-Action
to	B-Modifier
infect	B-Entity
computers	I-Entity
whenever	I-Entity
the	I-Entity
engineer	I-Entity
exchanged	I-Entity
the	I-Entity
project	I-Entity
files	I-Entity
.	O
Besides	O
this	O
,	O
it	O
also	O
spread	O
through	O
network	O
shares	O
,	O
a	O
printer	O
spooler	O
vulnerability	O
,	O
an	O
old	O
Windows	O
RPC	O
(	O
remote	O
procedure	O
calls	O
)	O
vulnerability	O
and	O
a	O
known	O
password	O
in	O
the	O
WinCC	O
database	O
.	O
In	O
the	O
end	O
,	O
Stuxnet	O
propagated	O
further	O
than	O
its	O
authors	O
probably	O
intended	O
.	O
We	O
have	O
monitored	O
more	O
than	O
40,000	O
infected	O
IP	O
addresses	O
in	O
155	O
countries	O
.	O
Many	O
of	O
those	O
systems	O
are	O
most	O
likely	O
just	O
collateral	O
damage	O
and	O
were	O
not	O
intended	O
to	O
be	O
infected	O
by	O
the	O
attackers	O
.	O
For	O
example	O
multiple	O
computers	O
at	O
Chevron	O
were	O
infected	O
by	O
Stuxnet	O
,	O
without	O
any	O
damage	O
being	O
done	O
.	O
Part	O
of	O
the	O
malware	O
code	O
was	O
signed	O
with	O
stolen	O
digital	O
certificates	O
making	O
it	O
harder	O
to	O
detect	O
by	O
security	O
tools	O
.	O
To	O
hide	O
its	O
activity	O
even	O
further	O
,	O
Stuxnet	O
executed	O
slightly	O
different	O
infection	O
routines	O
depending	O
on	O
the	O
security	O
software	O
installed	O
on	O
the	O
target	O
.	O
On	B-Modifier
the	B-Entity
USB	I-Entity
drive	I-Entity
itself	I-Entity
,	O
the	O
malware	O
would	O
hide	O
its	O
own	O
files	O
and	O
even	O
delete	B-Action
itself	B-Entity
from	B-Modifier
it	B-Entity
after	O
three	O
successful	O
propagations	O
.	O
Tricks	O
like	O
these	O
,	O
to	O
make	O
the	O
detection	O
of	O
the	O
malware	O
more	O
difficult	O
,	O
are	O
now	O
frequently	O
used	O
in	O
modern	O
targeted	O
attacks	O
.	O
Stuxnet	O
's	O
payload	O
focused	O
on	O
PLCs	O
,	O
which	O
are	O
used	O
to	O
control	O
different	O
industrial	O
components	O
.	O
The	O
target	O
of	O
the	O
Stuxnet	O
operation	O
is	O
believed	O
to	O
be	O
a	O
uranium	O
enrichment	O
facility	O
in	O
Iran	O
.	O
The	O
sabotage	O
payload	O
disrupted	O
and	O
partially	O
destroyed	O
the	O
cascaded	O
high	O
frequency	O
gas	O
centrifuges	O
.	O
The	O
early	O
version	O
of	O
Stuxnet	O
targeted	O
the	O
S7-	O
417	O
PLCs	O
and	O
modified	O
its	O
valve	O
settings	O
.	O
Closing	O
the	O
valves	O
at	O
certain	O
points	O
in	O
time	O
would	O
lead	O
to	O
an	O
increase	O
of	O
pressure	O
that	O
could	O
damage	O
the	O
equipment	O
.	O
The	O
later	O
version	O
of	O
the	O
threat	O
focused	O
on	O
the	O
S7-315	O
PLCs	O
,	O
manipulating	O
the	O
spinning	O
frequency	O
of	O
the	O
rotating	O
motors	O
.	O
By	O
speeding	O
the	O
centrifuges	O
up	O
and	O
slowing	B-Action
them	B-Entity
down	I-Entity
repeatedly	O
,	O
the	O
output	O
quality	O
could	O
be	O
spoiled	O
and	O
the	O
centrifuges	O
themselves	O
could	O
be	O
damaged	O
.	O
The	O
payload	O
would	O
only	O
become	O
active	O
if	O
the	O
fingerprint	O
in	O
the	O
found	O
PLC	O
setup	O
matched	O
a	O
given	O
configuration	O
setup	O
.	O
This	O
minimized	O
the	O
collateral	O
damage	O
at	O
other	O
facilities	O
and	O
showed	O
that	O
the	O
attackers	O
had	O
in-depth	O
knowledge	O
of	O
the	O
targeted	O
uranium	O
enrichment	O
facilities	O
.	O
To	O
avoid	O
detection	O
by	O
personnel	O
monitoring	O
the	O
human	O
machine	O
interface	O
(	O
HMI	O
)	O
of	O
the	O
plant	O
,	O
the	O
threat	O
recorded	O
measurement	O
readings	O
during	O
normal	O
operation	O
and	O
played	O
those	O
back	O
in	O
a	O
loop	O
.	O
Operation	O
Night	O
Dragon	O
,	O
which	O
was	O
uncovered	O
in	O
2010	O
,	O
is	O
a	O
typical	O
example	O
of	O
global	O
oil	O
companies	O
being	O
targeted	O
,	O
but	O
this	O
time	O
not	O
with	O
the	O
aim	O
of	O
disruption	O
in	O
mind	O
.	O
The	O
attacks	O
started	O
in	O
late	O
2009	O
and	O
were	O
directed	O
at	O
finding	O
project	O
details	O
and	O
financial	O
information	O
about	O
oil	O
and	O
gas	O
field	O
exploration	O
and	O
bids	O
.	O
The	B-Entity
attackers	I-Entity
started	I-Entity
by	I-Entity
compromising	I-Entity
public	I-Entity
facing	I-Entity
Web	I-Entity
servers	I-Entity
through	B-Modifier
SQL	B-Entity
injection	I-Entity
and	I-Entity
installing	I-Entity
Web	I-Entity
shells	I-Entity
on	O
them	O
.	O
Once	O
they	O
had	O
control	O
over	O
the	O
server	O
they	O
used	O
common	O
hacking	O
tools	O
to	O
harvest	O
local	O
passwords	O
,	O
dump	O
password	O
hashes	O
,	O
sniff	B-Action
authentication	B-Entity
messages	I-Entity
and	I-Entity
exploit	I-Entity
internal	I-Entity
active	I-Entity
directory	I-Entity
configuration	I-Entity
.	O
This	O
allowed	O
them	O
to	O
move	B-Action
on	I-Action
to	B-Modifier
other	B-Entity
internal	I-Entity
computers	I-Entity
using	B-Modifier
the	B-Entity
gathered	I-Entity
passwords	I-Entity
.	O
In	O
addition	O
,	O
spear	B-Entity
phishing	I-Entity
messages	I-Entity
were	B-Action
used	I-Action
to	O
compromise	O
additional	O
computers	O
.	O
The	O
attackers	O
did	O
not	O
use	O
any	O
zero-day	O
vulnerabilities	O
during	O
their	O
attacks	O
.	O
Rather	O
they	O
used	O
publicly	O
available	O
tools	O
for	O
each	O
individual	O
job	O
.	O
On	B-Modifier
compromised	B-Entity
computers	I-Entity
a	I-Entity
common	I-Entity
Backdoor.Trojan	I-Entity
was	I-Entity
installed	I-Entity
that	I-Entity
communicated	B-Action
back	B-Modifier
to	I-Modifier
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
,	O
allowing	O
remote	O
access	O
to	O
the	O
computer	O
.	O
This	B-Entity
allowed	B-Action
the	B-Entity
attacker	I-Entity
to	B-Modifier
find	B-Entity
and	I-Entity
extract	I-Entity
valuable	I-Entity
information	I-Entity
.	O
In	O
August	O
2012	O
an	O
extremely	O
destructive	O
cyberattack	O
hit	B-Action
an	B-Entity
estimated	I-Entity
30,000	I-Entity
computers	I-Entity
at	I-Entity
one	I-Entity
of	I-Entity
the	I-Entity
largest	I-Entity
oil	I-Entity
producers	I-Entity
of	I-Entity
the	I-Entity
world	I-Entity
in	I-Entity
Saudi	I-Entity
Arabia	I-Entity
.	O
The	O
W32.Disttrack	O
malware	O
used	O
in	O
this	O
attack	O
,	O
also	O
known	O
as	O
Shamoon	O
,	O
consists	O
of	O
three	O
components	O
:	O
a	O
dropper	O
,	O
a	O
wiper	O
and	O
a	O
reporter	O
module	O
.	O
The	B-Entity
dropper	I-Entity
component	I-Entity
is	O
responsible	O
for	O
creating	O
all	O
the	O
required	O
files	O
on	O
the	O
system	O
,	O
registering	O
a	O
service	O
called	O
''	O
TrkSvr	O
''	O
in	O
order	O
to	O
start	O
itself	O
with	O
Windows	O
.	O
It	O
also	O
attempts	O
to	O
copy	O
itself	O
to	O
accessible	O
network	O
shares	O
and	O
execute	B-Action
itself	B-Entity
remotely	I-Entity
if	O
successfully	O
copied	O
.	O
The	B-Entity
wiper	I-Entity
component	I-Entity
is	O
only	O
activated	O
when	O
a	O
hardcoded	O
configuration	O
date	O
has	O
been	O
passed	O
.	O
This	O
enables	O
a	O
coordinated	O
,	O
''	O
time	O
bomb	O
''	O
scenario	O
.	O
The	O
module	O
then	O
drops	B-Action
a	B-Entity
legitimate	O
and	O
digitally	O
signed	O
device	O
driver	O
that	O
provides	O
low	O
level	O
disk	O
access	O
from	O
user	O
space	O
.	O
The	B-Entity
malware	I-Entity
collects	B-Action
file	B-Entity
names	I-Entity
and	O
starts	O
overwriting	O
them	O
with	O
a	O
JPEG	O
image	O
or	O
192KB	O
blocks	O
of	O
random	O
data	O
.	O
At	O
the	O
end	O
Disttrack	O
finishes	O
the	O
computer	O
off	O
by	O
wiping	O
the	O
master	O
boot	O
record	O
with	O
the	O
same	O
data	O
.	O
The	O
reporter	O
component	O
is	O
responsible	O
for	O
sending	B-Action
back	B-Modifier
a	B-Entity
HTTP	I-Entity
GET	I-Entity
request	I-Entity
to	B-Modifier
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
.	O
It	O
reports	O
the	O
domain	O
name	O
,	O
IP	O
address	O
and	O
number	O
of	O
files	O
overwritten	O
.	O
By	B-Modifier
acquiring	B-Entity
user	I-Entity
credentials	I-Entity
and	I-Entity
gaining	I-Entity
access	I-Entity
to	B-Modifier
the	B-Entity
domain	I-Entity
controller	I-Entity
the	I-Entity
attackers	I-Entity
were	O
able	O
to	O
push	O
the	O
malware	O
on	O
to	O
many	O
systems	O
before	O
they	O
triggered	O
the	O
destructive	O
payload	O
.	O
Disttrack	O
's	O
secondary	O
goal	O
may	O
have	O
been	O
to	O
steal	B-Action
valuable	B-Entity
information	I-Entity
from	I-Entity
infected	I-Entity
computers	I-Entity
,	O
but	O
the	O
main	O
intent	O
was	O
to	O
render	O
the	O
computers	O
unusable	O
by	O
wiping	O
the	O
operating	O
system	O
and	O
master	O
boot	O
record	O
,	O
causing	O
disruption	O
and	O
downtime	O
at	O
the	O
targeted	O
company	O
.	O
Although	O
wiping	O
is	O
also	O
frequently	O
used	O
to	O
destroy	O
evidence	O
of	O
the	O
attack	O
and	O
make	O
forensics	O
more	O
difficult	O
.	O
The	O
malware	O
does	O
not	O
contain	O
any	O
payload	O
against	O
ICS	O
,	O
like	O
Stuxnet	O
does	O
for	O
PLCs	O
,	O
and	O
is	O
not	O
as	O
sophisticated	O
.	O
According	O
to	O
the	O
company	O
,	O
no	O
computer	O
related	O
with	O
the	O
production	O
or	O
distribution	O
of	O
oil	O
was	O
affected	O
,	O
since	O
the	O
operational	O
network	O
is	O
separated	O
and	O
specially	O
protected	O
.	O
One	O
group	O
that	O
claimed	O
responsibility	O
for	O
the	O
attack	O
posted	O
on	O
Pastebin	O
that	O
it	O
was	O
an	O
anti-oppression	O
hacker	O
group	O
.	O
The	O
attack	O
was	O
prompted	O
by	O
disappointment	O
with	O
some	O
of	O
the	O
regimes	O
in	O
the	O
Middle	O
East	O
,	O
the	O
group	O
said	O
.	O
True	O
or	O
not	O
,	O
this	O
shows	O
that	O
it	O
is	O
not	O
necessarily	O
only	O
state-sponsored	O
attackers	O
who	O
are	O
carrying	O
out	O
disruptive	O
attacks	O
.	O
Sabotage	O
attacks	O
usually	O
fall	O
into	O
the	O
orbit	O
of	O
hacktivists	O
,	O
who	O
seek	O
attention	O
rather	O
than	O
profit	O
.	O
Some	O
sources	O
reported	O
that	O
the	O
attackers	O
had	O
help	O
from	O
insiders	O
,	O
which	O
would	O
explain	O
the	O
so	O
far	O
unclear	O
infection	O
vector	O
.	O
Soon	O
after	O
this	O
attack	O
became	O
known	O
,	O
a	O
Qatari	O
gas	O
company	O
was	O
attacked	O
in	O
a	O
similar	O
way	O
.	O
Spear	B-Entity
phishing	I-Entity
is	O
,	O
along	O
with	O
watering	O
hole	O
attacks	O
,	O
one	O
of	O
the	O
most	O
common	O
attack	O
vectors	O
used	O
to	O
attack	O
companies	O
.	O
The	O
attacks	O
are	O
simple	O
to	O
carry	O
out	O
.	O
They	O
often	O
follow	O
the	O
same	O
pattern	O
,	O
starting	O
with	O
a	O
reconnaissance	O
phase	O
to	O
gather	B-Action
all	B-Entity
publicly	I-Entity
available	I-Entity
information	I-Entity
.	O
This	O
is	O
followed	O
by	O
the	O
incursion	O
phase	O
of	O
breaking	O
in	O
and	O
compromising	O
computers	O
.	O
After	O
that	O
comes	O
the	O
discovery	O
phase	O
,	O
where	O
the	O
attacker	O
gathers	O
passwords	O
and	O
maps	O
the	O
internal	O
network	O
.	O
The	B-Entity
final	I-Entity
stage	I-Entity
is	I-Entity
capture	I-Entity
and	I-Entity
exfiltration	I-Entity
,	O
where	O
the	B-Entity
valuable	I-Entity
information	I-Entity
is	B-Action
copied	I-Action
and	I-Action
sent	I-Action
back	B-Modifier
to	I-Modifier
the	B-Entity
attacker	I-Entity
.	O
The	O
last	O
phase	O
may	O
also	O
involve	O
a	O
disruption	O
attack	O
if	O
the	O
goal	O
is	O
sabotage	O
.	O
For	O
a	O
more	O
detailed	O
analysis	O
of	O
the	O
attack	O
phases	O
,	O
see	O
Appendix	O
C.	O
A	O
spear	O
phishing	O
attack	O
consists	O
of	O
an	O
email	O
with	O
either	O
a	O
malicious	O
attachment	O
or	O
a	O
link	O
to	O
a	O
malicious	O
website	O
.	O
Such	O
emails	O
are	O
sent	O
in	O
bulk	O
to	O
a	O
handful	O
of	O
key	O
users	O
.	O
These	O
waves	O
are	O
often	O
repeated	O
till	O
enough	O
people	O
fall	O
for	O
the	O
bait	O
and	O
compromise	O
their	O
computers	O
.	O
For	O
analysis	O
on	O
the	O
social	O
engineering	O
themes	O
used	O
,	O
attack	O
details	O
and	O
attachment	O
types	O
used	O
,	O
see	O
Appendix	O
A	O
.	O
Some	O
of	O
the	O
spear	O
phishing	O
campaigns	O
are	O
smaller	O
in	O
scale	O
and	O
are	O
focused	O
on	O
specific	O
targets	O
.	O
For	O
example	O
,	O
on	O
January	O
1	O
,	O
2013	O
a	O
global	O
energy	O
research	O
company	O
was	O
targeted	O
.	O
A	O
wave	O
of	O
spear	B-Entity
phishing	I-Entity
emails	I-Entity
were	B-Action
sent	I-Action
from	B-Modifier
two	B-Entity
Freemailer	I-Entity
accounts	I-Entity
to	I-Entity
291	I-Entity
individuals	I-Entity
at	B-Modifier
the	B-Entity
targeted	I-Entity
company	I-Entity
.	O
All	O
receiving	O
email	O
addresses	O
started	O
with	O
a	O
letter	O
between	O
G	O
and	O
R	O
,	O
covering	O
half	O
of	O
the	O
alphabet	O
.	O
Whether	O
there	O
was	O
a	O
second	O
wave	O
of	O
emails	B-Entity
using	B-Modifier
the	B-Entity
other	I-Entity
half	I-Entity
of	I-Entity
the	I-Entity
alphabet	I-Entity
or	I-Entity
whether	I-Entity
the	I-Entity
attackers	I-Entity
only	O
got	O
their	O
hands	O
on	O
part	O
of	O
the	O
address	O
book	O
remains	O
unknown	O
.	O
All	O
emails	O
had	O
either	O
the	O
subject	O
line	O
''	O
2013	O
,	O
Obama	O
QE4	O
!	O
Merry	O
Christmas	O
!	O
''	O
or	O
''	O
2013	O
,	O
Obama	O
QE4	O
!	O
''	O
.	O
It	O
is	O
common	O
to	O
see	O
spear	B-Entity
phishing	I-Entity
attacks	I-Entity
take	I-Entity
place	I-Entity
around	I-Entity
holidays	I-Entity
,	O
as	O
people	O
are	O
receiving	O
more	O
emails	O
during	O
these	O
times	O
and	O
are	O
less	O
likely	O
to	O
perform	O
due	O
diligence	O
while	O
opening	O
them	O
.	O
All	O
of	O
the	O
emails	O
contained	O
the	O
same	O
Trojan.Dropper	O
disguised	O
as	O
an	O
attachment	O
with	O
the	O
filename	O
AVP.dll	O
.	O
The	B-Entity
malware	I-Entity
itself	I-Entity
drops	B-Action
a	B-Entity
malicious	I-Entity
Downloader	I-Entity
''	I-Entity
clbcatq.dll	I-Entity
''	I-Entity
into	B-Modifier
a	B-Entity
newly	I-Entity
created	I-Entity
''	I-Entity
wuauclt	I-Entity
''	I-Entity
directory	I-Entity
,	O
posing	O
as	O
Windows	O
update	O
and	O
taking	O
advantage	O
of	O
the	O
DLL	O
search	O
order	O
hijack	O
weakness	O
in	O
order	O
to	O
load	B-Action
the	B-Entity
malicious	I-Entity
code	I-Entity
in	O
Windows	O
.	O
The	O
same	O
family	O
of	O
dropper	O
has	O
been	O
used	O
in	O
previous	O
targeted	O
attacks	O
against	O
other	O
sectors	O
,	O
indicating	O
that	O
a	O
group	O
with	O
multiple	O
interests	O
is	O
behind	O
the	O
attacks	O
.	O
The	O
back	O
door	O
provided	O
full	O
access	O
to	O
the	O
compromised	O
computers	O
.	O
A	O
week	O
later	O
,	O
on	O
January	O
7	O
,	O
2013	O
,	O
the	O
group	O
attacked	O
the	O
same	O
company	O
again	O
.	O
Seventy	O
emails	O
were	O
sent	O
to	O
58	O
individuals	O
using	O
either	O
''	O
2012-13	O
NFL	O
Playoffs	O
Schedule	O
''	O
or	O
''	O
Re	O
:	O
2012-13	O
NFL	O
Playoffs	O
Schedule	O
''	O
as	O
a	O
subject	O
line	O
.	O
In	O
this	O
wave	O
,	O
the	O
attackers	O
used	O
a	O
similar	O
AVP.dll	O
to	O
the	O
one	O
used	O
before	O
.	O
In	O
some	O
of	O
the	O
emails	O
,	O
an	O
additional	O
CHM	O
file	O
with	O
an	O
old	O
exploit	O
was	O
used	O
in	O
an	O
effort	O
to	O
maximize	O
the	O
chances	O
of	O
a	O
successful	O
infection	O
.	O
After	O
this	O
second	O
wave	O
,	O
the	O
attack	O
ceased	O
.	O
It	O
is	O
unknown	O
if	O
the	O
attackers	O
successfully	O
retrieved	O
the	O
information	O
they	O
were	O
seeking	O
,	O
if	O
they	B-Entity
installed	I-Entity
other	I-Entity
back	I-Entity
door	I-Entity
Trojans	I-Entity
or	I-Entity
gained	I-Entity
passwords	I-Entity
that	O
allowed	O
them	O
to	O
directly	O
access	O
the	O
computers	O
,	O
or	O
if	O
they	O
have	O
given	O
up	O
on	O
the	O
target	O
.	O
A	O
global	O
oil	O
company	O
,	O
with	O
offices	O
around	O
the	O
world	O
,	O
had	O
been	O
under	O
continuous	O
attack	O
for	O
some	O
time	O
,	O
but	O
in	O
September	O
2012	O
we	O
noticed	O
an	O
upsurge	O
in	O
activity	O
,	O
with	O
34	O
times	O
more	O
suspicious	O
emails	O
than	O
on	O
average	O
.	O
This	O
provided	O
a	O
clear	O
indication	O
that	O
something	O
suspicious	O
was	O
going	O
on	O
.	O
At	O
the	O
end	O
of	O
this	O
wave	O
of	O
emails	O
,	O
a	O
hotel	O
chain	O
,	O
a	O
rental	O
car	O
company	O
and	O
two	O
financial	O
institutions	O
were	O
also	O
targeted	O
by	O
the	O
same	O
attacker	O
.	O
This	O
may	O
have	O
been	O
an	O
attempt	O
to	O
find	O
further	O
information	O
that	O
could	O
be	B-Action
used	I-Action
in	B-Modifier
a	B-Entity
future	I-Entity
social	I-Entity
engineering	I-Entity
attack	I-Entity
against	O
the	O
oil	O
company	O
.	O
In	O
total	O
,	O
136	O
email	O
accounts	O
at	O
the	O
oil	O
company	O
were	O
targeted	O
.	O
A	O
regional	O
sales	O
manager	O
in	O
Greece	O
received	O
412	O
emails	O
over	O
the	O
12	O
month	O
period	O
,	O
with	O
155	O
different	O
attachments	O
.	O
A	O
HR	O
person	O
in	O
the	O
same	O
country	O
received	O
the	O
second	O
largest	O
amount	O
of	O
emails	O
with	O
90	O
in	O
total	O
.	O
Seventeen	O
other	O
people	O
were	O
targeted	O
between	O
70	O
and	O
90	O
times	O
,	O
many	O
in	O
the	O
same	O
region	O
.	O
The	O
rest	O
of	O
the	O
targeted	O
people	O
received	O
less	O
than	O
five	O
emails	O
each	O
,	O
in	O
what	O
seems	O
to	O
have	O
been	O
an	O
undirected	O
spraying	O
in	O
the	O
hope	O
that	O
at	O
least	O
some	O
would	O
fall	O
for	O
the	O
bait	O
.	O
Clearly	O
the	O
one	O
person	O
that	O
received	O
the	O
highest	O
volume	O
of	O
emails	O
was	O
deemed	O
to	O
be	O
of	O
high	O
value	O
to	O
the	O
attackers	O
.	O
Possible	O
explanations	O
for	O
the	O
attack	O
could	O
be	O
that	O
a	O
competitor	O
wanted	O
to	O
know	O
more	O
about	O
some	O
upcoming	O
deal	O
or	O
details	O
on	O
the	O
oil	O
field	O
exploration	O
,	O
but	O
this	O
would	O
be	O
highly	O
speculative	O
.	O
The	B-Entity
spear	I-Entity
phishing	I-Entity
emails	I-Entity
came	O
from	O
234	O
spoofed	O
addresses	O
.	O
They	O
were	O
made	O
to	O
appear	O
to	O
be	O
linked	O
to	O
the	O
company	O
in	O
relation	O
to	O
the	O
subject	O
and	O
attachment	O
chosen	O
.	O
Many	O
of	O
the	O
emails	O
came	O
from	O
the	O
same	O
country	O
as	O
the	O
main	O
targeted	O
sales	O
manager	O
.	O
The	B-Entity
emails	I-Entity
all	I-Entity
contained	I-Entity
malicious	I-Entity
attachments	I-Entity
.	O
None	O
of	O
them	O
linked	O
to	O
third	O
party	O
sites	O
for	O
drive-by	O
downloads	O
.	O
Of	O
the	O
attachments	O
,	O
1,588	O
had	O
a	O
.exe	O
extension	O
.	O
Of	O
those	O
,	O
842	O
had	O
a	O
.pdf.exe	O
extension	O
.	O
The	B-Entity
malware	I-Entity
chosen	I-Entity
was	I-Entity
a	I-Entity
variant	I-Entity
of	I-Entity
the	I-Entity
Poison	I-Entity
Ivy	I-Entity
Trojan	I-Entity
Backdoor.Darkmoon	I-Entity
and	O
,	O
in	O
some	O
minor	O
cases	O
,	O
Trojan	O
droppers	O
that	O
would	O
download	B-Action
additional	B-Entity
malware	I-Entity
.	O
The	O
attackers	O
did	O
not	O
use	O
any	O
zero-day	O
exploits	O
to	O
drop	B-Action
a	B-Entity
payload	I-Entity
.	O
The	B-Entity
social	I-Entity
engineering	I-Entity
messages	I-Entity
concentrated	O
mainly	O
around	O
the	O
following	O
two	O
themes	O
:	O
Once	O
installed	O
,	O
the	O
back	O
door	O
would	O
create	O
a	O
registry	O
run	O
key	O
in	O
order	O
to	O
restart	O
with	O
Windows	O
and	O
connect	B-Action
to	B-Modifier
one	B-Entity
of	I-Entity
three	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
servers	I-Entity
located	I-Entity
in	O
Greece	O
.	O
The	B-Entity
last	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
has	O
been	O
used	O
since	O
2010	O
in	O
similar	O
attacks	O
against	O
other	O
companies	O
.	O
Other	O
sub-domains	O
at	O
the	O
same	O
free	O
host	O
and	O
DNS	O
service	O
have	O
been	O
used	O
by	O
other	O
groups	O
to	O
spread	O
malware	O
in	O
the	O
past	O
.	O
The	B-Entity
chosen	I-Entity
names	I-Entity
of	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
domains	I-Entity
imitates	B-Action
legitimate	B-Entity
services	I-Entity
in	O
a	O
bid	O
to	O
be	O
overlooked	O
by	O
the	O
system	O
administrators	O
when	O
checking	O
their	O
logs	O
.	O
The	B-Entity
back	I-Entity
door	I-Entity
provides	B-Action
full	B-Entity
remote	I-Entity
access	I-Entity
to	B-Modifier
the	B-Entity
compromised	I-Entity
computers	I-Entity
,	O
allowing	O
for	O
extraction	O
of	O
any	O
data	O
.	O
It	O
is	O
unknown	O
if	O
the	O
attackers	O
succeeded	O
in	O
their	O
goal	O
and	O
if	O
valuable	O
information	O
has	O
been	O
extracted	O
.	O
The	O
attacks	O
did	O
not	O
completely	O
disappear	O
,	O
but	O
the	O
email	O
volume	O
decreased	O
significantly	O
to	O
only	O
a	O
few	O
emails	O
per	O
week	O
afterwards	O
.	O
As	O
with	O
all	O
targeted	O
attacks	O
,	O
there	O
are	O
many	O
different	O
groups	O
of	O
attackers	O
operating	O
in	O
this	O
field	O
.	O
These	O
attacks	O
can	O
not	O
be	O
attributed	O
to	O
only	O
one	O
group	O
or	O
geographical	O
region	O
.	O
We	O
have	O
seen	O
individuals	O
,	O
competitors	O
,	O
hacktivist	O
groups	O
and	O
possible	O
state	O
sponsored	O
agents	O
carrying	O
out	O
attacks	O
against	O
energy	O
companies	O
.	O
Some	O
of	O
the	O
attacks	O
have	O
been	O
purely	O
opportunistic	O
,	O
seeking	O
any	O
valuable	O
information	O
available	O
.	O
Other	O
campaigns	O
look	O
like	O
they	O
were	O
planned	O
over	O
a	O
lengthy	O
period	O
and	O
carried	O
out	O
methodically	O
with	O
a	O
clear	O
goal	O
in	O
mind	O
.	O
The	O
attackers	O
tend	O
to	O
go	O
after	O
valuable	O
information	O
,	O
including	O
maps	O
of	O
new	O
gas	O
fields	O
or	O
research	O
on	O
efficient	O
photovoltaic	O
generators	O
.	O
This	O
information	O
can	O
be	O
of	O
great	O
value	O
to	O
competitors	O
or	O
nations	O
that	O
want	O
to	O
make	O
progress	O
in	O
the	O
same	O
field	O
.	O
Another	O
motivation	O
for	O
attackers	O
is	O
to	O
profit	O
from	O
the	O
information	O
stolen	O
by	O
blackmailing	O
the	O
company	O
.	O
The	O
same	O
information	O
can	O
be	O
used	O
to	O
carry	O
out	O
sabotage	O
attacks	O
designed	O
to	O
disrupt	O
ICSs	O
,	O
as	O
the	O
energy	O
sector	O
is	O
also	O
a	O
primary	O
target	O
for	O
sabotage	O
attacks	O
which	O
will	O
not	O
generate	O
direct	O
profit	O
for	O
the	O
attacker	O
.	O
A	O
competitor	O
might	O
be	O
interested	O
in	O
generating	O
bad	O
press	O
and	O
bad	O
customer	O
experience	O
for	O
a	O
rival	O
company	O
,	O
in	O
order	O
to	O
win	O
some	O
new	O
clients	O
.	O
For	O
example	O
,	O
in	O
January	O
2013	O
a	O
group	O
claiming	O
to	O
be	O
related	O
to	O
Anonymous	O
posted	O
access	O
details	O
for	O
what	O
they	O
said	O
were	O
Israeli	O
SCADA	O
systems	O
for	O
power	O
plants	O
and	O
other	O
systems	O
.	O
Meanwhile	O
,	O
''	O
Operation	O
Save	O
the	O
Arctic	O
''	O
targeted	O
multiple	O
oil	O
companies	O
around	O
the	O
globe	O
in	O
protest	O
against	O
drilling	O
plans	O
in	O
the	O
Arctic	O
.	O
Disgruntled	O
employees	O
are	O
also	O
a	O
source	O
of	O
attacks	O
that	O
should	O
not	O
be	O
underestimated	O
.	O
With	O
their	O
knowhow	O
about	O
internal	O
critical	O
processes	O
and	O
systems	O
they	O
often	O
know	O
how	O
to	O
inflict	O
serious	O
damage	O
.	O
They	O
may	O
be	O
able	O
to	O
perform	O
system	O
modifications	O
that	O
could	O
go	O
unnoticed	O
for	O
a	O
long	O
periods	O
.	O
For	O
all	O
regular	O
client	O
computers	O
,	O
the	O
well-established	O
best	O
practice	O
guidelines	O
apply	O
.	O
These	O
computers	O
are	O
often	O
the	O
first	O
ones	O
to	O
be	O
attacked	O
.	O
Once	O
compromised	O
,	O
the	O
attacker	O
will	O
use	O
these	O
computers	O
and	O
try	O
to	O
explore	O
deeper	O
into	O
internal	O
networks	O
.	O
Securing	O
and	O
hardening	O
of	O
deployed	O
operating	O
systems	O
with	O
a	O
working	O
strategy	O
for	O
patch	O
deployment	O
is	O
important	O
.	O
Reoccurring	O
security	O
awareness	O
training	O
can	O
help	O
users	O
to	O
identify	O
social	O
engineering	O
attempts	O
and	O
prevent	O
them	O
from	O
falling	O
victim	O
to	O
them	O
in	O
the	O
first	O
place	O
.	O
The	O
company	O
can	O
perform	O
penetration	O
testing	O
on	O
Web	O
and	O
network	O
applications	O
but	O
also	O
on	O
ICSs	O
to	O
identify	O
and	O
remedy	O
any	O
vulnerability	O
.	O
For	O
examples	O
Web	O
applications	O
should	O
be	O
tested	O
against	O
SQL	B-Entity
injection	I-Entity
attacks	I-Entity
.	O
This	O
can	O
also	O
help	O
confirm	O
if	O
applied	O
polices	O
are	O
followed	O
through	O
,	O
if	O
the	O
patch	O
level	O
is	O
correct	O
on	O
all	O
computers	O
and	O
if	O
systems	O
are	O
compliant	O
.	O
Companies	O
can	O
monitor	B-Action
the	B-Entity
Internet	I-Entity
for	I-Entity
information	I-Entity
about	I-Entity
attacks	I-Entity
in	B-Modifier
the	B-Entity
same	I-Entity
vertical	I-Entity
and	O
apply	O
lessons	O
learned	O
where	O
possible	O
.	O
In	O
addition	O
,	O
different	O
layers	O
of	O
security	O
products	O
can	O
help	O
achieve	O
better	O
overall	O
protection	O
.	O
•	O
Security	O
Information	O
and	O
Event	O
Manager	O
system	O
(	O
SIEM	O
)	O
:	O
Using	O
a	O
SIEM	O
can	O
help	O
correlate	O
all	O
related	O
alerts	O
in	O
one	O
place	O
.	O
This	O
centralized	O
view	O
can	O
be	O
cross	O
referenced	O
with	O
threat	O
intelligence	O
data	O
to	O
generate	O
prioritization	O
and	O
an	O
action	O
plan	O
.	O
Painting	O
the	O
bigger	O
picture	O
of	O
the	O
overall	O
security	O
state	O
can	O
reveal	O
previously	O
unnoticed	O
attacks	O
.	O
For	O
example	O
failed	O
login	O
attempts	O
on	O
internal	O
servers	O
could	O
indicate	O
a	O
password	O
breach	O
.	O
This	O
includes	O
logging	O
of	O
critical	O
systems	O
and	O
synchronization	O
of	O
time	O
among	O
multiple	O
systems	O
.	O
•	O
Ingress	O
and	O
egress	O
filtering	O
:	O
Filtering	O
the	O
network	O
traffic	O
with	O
firewalls	O
,	O
content	O
filters	O
and	O
IPS	O
allows	O
the	O
control	O
of	O
data	O
flows	O
.	O
This	O
can	O
prevent	O
attackers	O
from	O
reaching	O
internal	O
systems	O
.	O
It	O
is	O
important	O
to	O
also	O
monitor	O
outbound	O
traffic	O
,	O
as	O
data	O
exfiltration	O
is	O
a	O
key	O
point	O
for	O
cyberespionage	O
.	O
It	O
should	O
be	O
noted	O
that	O
with	O
the	O
increased	O
use	O
of	O
cloud	O
services	O
and	O
mobile	O
devices	O
,	O
some	O
traffic	O
might	O
never	O
pass	O
through	O
the	O
company	O
's	O
gateways	O
.	O
Where	O
traffic	O
blocking	O
is	O
too	O
disruptive	O
at	O
least	O
monitoring	O
should	O
be	O
implemented	O
.	O
•	O
Data	O
loss	O
prevention	O
(	O
DLP	O
)	O
:	O
DLP	O
solutions	O
can	O
track	O
the	O
access	O
and	O
flow	O
of	O
critical	O
information	O
and	O
prevent	O
it	O
from	O
leaving	O
the	O
company	O
or	O
encrypt	B-Action
it	B-Entity
automatically	O
.	O
•	O
Endpoint	O
protection	O
:	O
Depending	O
on	O
the	O
usage	O
pattern	O
of	O
the	O
computer	O
,	O
different	O
solutions	O
are	O
available	O
to	O
protect	O
the	O
endpoint	O
.	O
Antivirus	O
solution	O
with	O
proactive	O
detection	O
methods	O
like	O
behavioral	O
analysis	O
and	O
reputation	O
scanning	O
can	O
prevent	O
unknown	O
malware	O
from	O
installing	O
itself	O
.	O
HIPS	O
(	O
host	O
based	O
intrusion	O
prevention	O
systems	O
)	O
,	O
behavioral	O
lockdown	O
or	O
whitelisting	O
can	O
protect	O
computers	O
from	O
any	O
kind	O
of	O
unwanted	O
tampering	O
without	O
the	O
need	O
of	O
constant	O
updates	O
.	O
•	O
System	O
protection	O
:	O
For	O
non-standard	O
IT	O
systems	O
,	O
hardening	O
can	O
increase	O
the	O
security	O
.	O
On	O
industrial	O
systems	O
which	O
are	O
not	O
often	O
updated	O
or	O
that	O
can	O
not	O
be	O
updated	O
,	O
exploitation	O
can	O
be	O
prevented	O
with	O
the	O
help	O
of	O
lockdown	O
solutions	O
like	O
Symantec	O
Critical	O
System	O
Protection	O
(	O
CSP	O
)	O
.	O
Through	O
policies	O
,	O
only	O
trusted	O
system	O
applications	O
are	O
allowed	O
to	O
run	O
.	O
ICS	O
should	O
be	O
regularly	O
checked	O
and	O
upgraded	O
if	O
new	O
firmware	O
exists	O
.	O
Where	O
this	O
is	O
not	O
possible	O
HIPS	O
and	O
behavioral	O
lockdown	O
tools	O
can	O
be	O
used	O
to	O
secure	O
computers	O
.	O
•	O
Email	O
filtering	O
:	O
Proper	O
email	O
filtering	O
can	O
prevent	O
many	O
spear	O
phishing	O
attempts	O
from	O
reaching	O
users	O
.	O
They	O
can	O
help	O
minimize	O
the	O
risk	O
of	O
an	O
untrained	O
user	O
falling	O
for	O
social	O
engineering	O
tricks	O
.	O
•	O
Authentication	O
:	O
Some	O
of	O
the	O
ICS	O
contain	O
hardcoded	O
passwords	O
and	O
,	O
wherever	O
possible	O
,	O
these	O
should	O
be	O
changed	O
.	O
ICS	O
frequently	O
use	O
weakly	O
authenticated	O
protocols	O
that	O
allow	O
for	O
impersonation	O
attacks	O
.	O
Where	O
possible	O
those	O
authentication	O
methods	O
should	O
be	O
upgraded	O
or	O
at	O
least	O
closely	O
monitored	O
.	O
Strong	O
authentication	O
or	O
PKI	O
should	O
be	O
used	O
where	O
applicable	O
.	O
Industrial	I-Entity
control	I-Entity
systems	I-Entity
(	I-Entity
ICS	I-Entity
)	I-Entity
should	O
be	O
specially	O
protected	O
and	O
monitored	O
.	O
The	B-Entity
control	I-Entity
system	I-Entity
and	I-Entity
control	I-Entity
network	I-Entity
should	O
be	O
secured	O
.	O
Where	O
possible	O
,	O
ICS	O
should	O
be	O
separate	O
from	O
the	O
Intranet	O
.	O
Isolating	O
these	O
networks	O
alone	O
is	O
often	O
not	O
enough	O
to	O
protect	O
the	O
control	O
network	O
,	O
but	O
it	O
can	O
make	O
it	O
more	O
difficult	O
for	O
attackers	O
to	O
succeed	O
.	O
For	O
some	O
systems	O
it	O
can	O
make	O
sense	O
to	O
have	O
a	O
plan	O
to	O
quickly	O
disconnect	O
or	O
separate	O
critical	O
machines	O
in	O
the	O
event	O
of	O
a	O
detected	O
cyberattack	O
.	O
Cyberespionage	O
campaigns	O
and	O
sabotage	O
attacks	O
are	O
becoming	O
increasingly	O
common	O
,	O
with	O
countless	O
threat	O
actors	O
attempting	O
to	O
gain	O
a	O
foothold	O
in	O
some	O
of	O
the	O
best	O
protected	O
organizations	O
.	O
At	O
this	O
stage	O
,	O
roughly	O
five	O
targeted	O
attacks	O
per	O
day	O
are	O
being	O
mounted	O
on	O
firms	O
in	O
the	O
energy	O
sector	O
.	O
These	O
attacks	O
have	O
become	O
increasingly	O
sophisticated	O
,	O
although	O
the	O
capabilities	O
and	O
tactics	O
used	O
by	O
these	O
threat	O
actors	O
vary	O
considerably	O
.	O
In	O
the	O
second	O
half	O
of	O
2012	O
,	O
the	O
energy	O
sector	O
was	O
the	O
second	O
most	O
targeted	O
with	O
16	O
percent	O
of	O
all	O
the	O
targeted	O
attacks	O
.	O
This	O
strong	O
increase	O
was	O
mainly	O
due	O
to	O
a	O
large	O
scale	O
attack	O
against	O
one	O
global	O
oil	O
company	O
.	O
In	O
the	O
first	O
half	O
of	O
2013	O
,	O
the	O
energy	O
sector	O
was	O
ranked	O
fifth	O
with	O
7.6	O
percent	O
of	O
all	O
attacks	O
focused	O
on	O
this	O
sector	O
.	O
In	O
general	O
we	O
have	O
observed	O
that	O
attackers	O
are	O
becoming	O
more	O
efficient	O
and	O
focusing	O
on	O
smaller	O
operations	O
that	O
attract	O
less	O
attention	O
.	O
The	O
attackers	O
tend	O
to	O
go	O
after	O
valuable	O
information	O
–	O
such	O
as	O
maps	O
of	O
a	O
new	O
gas	O
field	O
–	O
but	O
the	O
sector	O
is	O
also	O
a	O
major	O
target	O
for	O
sabotage	O
attacks	O
,	O
which	O
will	O
not	O
generate	O
direct	O
profit	O
for	O
the	O
attacker	O
.	O
Such	O
disruptive	O
attacks	O
do	O
already	O
happen	O
and	O
may	O
lead	O
to	O
large	O
financial	O
losses	O
.	O
State	O
sponsored	O
agents	O
,	O
competitors	O
,	O
internal	O
attackers	O
or	O
hacktivists	O
are	O
the	O
most	O
likely	O
authors	O
of	O
such	O
sabotage	O
attacks	O
.	O
Fortunately	O
,	O
there	O
have	O
not	O
been	O
many	O
successful	O
sabotage	O
attacks	O
against	O
energy	O
companies	O
to	O
date	O
.	O
However	O
,	O
the	O
increasing	O
number	O
of	O
connected	O
systems	O
and	O
centralized	O
control	O
for	O
ICS	O
systems	O
means	O
that	O
the	O
risk	O
of	O
attacks	O
in	O
the	O
future	O
will	O
increase	O
.	O
Energy	O
and	O
utility	O
companies	O
need	O
to	O
be	O
aware	O
of	O
these	O
risks	O
and	O
plan	O
accordingly	O
to	O
protect	O
their	O
valuable	O
information	O
as	O
well	O
as	O
their	O
ICS	O
or	O
SCADA	O
networks	O
.	O
Social	I-Entity
engineering	I-Entity
is	B-Action
an	B-Entity
essential	I-Entity
part	I-Entity
of	I-Entity
spear	I-Entity
phishing	I-Entity
campaigns	I-Entity
.	O
A	O
cleverly	O
chosen	O
,	O
enticing	O
message	O
may	O
prompt	O
the	O
user	O
into	O
opening	O
an	O
attachment	O
.	O
It	O
is	O
evident	O
that	O
most	O
attackers	O
are	O
carefully	O
selecting	O
the	O
themes	O
that	O
they	O
use	O
for	O
their	O
attacks	O
.	O
Some	O
groups	O
use	O
real	O
news	O
stories	O
and	O
copy	O
the	O
text	O
directly	O
from	O
the	O
newspaper	O
websites	O
.	O
Others	O
try	O
to	O
appeal	O
to	O
personal	O
hobbies	O
in	O
order	O
to	O
get	O
the	O
user	O
's	O
attention	O
.	O
In	O
the	O
energy	O
sector	O
the	O
most	O
commonly	O
used	B-Action
theme	B-Entity
for	B-Modifier
spear	B-Entity
phishing	I-Entity
emails	I-Entity
was	O
money	O
related	O
(	O
e.g	O
.	O
''	I-Entity
Wage	I-Entity
Data	I-Entity
2012	I-Entity
''	I-Entity
)	I-Entity
followed	O
by	O
sports	O
related	O
themes	O
(	O
e.g	O
.	O
''	O
2012-13	O
NFL	O
Playoffs	O
Schedule	O
''	O
)	O
.	O
As	O
an	O
example	O
,	O
the	O
subject	O
line	O
''	O
Wage	O
Data	O
2012	O
''	O
was	O
used	O
in	O
944	O
emails	O
,	O
sent	O
from	O
26	O
different	O
email	O
addresses	O
to	O
targets	O
in	O
nine	O
different	O
sectors	O
.	O
The	O
attack	O
was	O
carried	O
out	O
over	O
eight	O
days	O
and	O
used	B-Action
the	B-Entity
same	I-Entity
infected	I-Entity
Microsoft	I-Entity
Word	I-Entity
document	I-Entity
in	O
every	O
instance	O
.	O
In	O
general	O
any	O
topic	O
can	O
be	B-Action
used	I-Action
in	B-Modifier
a	B-Entity
social	I-Entity
engineering	I-Entity
attempt	O
,	O
which	O
makes	O
it	O
even	O
harder	O
for	O
regular	O
users	O
to	O
spot	O
the	O
attacks	O
.	O
Here	O
are	O
a	O
few	O
examples	O
of	O
subject	O
lines	O
used	O
,	O
listed	O
by	O
category	O
:	O
In	O
the	O
last	O
six	O
month	O
of	O
2012	O
the	O
average	O
number	O
of	O
targeted	O
attacks	O
observed	O
per	O
day	O
was	O
87	O
(	O
with	O
14	O
in	O
the	O
energy	O
sector	O
)	O
.	O
In	O
the	O
first	O
six	O
month	O
of	O
2013	O
the	O
average	O
number	O
decreased	O
to	O
60	O
targeted	O
attacks	O
per	O
day	O
(	O
five	O
in	O
the	O
energy	O
sector	O
)	O
.	O
The	O
spike	O
in	O
August	O
and	O
September	O
2012	O
is	O
mostly	O
related	O
to	O
a	O
large	O
scale	O
attack	O
against	O
a	O
global	O
oil	O
company	O
.	O
The	O
increase	O
in	O
May	O
2013	O
was	O
due	O
to	O
multiple	O
attacks	O
against	O
financial	O
services	O
,	O
public	O
sector	O
and	O
IT	O
service	O
organizations	O
.	O
The	O
government	O
and	O
public	O
sector	O
was	O
quantitatively	O
the	O
most	O
attacked	O
sector	O
,	O
with	O
25.4	O
percent	O
of	O
all	O
targeted	O
attacks	O
falling	O
in	O
this	O
sector	O
for	O
the	O
last	O
half	O
of	O
2012	O
and	O
24	O
percent	O
for	O
the	O
first	O
half	O
of	O
2013	O
.	O
The	O
energy	O
sector	O
accounted	O
for	O
7.6	O
percent	O
of	O
all	O
targeted	O
attacks	O
,	O
making	O
it	O
the	O
fifth	O
most	O
targeted	O
sector	O
in	O
the	O
first	O
six	O
month	O
of	O
2013	O
.	O
This	O
was	O
a	O
big	O
decrease	O
from	O
16.3	O
percent	O
of	O
all	O
attacks	O
in	O
the	O
last	O
half	O
of	O
2012	O
,	O
when	O
it	O
was	O
the	O
second	O
most	O
attacked	O
sector	O
.	O
This	O
spike	O
in	O
2012	O
is	O
mainly	O
due	O
to	O
a	O
large	O
attack	O
campaign	O
against	O
a	O
global	O
oil	O
company	O
which	O
took	O
place	O
in	O
September	O
2012	O
.	O
On	O
average	O
we	O
saw	O
18.6	O
mail	O
accounts	O
being	O
attacked	O
for	O
any	O
given	O
target	O
company	O
in	O
the	O
last	O
half	O
of	O
2012	O
(	O
60.7	O
in	O
the	O
energy	O
sector	O
)	O
and	O
5.6	O
email	O
accounts	O
in	O
the	O
first	O
half	O
of	O
2013	O
(	O
10	O
in	O
the	O
energy	O
sector	O
)	O
.	O
Overall	O
,	O
we	O
see	O
a	O
trend	O
of	O
the	O
attacker	O
conducting	O
more	O
focused	O
attacks	O
against	O
fewer	O
individuals	O
.	O
This	O
generates	O
less	O
noise	O
and	O
the	O
risk	O
of	O
getting	O
noticed	O
or	O
discovered	O
is	O
smaller	O
.	O
These	O
emails	O
are	O
sent	O
in	O
small	O
bursts	O
and	O
then	O
repeated	O
against	O
a	O
changing	O
target	O
space	O
till	O
enough	O
computers	O
are	O
compromised	O
.	O
Half	O
of	O
all	O
the	O
attachments	O
analyzed	O
used	O
an	O
extension	O
that	O
would	O
run	O
directly	O
when	O
double	O
clicked	O
.	O
This	O
old	O
method	O
is	O
still	O
the	O
most	O
common	O
scheme	O
used	O
.	O
Of	O
all	O
attachments	O
analyzed	O
,	O
38	O
percent	O
were	O
.exe	O
and	O
12	O
percent	O
were	O
.src	O
files	O
.	O
In	O
total	O
only	O
6	O
percent	O
used	O
double	O
extensions	O
like	O
.pdf.exe	O
to	O
fool	O
the	O
user	O
.	O
It	O
should	O
also	O
be	O
noted	O
that	O
23	O
percent	O
were	O
Microsoft	O
Word	O
documents	O
using	O
some	O
exploit	O
to	O
execute	O
custom	O
code	O
on	O
the	O
computer	O
.	O
There	O
were	O
also	O
some	O
more	O
exotic	O
extensions	O
used	O
like	O
AutoIt	O
scripts	O
(	O
.au3	O
)	O
and	O
ZX-Edit	O
files	O
(	O
.zed	O
)	O
,	O
but	O
these	O
are	O
the	O
exception	O
rather	O
than	O
the	O
rule	O
.	O
It	O
might	O
be	O
that	O
the	O
attackers	O
tried	O
to	O
bypass	O
some	O
email	O
filtering	O
software	O
by	O
experimenting	O
with	O
different	O
attachment	O
types	O
.	O
Sometimes	O
even	O
older	O
exploits	B-Entity
like	I-Entity
the	I-Entity
Microsoft	I-Entity
DirectX	I-Entity
DirectShow	I-Entity
Length	I-Entity
Record	I-Entity
Remote	I-Entity
Code	I-Entity
Execution	I-Entity
Vulnerability	I-Entity
(	I-Entity
CVE-	I-Entity
2009-1539	I-Entity
)	I-Entity
in	I-Entity
.mp4	I-Entity
files	I-Entity
are	O
still	O
occasionally	O
used	O
.	O
This	O
indicates	O
that	O
either	O
not	O
all	O
attackers	O
have	O
the	O
knowhow	O
to	O
use	O
newer	O
exploits	O
that	O
are	O
publicly	O
available	O
or	O
they	O
speculate	O
that	O
the	O
target	O
has	O
not	O
patched	O
all	O
computers	O
.	O
Some	O
of	O
the	O
attackers	O
do	O
not	O
seem	O
to	O
be	O
too	O
sophisticated	O
.	O
For	O
example	O
they	O
used	O
''	O
www	O
.	O
[	I-Entity
COMPANY-NAME	I-Entity
]	I-Entity
.com.exe	I-Entity
''	I-Entity
as	B-Modifier
an	B-Entity
attachment	I-Entity
name	I-Entity
,	O
clearly	O
missing	O
that	O
the	O
''	O
.com	O
''	O
at	O
the	O
end	O
would	O
be	O
sufficient	O
to	O
run	O
it	O
and	O
the	O
additional	O
''	O
.exe	O
''	O
was	O
not	O
needed	O
.	O
To	O
identify	O
a	O
series	O
of	O
targeted	O
attacks	O
that	O
are	O
likely	O
performed	O
by	O
the	O
same	O
individuals	O
,	O
we	O
have	O
used	O
a	O
novel	O
attack	O
attribution	O
methodology	O
named	O
TRIAGE	O
.	O
Developed	O
by	O
Symantec	O
Research	O
Labs	O
,	O
TRIAGE	O
is	O
data	O
mining	O
software	O
that	O
relies	O
on	O
multi-criteria	O
decision	O
analysis	O
and	O
intelligent	O
data	O
fusion	O
algorithms	O
to	O
reliably	O
link	O
different	O
attacks	O
to	O
the	O
same	O
source	O
.	O
This	O
framework	O
has	O
been	O
developed	O
in	O
order	O
to	O
automate	O
cyberintelligence	O
tasks	O
and	O
reduce	O
the	O
time	O
needed	O
to	O
get	O
insights	O
into	O
organized	O
cybercrime	O
activities	O
.	O
By	O
enabling	O
rapid	O
analysis	O
of	O
large	O
security	O
data	O
sets	O
,	O
Symantec	O
analysts	O
can	O
then	O
quickly	O
and	O
more	O
efficiently	O
attribute	O
various	O
waves	O
of	O
cyberattacks	O
to	O
a	O
specific	O
attack	O
campaign	O
likely	O
run	O
by	O
the	O
same	O
individuals	O
.	O
The	O
TRIAGE	O
framework	O
was	O
recently	O
enhanced	O
with	O
novel	O
visualizations	O
thanks	O
to	O
VIS-SENSE	O
,	O
a	O
European	O
research	O
project	O
aiming	O
at	O
developing	O
visual	O
analytics	O
technologies	O
for	O
network	O
security	O
applications	O
.	O
Since	O
its	O
original	O
conception	O
,	O
TRIAGE	O
has	O
been	O
successfully	O
used	O
to	O
analyze	O
the	O
behavior	O
of	O
cybercriminals	O
involved	O
in	O
various	O
types	O
of	O
Internet	O
attack	O
activities	O
,	O
such	O
as	O
rogue	O
antivirus	O
websites	O
,	O
spam	O
botnets	O
operations	O
,	O
scam	B-Entity
campaigns	I-Entity
and	I-Entity
targeted	I-Entity
attacks	I-Entity
performed	B-Action
via	B-Modifier
spear	B-Entity
phishing	I-Entity
emails	I-Entity
.	O
As	O
with	O
any	O
other	O
targeted	O
attacks	O
,	O
attacks	O
against	O
the	O
energy	O
sector	O
often	O
follow	O
the	O
same	O
pattern	O
.	O
It	O
can	O
be	O
broken	O
down	O
in	O
different	O
phases	O
of	O
attack	O
.	O
It	O
should	O
be	O
noted	O
that	O
we	O
have	O
seen	O
attackers	O
modify	O
their	O
behavior	O
and	O
exceptions	O
from	O
the	O
norm	O
and	O
this	O
is	O
possible	O
especially	O
if	O
the	O
target	O
company	O
has	O
special	O
circumstances	O
or	O
security	O
measures	O
in	O
place	O
.	O
During	O
this	O
phase	O
the	O
attacker	O
tries	O
to	O
learn	O
as	O
much	O
as	O
possible	O
about	O
the	O
targeted	O
organization	O
.	O
Information	O
sources	O
often	O
include	O
social	O
networks	O
,	O
job	O
posting	O
sites	O
and	O
press	O
releases	O
.	O
This	O
enables	O
the	O
attacker	O
to	O
learn	O
the	O
contact	O
details	O
of	O
possible	O
target	O
individuals	O
as	O
well	O
as	O
context	O
that	O
can	O
be	O
used	O
in	O
social	O
engineering	O
scenarios	O
.	O
The	B-Entity
attacker	I-Entity
will	O
often	O
create	O
a	O
list	O
of	O
implemented	O
security	O
software	O
used	O
at	O
the	O
targeted	O
company	O
from	O
whatever	O
information	O
is	O
available	O
.	O
These	O
investigations	O
often	O
start	O
completely	O
passively	O
without	O
any	O
direct	O
contact	O
with	O
the	O
company	O
,	O
since	O
there	O
are	O
many	O
data	O
sources	O
publicly	O
available	O
.	O
Subsequently	O
the	O
attacker	O
can	O
use	O
more	O
interaction	O
if	O
needed	O
.	O
Some	B-Entity
attackers	I-Entity
go	I-Entity
through	O
all	O
the	O
effort	O
of	O
creating	B-Action
a	B-Entity
fake	I-Entity
social	I-Entity
media	I-Entity
account	I-Entity
and	O
befriending	O
key	O
employees	O
.	O
After	O
a	O
period	O
of	O
small	O
talk	O
,	O
to	O
create	O
a	O
false	O
sense	O
of	O
security	O
,	O
such	O
a	O
connection	O
can	O
then	O
be	O
used	O
to	O
pass	O
on	O
an	O
infected	O
document	O
or	O
find	O
out	O
about	O
some	O
key	O
information	O
.	O
Depending	O
on	O
the	O
targeted	O
location	O
,	O
physical	O
reconnaissance	O
and	O
eavesdropping	O
may	O
also	O
be	O
used	O
.	O
The	O
actual	O
break-in	O
occurs	O
during	O
this	O
phase	O
.	O
The	B-Entity
attacker	I-Entity
usually	I-Entity
compromises	O
the	O
network	O
by	O
delivering	B-Action
targeted	B-Entity
malware	I-Entity
to	B-Modifier
vulnerable	B-Entity
systems	I-Entity
or	O
employees	O
.	O
There	O
are	O
two	O
main	O
avenues	O
of	O
attack	O
.	O
One	O
is	O
to	O
send	B-Action
spear	B-Entity
phishing	I-Entity
emails	I-Entity
,	O
where	O
a	B-Entity
link	I-Entity
to	B-Modifier
a	B-Entity
malicious	I-Entity
website	I-Entity
or	I-Entity
a	I-Entity
malicious	I-Entity
attachment	I-Entity
is	B-Action
delivered	I-Action
using	B-Modifier
social	B-Entity
engineering	I-Entity
techniques	I-Entity
.	O
The	O
second	O
method	O
,	O
which	O
is	O
gaining	O
traction	O
,	O
is	O
watering	O
hole	O
attacks	O
,	O
where	O
the	B-Entity
attacker	I-Entity
infects	B-Action
a	B-Entity
website	I-Entity
that	O
has	O
a	O
high	O
likelihood	O
of	O
being	O
visited	O
by	O
the	O
intended	O
victim	O
.	O
By	O
using	O
IP	O
address	O
filters	O
before	O
infecting	O
any	O
visitor	O
of	O
such	O
sites	O
,	O
the	O
attacker	O
can	O
reduce	O
the	O
number	O
of	O
infected	O
systems	O
and	O
bring	O
it	O
to	O
a	O
manageable	O
quantity	O
which	O
can	O
be	O
assessed	O
manually	O
at	O
another	O
time	O
.	O
Some	O
groups	O
carefully	O
plan	O
watering	O
hole	O
attacks	O
.	O
For	O
example	O
the	O
Hidden	O
Lynx	O
group	O
stopped	O
using	O
a	O
zero-day	O
vulnerability	O
in	O
a	O
large	O
watering	O
hole	O
attack	O
after	O
Microsoft	O
released	O
details	O
on	O
the	O
vulnerability	O
.	O
This	O
helped	O
to	O
cover	O
their	O
activities	O
and	O
avoid	O
unwanted	O
attention	O
.	O
A	O
few	O
days	O
later	O
the	O
group	O
resumed	O
the	O
watering	O
hole	O
attack	O
again	O
,	O
this	O
time	O
using	O
a	O
different	O
exploit	O
.	O
For	O
more	O
difficult	O
targets	O
,	O
man-in-the-middle	O
attacks	O
can	O
be	O
used	O
.	O
These	O
can	O
be	O
performed	O
either	O
at	O
the	O
same	O
physical	O
location	O
,	O
posing	O
as	O
a	O
genuine	O
Wi-Fi	O
hotspot	O
or	O
through	O
supply	O
chain	O
attacks	O
.	O
This	O
can	O
enable	O
the	O
attacker	O
to	O
swap	O
an	O
update	O
of	O
legitimate	O
software	O
for	O
a	O
maliciously	O
crafted	O
version	O
.	O
Once	O
the	O
victim	O
installs	O
the	O
genuine	O
looking	O
update	O
,	O
the	O
attacker	O
effectively	O
gains	O
control	O
over	O
the	O
computer	O
.	O
Due	O
to	O
the	O
complexity	O
of	O
such	O
an	O
attack	O
,	O
they	O
are	O
rarely	O
used	O
.	O
Depending	O
on	O
the	O
skills	O
of	O
the	O
attacker	O
and	O
the	O
time	O
available	O
,	O
the	O
attacker	O
might	O
also	O
attack	O
systems	O
at	O
the	O
perimeter	O
,	O
such	O
as	O
Web	O
servers	O
,	O
and	O
try	O
to	O
break	O
in	O
from	O
there	O
.	O
The	O
malware	O
used	O
is	O
not	O
always	O
sophisticated	O
.	O
Sometimes	O
a	B-Entity
regular	I-Entity
off-the-shelf	I-Entity
back	I-Entity
door	I-Entity
Trojan	I-Entity
is	O
used	O
.	O
In	O
these	O
cases	O
the	O
person	O
behind	O
the	O
malware	O
orchestrating	O
the	O
commands	O
is	O
what	O
makes	O
the	O
difference	O
between	O
a	O
targeted	O
attack	O
and	O
a	O
broad	O
generic	O
infection	O
.	O
Having	O
said	O
this	O
,	O
on	O
very	O
unique	O
targets	O
,	O
we	O
will	O
often	O
see	O
the	O
use	O
of	O
a	O
specifically	O
designed	O
piece	O
malware	O
,	O
such	O
as	O
in	O
the	O
case	O
of	O
Stuxnet	O
.	O
Depending	O
on	O
the	O
protection	O
measures	O
implemented	O
by	O
the	O
target	O
,	O
the	O
attackers	O
may	O
also	O
digitally	O
sign	O
their	O
malware	O
creation	O
.	O
In	O
the	O
past	O
there	O
have	O
been	O
quite	O
a	O
few	O
cases	O
where	O
code	O
signing	O
certificates	O
were	O
stolen	O
and	O
later	O
misused	O
to	O
sign	O
malware	O
in	O
order	O
to	O
pass	B-Action
it	B-Entity
unnoticed	I-Entity
to	B-Modifier
high	B-Entity
value	I-Entity
targets	I-Entity
.	O
Once	O
the	O
attacker	O
has	O
a	O
foothold	O
on	O
one	O
system	O
,	O
the	O
next	O
step	O
is	O
to	O
create	O
a	O
plan	O
for	O
lateral	O
movement	O
through	O
the	O
network	O
until	O
the	O
interesting	O
data	O
is	O
found	O
.	O
With	O
more	O
specialized	O
teams	O
of	O
attackers	O
,	O
we	O
can	O
often	O
observe	O
that	O
the	O
infected	O
system	O
is	O
first	O
analyzed	O
to	O
ensure	O
that	O
it	O
is	O
of	O
interest	O
to	O
them	O
.	O
With	O
watering	O
hole	O
attacks	O
especially	O
,	O
it	O
can	O
happen	O
that	O
computers	O
that	O
were	O
not	O
targeted	O
get	O
infected	O
.	O
Infected	O
computers	O
need	O
to	O
be	O
assessed	O
by	O
the	O
attacker	O
and	O
,	O
if	O
necessary	O
,	O
removed	O
to	O
keep	O
the	O
profile	O
,	O
and	O
with	O
that	O
the	O
chances	O
of	O
exposure	O
,	O
low	O
.	O
One	O
of	O
the	O
obvious	O
tasks	O
performed	O
by	O
attackers	O
is	O
to	O
install	O
key	O
loggers	O
,	O
dump	B-Action
local	B-Entity
credentials	I-Entity
,	I-Entity
search	I-Entity
local	I-Entity
storage	I-Entity
for	I-Entity
saved	I-Entity
accounts	I-Entity
and	I-Entity
sniff	I-Entity
the	I-Entity
network	I-Entity
for	I-Entity
passwords	I-Entity
.	O
Any	O
account	O
detail	O
can	O
be	O
useful	O
to	O
them	O
.	O
Domain	B-Entity
administrator	I-Entity
passwords	I-Entity
are	O
of	O
especially	O
high	O
value	O
,	O
as	O
they	O
can	O
help	O
greatly	O
in	O
moving	O
further	O
through	O
the	O
Intranet	O
.	O
Often	O
small	O
scripts	O
or	O
even	O
manual	O
commands	O
are	O
used	O
to	O
comb	O
through	O
local	O
files	O
and	O
create	O
network	O
mappings	O
.	O
Simple	I-Entity
system	I-Entity
commands	I-Entity
can	O
help	O
the	O
attacker	O
to	O
learn	O
about	O
installed	O
security	O
tools	O
,	O
saved	O
links	O
to	O
internal	O
platforms	O
and	O
local	O
address	O
books	O
.	O
Once	O
new	O
systems	O
are	O
identified	O
the	O
attacker	O
will	O
attempt	O
to	O
hop	O
onto	O
them	O
as	O
well	O
.	O
In	O
some	O
instances	O
they	O
might	O
even	O
use	O
zero-day	O
vulnerabilities	O
to	O
spread	O
further	O
into	O
the	O
network	O
.	O
One	O
method	O
which	O
is	O
gaining	O
more	O
relevance	O
is	O
the	O
hijacking	O
of	O
local	O
software	O
distribution	O
systems	O
for	O
further	O
distribution	O
.	O
This	O
can	O
either	O
be	O
proprietary	O
systems	O
,	O
such	O
as	O
the	O
case	O
of	O
Trojan.Jokra	O
in	O
South	O
Korea	O
,	O
or	O
OS-specific	O
,	O
such	O
as	O
hijacking	O
Windows	O
Update	O
,	O
in	O
the	O
case	O
of	O
Flamer	O
.	O
Once	O
the	O
attackers	O
have	O
successfully	O
managed	O
to	O
create	O
and	O
distribute	O
their	O
own	O
package	O
,	O
they	O
can	O
easily	O
infect	B-Action
all	B-Entity
connected	I-Entity
systems	I-Entity
at	O
once	O
.	O
Especially	O
in	O
cases	O
of	O
wiping	O
attacks	O
,	O
such	O
Trojan.Jokra	O
,	O
this	O
is	O
a	O
very	O
efficient	O
way	O
to	O
disrupt	O
as	O
many	O
computers	O
as	O
possible	O
.	O
If	O
the	O
target	O
is	O
assumed	O
to	O
be	O
in	O
a	O
separated	O
network	O
not	O
connected	O
to	O
the	O
Internet	O
,	O
the	O
malware	O
used	O
might	O
try	O
and	O
autonomously	O
infect	B-Action
removable	B-Entity
drives	I-Entity
,	O
like	O
USB	O
sticks	O
,	O
or	O
project	O
files	O
for	O
PLCs	O
.	O
This	O
could	O
allow	O
the	O
malware	O
to	O
be	O
manually	O
introduced	O
to	O
the	O
destination	O
network	O
,	O
without	O
the	O
knowledge	O
of	O
the	O
carrier	O
,	O
essentially	O
jumping	O
air	O
gaps	O
into	O
isolated	O
networks	O
.	O
At	O
the	O
end	O
of	O
the	O
discovery	O
phase	O
the	O
attackers	O
should	O
know	O
the	O
internals	O
of	O
the	O
infected	O
networks	O
and	O
have	O
identified	O
systems	O
with	O
interesting	O
data	O
or	O
with	O
connected	O
industrial	O
control	O
systems	O
.	O
The	B-Entity
capture	I-Entity
and	I-Entity
exfiltration	I-Entity
phases	O
are	O
not	O
always	O
present	O
.	O
If	O
the	O
sole	O
goal	O
of	O
the	O
attackers	O
is	O
to	O
cause	O
a	O
disruption	O
they	O
may	O
directly	O
jump	O
to	O
a	O
destructive	O
payload	O
.	O
However	O
,	O
in	O
most	O
cases	O
information	O
is	O
extracted	O
first	O
,	O
which	O
in	O
turn	O
allows	O
the	O
sabotage	O
to	O
be	O
constructed	O
more	O
efficiently	O
at	O
a	O
later	O
phase	O
.	O
In	O
this	O
phase	O
the	O
interesting	O
data	O
is	O
gathered	O
and	O
sent	B-Action
back	B-Modifier
to	I-Modifier
the	B-Entity
attackers	I-Entity
.	O
This	O
can	O
be	O
done	O
with	O
different	O
levels	O
of	O
sophistication	O
.	O
The	O
simple	O
attacks	O
compress	O
the	O
files	O
and	O
upload	B-Action
them	B-Entity
through	B-Modifier
FTP	B-Entity
or	I-Entity
through	B-Modifier
a	B-Entity
HTTP	I-Entity
POST	I-Entity
request	I-Entity
to	B-Modifier
a	B-Entity
remote	I-Entity
drop	I-Entity
server	I-Entity
.	O
More	O
sophisticated	O
attackers	O
obfuscate	O
the	O
data	O
by	O
XOR-ing	O
it	O
,	O
encrypting	O
it	O
with	O
proper	O
asymmetric	O
encryption	O
or	O
embedding	O
it	O
into	O
media	O
files	O
using	O
steganography	O
to	O
hide	B-Action
the	B-Entity
data	I-Entity
from	I-Entity
traffic	I-Entity
inspection	I-Entity
.	O
In	O
addition	O
to	O
this	O
,	O
the	O
amount	O
of	O
data	O
sent	O
and	O
the	O
timing	O
can	O
be	O
chosen	O
in	O
a	O
smart	O
way	O
.	O
For	O
example	O
,	O
some	O
malware	O
samples	O
will	O
send	O
the	O
data	O
in	O
smaller	O
bursts	O
so	O
as	O
not	O
to	O
swamp	O
the	O
network	O
or	O
generate	O
network	O
spikes	O
that	O
might	O
attract	O
attention	O
.	O
Since	O
most	O
employees	O
use	O
laptops	O
,	O
the	O
malware	O
can	O
use	O
location	O
awareness	O
to	O
detect	O
if	O
the	O
compromised	O
computer	O
is	O
outside	O
of	O
the	O
corporate	O
network	O
and	O
send	B-Action
the	B-Entity
data	I-Entity
once	B-Modifier
it	B-Entity
's	O
directly	O
connected	O
to	O
the	O
Internet	O
,	O
such	O
as	O
from	O
a	O
Wi-Fi	O
hotspot	O
at	O
an	O
airport	O
.	O
This	O
might	O
allow	O
the	O
traffic	O
to	O
bypass	O
perimeter	O
security	O
and	O
receive	B-Action
less	B-Entity
scrutiny	I-Entity
.	O
In	O
some	O
instances	O
the	O
infected	O
computer	O
might	O
not	O
have	O
a	O
direct	O
connection	O
to	O
the	O
Internet	O
.	O
In	O
such	O
cases	O
,	O
a	O
previously	O
compromised	O
computer	O
in	O
the	O
DMZ	O
can	O
act	O
as	O
a	O
proxy	O
,	O
forwarding	O
all	O
the	O
collected	O
data	O
.	O
This	O
is	O
when	O
any	O
destructive	O
payload	O
is	O
launched	O
.	O
If	O
the	O
attackers	O
are	O
only	O
after	O
information	O
this	O
phase	O
might	O
not	O
happen	O
at	O
all	O
.	O
The	O
targets	O
and	O
the	O
goals	O
for	O
disruption	O
attacks	O
can	O
be	O
very	O
different	O
,	O
there	O
is	O
no	O
such	O
thing	O
as	O
one-	O
size-fits-all	O
for	O
disruption	O
attacks	O
.	O
For	O
example	O
,	O
Stuxnet	O
was	O
tailored	O
to	O
attack	O
a	O
specific	O
uranium	O
enrichment	O
facility	O
and	O
would	O
not	O
work	O
against	O
a	O
different	O
target	O
.	O
In	O
recent	O
times	O
,	O
wiper	O
Trojans	O
have	O
been	O
popular	O
in	O
attacks	O
against	O
the	O
energy	O
sector	O
.	O
The	B-Entity
malware	I-Entity
deletes	B-Action
all	B-Entity
files	I-Entity
on	O
a	O
computer	O
and	O
then	O
deletes	B-Action
the	B-Entity
master	I-Entity
boot	I-Entity
record	O
,	O
rendering	O
the	O
computer	O
unusable	O
.	O
This	O
can	O
happen	O
on	O
any	O
operating	O
systems	O
and	O
we	O
have	O
seen	O
scripts	O
for	O
different	O
UNIX	O
flavors	O
being	O
used	O
as	O
well	O
.	O
Depending	O
on	O
the	O
disaster	O
recovery	O
plan	O
in	O
place	O
,	O
these	O
computers	O
can	O
be	O
remotely	O
recovered	O
.	O
However	O
,	O
there	O
may	O
still	O
be	O
an	O
outage	O
while	O
the	O
computers	O
are	O
being	O
restored	O
.	O
by	O
John	O
Scott-Railton	O
and	O
Seth	O
Hardy	O
With	O
the	O
collaboration	O
of	O
Cyber	O
Arabs	O
.	O
Media	O
coverage	O
:	O
Associated	O
Press	O
,	O
Forbes	O
This	O
report	O
describes	O
a	O
malware	O
attack	O
with	O
circumstantial	O
links	O
to	O
the	O
Islamic	O
State	O
in	O
Iraq	O
and	O
Syria	O
.	O
In	O
the	O
interest	O
of	O
highlighting	O
a	O
developing	O
threat	O
,	O
this	O
post	O
analyzes	O
the	O
attack	O
and	O
provides	O
a	O
list	O
of	O
Indicators	O
of	O
Compromise	O
.	O
A	O
Syrian	O
citizen	O
media	O
group	O
critical	O
of	O
Islamic	O
State	O
of	O
Iraq	O
and	O
Syria	O
(	O
ISIS	O
)	O
was	O
recently	O
targeted	O
in	O
a	O
customized	O
digital	O
attack	O
designed	O
to	O
unmask	O
their	O
location	O
.	O
The	O
Syrian	O
group	O
,	O
Raqqah	O
is	O
being	O
Slaughtered	O
Silently	O
(	O
RSS	O
)	O
,	O
focuses	O
its	O
advocacy	O
on	O
documenting	O
human	O
rights	O
abuses	O
by	O
ISIS	O
elements	O
occupying	O
the	O
city	O
of	O
Ar-	O
Raqah	O
.	O
In	O
response	O
,	O
ISIS	O
forces	O
in	O
the	O
city	O
have	O
reportedly	O
targeted	O
the	O
group	O
with	O
house	O
raids	O
,	O
kidnappings	O
,	O
and	O
an	O
alleged	O
assassination	O
.	O
The	O
group	O
also	O
faces	O
online	O
threats	O
from	O
ISIS	O
and	O
its	O
supporters	O
,	O
including	O
taunts	O
that	O
ISIS	O
is	O
spying	O
on	O
the	O
group	O
.	O
Though	O
we	O
are	O
unable	O
to	O
conclusively	O
attribute	O
the	O
attack	O
to	O
ISIS	O
or	O
its	O
supporters	O
,	O
a	O
link	O
to	O
ISIS	O
is	O
plausible	O
.	O
The	O
malware	O
used	O
in	O
the	O
attack	O
differs	O
substantially	O
from	O
campaigns	O
linked	O
to	O
the	O
Syrian	O
regime	O
,	O
and	O
the	O
attack	O
is	O
focused	O
against	O
a	O
group	O
that	O
is	O
an	O
active	O
target	O
of	O
ISIS	O
forces	O
.	O
As	O
the	O
Syrian	O
Civil	O
War	O
continues	O
,	O
Syrian	O
citizen	O
journalists	O
and	O
nonviolent	O
activists	O
operate	O
in	O
an	O
increasingly	O
unsafe	O
environment	O
.	O
The	O
regime	O
has	O
never	O
welcomed	O
their	O
work	O
,	O
and	O
has	O
often	O
targeted	O
them	O
for	O
arrest	O
and	O
detention	O
,	O
and	O
a	O
multi-year	O
hacking	O
campaign	O
(	O
see	O
Pro-Regime	O
/	O
Regime	O
Linked	O
Groups	O
)	O
.	O
Additionally	O
,	O
not	O
all	O
elements	O
of	O
the	O
Syrian	O
opposition	O
have	O
uniformly	O
supported	O
nonviolent	O
activists	O
and	O
citizen	O
journalists	O
.	O
More	O
recently	O
,	O
in	O
areas	O
like	O
Raqqah	O
,	O
nonviolent	O
activists	O
face	O
a	O
new	O
and	O
exceptionally	O
grave	O
threat	O
:	O
ISIS	O
.	O
A	O
growing	O
number	O
of	O
reports	O
suggest	O
that	O
ISIS	O
is	O
systematically	O
targeting	O
groups	O
that	O
document	O
atrocities	O
,	O
or	O
that	O
communicate	O
with	O
Western	O
media	O
and	O
aid	O
organizations	O
,	O
sometimes	O
under	O
the	O
pretext	O
of	O
finding	O
''	O
spies	O
''	O
.	O
Ar-Raqqah	O
,	O
the	O
city	O
in	O
which	O
the	O
case	O
study	O
is	O
located	O
,	O
is	O
situated	O
in	O
northern	O
Syria	O
and	O
continues	O
to	O
be	O
a	O
key	O
conflict	O
flashpoint	O
of	O
the	O
Syrian	O
Civil	O
War	O
.	O
In	O
the	O
spring	O
of	O
2013	O
,	O
Islamists	O
and	O
Free	O
Syrian	O
Army	O
(	O
FSA	O
)	O
fighters	O
took	O
over	O
Ar-	O
Raqqah	O
from	O
regime	O
forces	O
.	O
As	O
ISIS	O
gained	O
momentum	O
,	O
they	O
consolidated	O
their	O
control	O
over	O
the	O
city	O
,	O
edging	O
out	O
FSA-	O
affiliated	O
groups	O
through	O
attacks	O
,	O
summary	O
executions	O
,	O
and	O
kidnappings	O
against	O
a	O
range	O
of	O
groups	O
,	O
including	O
ethnic	O
and	O
religious	O
minorities	O
.	O
During	O
2014	O
,	O
there	O
were	O
a	O
number	O
of	O
reports-many	O
unconfirmed-that	O
ISIS	O
confiscated	O
smartphones	O
and	O
laptops	O
from	O
captured	O
activists	O
.	O
According	O
to	O
Syrians	O
who	O
experienced	O
these	O
searches	O
and	O
spoke	O
with	O
one	O
of	O
the	O
reports	O
'	O
authors	O
,	O
ISIS	O
sometimes	O
extracts	B-Action
data	B-Entity
from	I-Entity
confiscated	I-Entity
smartphones	I-Entity
and	I-Entity
laptops	I-Entity
to	I-Entity
collect	I-Entity
information	I-Entity
about	I-Entity
people	I-Entity
and	I-Entity
groups	I-Entity
they	I-Entity
are	O
targeting	O
,	O
as	O
well	O
as	O
to	O
seek	O
evidence	O
of	O
''	O
un-Islamic	O
''	O
activities	O
.	O
As	O
ISIS	O
cements	O
their	O
control	O
of	O
Ar-Raqqah	O
and	O
other	O
territories	O
,	O
reports	O
have	O
emerged	O
recently	O
(	O
though	O
not	O
all	O
of	O
them	O
confirmed	O
)	O
suggesting	O
that	O
elements	O
within	O
ISIS	O
are	O
growing	O
increasingly	O
sophisticated	O
at	O
imposing	O
control	O
and	O
targeting	O
opponents	O
using	O
digital	O
methods	O
.	O
Reports	O
about	O
ISIS	O
targeting	O
Internet	O
cafés	O
have	O
grown	O
increasingly	O
common	O
,	O
and	O
in	O
some	O
cases	O
reports	O
point	O
to	O
the	O
possible	O
use	O
of	O
keyloggers	O
as	O
well	O
as	O
unspecified	O
''	O
IP	O
sniffers	O
''	O
to	O
track	O
behaviour	O
in	O
Internet	O
cafes	O
.	O
Nonviolent	O
activists	O
and	O
citizen	O
journalists	O
based	O
in	O
Ar-Raqqah	O
have	O
provided	O
the	O
outside	O
world	O
with	O
much	O
of	O
what	O
we	O
know	O
about	O
how	O
ISIS	O
treats	O
the	O
population	O
.	O
These	O
activists	O
and	O
journalists	O
face	O
mortal	O
danger	O
for	O
their	O
actions	O
,	O
and	O
reports	O
have	O
emerged	O
of	O
their	O
detention	O
and	O
torture	O
at	O
the	O
hands	O
of	O
ISIS	O
.	O
As	O
ISIS	O
continues	O
to	O
use	O
social	O
media	O
to	O
push	O
the	O
message	O
that	O
it	O
is	O
welcomed	O
by	O
the	O
population	O
of	O
Ar-Raqqah	O
,	O
groups	O
like	O
Raqqah	O
is	O
being	O
Slaughtered	O
Silently	O
(	O
RSS	O
)	O
provide	O
a	O
compelling	O
counter	O
narrative	O
.	O
RSS	O
has	O
n't	O
escaped	O
ISIS	O
'	O
notice	O
,	O
and	O
the	O
group	O
has	O
been	O
targeted	O
for	O
kidnappings	O
,	O
house	O
raids	O
,	O
and	O
at	O
least	O
one	O
alleged	O
targeted	O
killing	O
.	O
At	O
the	O
time	O
of	O
writing	O
,	O
ISIS	O
is	O
allegedly	O
holding	O
several	O
citizen	O
journalists	O
in	O
Ar-Raqqah	O
.	O
In	O
addition	O
,	O
RSS	O
is	O
targeted	O
online	O
by	O
ISIS	O
supporters	O
with	O
harassment	O
,	O
including	O
threats	O
to	O
the	O
physical	O
safety	O
of	O
its	O
members	O
.	O
For	O
example	O
,	O
ISIS	O
supporters	O
have	O
claimed	O
that	O
ISIS	O
has	O
established	O
a	O
system	O
of	O
CCTV	O
cameras	O
in	O
Ar-Raqqah	O
to	O
observe	O
residents	O
'	O
movements	O
.	O
While	O
this	O
claim	O
may	O
be	O
a	O
bluff	O
or	O
exaggeration	O
,	O
at	O
least	O
one	O
ISIS	O
supporter	O
has	O
indicated	O
on	O
social	O
media	O
that	O
this	O
system	O
could	O
be	O
used	O
to	O
look	O
for	O
members	O
of	O
RSS	O
.	O
This	O
section	O
describes	O
a	B-Entity
highly	I-Entity
targeted	I-Entity
attack	I-Entity
sent	B-Action
to	B-Modifier
an	B-Entity
e-mail	I-Entity
address	I-Entity
belonging	I-Entity
to	O
RSS	O
.	O
The	O
Citizen	O
Lab	O
analyzed	O
this	O
attack	O
with	O
the	O
consent	O
of	O
RSS	O
,	O
which	O
requested	O
that	O
their	O
name	O
be	O
used	O
in	O
this	O
report	O
.	O
The	O
attack	O
took	O
the	O
form	O
of	O
an	O
unsolicited	O
e-mail	O
containing	O
a	B-Entity
download	I-Entity
link	I-Entity
to	B-Modifier
a	B-Entity
decoy	I-Entity
file	I-Entity
.	O
The	O
file	O
contained	O
custom	O
malware	O
that	O
profiled	O
the	O
victim	O
's	O
computer	O
and	O
beaconed	O
its	B-Entity
IP	I-Entity
address	I-Entity
to	B-Modifier
an	B-Entity
e-mail	I-Entity
account	I-Entity
under	I-Entity
the	I-Entity
attacker	I-Entity
's	I-Entity
control	I-Entity
.	O
The	O
unsolicited	O
message	O
below	O
was	O
sent	O
to	O
RSS	O
at	O
the	O
end	O
of	O
November	O
2014	O
from	O
a	O
Gmail	O
email	O
address	O
.	O
The	O
message	O
was	O
carefully	O
worded	O
,	O
and	O
contained	O
references	O
specific	O
to	O
the	O
work	O
and	O
interests	O
of	O
RSS	O
.	O
Thank	O
you	O
for	O
your	O
efforts	O
to	O
deliver	O
a	O
true	O
picture	O
of	O
the	O
reality	O
of	O
life	O
in	O
Raqqah	O
.	O
As	O
Syrians	O
residing	O
in	O
Canada	O
we	O
are	O
working	O
with	O
media	O
because	O
we	O
believe	O
in	O
the	O
importance	O
of	O
shedding	O
light	O
on	O
the	O
realities	O
of	O
life	O
in	O
Syria	O
,	O
and	O
Raqqah	O
in	O
particular	O
.	O
We	O
are	O
preparing	O
a	O
lengthy	O
news	O
report	O
on	O
the	O
realities	O
of	O
life	O
in	O
Raqqah	O
.	O
We	O
are	O
sharing	O
some	O
information	O
with	O
you	O
with	O
the	O
hope	O
that	O
you	O
will	O
correct	O
it	O
in	O
case	O
it	O
contains	O
errors	O
.	O
We	O
have	O
prepared	O
a	O
map	O
of	O
the	O
city	O
of	O
Raqqah	O
,	O
in	O
addition	O
to	O
a	O
preliminary	O
report	O
.	O
We	O
hope	O
that	O
you	O
have	O
a	O
look	O
at	O
it	O
with	O
them	O
and	O
inform	O
us	O
of	O
any	O
errors	O
.	O
We	O
also	O
hope	O
that	O
if	O
you	O
happen	O
to	O
be	O
on	O
Facebook	O
,	O
you	O
could	O
provide	O
us	O
with	O
the	O
account	O
of	O
the	O
person	O
responsible	O
for	O
the	O
campaign	O
,	O
if	O
you	O
do	O
n't	O
mind	O
,	O
so	O
that	O
we	O
can	O
communicate	O
with	O
him	O
directly	O
.	O
You	O
can	O
see	O
a	O
preliminary	O
copy	O
of	O
the	O
report	O
on	O
this	O
linkhttp	O
:	O
//tempsend	B-Entity
[	I-Entity
DOT	I-Entity
]	I-Entity
com/	I-Entity
[	I-Entity
Redacted	I-Entity
]	I-Entity
With	I-Entity
all	I-Entity
respect	I-Entity
[	I-Entity
Name	I-Entity
Redacted	I-Entity
]	I-Entity
We	O
are	O
unsure	O
why	O
the	B-Entity
attacker	I-Entity
specifically	I-Entity
mentions	I-Entity
Canada	I-Entity
in	I-Entity
the	I-Entity
email	I-Entity
lure	I-Entity
.	O
However	O
,	O
it	O
is	O
well	O
known	O
that	O
Syria's	O
extensive	O
diaspora	O
(	O
including	O
in	O
Canada	O
)	O
regularly	O
engages	O
in	O
advocacy	O
,	O
sometimes	O
in	O
coordination	O
with	O
groups	O
within	O
Syria	O
.	O
Thus	O
,	O
the	O
message	O
is	O
not	O
on	O
its	O
face	O
implausible	O
.	O
However	O
,	O
we	O
note	O
that	O
the	O
attacker	O
also	O
attempts	O
to	O
social	B-Action
engineer	I-Action
the	B-Entity
identity	I-Entity
of	I-Entity
individuals	I-Entity
working	O
with	O
RSS	O
,	O
by	O
requesting	O
a	O
personal	O
Facebook	O
page	O
.	O
The	B-Entity
custom	I-Entity
malware	I-Entity
used	B-Action
in	B-Modifier
this	B-Entity
attack	I-Entity
infects	B-Action
a	B-Entity
user	I-Entity
who	O
views	O
the	O
decoy	O
''	O
slideshow	O
,	O
''	O
and	O
beacons	O
home	O
with	O
the	O
IP	O
address	O
of	O
the	O
victim	O
's	O
computer	O
and	O
details	O
about	O
his	O
or	O
her	O
system	O
each	O
time	O
the	O
computer	O
restarts	O
.	O
Unlike	O
Syrian	O
regime-linked	O
malware	O
,	O
it	B-Entity
contains	B-Action
no	B-Entity
Remote	I-Entity
Access	I-Entity
Trojan	I-Entity
(	I-Entity
RAT	I-Entity
)	I-Entity
functionality	I-Entity
,	O
suggesting	O
it	O
is	O
intended	O
for	O
identifying	O
and	O
locating	O
a	O
target	O
.	O
Further	O
,	O
because	O
the	O
malware	O
sends	O
data	O
captured	O
by	O
the	O
malware	O
to	O
an	O
e-mail	O
address	O
,	O
it	O
does	O
not	O
require	O
that	O
the	B-Entity
attackers	I-Entity
maintain	B-Action
a	B-Entity
command-and-control	I-Entity
server	I-Entity
online	I-Entity
.	O
This	O
functionality	O
would	O
be	O
especially	O
useful	O
to	O
an	O
adversary	O
unsure	O
of	O
whether	O
it	O
can	O
maintain	B-Action
uninterrupted	B-Entity
Internet	I-Entity
connectivity	I-Entity
.	O
Accessing	B-Entity
the	I-Entity
link	I-Entity
provided	I-Entity
in	I-Entity
the	I-Entity
malicious	I-Entity
e-mail	I-Entity
sends	B-Action
the	B-Entity
user	I-Entity
to	B-Modifier
a	B-Entity
.zip	I-Entity
file	I-Entity
hosted	I-Entity
on	I-Entity
file-sharing	I-Entity
site	I-Entity
tempsend.com	I-Entity
.	O
At	O
the	O
time	O
of	O
writing	O
the	O
file	O
had	O
been	O
downloaded	O
only	O
10	O
times	O
This	O
file	O
is	O
a	O
self-extracting	O
archive	O
with	O
an	O
icon	O
intended	O
to	O
suggest	O
to	O
the	O
victim	O
that	O
it	O
is	O
itself	O
a	O
slideshow	O
.	O
When	O
run	O
,	O
the	O
file	O
opens	O
a	O
slideshow	O
of	O
Google	O
Earth	O
screen	O
captures	O
to	O
the	O
victim	O
,	O
displaying	O
a	O
series	O
of	O
locations	O
in	O
Syria	O
,	O
and	O
highlighting	O
an	O
''	O
ISIS	O
HQ	O
''	O
and	O
other	O
images	O
showing	O
the	O
alleged	O
locations	O
of	O
US	O
airstrikes	O
.	O
Examples	O
of	O
images	O
in	O
the	O
slideshow	O
as	O
follows	O
:	O
When	O
opened	O
,	O
the	O
''	O
slideshow.zip	O
''	O
file	O
writes	B-Action
and	I-Action
executes	I-Action
several	B-Entity
files	I-Entity
:	O
''	O
AdobeR1.exe	O
''	O
is	O
malicious	O
,	O
while	O
''	O
pictures.exe	O
''	O
is	O
the	O
genuine	O
slideshow	O
displayed	O
to	O
the	O
victim	O
.	O
When	O
the	O
slideshow	O
is	O
closed	O
both	O
AdobeR1.exe	O
and	O
pictures.exe	O
are	O
deleted	O
.	O
The	B-Entity
AdobeR1	I-Entity
file	I-Entity
writes	B-Action
a	B-Entity
series	I-Entity
of	I-Entity
executable	I-Entity
files	I-Entity
that	O
perform	O
information	O
collection	O
and	O
communication	O
functions	O
,	O
including	O
:	O
The	O
program	O
sequence	O
of	O
data	O
collection	O
and	O
sending	O
is	O
somewhat	O
unusual	O
,	O
with	O
each	O
program	O
performing	O
a	O
single	O
task	O
and	O
communicating	O
via	O
markers	O
left	O
in	O
the	O
registry	O
.	O
Programs	O
appear	O
to	O
make	O
use	O
of	O
the	O
Visual	O
C++	O
Runtime	O
Library	O
.	O
First	O
,	O
the	O
program	O
nvidrv	O
adds	O
itself	O
to	O
autorun	O
:	O
It	O
also	O
creates	B-Action
a	B-Entity
series	I-Entity
of	I-Entity
registry	I-Entity
keys	I-Entity
that	I-Entity
the	I-Entity
individual	I-Entity
programs	I-Entity
use	B-Action
to	B-Modifier
communicate	B-Entity
:	I-Entity
Registry	I-Entity
keys	I-Entity
and	I-Entity
programs	I-Entity
using	B-Modifier
them	B-Entity
:	O
It	O
then	O
runs	O
GooglUpd	O
,	O
which	O
cleans	B-Action
up	I-Action
the	B-Entity
program	I-Entity
files	I-Entity
if	B-Modifier
they	B-Entity
exist	I-Entity
,	O
and	O
runs	O
AdbrRader	O
.	O
AdbrRader	O
(	O
communicating	B-Action
through	B-Modifier
registry	B-Entity
key	I-Entity
''	I-Entity
2	I-Entity
''	I-Entity
)	I-Entity
writes	B-Action
the	B-Entity
file	I-Entity
vgadmysadm.tmp	I-Entity
with	B-Modifier
the	B-Entity
name	I-Entity
of	I-Entity
another	I-Entity
registry	I-Entity
key	I-Entity
''	I-Entity
2	I-Entity
''	I-Entity
with	I-Entity
startup	I-Entity
info	I-Entity
.	O
Next	O
,	O
nvidrv	O
runs	O
GoogleUpate	O
,	O
which	O
collects	B-Action
system	B-Entity
information	I-Entity
and	I-Entity
writes	B-Action
it	B-Entity
to	O
:	O
Then	O
nvidrv	O
runs	B-Action
nvisdvr	B-Entity
(	I-Entity
registry	I-Entity
key	I-Entity
''	I-Entity
4	I-Entity
''	I-Entity
)	I-Entity
that	I-Entity
collects	B-Action
a	B-Entity
list	I-Entity
of	I-Entity
running	I-Entity
processes	I-Entity
,	O
which	O
are	O
written	O
to	O
:	O
Finally	O
,	O
nvidrv	O
runs	O
svhosts	O
,	O
which	O
tests	B-Action
Internet	B-Entity
connectivity	I-Entity
by	I-Entity
doing	I-Entity
a	I-Entity
DNS	I-Entity
query	I-Entity
for	I-Entity
windowsupdate.microsoft.com	I-Entity
.	O
It	O
then	O
runs	O
rundl132	O
if	O
it	O
has	O
not	O
before	O
,	O
by	O
checking	O
whether	O
registry	O
key	O
name	O
''	O
6	O
''	O
is	O
present	O
.	O
It	B-Entity
sets	B-Action
the	B-Entity
key	I-Entity
to	I-Entity
''	I-Entity
0	I-Entity
''	I-Entity
and	I-Entity
runs	B-Action
it	B-Entity
.	O
Next	O
,	O
''	O
rundl132.exe	O
''	O
performs	O
an	O
HTTP	O
GET	O
request	O
to	O
myexternalip.com	O
and	O
collects	B-Action
the	B-Entity
external	I-Entity
IP	I-Entity
of	I-Entity
the	I-Entity
infected	I-Entity
machine	I-Entity
:	O
Next	O
,	O
rundl132	O
writes	O
:	O
Then	O
rundl132	O
writes	O
the	O
external	O
IP	O
to	O
:	O
Finally	O
,	O
rundl132	O
runs	O
AdobeIns	O
,	O
which	O
zips	O
the	B-Entity
contents	I-Entity
of	I-Entity
the	I-Entity
win32.tmp	I-Entity
folder	I-Entity
.	O
Program	O
''	O
AdobeIns.exe	O
''	O
takes	O
the	O
files	O
written	O
by	O
the	O
other	O
programs	O
and	O
zips	O
them	O
in	O
an	O
encrypted	O
,	O
password-	O
protected	O
file	O
:	O
Data	O
is	O
transmitted	O
by	O
e-mail	O
to	O
an	O
account	O
presumably	O
controlled	O
by	O
the	O
attacker	O
.	O
AdobeIns	O
connects	B-Action
to	B-Modifier
an	B-Entity
account	I-Entity
at	B-Modifier
the	B-Entity
online	I-Entity
e-mail	I-Entity
provider	I-Entity
inbox.com	I-Entity
via	B-Modifier
smtp	B-Entity
using	B-Modifier
hardcoded	B-Entity
credentials	I-Entity
.	O
The	O
malware	O
then	O
sends	O
an	O
e-mail	O
to	O
the	O
same	O
inbox	O
containing	O
the	O
text	O
''	O
Hello	O
''	O
and	O
with	O
mxtd	O
file	O
attached	O
.	O
SMTP	B-Entity
traffic	I-Entity
generated	I-Entity
by	I-Entity
the	I-Entity
malware	I-Entity
to	I-Entity
inbox.com	I-Entity
(	O
with	O
redactions	O
)	O
The	O
malware	O
seen	O
in	O
this	O
case	O
study	O
is	O
unusual	O
as	O
it	O
relies	O
on	O
a	O
half-dozen	O
separate	O
executable	O
files	O
,	O
each	O
with	O
a	O
single	O
task	O
,	O
and	O
each	O
communicating	O
via	O
markers	O
dropped	O
in	O
the	O
Registry	O
.	O
The	O
malware	O
is	O
also	O
interesting	O
because	O
it	O
does	O
not	O
provide	O
remote	O
access	O
,	O
but	O
only	O
sends	B-Action
an	B-Entity
e-mail	I-Entity
containing	I-Entity
the	I-Entity
victim	I-Entity
's	I-Entity
IP	I-Entity
address	I-Entity
and	I-Entity
miscellaneous	I-Entity
system	I-Entity
information	I-Entity
.	O
The	B-Entity
malware	I-Entity
resends	B-Action
the	B-Entity
information	I-Entity
each	I-Entity
time	I-Entity
the	I-Entity
computer	I-Entity
is	O
restarted	O
,	O
but	O
it	O
does	O
not	O
refresh	O
the	O
sent	O
information	O
on	O
restart	O
(	O
which	O
may	O
be	O
a	O
bug	O
)	O
.	O
This	B-Entity
behaviour	I-Entity
strongly	O
suggests	O
that	O
the	O
function	O
of	O
this	O
malware	O
is	O
to	O
serve	O
as	O
a	O
beacon	O
.	O
The	O
system	O
information	O
could	O
be	O
used	O
to	O
identify	O
processes	O
to	O
exploit	O
in	O
the	O
future	O
,	O
however	O
since	O
the	O
attacker	O
has	O
already	O
triggered	O
the	O
execution	O
of	O
a	O
file	O
on	O
the	O
victim	O
's	O
system	O
,	O
it	O
is	O
surprising	O
that	O
more	O
was	O
not	O
taken	O
,	O
or	O
that	O
a	O
RAT	O
(	O
custom	O
or	O
widely	O
available	O
)	O
was	O
not	O
used	O
.	O
A	O
RAT	O
would	O
have	O
provided	O
much	O
greater	O
access	O
alongside	O
IP	O
information	O
By	O
not	O
providing	O
remote	O
access	O
and	O
other	O
RAT	O
functionality	O
,	O
the	O
program	O
looks	O
less	O
like	O
malware	O
,	O
and	O
may	O
attract	O
less	O
attention	O
from	O
endpoint	O
protection	O
tools	O
and	O
scanners	O
.	O
Detections	O
were	O
low	O
when	O
the	O
file	O
was	O
first	O
submitted	O
to	O
VirusTotal	O
,	O
for	O
example	O
.	O
It	O
registered	O
only	O
6/55	O
detections	O
by	O
anti	O
virus	O
scanners	O
,	O
or	O
a	O
10	O
%	O
detection	O
rate	O
.	O
Transmitting	O
the	O
malware	O
via	O
e-mail	O
also	O
provides	O
a	O
degree	O
of	O
obscurity	O
,	O
and	O
has	O
the	O
additional	O
advantage	O
of	O
providing	O
a	O
layer	O
of	O
abstraction	O
between	O
the	O
attacker	O
and	O
the	O
target	O
:	O
there	O
is	O
no	O
need	O
to	O
maintain	B-Action
a	B-Entity
RAT	I-Entity
command-and-control	I-Entity
server	I-Entity
.	O
The	O
malware	O
transmits	O
autonomously	O
,	O
leaving	O
the	O
material	O
in	O
an	O
inbox	O
for	O
the	O
attacker	O
to	O
collect	O
at	O
a	O
later	O
time	O
.	O
The	O
malware	O
has	O
no	O
obfuscation	O
processes	O
and	O
is	O
not	O
highly	O
technical	O
in	O
its	O
development	O
or	O
interaction	O
with	O
Windows	O
.	O
Nevertheless	O
,	O
we	O
believe	O
that	O
the	O
author	O
of	O
the	O
program	O
is	O
aware	O
of	O
certain	O
techniques	O
to	O
reduce	O
the	O
visibility	O
of	O
malware	O
on	O
a	O
network	O
,	O
including	O
transmitting	O
data	B-Entity
via	B-Modifier
encrypted	B-Entity
e-mail	I-Entity
communications	I-Entity
.	O
However	O
,	O
the	O
attacker	O
has	O
not	O
correctly	O
implemented	O
encrypted	O
e-mail	O
:	O
the	O
malware	O
will	O
not	O
attempt	O
to	O
use	O
a	O
TLS	O
connection	O
in	O
certain	O
cases	O
.	O
As	O
a	O
result	O
,	O
account	O
login	O
credentials	O
may	O
be	O
readily	O
available	O
in	O
network	O
traffic	O
.	O
In	O
addition	O
,	O
the	O
malware	O
uses	O
the	O
old	O
PKWARE	O
implementation	O
of	O
zip	O
encryption	O
,	O
which	O
is	O
not	O
particularly	O
secure	O
.	O
The	O
password	O
for	O
the	O
zipped	O
file	O
is	O
also	O
present	O
in	O
the	O
binary	O
without	O
encryption	O
or	O
obfuscation	O
.	O
Citizen	O
Lab	O
researchers	O
have	O
developed	O
the	O
Targeted	O
Threat	O
Index	O
(	O
TTI	O
)	O
as	O
a	O
tool	O
to	O
standardize	O
information	O
about	O
the	O
sophistication	O
of	O
targeted	O
threats	O
against	O
civil	O
society	O
groups	O
in	O
our	O
research	O
.	O
The	O
index	O
captures	O
information	O
about	O
the	O
level	O
of	O
social	O
engineering	O
used	O
(	O
''	O
Targeting	O
Sophistication	O
''	O
)	O
,	O
and	O
adds	O
a	O
Technical	O
Sophistication	O
value	O
for	O
the	O
attack	O
as	O
a	O
multiplier	O
.	O
This	O
attack	O
,	O
which	O
has	O
little	O
technical	O
sophistication	O
(	O
i.e.	O
,	O
it	O
uses	O
no	O
exploits	O
,	O
code	O
obfuscation	O
,	O
or	O
techniques	O
to	O
frustrate	O
reversing	O
,	O
etc	O
.	O
)	O
,	O
nevertheless	O
has	O
carefully	O
developed	B-Action
social	I-Action
engineering	I-Action
in	B-Modifier
the	B-Entity
seeding	I-Entity
materials	I-Entity
and	I-Entity
bait	I-Entity
document	I-Entity
.	O
Taken	O
together	O
it	O
rates	O
a	O
3	O
for	O
Targeting	O
Sophistication	O
and	O
a	O
1.25	O
for	O
Technical	O
Sophistication	O
by	O
our	O
metric	O
,	O
yielding	O
a	O
TTI	O
score	O
of	O
3.75	O
.	O
Citizen	O
Lab	O
research	O
using	O
the	O
TTI	O
has	O
found	O
that	O
,	O
despite	O
low	O
levels	O
of	O
technical	O
sophistication	O
,	O
with	O
well-crafted	O
social	B-Entity
engineering	I-Entity
malware	I-Entity
attacks	I-Entity
remain	O
highly	O
effective	O
against	O
civil	O
society	O
groups	O
.	O
More	O
information	O
is	O
available	O
about	O
the	O
TTI	O
in	O
a	O
recent	O
Usenix	O
Security	O
paper	O
.	O
There	O
are	O
at	O
least	O
three	O
possible	O
sources	O
for	O
this	O
malware	O
attack	O
:	O
We	O
evaluate	O
each	O
of	O
these	O
possibilities	O
in	O
turn	O
,	O
drawing	O
on	O
the	O
information	O
available	O
to	O
us	O
after	O
almost	O
three	O
years	O
of	O
tracking	O
regime-linked	O
malware	O
.	O
Pro-regime	O
malware	O
actors	O
have	O
continually	O
targeted	O
the	O
Syrian	O
opposition	O
with	O
waves	O
of	O
malware	O
since	O
at	O
least	O
late	O
2011	O
.	O
Those	O
campaigns	O
have	O
been	O
extensively	O
reported	O
on	O
by	O
a	O
range	O
of	O
groups	O
,	O
including	O
Kaspersky	O
,	O
FireEye	O
,	O
Citizen	O
Lab	O
,	O
the	O
Electronic	O
Frontier	O
Foundation	O
,	O
and	O
many	O
others	O
.	O
Regime-linked	O
malware	O
has	O
a	O
number	O
of	O
common	O
features	O
that	O
typically	O
serve	O
as	O
distinguishing	O
characteristics	O
:	O
Social	O
engineering	O
focusing	O
on	O
the	O
needs	O
and	O
interests	O
of	O
the	O
opposition	O
.	O
Although	O
targeted	O
,	O
the	O
malware	O
seeding	O
often	O
aims	O
at	O
classes	O
of	O
people	O
(	O
e.g.	O
,	O
people	O
interested	O
in	O
'shocking	O
'	O
news	O
about	O
a	O
fighter	O
,	O
or	O
'leaked	O
'	O
information	O
about	O
the	O
Assad	O
regime	O
)	O
rather	O
than	O
carefully	O
written	O
spear	O
phishing	O
targeting	O
a	O
single	O
individual	O
or	O
small	O
group	O
.	O
Use	O
of	O
widely	O
available	O
RATs	O
(	O
njRAT	O
,	O
Xtreme	O
Rat	O
,	O
ShadowTech	O
Rat	O
,	O
DarkComet	O
RAT	O
,	O
and	O
Blackshades	O
RAT	O
,	O
among	O
others	O
)	O
.	O
At	O
least	O
one	O
command-and-control	O
server	O
located	O
within	O
Syrian	O
IP	O
space	O
(	O
often	O
from	O
a	O
limited	O
range	O
of	O
addresses	O
)	O
.	O
Frequent	O
use	O
of	O
Dynamic	O
DNS	O
providers	O
like	O
no-ip	O
.	O
Use	O
of	O
''	O
crypters	O
''	O
to	O
obscure	O
the	O
binary	O
.	O
These	O
characteristics	O
are	O
not	O
all	O
present	O
in	O
every	O
sample	O
,	O
but	O
we	O
have	O
typically	O
found	O
one	O
or	O
more	O
in	O
almost	O
every	O
binary	O
we	O
have	O
examined	O
that	O
is	O
Syrian	O
regime-linked	O
.	O
This	B-Entity
malware	I-Entity
attack	I-Entity
differs	O
from	O
known	O
regime-linked	O
groups	O
in	O
each	O
of	O
these	O
elements	O
.	O
Not	O
only	O
is	O
it	O
exceptionally	O
targeted	O
,	O
but	O
it	O
is	O
also	O
not	O
a	O
commonly	O
available	O
RAT	O
.	O
Nor	O
does	O
it	O
have	O
RAT	O
functionality	O
.	O
The	O
function	O
of	O
the	O
malware	O
appears	O
to	O
be	O
:	O
identify	O
and	O
unmask	O
the	O
IP	O
address	O
of	O
target	O
(	O
s	O
)	O
,	O
and	O
resend	B-Action
them	B-Entity
to	B-Modifier
the	B-Entity
attacker	I-Entity
with	I-Entity
each	I-Entity
reboot	I-Entity
.	O
In	O
addition	O
,	O
data	O
is	O
sent	O
to	O
an	O
Internet	O
e-mail	O
address	O
,	O
and	O
no	O
crypter	O
is	O
used	O
to	O
obscure	O
the	O
binary	O
.	O
We	O
are	O
aware	O
of	O
only	O
one	O
previous	O
case	O
in	O
Syria	O
in	O
which	O
e-mail	O
was	O
used	O
to	O
transmit	O
data	O
,	O
and	O
that	O
we	O
believed	O
was	O
regime	O
linked	O
.	O
That	O
incident	O
,	O
observed	O
in	O
2012	O
,	O
also	O
used	O
hardcoded	O
e-mail	O
to	O
exfiltrate	O
.	O
However	O
,	O
that	O
malware	O
had	O
substantially	O
more	O
functionality	O
than	O
this	O
case	O
:	O
not	O
only	O
did	O
it	B-Entity
drop	B-Action
a	B-Entity
second	I-Entity
stage	I-Entity
from	B-Modifier
a	B-Entity
compromised	I-Entity
site	I-Entity
,	O
but	O
was	O
also	O
included	O
a	O
mechanism	O
for	O
exfiltrating	B-Action
credentials	B-Entity
from	O
Facebook	O
and	O
hooking	O
programs	O
like	O
Skype	O
.	O
The	O
lack	O
of	O
overlap	O
in	O
Tactics	O
,	O
Techniques	O
,	O
and	O
Procedures	O
(	O
TTPs	O
)	O
between	O
this	O
attack	O
and	O
prior	O
attacks	O
does	O
not	O
rule	O
out	O
Syrian	O
regime-linked	O
attackers	O
.	O
It	O
is	O
possible	O
that	O
regime-linked	O
groups	O
are	O
trying	O
a	O
new	O
approach	O
.	O
However	O
,	O
given	O
that	O
known	O
regime-linked	O
groups	O
continued	O
to	O
remain	O
active	O
during	O
the	O
same	O
date	O
range	O
using	O
familiar	O
TTPs	O
,	O
this	O
scenario	O
seems	O
unlikely	O
.	O
In	O
addition	O
,	O
it	O
would	O
be	O
strange	O
for	O
regime-linked	O
malware	O
groups	O
to	O
undertake	O
significant	O
effort	O
to	O
prepare	O
and	O
send	B-Action
an	B-Entity
implant	I-Entity
that	O
has	O
significantly	O
less	O
functionality	O
than	O
what	O
they	O
commonly	O
use	O
.	O
Taken	O
together	O
,	O
we	O
find	O
this	O
evidence	O
supports	O
the	O
hypothesis	O
that	O
familiar	O
regime-linked	O
groups	O
did	O
not	O
conduct	O
the	O
attack	O
.	O
RSS	O
operates	O
in	O
territory	O
controlled	O
by	O
ISIS	O
,	O
and	O
has	O
faced	O
extensive	O
targeting	O
by	O
ISIS	O
.	O
Currently	O
,	O
they	O
appear	O
to	O
be	O
directly	O
targeted	O
by	O
ISIS	O
for	O
kidnappings	O
and	O
other	O
retaliation	O
,	O
including	O
executions	O
.	O
In	O
addition	O
,	O
ISIS	O
supporters	O
have	O
explicitly	O
suggested	O
that	O
the	O
group	O
is	O
under	O
surveillance	O
and	O
actively	O
hunted	O
.	O
Together	O
this	O
evidence	O
suggests	O
that	O
ISIS	O
has	O
a	O
strong	O
motivation	O
for	O
using	O
social	O
engineering	O
and/or	O
malware	O
to	O
locate	O
the	O
members	O
of	O
RSS	O
.	O
We	O
think	O
there	O
are	O
several	O
features	O
of	O
the	O
malware	O
attack	O
that	O
align	O
with	O
the	O
needs	O
and	O
constraints	O
of	O
ISIS	O
and	O
its	O
supporters	O
in	O
Ar-Raqqah	O
,	O
more	O
so	O
than	O
other	O
groups	O
,	O
as	O
we	O
understand	O
them	O
.	O
For	O
example	O
:	O
The	O
malware	O
beacons	O
location	O
but	O
does	O
not	O
provide	O
RAT	O
functionality	O
.	O
The	O
seeding	O
attempts	O
to	O
obtain	O
a	O
'private	O
'	O
Facebook	O
identity	O
from	O
RSS	O
through	O
social	O
engineering	O
.	O
The	B-Entity
malware	I-Entity
exfiltrates	B-Action
to	B-Modifier
an	B-Entity
online	I-Entity
e-mail	I-Entity
account	I-Entity
,	O
thus	O
not	O
requiring	O
the	O
attacker	O
to	O
maintain	B-Action
a	B-Entity
command-and-	I-Entity
control	I-Entity
server	I-Entity
online	I-Entity
.	O
The	O
social	O
media	O
activity	O
of	O
members	O
of	O
RSS	O
is	O
often	O
highly	O
public	O
.	O
Their	O
location	O
and	O
exact	O
membership	O
,	O
however	O
,	O
is	O
secret	O
.	O
We	O
speculate	O
that	O
if	O
an	O
attacker	O
were	O
interested	O
in	O
maintaining	O
long-term	O
surveillance	O
of	O
the	O
activities	O
of	O
RSS	O
they	O
could	O
have	O
employed	O
a	O
RAT	O
.	O
However	O
,	O
if	O
the	O
attacker	O
were	O
interested	O
in	O
unmasking	O
the	O
location	O
of	O
its	O
targets	O
so	O
they	O
could	O
be	O
physically	O
tracked	O
down	O
,	O
collecting	B-Action
IP	B-Entity
data	I-Entity
and	I-Entity
system	I-Entity
info	I-Entity
would	O
be	O
a	O
more	O
reasonable	O
approach	O
.	O
ISIS	O
or	O
its	O
supporters	O
clearly	O
have	O
a	O
strong	O
interest	O
in	O
the	O
(	O
rudimentary	O
)	O
location	O
tracking	O
of	O
the	O
members	O
of	O
RSS	O
that	O
this	O
malware	O
provides	O
.	O
Internet	O
connectivity	O
in	O
Raqqah	O
is	O
extremely	O
limited	O
,	O
and	O
some	O
of	O
it	O
is	O
under	O
ISIS	O
control	O
.	O
Knowing	O
the	O
IP	O
address	O
of	O
a	O
target	O
could	O
quickly	O
narrow	O
down	O
targets	O
to	O
specific	O
locations	O
,	O
and	O
specific	O
Internet	O
services	O
,	O
or	O
Internet	O
cafes	O
in	O
Raqqah	O
.	O
Given	O
that	O
the	O
identities	O
and	O
locations	O
of	O
RSS	O
members	O
are	O
closely	O
guarded	O
,	O
such	O
information	O
would	O
hold	O
significant	O
intelligence	O
value	O
for	O
ISIS	O
.	O
Armed	O
with	O
this	O
kind	O
of	O
information	O
,	O
ISIS	O
could	O
physically	O
harm	O
people	O
within	O
Raqqah	O
(	O
and	O
it	O
is	O
also	O
possible	O
that	O
they	O
have	O
the	O
ability	O
to	O
operate	O
in	O
some	O
capacity	O
in	O
border	O
areas	O
of	O
Turkey	O
)	O
.	O
Little	O
is	O
publicly	O
known	O
about	O
the	O
technical	O
capabilities	O
of	O
ISIS	O
and	O
its	O
supporters	O
;	O
however	O
,	O
reports	O
have	O
begun	O
to	O
emerge	O
suggesting	O
that	O
ISIS	O
is	O
interested	O
in	O
expanding	O
its	O
abilities	O
.	O
In	O
addition	O
,	O
ISIS	O
has	O
reportedly	O
gained	B-Action
the	B-Entity
support	I-Entity
of	I-Entity
at	I-Entity
least	I-Entity
one	I-Entity
individual	I-Entity
with	B-Modifier
some	B-Entity
experience	I-Entity
with	I-Entity
social	I-Entity
engineering	I-Entity
and	O
hacking	O
:	O
Junaid	O
Hussain	O
(	O
aka	O
TriCk	O
)	O
,	O
a	O
former	O
member	O
of	O
teamp0ison	O
hacking	O
team	O
.	O
While	O
Mr.	O
Hussain	O
and	O
associates	O
have	O
reportedly	O
made	O
threats	O
against	O
Western	O
governments	O
,	O
it	O
is	O
possible	O
that	O
he	O
or	O
others	O
working	O
with	O
ISIS	O
have	O
quietly	O
supported	O
an	O
effort	O
to	O
identify	O
the	O
targeted	O
organization	O
,	O
which	O
is	O
a	O
highly	O
visible	O
thorn	O
in	O
the	O
side	O
of	O
ISIS	O
.	O
It	O
is	O
possible	O
that	O
the	O
attack	O
is	O
the	O
product	O
of	O
actors	O
working	O
for	O
unknown	O
purposes	O
and	O
targeting	O
RSS	O
.	O
Given	O
the	O
activities	O
of	O
RSS	O
,	O
however	O
,	O
it	O
is	O
unclear	O
who	O
this	O
might	O
be	O
.	O
It	O
is	O
not	O
possible	O
,	O
for	O
example	O
,	O
to	O
reject	O
the	O
theory	O
that	O
some	O
unknown	O
group	O
within	O
the	O
FSA	O
,	O
or	O
other	O
groups	O
opposing	O
the	O
Assad	O
regime	O
are	O
responsible	O
.	O
Citizen	O
journalists	O
in	O
Ar-Raqqah	O
were	O
previously	O
critical	O
of	O
arbitrary	O
arrests	O
carried	O
out	O
by	O
non-ISIS	O
groups	O
in	O
2013	O
.	O
However	O
,	O
it	O
is	O
unclear	O
why	O
those	O
groups	O
,	O
which	O
no	O
longer	O
control	O
Ar-Raqqah	O
,	O
would	O
be	O
interested	O
in	O
RSS	O
in	O
November	O
2014	O
.	O
It	O
is	O
likely	O
that	O
third	O
party	O
actors	O
,	O
including	O
several	O
intelligence	O
services	O
,	O
are	O
closely	O
monitoring	B-Action
various	B-Entity
actors	I-Entity
in	O
the	O
conflict	O
through	O
a	O
range	O
of	O
electronic	O
means	O
.	O
However	O
,	O
there	O
is	O
little	O
reason	O
to	O
suggest	O
that	O
they	O
would	O
use	O
a	O
tailored	O
but	O
technically	O
rudimentary	O
attack	O
to	O
target	O
RSS	O
in	O
particular	O
.	O
After	O
considering	O
each	O
possibility	O
,	O
we	O
find	O
strong	O
but	O
inconclusive	O
circumstantial	O
evidence	O
to	O
support	O
a	O
link	O
to	O
ISIS	O
.	O
However	O
,	O
we	O
are	O
unable	O
to	O
connect	O
this	O
attack	O
directly	O
to	O
ISIS	O
,	O
Mr.	O
Hussain	O
,	O
or	O
other	O
ISIS	O
supporters	O
.	O
If	O
indeed	O
ISIS	O
or	O
its	O
supporters	O
are	O
responsible	O
,	O
it	O
seems	O
reasonable	O
that	O
such	O
an	O
offensive	O
capability	O
may	O
still	O
be	O
in	O
development	O
.	O
We	O
hope	O
that	O
publishing	O
this	O
report	O
will	O
draw	O
attention	O
to	O
a	O
new	O
and	O
concerning	O
threat	O
that	O
includes	O
ISIS	O
critics	O
among	O
its	O
targets	O
.	O
If	O
ISIS	O
is	O
responsible	O
,	O
while	O
this	O
attack	O
targets	O
in-country	O
impediments	O
to	O
ISIS	O
objectives	O
,	O
other	O
targets	O
may	O
include	O
ideological	O
or	O
military	O
adversaries	O
abroad	O
.	O
Whether	O
or	O
not	O
ISIS	O
is	O
responsible	O
,	O
this	O
attack	O
is	O
likely	O
the	O
work	O
of	O
a	O
non-regime	O
threat	O
actor	O
who	O
may	O
be	O
just	O
beginning	O
to	O
field	O
a	O
still-rudimentary	O
capability	O
in	O
the	O
Syrian	O
conflict	O
.	O
The	O
entry	O
costs	O
for	O
engaging	O
in	O
malware	O
attacks	O
in	O
a	O
conflict	O
like	O
the	O
Syrian	O
Civil	O
War	O
are	O
low	O
,	O
and	O
made	O
lower	O
by	O
the	O
fact	O
that	O
the	O
rule	O
of	O
law	O
is	O
nonexistent	O
for	O
large	O
parts	O
of	O
the	O
country	O
.	O
In	O
still	O
other	O
parts	O
(	O
under	O
regime	O
control	O
)	O
,	O
malware	O
attacks	O
appear	O
to	O
be	O
state	O
sanctioned	O
.	O
Citizen	O
Lab	O
research	O
into	O
targeted	O
digital	O
threats	O
against	O
civil	O
society	O
confirms	O
that	O
civil	O
society	O
groups	O
face	O
grave	O
threats	O
from	O
targeted	O
malware	O
attacks	O
,	O
despite	O
being	O
under-resourced	O
to	O
defend	O
against	O
them	O
.	O
The	O
case	O
highlighted	O
here	O
is	O
no	O
exception	O
:	O
lack	O
of	O
IT	O
and	O
security	O
resources	O
have	O
made	O
it	O
difficult	O
for	O
the	O
Syrian	O
opposition	O
to	O
address	O
targeted	O
and	O
persistent	O
digital	O
threats	O
against	O
them	O
.	O
In	O
addition	O
,	O
if	O
ISIS	O
is	O
indeed	O
responsible	O
,	O
this	O
case	O
suggests	O
how	O
easy	O
it	O
is	O
for	O
belligerents	O
in	O
a	O
conflict	O
to	O
begin	O
fielding	O
basic	O
offensive	O
digital	O
capabilities	O
,	O
and	O
how	O
quickly	O
the	O
capabilities	O
can	O
be	O
pointed	O
at	O
unarmed	O
civil	O
society	O
groups	O
.	O
This	O
attack	O
was	O
exceptionally	O
targeted	O
,	O
and	O
clearly	O
reflected	O
the	O
work	O
of	O
an	O
actor	O
familiar	O
with	O
the	O
operations	O
of	O
the	O
targeted	O
organization	O
.	O
As	O
most	O
organizations	O
working	O
on	O
issues	O
surrounding	O
Syria	O
are	O
aware	O
,	O
malware	O
delivered	O
with	O
good	O
social	O
engineering	O
is	O
a	O
constant	O
source	O
of	O
danger	O
.	O
This	O
particular	O
attack	O
can	O
be	O
prevented	O
by	O
not	O
opening	O
files	O
sent	O
by	O
unknown	O
persons	O
.	O
However	O
,	O
many	O
attacks	O
in	O
Syria	O
come	O
from	O
hijacked	O
accounts	O
and	O
impersonate	O
people	O
known	O
to	O
the	O
targets	O
.	O
Social	I-Entity
engineering	I-Entity
remains	O
an	O
unsolved	O
problem	O
,	O
and	O
continues	O
to	O
compromise	O
groups	O
throughout	O
the	O
Syrian	O
opposition	O
and	O
their	O
supporters	O
.	O
This	O
attack	O
reaffirms	O
the	O
dangers	O
posed	O
by	O
social	B-Entity
engineering	I-Entity
attacks	I-Entity
,	O
whether	O
they	B-Entity
deliver	B-Action
phishing	B-Entity
campaigns	I-Entity
or	I-Entity
malware	I-Entity
.	O
The	O
circumstantial	O
evidence	O
of	O
ISIS	O
involvement	O
suggests	O
that	O
groups	O
working	O
on	O
topics	O
that	O
ISIS	O
considers	O
a	O
threat	O
,	O
and	O
their	O
partner	O
organizations	O
and	O
supporters	O
,	O
should	O
urgently	O
examine	O
their	O
security	O
policies	O
and	O
assess	O
the	O
possible	O
risks	O
to	O
their	O
operations	O
,	O
and	O
the	O
consequences	O
of	O
exposure	O
of	O
sensitive	O
information	O
to	O
ISIS	O
.	O
Even	O
if	O
the	O
link	O
to	O
ISIS	O
turns	O
out	O
to	O
be	O
incorrect	O
,	O
it	O
is	O
possible	O
that	O
this	O
will	O
be	O
a	O
threat	O
in	O
the	O
future	O
.	O
Individuals	O
and	O
groups	O
at	O
risk	O
can	O
also	O
consult	O
materials	O
in	O
Arabic	O
provided	O
by	O
Cyber	O
Arabs	O
including	O
a	O
series	O
of	O
very	O
accessible	O
videos	O
on	O
digital	O
security	O
.	O
The	B-Entity
malware	I-Entity
files	B-Action
Files	B-Entity
dropped	I-Entity
by	I-Entity
the	I-Entity
malware	I-Entity
Collected	I-Entity
Information	I-Entity
Files	I-Entity
(	I-Entity
unencrypted	I-Entity
)	I-Entity
Exfiltrated	I-Entity
file	I-Entity
(	I-Entity
encrypted	I-Entity
)	I-Entity
Registry	I-Entity
Keys	I-Entity
Acknowledgements	I-Entity
:	O
We	O
are	O
grateful	O
to	O
Cyber	O
Arabs	O
and	O
the	O
Institute	O
for	O
War	O
and	O
Peace	O
Reporting	O
for	O
their	O
critical	O
work	O
and	O
assistance	O
.	O
Special	O
thanks	O
to	O
:	O
several	O
anonymous	O
Syrians	O
,	O
Masashi	O
Crete-Nishihata	O
,	O
Sarah	O
McKune	O
,	O
Morgan	O
Marquis-Boire	O
,	O
Ron	O
Deibert	O
,	O
Bill	O
Marczak	O
,	O
Nart	O
Villeneuve	O
,	O
Irene	O
Poetranto	O
,	O
and	O
Kristen	O
Dennesen	O
.	O
Support	O
for	O
this	O
research	O
is	O
provided	O
by	O
grants	O
from	O
the	O
John	O
D.	O
and	O
Catherine	O
T.	O
MacArthur	O
Foundation	O
and	O
the	O
Ford	O
Foundation	O
.	O
Over	O
the	O
last	O
10	O
months	O
,	O
Kaspersky	O
Lab	O
researchers	O
have	O
analyzed	O
a	O
massive	O
cyber-espionage	O
operation	O
which	O
we	O
call	O
''	O
Epic	O
Turla	O
''	O
.	O
The	B-Entity
attackers	I-Entity
behind	I-Entity
Epic	I-Entity
Turla	I-Entity
have	O
infected	O
several	O
hundred	O
computers	O
in	O
more	O
than	O
45	O
countries	O
,	O
including	O
government	O
institutions	O
,	O
embassies	O
,	O
military	O
,	O
education	O
,	O
research	O
and	O
pharmaceutical	O
companies	O
.	O
The	O
attacks	O
are	O
known	O
to	O
have	O
used	O
at	O
least	O
two	O
zero-day	O
exploits	O
:	O
We	O
also	O
observed	O
exploits	O
against	O
older	O
(	O
patched	O
)	O
vulnerabilities	O
,	O
social	B-Entity
engineering	I-Entity
techniques	I-Entity
and	I-Entity
watering	I-Entity
hole	I-Entity
strategies	I-Entity
in	I-Entity
these	I-Entity
attacks	I-Entity
.	O
The	B-Entity
primary	I-Entity
backdoor	I-Entity
used	B-Action
in	B-Modifier
the	B-Entity
Epic	I-Entity
attacks	I-Entity
is	O
also	O
known	O
as	O
''	O
WorldCupSec	O
''	O
,	O
''	O
TadjMakhal	O
''	O
,	O
''	O
Wipbot	O
''	O
or	O
''	O
Tavdig	O
''	O
.	O
When	O
G-Data	O
published	O
on	O
Turla/Uroburos	O
back	O
in	O
February	O
,	O
several	O
questions	O
remained	O
unanswered	O
.	O
One	O
big	O
unknown	O
was	O
the	O
infection	O
vector	O
for	O
Turla	O
(	O
aka	O
Snake	O
or	O
Uroburos	O
)	O
.	O
Our	O
analysis	O
indicates	O
that	O
victims	O
are	O
infected	O
via	O
a	O
sophisticated	O
multi-stage	O
attack	O
,	O
which	O
begins	O
with	O
the	O
Epic	O
Turla	O
.	O
In	O
time	O
,	O
as	O
the	O
attackers	O
gain	O
confidence	O
,	O
this	O
is	O
upgraded	O
to	O
more	O
sophisticated	O
backdoors	O
,	O
such	O
as	O
the	O
Carbon/Cobra	O
system	O
.	O
Sometimes	O
,	O
both	O
backdoors	O
are	O
run	O
in	O
tandem	O
,	O
and	O
used	O
to	O
''	O
rescue	O
''	O
each	O
other	O
if	O
communications	O
are	O
lost	O
with	O
one	O
of	O
the	O
backdoors	O
.	O
Once	O
the	O
attackers	O
obtain	O
the	O
necessary	O
credentials	O
without	O
the	O
victim	O
noticing	O
,	O
they	B-Entity
deploy	B-Action
the	B-Entity
rootkit	I-Entity
and	I-Entity
other	I-Entity
extreme	I-Entity
persistence	I-Entity
mechanisms	I-Entity
.	O
The	O
attacks	O
are	O
still	O
ongoing	O
as	O
of	O
July	O
2014	O
,	O
actively	O
targeting	O
users	O
in	O
Europe	O
and	O
the	O
Middle	O
East	O
.	O
Note	O
:	O
A	O
full	O
analysis	O
of	O
the	O
Epic	O
attacks	O
is	O
available	O
to	O
the	O
Kaspersky	O
Intelligent	O
Services	O
subscribers	O
.	O
Contact	O
:	O
intelreports	O
@	O
kaspersky.com	O
The	O
attacks	O
in	O
this	O
campaign	O
fall	O
into	O
several	O
different	O
categories	O
depending	O
on	O
the	O
vector	O
used	O
in	O
the	O
initial	O
compromise	O
:	O
The	B-Entity
attackers	I-Entity
use	B-Action
both	B-Entity
direct	I-Entity
spearphishing	I-Entity
and	I-Entity
watering	I-Entity
hole	I-Entity
attacks	I-Entity
to	I-Entity
infect	I-Entity
their	I-Entity
victims	I-Entity
.	O
Watering	O
holes	O
(	O
waterholes	O
)	O
are	O
websites	O
of	O
interest	O
to	O
the	O
victims	O
that	O
have	O
been	O
compromised	O
by	O
the	O
attackers	O
and	O
injected	O
to	O
serve	O
malicious	O
code	O
.	O
So	O
far	O
we	O
have	O
n't	O
been	O
able	O
to	O
locate	O
any	O
e-mail	O
used	O
against	O
the	O
victims	O
,	O
only	O
the	O
attachments	O
.	O
The	B-Entity
PDF	I-Entity
attachments	I-Entity
do	O
not	O
show	O
any	O
''	O
lure	O
''	O
to	O
the	O
victim	O
when	O
opened	O
,	O
however	O
,	O
the	O
SCR	O
packages	O
sometime	O
show	O
a	O
clean	O
PDF	O
upon	O
successful	O
installation	O
.	O
Some	O
of	O
known	O
attachment	O
names	O
used	O
in	O
the	O
spearphishing	O
attacks	O
are	O
:	O
In	O
some	O
cases	O
,	O
these	O
filenames	O
can	O
provide	O
clues	O
about	O
the	O
type	O
of	O
victims	O
the	O
attackers	O
are	O
targeting	O
.	O
Currently	O
,	O
the	B-Entity
Epic	I-Entity
attackers	I-Entity
run	B-Action
a	B-Entity
vast	I-Entity
network	I-Entity
of	I-Entity
watering	I-Entity
holes	I-Entity
that	I-Entity
target	I-Entity
visitors	I-Entity
with	O
surgical	O
precision	O
.	O
Some	O
of	O
the	O
injected	O
websites	O
include	O
:	O
In	O
total	O
,	O
we	O
observed	O
more	O
than	O
100	O
injected	O
websites	O
.	O
Currently	O
,	O
the	O
largest	O
number	O
of	O
injected	O
sites	O
is	O
in	O
Romania	O
.	O
Here	O
's	O
a	O
statistic	O
on	O
the	O
injected	O
websites	O
:	O
The	O
distribution	O
is	O
obviously	O
not	O
random	O
,	O
and	O
it	O
reflects	O
some	O
of	O
the	O
interests	O
of	O
the	O
attackers	O
.	O
For	O
instance	O
,	O
in	O
Romania	O
many	O
of	O
the	O
infected	O
sites	O
are	O
in	O
the	O
Mures	O
region	O
,	O
while	O
many	O
of	O
the	O
Spanish	O
infected	O
sites	O
belong	O
to	O
local	O
governments	O
(	O
City	O
Hall	O
)	O
.	O
Most	O
of	O
the	O
infected	O
sites	O
use	O
the	O
TYPO3	O
CMS	O
(	O
see	O
:	O
http	O
:	O
//typo3.org/	O
)	O
,	O
which	O
could	O
indicate	O
the	O
attackers	O
are	O
abusing	O
a	O
specific	O
vulnerability	O
in	O
this	O
publishing	O
platform	O
.	O
Injected	I-Entity
websites	I-Entity
load	B-Action
a	B-Entity
remote	I-Entity
JavaScript	I-Entity
into	B-Modifier
the	B-Entity
victim	I-Entity
's	I-Entity
browser	I-Entity
:	O
The	O
script	O
''	O
sitenavigatoin.js	O
''	O
is	O
a	O
Pinlady-style	O
browser	O
and	O
plugin	O
detection	O
script	O
,	O
which	O
in	O
turn	O
,	O
redirects	B-Action
to	B-Modifier
a	B-Entity
PHP	I-Entity
script	I-Entity
sometimes	I-Entity
called	I-Entity
main.php	I-Entity
or	O
wreq.php	O
.	O
Sometimes	O
,	O
the	O
attackers	O
register	O
the	O
.JPG	O
extension	O
with	O
the	O
PHP	O
handler	O
on	O
the	O
server	O
,	O
using	O
''	O
JPG	O
''	O
files	O
to	O
run	B-Action
PHP	B-Entity
scripts	I-Entity
:	O
The	O
main	O
exploitation	O
script	O
''	O
wreq.php	O
''	O
,	O
''	O
main.php	O
''	O
or	O
''	O
main.jpg	O
''	O
performs	O
a	O
numbers	O
of	O
tasks	O
.	O
We	O
have	O
located	O
several	O
versions	O
of	O
this	O
script	O
which	O
attempt	O
various	O
exploitation	O
mechanisms	O
.	O
One	B-Entity
version	I-Entity
of	I-Entity
this	I-Entity
script	I-Entity
attempts	B-Action
to	B-Entity
exploit	I-Entity
Internet	I-Entity
Explorer	I-Entity
versions	I-Entity
6	I-Entity
,	O
7	O
and	O
8	O
:	O
Unfortunately	O
,	O
the	O
Internet	O
Explorer	O
exploits	O
have	O
not	O
yet	O
been	O
retrieved	O
.	O
Another	O
more	O
recent	O
version	O
attempts	O
to	O
exploit	O
Oracle	O
Sun	O
Java	O
and	O
Adobe	O
Flash	O
Player	O
:	O
Although	O
the	O
Flash	O
Player	O
exploits	O
could	O
n't	O
be	O
retrieved	O
,	O
we	O
did	O
manage	O
to	O
obtain	O
the	O
Java	O
exploits	O
:	O
The	O
Java	O
files	O
exploit	O
a	O
popular	O
vulnerability	O
,	O
CVE-2012-1723	O
,	O
in	O
various	O
configurations	O
.	O
The	O
payload	O
dropped	O
by	O
these	O
Java	O
exploits	O
is	O
the	O
following	O
:	O
The	O
Java	O
exploit	O
use	O
a	O
special	O
loader	O
that	O
attempts	O
to	O
inject	B-Action
the	B-Entity
final	I-Entity
Epic	I-Entity
backdoor	I-Entity
payload	I-Entity
into	I-Entity
explorer.exe	I-Entity
.	O
The	B-Entity
backdoor	I-Entity
extracted	B-Action
from	B-Modifier
the	B-Entity
Java	I-Entity
exploits	I-Entity
has	O
the	O
following	O
C	O
&	O
C	O
hardcoded	O
inside	O
:	O
This	O
C	O
&	O
C	O
is	O
still	O
online	O
at	O
the	O
moment	O
although	O
it	B-Entity
redirects	B-Action
to	B-Modifier
a	B-Entity
currently	I-Entity
suspended	I-Entity
page	I-Entity
at	I-Entity
''	I-Entity
hxxp	I-Entity
:	O
//busandcoachdirectory.com	O
[	O
.	O
]	O
au	O
''	O
.	O
For	O
a	O
full	O
list	O
of	O
C	O
&	O
C	O
servers	O
,	O
please	O
see	O
the	O
Appendix	O
.	O
The	B-Entity
Epic	I-Entity
Turla	I-Entity
attackers	I-Entity
are	O
extremely	O
dynamic	O
in	O
using	O
exploits	O
or	O
different	O
methods	O
depending	O
on	O
what	O
is	O
available	O
at	O
the	O
moment	O
.	O
Most	O
recently	O
,	O
we	O
observed	O
them	O
using	O
yet	O
another	B-Entity
technique	I-Entity
coupled	I-Entity
with	I-Entity
watering	I-Entity
hole	I-Entity
attacks	I-Entity
.	O
This	B-Entity
takes	I-Entity
advantage	I-Entity
of	I-Entity
social	I-Entity
engineering	I-Entity
to	I-Entity
trick	I-Entity
the	I-Entity
user	I-Entity
into	B-Modifier
running	B-Entity
a	I-Entity
fake	I-Entity
Flash	I-Entity
Player	O
(	O
MD5	O
:	O
030f5fdb78bfc1ce7b459d3cc2cf1877	O
)	O
:	O
In	O
at	O
least	O
one	O
case	O
,	O
they	O
tried	O
to	O
trick	B-Action
the	B-Entity
user	I-Entity
into	B-Modifier
downloading	B-Entity
and	I-Entity
running	I-Entity
a	I-Entity
fake	I-Entity
Microsoft	I-Entity
Security	I-Entity
Essentials	I-Entity
app	I-Entity
(	O
MD5	O
:	O
89b0f1a3a667e5cd43f5670e12dba411	O
)	O
:	O
The	O
fake	O
application	O
is	O
signed	O
by	O
a	O
valid	O
digital	O
certificate	O
from	O
Sysprint	O
AG	O
:	O
This	O
file	O
was	O
distributed	O
from	O
the	O
Ministry	O
of	O
Foreign	O
Affairs	O
of	O
Tajikistan	O
's	O
website	O
,	O
at	O
''	O
hxxp	O
:	O
//mfa	O
[	O
.	O
]	O
tj/upload/security.php	O
''	O
.	O
The	O
file	O
is	O
a	O
.NET	O
application	O
that	O
contains	O
an	O
encrypted	O
resource	O
.	O
This	B-Entity
drops	B-Action
the	B-Entity
malicious	I-Entity
file	I-Entity
with	O
the	O
MD5	O
7731d42b043865559258464fe1c98513	O
.	O
This	O
is	O
an	O
Epic	O
backdoor	O
which	O
connects	O
to	O
the	O
following	O
C	O
&	O
Cs	O
,	O
with	O
a	O
generic	O
internal	O
ID	O
of	O
1156fd22-	O
3443-4344-c4ffff	O
:	O
A	O
full	O
list	B-Action
with	B-Modifier
all	B-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
URLs	I-Entity
that	O
we	O
recovered	O
from	O
the	O
samples	O
can	O
be	O
found	O
in	O
the	O
technical	O
Appendix	O
.	O
The	O
Epic	O
backdoors	O
are	O
commanded	O
by	O
a	O
huge	O
network	O
of	O
hacked	O
servers	O
that	O
deliver	O
command	O
and	O
control	O
functionality	O
.	O
The	O
huge	O
network	O
commanded	O
by	O
the	O
Epic	O
Turla	O
attackers	O
serves	O
multiple	O
purposes	O
.	O
For	O
instance	O
,	O
the	O
motherships	O
function	O
as	O
both	O
exploitation	O
sites	O
and	O
command	O
and	O
control	O
panels	O
for	O
the	O
malware	O
.	O
Here	O
's	O
how	O
the	O
big	O
picture	O
looks	O
like	O
:	O
The	O
first	O
level	O
of	O
command	O
and	O
control	O
proxies	O
generally	O
talk	O
to	O
a	O
second	O
level	O
of	O
proxies	O
,	O
which	O
in	O
turn	O
,	O
talk	O
to	O
the	O
''	O
mothership	O
''	O
server	O
.	O
The	O
mothership	O
server	O
is	O
generally	O
a	O
VPS	O
,	O
which	O
runs	O
the	O
Control	O
panel	O
software	O
used	O
to	O
interact	O
with	O
the	O
victims	O
.	O
The	B-Entity
attackers	I-Entity
operate	B-Action
the	B-Entity
mothership	I-Entity
using	B-Modifier
a	B-Entity
network	I-Entity
of	I-Entity
proxies	I-Entity
and	I-Entity
VPN	I-Entity
servers	I-Entity
for	O
anonymity	O
reasons	O
.	O
The	O
mothership	O
also	O
work	O
as	O
the	O
exploitation	O
servers	O
used	O
in	O
the	O
watering	O
hole	O
attacks	O
,	O
delivering	O
Java	O
,	O
IE	O
or	O
fake	O
applications	O
to	O
the	O
victim	O
.	O
We	O
were	O
able	O
to	O
get	O
a	O
copy	O
of	O
one	O
of	O
the	O
motherships	O
,	O
which	O
provided	O
some	O
insight	O
into	O
the	O
operation	O
.	O
It	B-Entity
runs	B-Action
a	B-Entity
control	I-Entity
panel	I-Entity
which	O
is	O
password	O
protected	O
:	O
Once	O
logged	O
into	O
the	O
Control	O
panel	O
,	O
the	O
attackers	O
can	O
see	O
a	O
general	O
overview	O
of	O
the	O
system	O
including	O
the	O
number	O
of	O
interesting	O
potential	O
targets	O
:	O
A	O
very	O
interesting	O
file	O
on	O
the	O
servers	O
is	O
task.css	O
,	O
where	O
the	O
attackers	O
define	O
the	O
IP	O
ranges	O
they	O
are	O
interested	O
in	O
.	O
To	O
change	O
the	O
file	O
,	O
they	O
are	O
using	O
the	O
''	O
Task	O
editor	O
''	O
from	O
the	O
menu	O
.	O
Depending	O
on	O
the	O
''	O
tasks	O
''	O
,	O
they	O
will	O
decide	O
whether	O
to	O
infect	B-Action
the	B-Entity
visitors	I-Entity
or	O
not	O
.	O
In	O
this	O
case	O
,	O
we	O
found	O
they	O
targeted	O
two	O
ranges	O
belonging	O
to	O
:	O
It	O
should	O
be	O
noted	O
though	O
,	O
the	O
fact	O
that	O
the	O
attackers	O
were	O
targeting	O
these	O
ranges	O
does	O
n't	O
necessarily	O
mean	O
they	O
also	O
got	O
infected	O
.	O
Some	O
other	O
unknown	O
IPs	O
were	O
also	O
observed	O
in	O
the	O
targeting	O
schedules	O
.	O
There	O
is	O
also	O
an	O
''	O
except.css	O
''	O
file	O
where	O
attackers	O
log	O
the	O
reasons	O
they	O
did	O
n't	O
try	O
to	O
exploit	O
certain	O
visitors	O
.	O
There	O
are	O
three	O
possible	O
values	O
:	O
These	O
are	O
the	O
''	O
do	O
n't	O
meet	O
the	O
conditions	O
''	O
reasons	O
observed	O
in	O
the	O
logs	O
:	O
For	O
this	O
first	O
stage	O
of	O
the	O
attack	O
,	O
the	O
threat	O
actor	O
uses	O
a	O
custom	O
backdoor	O
.	O
In	O
some	O
cases	O
,	O
the	O
backdoor	O
is	O
packaged	O
together	O
with	O
the	O
CVE-2013-5065	O
EoP	O
exploit	O
and	O
heavily	O
obfuscated	O
.	O
This	O
makes	O
the	O
analysis	O
more	O
difficult	O
.	O
The	O
CVE-2013-5065	O
exploit	O
allows	O
the	O
backdoor	O
to	O
achieve	B-Action
administrator	B-Entity
privileges	I-Entity
on	O
the	O
system	O
and	O
run	O
unrestricted	O
.	O
This	O
exploit	O
only	O
works	O
on	O
unpatched	O
Microsoft	O
Windows	O
XP	O
systems	O
.	O
Other	O
known	O
detection	O
names	O
for	O
the	O
backdoor	O
is	O
Trojan.Wipbot	O
(	O
Symantec	O
)	O
or	O
Tavdig	O
.	O
The	O
main	O
backdoor	O
is	O
about	O
60KB	O
in	O
size	O
and	O
implements	B-Action
a	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
protocol	I-Entity
on	O
top	O
of	O
normal	O
HTTP	O
requests	O
.	O
The	O
communication	O
protocol	O
uses	O
requests	O
in	O
the	O
C	O
&	O
C	O
replies	O
,	O
which	O
the	O
malware	O
decrypts	O
and	O
processes	O
.	O
The	O
replies	O
are	O
sent	B-Action
back	B-Modifier
to	I-Modifier
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
through	B-Modifier
the	B-Entity
same	I-Entity
channel	I-Entity
.	O
The	B-Entity
malware	I-Entity
behavior	I-Entity
is	O
defined	O
by	O
a	O
configuration	O
block	O
.	O
The	O
configuration	O
block	O
usually	O
contains	O
two	O
hard-coded	O
C	O
&	O
C	O
URLs	O
.	O
He	O
have	O
also	O
seen	O
one	O
case	O
where	O
the	O
configuration	O
block	O
contains	O
just	O
one	O
URL	O
.	O
The	O
configuration	O
can	O
also	O
be	O
updated	O
on	O
the	O
fly	O
by	O
the	O
attackers	O
,	O
via	O
the	O
C	O
&	O
C	O
.	O
The	O
backdoor	O
attempts	O
to	O
identify	O
the	O
following	O
processes	O
and	O
,	O
if	O
found	O
,	O
it	O
will	O
terminate	O
itself	O
:	O
It	O
contains	O
an	O
internal	O
unique	O
ID	O
,	O
which	O
is	O
used	O
to	O
identify	O
the	O
victim	O
to	O
the	O
C	O
&	O
C	O
.	O
Most	O
samples	O
,	O
especially	O
old	O
ones	O
,	O
have	O
the	O
ID	O
1156fd22-3443-4344-c4ffff	O
.	O
Once	O
a	O
victim	O
is	O
confirmed	O
as	O
''	O
interesting	O
''	O
,	O
the	B-Entity
attackers	I-Entity
upload	B-Action
another	B-Entity
Epic	I-Entity
backdoor	I-Entity
which	O
has	O
a	O
unique	O
ID	O
used	O
to	O
control	O
this	O
specific	O
victim	O
.	O
During	O
the	O
first	O
C	O
&	O
C	O
call	O
,	O
the	B-Entity
backdoor	I-Entity
sends	B-Action
a	B-Entity
pack	I-Entity
with	B-Modifier
the	B-Entity
victim	I-Entity
's	I-Entity
system	I-Entity
information	I-Entity
.	O
All	B-Entity
further	I-Entity
information	I-Entity
sent	B-Action
to	B-Modifier
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
is	B-Action
encrypted	I-Action
with	B-Modifier
a	B-Entity
public	I-Entity
key	I-Entity
framework	I-Entity
,	O
making	O
decryption	O
impossible	O
.	O
The	B-Entity
commands	I-Entity
from	B-Modifier
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
are	B-Action
encrypted	I-Action
in	O
a	O
simpler	O
manner	O
and	O
can	O
be	O
decrypted	O
if	O
intercepted	O
because	O
the	O
secret	O
key	O
is	O
hardcoded	O
in	O
the	O
malware	O
.	O
Through	O
monitoring	O
,	O
we	O
were	O
able	O
to	O
capture	B-Action
a	B-Entity
large	I-Entity
amount	I-Entity
of	I-Entity
commands	I-Entity
sent	B-Action
to	B-Modifier
the	B-Entity
victims	I-Entity
by	I-Entity
the	I-Entity
attackers	I-Entity
,	O
providing	O
an	O
unique	O
view	O
into	O
this	O
operation	O
.	O
Here	O
's	O
a	O
look	O
at	O
one	O
of	O
the	O
encrypted	O
server	O
replies	O
:	O
Once	O
a	O
victim	O
is	O
infected	O
and	O
''	O
checks	O
in	O
''	O
with	O
the	O
server	O
,	O
the	B-Entity
attackers	I-Entity
send	B-Action
a	B-Entity
template	I-Entity
of	I-Entity
commands	I-Entity
:	O
Next	O
,	O
the	O
attackers	O
try	O
to	O
move	O
through	O
the	O
victim	O
's	O
network	O
using	O
pre-defined	O
or	O
collected	O
passwords	O
:	O
Listing	O
all	O
.doc	O
files	O
recursively	O
is	O
also	O
a	O
common	O
''	O
theme	O
''	O
:	O
In	O
total	O
,	O
we	O
have	O
decoded	B-Action
several	B-Entity
hundreds	I-Entity
of	I-Entity
these	I-Entity
command	I-Entity
packages	I-Entity
delivered	I-Entity
to	I-Entity
the	I-Entity
victims	I-Entity
,	O
providing	O
an	O
unique	O
insight	O
into	O
the	O
inner	O
workings	O
of	O
the	O
attackers	O
.	O
In	O
addition	O
to	O
generic	O
searches	O
,	O
some	O
very	O
specific	O
lookups	O
have	O
been	O
observed	O
as	O
well	O
.	O
These	O
include	O
searches	O
for	O
:	O
In	O
this	O
case	O
,	O
the	O
attackers	O
were	O
interested	O
to	O
find	O
e-mails	O
related	O
to	O
''	O
NATO	O
''	O
,	O
''	O
Energy	O
Dialogue	O
within	O
European	O
Unition	O
''	O
and	O
so	O
on	O
.	O
For	O
some	O
of	O
the	O
C	O
&	O
C	O
servers	O
,	O
the	O
attackers	O
implemented	O
RSA	O
encryption	O
for	O
the	O
C	O
&	O
C	O
logs	O
,	O
which	O
makes	O
it	O
impossible	O
to	O
decrypt	O
them	O
.	O
This	O
scheme	O
was	O
implemented	O
in	O
April	O
2014	O
.	O
Once	O
a	O
victim	O
is	O
compromised	O
,	O
the	B-Entity
attackers	I-Entity
upload	B-Action
several	B-Entity
tools	I-Entity
that	O
are	O
used	O
for	O
lateral	O
movement	O
.	O
One	O
such	O
tool	O
observed	O
in	O
the	O
attacks	O
and	O
saved	O
as	O
''	O
C	O
:	O
\Documents	O
and	O
Settings\All	O
users\Start	O
Menu\Programs\Startup\winsvclg.exe	O
''	O
is	O
:	O
This	O
is	B-Action
a	B-Entity
keylogger	I-Entity
tool	I-Entity
that	I-Entity
creates	B-Action
%	B-Entity
temp	I-Entity
%	I-Entity
\~DFD3O8.tmp	I-Entity
.	O
Note	O
:	O
the	O
filename	O
can	O
change	O
across	O
victims	O
.	O
On	O
one	O
Central	O
Asian	O
government	O
's	O
Ministry	O
of	O
Foreign	O
Affairs	O
victim	O
system	O
,	O
the	O
filename	O
used	O
was	O
''	O
adobe32updt.exe	O
''	O
.	O
In	O
addition	O
to	O
these	O
custom	O
tools	O
,	O
we	O
observed	O
the	O
usage	O
of	O
standard	O
administration	O
utilities	O
.	O
For	O
instance	O
,	O
another	O
tool	O
often	O
uploaded	O
by	O
the	O
attackers	O
to	O
the	O
victim	O
's	O
machine	O
is	O
''	O
winrs.exe	O
''	O
:	O
This	O
is	O
an	O
UPX	O
packed	O
binary	O
,	O
which	O
contains	O
the	O
genuine	O
''	O
dnsquery.exe	O
''	O
tool	O
from	O
Microsoft	O
,	O
unpacked	O
MD5	O
:	O
c0c03b71684eb0545ef9182f5f9928ca	O
.	O
In	O
several	O
cases	O
,	O
an	O
interesting	O
update	O
has	O
been	O
observed	O
--	O
a	O
malware	O
from	O
a	O
different	O
,	O
yet	O
related	O
family	O
.	O
This	B-Entity
backdoor	I-Entity
is	O
more	O
sophisticated	O
and	O
belongs	O
to	O
the	O
next	O
level	O
of	O
cyber-espionage	O
tools	O
called	O
the	O
''	O
Carbon	O
system	O
''	O
or	O
Cobra	O
by	O
the	O
Turla	O
attackers	O
.	O
Several	O
plugins	O
for	O
the	O
''	O
Carbon	O
system	O
''	O
are	O
known	O
to	O
exist	O
.	O
Note	O
:	O
the	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
servers	I-Entity
www.losguayaberos	I-Entity
[	I-Entity
.	O
]	I-Entity
com	I-Entity
and	O
thebesttothbrushes	O
[	O
.	O
]	I-Entity
com	I-Entity
have	O
been	O
sinkholed	O
by	O
Kaspersky	O
Lab	O
.	O
Other	O
packages	O
delivered	O
to	O
the	O
victims	O
include	O
:	O
These	O
top	O
level	O
packages	O
deploy	B-Action
both	B-Entity
updated	I-Entity
Epic	I-Entity
backdoors	I-Entity
and	I-Entity
Turla	I-Entity
Carbon	I-Entity
system	I-Entity
backdoors	I-Entity
to	I-Entity
confirmed	I-Entity
victims	I-Entity
,	O
effectively	O
linking	O
the	O
Epic	O
and	O
Turla	O
Carbon	O
operations	O
together	O
.	O
The	B-Entity
Turla	I-Entity
Carbon	I-Entity
dropper	I-Entity
from	I-Entity
these	I-Entity
packages	I-Entity
has	O
the	O
following	O
properties	O
:	O
This	O
is	O
called	O
internally	O
by	O
the	O
authors	O
''	O
Carbon	O
System	O
''	O
,	O
part	O
of	O
the	O
''	O
Cobra	O
''	O
project	O
,	O
as	O
it	O
can	O
be	O
seen	O
from	O
the	O
debug	O
path	O
inside	O
:	O
This	O
acts	O
as	O
a	O
dropper	O
for	O
the	O
following	O
modules	O
,	O
both	O
32	O
and	O
64	O
bit	O
:	O
The	O
Carbon	O
system	O
is	O
in	O
essence	O
an	O
extensible	O
platform	O
,	O
very	O
similar	O
to	B-Modifier
other	B-Entity
attack	I-Entity
platforms	I-Entity
such	I-Entity
as	I-Entity
the	I-Entity
Tilded	I-Entity
platform	I-Entity
or	I-Entity
the	I-Entity
Flame	I-Entity
platform	I-Entity
.	O
The	O
plugins	O
for	O
the	O
Carbon	O
system	O
can	O
be	O
easily	O
recognized	O
as	O
they	O
always	O
feature	O
at	O
least	O
two	O
exports	O
named	O
:	O
Several	O
Epic	O
backdoors	O
appear	O
to	O
have	O
been	O
designed	O
to	O
work	O
as	O
Carbon	O
system	O
plugins	O
as	O
well	O
-	O
they	O
require	O
a	O
specialized	O
loader	O
to	O
start	O
in	O
victim	O
systems	O
that	O
do	O
not	O
have	O
the	O
Carbon	O
system	O
deployed	O
.	O
Some	O
modules	O
have	O
artifacts	O
which	O
indicate	O
the	O
Carbon	O
system	O
is	O
already	O
at	O
version	O
3.x	O
,	O
although	O
the	O
exact	O
Carbon	O
system	O
version	O
is	O
very	O
rarely	O
seen	O
in	O
samples	O
:	O
The	O
author	O
of	O
the	O
Carbon	O
module	O
above	O
can	O
be	O
also	O
seen	O
in	O
the	O
code	O
,	O
as	O
''	O
gilg	O
''	O
,	O
which	O
also	O
authored	O
several	O
other	O
Turla	O
modules	O
.	O
We	O
are	O
planning	O
to	O
cover	O
the	O
Turla	O
Carbon	O
system	O
with	O
more	O
details	O
in	O
a	O
future	O
report	O
.	O
The	O
payload	O
recovered	O
from	O
one	O
of	O
the	O
mothership	O
servers	O
(	O
at	O
newsforum.servehttp	O
[	O
.	O
]	O
com/wordpress/wp-includes/css/img/upload.php	O
,	O
MD5	O
:	O
4dc22c1695d1f275c3b6e503a1b171f5	O
,	O
Compiled	O
:	O
Thu	O
Sep	O
06	O
14:09:55	O
2012	O
)	O
contains	O
two	O
modules	O
,	O
a	O
loader/injector	O
and	O
a	O
backdoor	O
.	O
Internally	O
,	O
the	O
backdoor	O
is	O
named	O
''	O
Zagruzchick.dll	O
''	O
:	O
The	O
word	O
''	O
Zagruzchick	O
''	O
means	O
''	O
boot	O
loader	O
''	O
in	O
Russian	O
.	O
The	O
Control	O
panel	O
for	O
the	O
Epic	O
motherships	O
also	O
sets	O
the	O
language	O
to	O
codepage	O
''	O
1251	O
''	O
:	O
Codepage	O
1251	O
is	O
commonly	O
used	O
to	O
render	O
Cyrillic	O
characters	O
.	O
There	O
are	O
other	O
indications	O
that	O
the	O
attackers	O
are	O
not	O
native	O
English	O
language	O
speakers	O
:	O
The	O
sample	O
e9580b6b13822090db018c320e80865f	O
that	O
was	B-Action
delivered	I-Action
to	B-Modifier
several	B-Entity
Epic	I-Entity
victims	I-Entity
as	B-Modifier
an	B-Entity
upgraded	I-Entity
backdoor	I-Entity
,	O
has	O
the	O
compilation	O
code	O
page	O
language	O
set	O
to	O
''	O
LANGRUSSIAN	O
''	O
.	O
The	O
threat	O
actor	O
behind	O
the	O
''	O
Epic	O
''	O
operation	O
uses	O
mainly	O
hacked	O
servers	O
to	O
host	O
their	O
proxies	O
.	O
The	O
hacked	O
servers	O
are	O
controlled	O
through	O
the	O
use	O
of	O
a	O
PHP	O
webshell	O
.	O
This	O
shell	O
is	O
password	O
protected	O
;	O
the	O
password	O
is	O
checked	O
against	O
an	O
MD5	O
hash	O
:	O
The	O
MD5	O
''	O
af3e8be26c63c4dd066935629cf9bac8	O
''	O
has	O
been	O
solved	O
by	O
Kaspersky	O
Lab	O
as	O
the	O
password	O
''	O
kenpachi	O
''	O
.	O
In	O
February	O
2014	O
we	O
observed	O
the	O
Miniduke	B-Entity
threat	I-Entity
actor	I-Entity
using	B-Modifier
the	B-Entity
same	I-Entity
backdoor	I-Entity
on	O
their	O
hacked	O
servers	O
,	O
although	O
using	O
a	O
much	O
stronger	O
password	O
.	O
Once	O
again	O
,	O
it	O
is	O
also	O
interesting	O
to	O
point	O
out	O
the	O
usage	O
of	O
Codepage	O
1251	O
in	O
the	O
webshell	O
,	O
which	O
is	O
used	O
to	O
render	O
Cyrillic	O
characters	O
.	O
There	O
appears	O
to	O
be	O
several	O
links	O
between	O
Turla	O
and	O
Miniduke	O
,	O
but	O
we	O
will	O
leave	O
that	O
for	O
a	O
future	O
blogpost	O
.	O
On	B-Modifier
some	B-Entity
of	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
servers	I-Entity
used	B-Action
in	B-Modifier
the	B-Entity
Epic	I-Entity
attacks	I-Entity
,	O
we	O
were	O
able	O
to	O
identify	O
detailed	O
victim	O
statistics	O
,	O
which	O
were	O
saved	O
for	O
debugging	O
purposes	O
by	O
the	O
attackers	O
.	O
This	O
is	O
the	O
country	O
distribution	O
for	O
the	O
top	O
20	O
affected	O
countries	O
by	O
victim	O
's	O
IP	O
:	O
According	O
to	O
the	O
public	O
information	O
available	O
for	O
the	O
victims	O
'	O
IPs	O
,	O
targets	O
of	O
''	O
Epic	O
''	O
belong	O
to	O
the	O
following	O
categories	O
:	O
When	O
G-Data	O
published	O
their	O
Turla	O
paper	O
,	O
there	O
were	O
few	O
details	O
publicly	O
available	O
on	O
how	O
victims	O
get	B-Action
infected	I-Action
with	B-Modifier
this	B-Entity
malware	I-Entity
campaign	I-Entity
.	O
Our	O
analysis	O
indicates	O
this	O
is	O
a	O
sophisticated	O
multi-stage	O
infection	O
;	O
which	O
begins	O
with	O
Epic	O
Turla	O
.	O
This	O
is	O
used	O
to	O
gain	O
a	O
foothold	O
and	O
validate	B-Action
the	B-Entity
high	I-Entity
profile	I-Entity
victim	I-Entity
.	O
If	O
the	O
victim	O
is	O
interesting	O
,	O
they	O
get	O
upgraded	O
to	O
the	O
Turla	O
Carbon	O
system	O
.	O
Most	O
recently	O
,	O
we	O
observed	O
this	O
attack	O
against	O
a	O
Kaspersky	O
Lab	O
user	O
on	O
August	O
5	O
,	O
2014	O
,	O
indicating	O
the	O
operation	O
remains	O
fresh	O
and	O
ongoing	O
.	O
Note	O
:	O
A	O
full	O
analysis	O
of	O
the	O
Epic	O
attacks	O
is	O
available	O
to	O
the	O
Kaspersky	O
Intelligent	O
Services	O
customers	O
.	O
Context	O
Information	O
Security	O
distribute	O
Context	O
Threat	O
Intelligence	O
(	O
CTI	O
)	O
reporting	O
under	O
the	O
Traffic	O
Light	O
Protocol	O
(	O
TLP	O
)	O
,	O
a	O
method	O
of	O
classifying	O
a	O
document	O
in	O
order	O
to	O
promote	O
the	O
distribution	O
of	O
sensitive	O
information	O
between	O
individuals	O
,	O
organisations	O
or	O
communities	O
in	O
a	O
controlled	O
and	O
trusted	O
way	O
,	O
based	O
on	O
the	O
originator	O
's	O
wishes	O
.	O
The	O
various	O
levels	O
of	O
the	O
TLP	O
are	O
represented	O
by	O
the	O
following	O
colours	O
:	O
Sources	O
may	O
use	O
TLP	O
:	O
RED	O
when	O
information	O
can	O
not	O
be	O
effectively	O
acted	O
upon	O
by	O
additional	O
parties	O
,	O
and	O
could	O
lead	O
to	O
impacts	O
on	O
a	O
party	O
's	O
privacy	O
,	O
reputation	O
,	O
or	O
operations	O
if	O
misused	O
.	O
Recipients	O
may	O
not	O
share	O
TLP	O
:	O
RED	O
information	O
with	O
any	O
parties	O
outside	O
of	O
the	O
specific	O
exchange	O
,	O
meeting	O
,	O
or	O
conversation	O
in	O
which	O
it	O
is	O
originally	O
disclosed	O
.	O
TLP	O
:	O
RED	O
information	O
will	O
be	O
passed	O
verbally	O
or	O
in	O
person	O
.	O
Sources	O
may	O
use	O
TLP	O
:	O
AMBER	O
when	O
information	O
requires	O
support	O
to	O
be	O
effectively	O
acted	O
upon	O
,	O
but	O
carries	O
risks	O
to	O
privacy	O
,	O
reputation	O
,	O
or	O
operations	O
if	O
shared	O
outside	O
of	O
the	O
organisations	O
involved	O
.	O
Recipients	O
may	O
only	O
share	O
TLP	O
:	O
AMBER	O
information	O
with	O
members	O
of	O
their	O
own	O
organisation	O
who	O
need	O
to	O
know	O
,	O
and	O
only	O
as	O
widely	O
as	O
necessary	O
to	O
act	O
on	O
that	O
information	O
.	O
Sources	O
may	O
use	O
TLP	O
:	O
GREEN	O
when	O
information	O
is	O
useful	O
for	O
the	O
awareness	O
of	O
all	O
participating	O
organisations	O
as	O
well	O
as	O
with	O
peers	O
within	O
the	O
broader	O
community	O
or	O
sector	O
.	O
Recipients	O
may	O
share	O
TLP	O
:	O
GREEN	O
information	O
with	O
peers	O
and	O
partner	O
organisations	O
within	O
their	O
sector	O
or	O
community	O
,	O
but	O
not	O
via	O
publicly	O
accessible	O
channels	O
such	O
as	O
publication	O
or	O
posting	O
publicly	O
on	O
the	O
Internet	O
.	O
Sources	O
may	O
use	O
TLP	O
:	O
WHITE	O
when	O
information	O
carries	O
minimal	O
or	O
no	O
foreseeable	O
risk	O
of	O
misuse	O
,	O
in	O
accordance	O
with	O
applicable	O
rules	O
and	O
procedures	O
for	O
public	O
release	O
.	O
Subject	O
to	O
standard	O
copyright	O
rules	O
,	O
TLP	O
:	O
WHITE	O
information	O
may	O
be	O
distributed	O
freely	O
,	O
without	O
restriction	O
.	O
On	O
2nd	O
January	O
2014	O
a	O
Systems	O
Administrator	O
at	O
the	O
Monju	O
fast	O
breeder	O
reactor	O
facility	O
in	O
Japan	O
noticed	O
suspicious	O
connections	O
emanating	O
from	O
a	O
machine	O
in	O
the	O
control	O
room	O
,	O
coinciding	O
with	O
what	O
was	O
a	O
seemingly	O
routine	O
software	O
update	O
to	O
a	O
free	O
media	O
player	O
.	O
Among	O
other	O
items	O
,	O
staff	O
training	O
documents	O
and	O
more	O
than	O
40,000	O
emails	O
were	O
stored	O
on	O
the	O
machine	O
and	O
thought	O
to	O
be	O
harvested	O
by	O
the	O
attacker	O
.	O
The	O
Japanese	O
Atomic	O
Energy	O
Agency	O
is	O
investigating	O
further	O
.	O
The	O
attack	O
appears	O
to	O
have	O
been	O
the	O
result	O
of	O
the	O
attackers	O
having	O
compromised	O
the	O
'GOM	O
Player	O
'	O
update	O
server	O
and	O
having	B-Action
it	B-Entity
act	B-Action
as	B-Modifier
a	B-Entity
'watering	I-Entity
hole	I-Entity
'	O
,	O
meaning	O
that	O
machines	O
which	O
access	O
the	O
site	O
are	O
delivered	O
malware	O
.	O
Gom	O
Player	O
originates	O
in	O
South	O
Korea	O
and	O
in	O
some	O
parts	O
of	O
Asia	O
it	O
is	O
a	O
popular	O
alternative	O
to	O
Windows	O
Media	O
Player	O
.	O
It	O
is	O
unclear	O
whether	O
every	O
machine	O
trying	O
to	O
download	B-Action
an	B-Entity
update	I-Entity
received	I-Entity
this	I-Entity
malware	I-Entity
or	O
whether	O
only	O
machines	O
which	O
fitted	O
a	O
certain	O
profile	O
were	O
infected	O
.	O
Technical	O
analysis	O
of	O
the	O
implant	O
on	O
the	O
compromised	O
machine	O
has	O
shown	O
it	O
to	O
be	O
a	O
variant	O
of	O
a	O
Trojan	O
which	O
has	O
been	O
in	O
the	O
wild	O
for	O
some	O
years	O
now	O
and	O
continues	O
to	O
be	O
effective	O
.	O
The	O
'Gh0st	O
RAT	O
'	O
has	O
been	O
used	O
extensively	O
in	O
attacks	O
linked	O
to	O
the	O
Chinese	O
state	O
,	O
though	O
it	O
is	O
important	O
to	O
remember	O
that	O
the	O
code	O
is	O
publicly	O
available	O
and	O
can	O
be	O
modified	O
and	O
used	O
by	O
anyone	O
.	O
The	O
targeting	O
of	O
a	O
Japanese	O
nuclear	O
facility	O
however	O
,	O
is	O
consistent	O
with	O
Chinese	O
state	O
intelligence	O
requirements	O
.	O
If	O
this	O
is	O
the	O
work	O
of	O
a	O
Chinese	O
group	O
then	O
we	O
feel	O
the	O
targeting	O
may	O
go	O
much	O
further	O
than	O
the	O
Civil	O
Nuclear	O
sector	O
and	O
thus	O
be	O
of	O
interest	O
to	O
the	O
wider	O
Energy	O
Sector	O
and	O
industry	O
as	O
a	O
whole	O
.	O
In	O
order	O
to	O
inform	O
the	O
Energy	O
Sector	O
and	O
beyond	O
about	O
this	O
attack	O
,	O
we	O
have	O
compiled	O
a	O
technical	O
summary	O
of	O
the	O
attack	O
and	O
have	O
provided	O
a	O
number	O
of	O
Indicators	O
Of	O
Compromise	O
(	O
IOCs	O
)	O
which	O
can	O
be	O
used	O
to	O
aid	O
detection	O
.	O
It	O
is	O
likely	O
that	O
the	O
attackers	O
would	O
redeploy	O
their	O
implant	O
against	O
other	O
targets	O
,	O
albeit	O
with	O
a	O
delivery	O
mechanism	O
more	O
tailored	O
to	O
the	O
location	O
of	O
the	O
intended	O
victims	O
.	O
Based	O
on	O
open	O
source	O
reporting	O
,	O
it	O
appears	O
that	O
the	O
intrusion	O
took	O
place	O
via	O
the	O
compromise	O
of	O
the	O
GOM	O
Player	O
update	O
server	O
(	O
app.gomlab.com	O
)	O
,	O
where	O
attackers	O
may	O
have	O
gained	O
entry	O
via	O
a	O
PHP-based	O
webshell	O
,	O
hidden	O
within	O
an	O
image	O
,	O
present	O
on	O
the	O
host	O
since	O
October	O
2011	O
.	O
The	O
observed	O
malicious	O
activity	O
relates	O
to	O
the	O
modification	O
of	O
a	O
file	O
that	O
controls	O
GOM	O
Player	O
updates	O
,	O
spanning	O
the	O
date	O
range	O
27th	O
December	O
2013	O
to	O
16th	O
January	O
2014	O
,	O
during	O
which	O
time	O
these	O
alterations	O
are	O
reported	O
to	O
have	O
only	O
manifested	O
themselves	O
for	O
visitors	O
on	O
certain	O
IP	O
ranges	O
;	O
evidence	O
supporting	O
this	O
claim	O
has	O
not	O
yet	O
been	O
made	O
public	O
.	O
If	O
this	O
was	O
indeed	O
the	O
case	O
,	O
then	O
the	O
nature	O
of	O
this	O
attack	O
is	O
certainly	O
more	O
targeted	O
than	O
one	O
that	O
would	O
cover	O
the	O
entire	O
userbase	O
of	O
the	O
GOM	O
Player	O
product	O
,	O
with	O
victims	O
comprising	O
of	O
the	O
Japanese	O
Government	O
in	O
addition	O
to	O
those	O
at	O
the	O
Monju	O
nuclear	O
facility	O
.	O
The	B-Entity
modified	I-Entity
file	I-Entity
redirected	B-Action
the	B-Entity
GOM	I-Entity
Player	I-Entity
update	I-Entity
process	I-Entity
to	B-Modifier
another	B-Entity
compromised	I-Entity
server	I-Entity
(	I-Entity
www.fudousankaitori.jp	I-Entity
(	I-Entity
203.189.101.35	I-Entity
)	I-Entity
)	I-Entity
,	O
where	O
a	O
file	O
containing	O
both	O
the	O
legitimate	O
update	O
and	O
the	O
malware	O
was	O
deliver	O
to	O
the	O
victim	O
.	O
Deployed	B-Action
to	B-Modifier
the	B-Entity
system	I-Entity
via	B-Modifier
a	B-Entity
compressed	I-Entity
bundle	I-Entity
containing	O
the	O
official	O
GOM	O
Player	O
setup	O
binary	O
and	O
a	O
self-extracting	O
RAR	O
archive	O
containing	O
the	O
malicious	O
files	O
,	O
the	O
malware	O
consists	O
of	O
a	O
number	O
of	O
individual	O
pieces	O
.	O
Upon	O
extraction	O
from	O
the	O
RAR	O
archive	O
,	O
the	O
installer	O
component	O
(	O
0ae82fd94836815a1e8d284ccb75109d	O
)	O
is	O
automatically	O
launched	O
alongside	O
the	O
GOM	O
Player	O
update	O
,	O
distracting	O
victims	O
from	O
the	O
malicious	O
activity	O
taking	O
place	O
.	O
The	B-Entity
installer	I-Entity
component	I-Entity
is	O
referred	O
to	O
by	O
the	O
author	O
as	O
'miansha	O
'	O
which	O
,	O
according	O
to	O
an	O
East	O
Asia	O
Cyber	O
Threat	O
Intelligence	O
Researcher	O
,	O
is	O
likely	O
Miǎnshā	O
(	O
免杀	O
)	O
,	O
a	O
phrase	O
commonly	O
used	O
by	O
People	O
's	O
Republic	O
of	O
China	O
(	O
PRC	O
)	O
hackers	O
to	O
mean	O
'anti	O
Antivirus	O
detection	O
'	O
or	O
'Antivirus	O
avoidance	O
'	O
;	O
Symantec	O
have	O
named	O
the	O
detection	O
for	O
this	O
code	O
'Backdoor.Miancha	O
'	O
,	O
where	O
Miǎnchá	O
(	O
免查	O
,	O
likely	O
shorthand	O
for	O
免杀查	O
)	O
similarly	O
means	O
'Antivirus	O
avoidance	O
'	O
.	O
The	O
installer	O
is	O
responsible	O
for	O
the	B-Entity
malware	I-Entity
persistence	I-Entity
mechanism	I-Entity
,	O
adding	O
entries	O
to	O
the	O
registry	O
in	O
the	O
following	O
locations	O
,	O
depending	O
on	O
Windows	O
Version	O
:	O
The	O
installer	O
will	O
also	O
determine	B-Action
the	B-Entity
system	I-Entity
architecture	I-Entity
(	I-Entity
32-	I-Entity
or	I-Entity
64-bit	I-Entity
)	I-Entity
and	O
then	O
deobfuscate	B-Action
the	B-Entity
relevant	I-Entity
loader	I-Entity
DLL	I-Entity
to	B-Modifier
the	B-Entity
path	I-Entity
'C	I-Entity
:	I-Entity
\Windows\temp\install.ocx	I-Entity
'	I-Entity
,	I-Entity
ensuring	I-Entity
the	I-Entity
malware	I-Entity
is	B-Action
launched	I-Action
on	O
system	O
start-up	O
.	O
Oddly	O
,	O
this	O
file	O
is	O
padded	O
with	O
null	O
bytes	O
,	O
resulting	O
in	O
a	O
25	O
megabyte	O
file	O
.	O
The	O
main	O
implant	O
code	O
is	O
stored	O
in	O
files	O
named	O
instructions.pdf	O
and	O
instructions64.pdf	O
;	O
not	O
PDF	O
documents	O
but	O
instead	O
DLLs	O
obfuscated	O
with	O
a	O
one-byte	O
XOR	O
with	O
0x14	O
,	O
similar	O
to	O
the	O
malware	O
loader	O
DLLs	O
.	O
The	O
loader	O
,	O
referred	O
to	O
by	O
the	O
malware	O
author	O
as	O
壳	O
(	O
shell	O
)	O
,	O
reads	O
and	O
deobfuscates	O
the	O
main	O
implant	O
code	O
which	O
then	O
communicates	B-Action
with	B-Modifier
the	B-Entity
attacker-controlled	I-Entity
server	I-Entity
at	I-Entity
testqweasd.tk	I-Entity
(	I-Entity
211.43.220.89	I-Entity
)	I-Entity
on	I-Entity
TCP	I-Entity
port	I-Entity
443	I-Entity
.	O
The	O
main	O
implant	O
code	O
is	O
referred	O
to	O
as	O
白加黑	O
(	O
'Black	O
on	O
White	O
'	O
)	O
,	O
a	O
term	O
used	B-Action
in	B-Modifier
the	B-Entity
PRC	I-Entity
hacking	I-Entity
community	I-Entity
to	B-Modifier
denote	B-Entity
the	I-Entity
act	I-Entity
of	I-Entity
Antivirus	I-Entity
avoidance	I-Entity
through	B-Modifier
the	B-Entity
loading	I-Entity
of	I-Entity
malicious	I-Entity
'black	I-Entity
'	I-Entity
code	I-Entity
via	I-Entity
non-malicious	I-Entity
or	I-Entity
trusted	I-Entity
'white	I-Entity
'	I-Entity
code	I-Entity
.	O
This	O
is	O
a	O
practice	O
recently	O
illustrated	O
through	O
the	O
deployment	O
of	O
the	O
PlugX	O
trojan	O
,	O
utilising	O
DLL	O
load	O
order	O
hijacking	O
alongside	O
a	O
signed	O
(	O
trusted	O
)	O
executable	O
.	O
Analysis	O
of	O
this	O
malware	O
revealed	O
it	O
to	O
be	O
a	O
variant	O
of	O
the	O
Gh0st	O
RAT	O
,	O
often	O
used	O
by	O
Chinese	O
actors	O
(	O
including	O
those	O
who	O
are	O
state-motivated	O
or	O
directly	O
state-sponsored	O
)	O
.	O
This	O
specific	O
variant	O
shows	O
similarities	O
to	O
that	O
used	O
during	O
the	O
VOHO	O
campaign	O
,	O
where	O
Gh0st	O
RAT	O
was	B-Action
spread	I-Action
via	B-Modifier
watering	B-Entity
hole	I-Entity
attacks	I-Entity
utilising	I-Entity
vulnerable	I-Entity
websites	I-Entity
belonging	I-Entity
to	I-Entity
financial	I-Entity
services	I-Entity
and	O
technology	O
companies	O
.	O
Specifically	O
,	O
the	O
initial	O
five	O
bytes	O
of	O
the	O
communications	O
(	O
often	O
used	O
to	O
denote	O
a	O
campaign	O
or	O
victim	O
)	O
are	O
'HTTPS	O
'	O
,	O
amended	O
from	O
the	O
original	O
'Gh0st	O
'	O
;	O
the	O
same	O
as	O
the	O
traffic	O
produced	O
by	O
the	O
VOHO	O
Gh0st	O
variant	O
.	O
In	O
addition	O
to	O
delivering	O
system-specific	O
details	O
back	O
to	O
the	O
attacker	O
,	O
Gh0st	O
RAT	O
provides	O
the	O
capability	O
to	O
deploy	B-Action
additional	B-Entity
malware	I-Entity
,	O
enabling	O
the	O
harvesting	O
of	O
sensitive	O
data	O
and	O
enabling	O
the	O
further	O
propagation	O
throughout	O
the	O
infected	O
network	O
.	O
In	O
February	O
2014	O
,	O
the	O
experts	O
of	O
the	O
G	O
DATA	O
SecurityLabs	O
published	O
an	O
analysis	O
of	O
Uroburos	O
,	O
the	O
rootkit	O
with	O
Russian	O
roots	O
.	O
We	O
explained	O
that	O
a	O
link	O
exists	O
between	O
Uroburos	O
and	O
the	O
Agent.BTZ	O
malware	O
,	O
which	O
was	O
responsible	O
for	O
''	O
the	O
most	O
significant	O
breach	O
of	O
U.S.	O
military	O
computers	O
ever	O
.	O
''	O
Nine	O
months	O
later	O
,	O
after	O
the	O
buzz	O
around	O
Uroburos	O
,	O
aka	O
Snake	O
or	O
Turla	O
,	O
we	O
now	O
identified	O
a	O
new	O
generation	O
of	O
Agent.BTZ	O
.	O
We	O
dubbed	O
it	O
ComRAT	O
and	O
,	O
by	O
now	O
,	O
analyzed	O
two	O
versions	O
of	O
the	O
threat	O
(	O
v3.25	O
and	O
v3.26	O
)	O
.	O
As	O
reported	O
earlier	O
this	O
year	O
,	O
Agent.BTZ	O
used	B-Action
the	B-Entity
same	I-Entity
encoding	I-Entity
key	I-Entity
and	I-Entity
the	I-Entity
installation	I-Entity
log	I-Entity
file	I-Entity
name	I-Entity
as	O
Uroburos	O
.	O
ComRAT	O
,	O
in	O
its	O
version	O
3.25	O
,	O
shows	O
the	O
same	O
behavior	O
.	O
Furthermore	O
,	O
the	O
attackers	O
also	O
shared	O
a	O
C	O
&	O
C	O
domain	O
.	O
The	O
latest	O
version	O
of	O
ComRAT	O
known	O
to	O
us	O
(	O
v3.26	O
)	O
uses	O
a	O
new	O
key	O
and	O
does	O
not	O
create	O
the	O
installation	O
log	O
file	O
,	O
in	O
order	O
to	O
complicate	O
the	O
analysis	O
and	O
to	O
disguise	B-Action
the	B-Entity
link	I-Entity
between	O
the	O
two	O
cases	O
.	O
Another	O
very	O
interesting	O
fact	O
:	O
the	B-Entity
attackers	I-Entity
use	I-Entity
COM	I-Entity
Object	I-Entity
hijacking	I-Entity
,	I-Entity
the	I-Entity
same	I-Entity
persistence	I-Entity
mechanism	I-Entity
as	O
COMpfun	O
,	O
which	O
we	O
described	O
recently	O
.	O
Taken	O
everything	O
into	O
consideration	O
,	O
the	O
indications	O
we	O
saw	O
during	O
our	O
analyzes	O
lead	O
to	O
the	O
supposition	O
that	O
the	O
group	O
behind	O
Agent.BTZ	O
and	O
Uroburos	O
is	O
still	O
active	O
and	O
is	O
pursuing	O
the	O
Agent.BTZ	O
path	O
once	O
more	O
to	O
improve	O
and	O
change	O
the	O
RAT	O
.	O
The	O
analyzed	O
file	O
is	O
the	O
latest	O
version	O
we	O
identified	O
:	O
v3.26	O
.	O
The	O
version	O
identification	O
is	O
described	O
in	O
the	O
chapter	O
''	O
Log	O
files	O
''	O
.	O
The	O
major	O
difference	O
between	O
this	O
version	O
and	O
the	O
older	O
version	O
(	O
s	O
)	O
will	O
be	O
described	O
there	O
.	O
The	O
first	O
task	O
of	O
the	O
malware	O
is	O
to	O
install	B-Action
the	B-Entity
file	I-Entity
credprov.tlb	I-Entity
in	I-Entity
%	I-Entity
APPDATA	I-Entity
%	I-Entity
\Microsoft\	I-Entity
.	O
This	O
file	O
is	O
the	O
main	O
payload	O
of	O
the	O
malware	O
.	O
The	B-Entity
dropper	I-Entity
executes	B-Action
the	B-Entity
following	I-Entity
command	I-Entity
in	B-Modifier
order	I-Modifier
to	I-Modifier
install	I-Action
a	B-Entity
second	I-Entity
file	I-Entity
:	O
The	O
second	O
file	O
is	O
shdocw.tlp	O
.	O
The	O
two	O
files	O
are	O
Microsoft	O
Windows	O
dynamic	O
libraries	O
.	O
To	O
be	B-Action
started	I-Action
during	B-Modifier
the	B-Entity
boot	I-Entity
process	I-Entity
of	I-Entity
the	I-Entity
infected	I-Entity
machine	I-Entity
,	I-Entity
the	I-Entity
malware	I-Entity
creates	B-Action
the	B-Entity
following	I-Entity
registry	I-Entity
key	I-Entity
:	O
This	O
registry	O
key	O
is	O
used	O
to	O
associate	O
the	O
library	O
shdocvw.tlp	O
to	O
the	O
object	O
42aedc87-2188-41fd-b9a3-0c966feabec1	O
as	O
previously	O
explained	O
in	O
the	O
article	O
about	O
COMpfun	O
.	O
The	O
purpose	O
is	O
to	O
load	B-Action
the	B-Entity
library	I-Entity
into	B-Modifier
each	B-Entity
and	I-Entity
every	I-Entity
process	I-Entity
executed	I-Entity
on	I-Entity
the	I-Entity
infected	I-Entity
system	I-Entity
.	O
If	O
the	O
version	O
of	O
the	O
malware	O
is	O
older	O
than	O
3.26	O
,	O
the	O
dropper	O
creates	O
an	O
additional	O
file	O
called	O
winview.ocx	O
.	O
We	O
noticed	O
that	O
the	O
file	O
name	O
is	O
still	O
the	O
same	O
as	O
the	O
file	O
name	O
used	O
by	O
Agent.BTZ	O
in	O
the	O
past	O
.	O
The	O
file	O
is	O
xored	O
with	O
the	O
following	O
obfuscation	O
key	O
(	O
used	O
by	O
both	O
,	O
Uroburos	O
and	O
Agent.BTZ	O
)	O
:	O
Here	O
is	O
the	O
decoded	O
log	O
file	O
content	O
:	O
We	O
can	O
notice	O
that	O
the	B-Entity
malware	I-Entity
checks	I-Entity
if	B-Modifier
an	B-Entity
older	I-Entity
version	I-Entity
is	B-Action
installed	I-Action
on	B-Modifier
the	B-Entity
system	I-Entity
and	O
if	O
this	O
is	O
the	O
case	O
,	O
the	O
dropper	O
removes	O
the	O
older	O
version	O
.	O
In	O
contrast	O
to	O
this	O
,	O
in	O
our	O
Uroburos	O
analysis	O
,	O
we	O
found	O
out	O
that	O
Uroburos	O
does	O
not	O
install	O
itself	O
in	O
case	O
a	O
version	O
of	O
Agent.BTZ	O
was	O
found	O
on	O
a	O
system	O
.	O
During	O
the	O
startup	O
of	O
the	O
infected	O
machine	O
,	O
the	O
shdocvw.tlp	O
library	O
is	B-Action
loaded	I-Action
into	B-Modifier
all	B-Entity
processes	I-Entity
.	O
If	O
the	O
process	O
is	O
explorer.exe	O
,	O
this	O
library	O
will	O
load	O
the	O
other	O
library	O
called	O
credprov.tlb	O
.	O
This	O
library	O
is	O
the	O
real	O
payload	O
.	O
Its	O
features	O
are	O
common	O
for	O
a	O
Remote	O
Administration	O
Tool	O
(	O
RAT	O
)	O
:	O
ComRAT	O
's	O
communication	O
to	O
the	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
server	I-Entity
is	B-Action
performed	I-Action
by	B-Modifier
the	B-Entity
browser	I-Entity
process	I-Entity
and	O
not	O
by	O
explorer.exe	O
in	O
order	O
to	O
avoid	O
being	O
blocked	O
by	O
a	O
firewall	O
on	O
the	O
system	O
or	O
any	O
additional	O
security	O
products	O
.	O
The	B-Entity
communication	I-Entity
between	I-Entity
the	I-Entity
processes	I-Entity
is	B-Action
performed	I-Action
by	O
named	O
pipe	O
.	O
Two	B-Entity
log	I-Entity
files	I-Entity
are	B-Action
created	I-Action
during	B-Modifier
the	B-Entity
malware	I-Entity
execution	I-Entity
:	O
mskfp32.ocx	O
and	O
msvcrtd.tlb	O
.	O
If	O
the	O
malware	O
version	O
is	O
older	O
than	O
3.26	O
,	O
the	O
xored	O
key	O
is	O
the	O
same	O
as	O
the	O
dropper	O
key	O
.	O
Concerning	O
the	O
version	O
3.26	O
,	O
the	O
malware	O
uses	O
a	O
new	O
non-ASCII	O
key	O
.	O
Here	O
is	O
an	O
example	O
of	O
decoded	O
log	O
file	O
for	O
the	O
version	O
3.26	O
:	O
We	O
can	O
identify	O
the	O
version	O
of	O
the	O
malware	O
thanks	O
to	O
the	O
PVer	O
flag	O
.	O
The	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
server	I-Entity
information	I-Entity
is	O
stored	O
in	O
the	O
registry	O
,	O
not	O
in	O
an	O
XML	O
,	O
and	O
encoded	O
:	O
For	O
example	O
,	O
in	O
the	O
analyzed	O
sample	O
the	O
CC	O
is	O
:	O
weather-online.hopto.org	O
.	O
This	O
domain	O
is	O
far	O
from	O
unknown	O
,	O
as	O
it	O
has	O
been	O
mentioned	O
in	O
BAE	O
System	O
's	O
Uroburos	O
(	O
aka	O
Snake	B-Entity
)	I-Entity
analysis	I-Entity
paper	I-Entity
as	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
domain	I-Entity
for	B-Modifier
the	B-Entity
Uroburos	I-Entity
malware	I-Entity
.	O
Another	O
connection	O
between	O
the	O
cases	O
.	O
If	O
the	O
malware	O
version	O
in	O
lower	O
than	O
3.26	O
,	O
the	O
XML	O
log	O
file	O
contains	B-Action
the	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
server	I-Entity
information	I-Entity
:	O
Let	O
us	O
summarize	O
the	O
similarities	O
and	O
differences	O
between	O
Agent.BTZ	O
,	O
Uroburos	O
and	O
ComRAT	O
as	O
far	O
as	O
we	O
can	O
:	O
Some	O
parts	O
of	O
the	O
code	O
are	O
exactly	O
the	O
same	O
(	O
appears	O
to	O
be	O
copy	O
&	O
paste	O
)	O
.	O
That	O
is	O
the	O
reason	O
why	O
the	O
sample	O
is	O
detected	O
as	O
Uroburos	O
(	O
aka	O
Turla	O
)	O
.	O
The	O
same	O
code	O
was	O
used	O
by	O
Agent.BTZ	O
and	O
also	O
the	O
dll	O
loaded	O
into	O
userland	O
during	O
the	O
Uroburos	O
analysis	O
.	O
Command	B-Entity
and	I-Entity
control	I-Entity
server	I-Entity
domains	I-Entity
are	O
shared	O
between	O
Uroburos	O
and	O
ComRAT	O
.	O
In	O
version	O
3.26	O
,	O
the	O
author	O
changed	O
the	O
key	O
and	O
remove	O
the	O
known	O
file	O
name	O
.	O
This	O
action	O
can	O
be	O
an	O
indication	O
for	O
the	O
developer	O
's	O
effort	O
to	O
hide	O
this	O
connection	O
.	O
The	O
main	O
difference	O
is	O
the	O
design	O
.	O
Agent.BTZ	O
is	O
a	O
common	O
RAT	O
,	O
a	O
simple	O
library	O
executed	O
on	O
an	O
infected	O
machine	O
.	O
ComRAT	O
is	O
more	O
complex	O
and	O
cleverer	O
.	O
The	B-Entity
malware	I-Entity
is	B-Action
loaded	I-Action
into	B-Modifier
each	B-Entity
and	I-Entity
every	I-Entity
process	I-Entity
of	I-Entity
the	I-Entity
infected	I-Entity
machine	I-Entity
and	I-Entity
the	I-Entity
main	I-Entity
part	I-Entity
(	I-Entity
payload	I-Entity
)	I-Entity
of	I-Entity
the	I-Entity
malware	I-Entity
is	B-Action
only	B-Entity
executed	I-Entity
in	I-Entity
explorer.exe	I-Entity
.	O
Furthermore	O
,	O
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
communication	I-Entity
blends	B-Action
into	B-Modifier
the	B-Entity
usual	I-Entity
browser	I-Entity
traffic	I-Entity
and	I-Entity
the	I-Entity
malware	I-Entity
communicates	B-Action
to	B-Modifier
the	B-Entity
browser	I-Entity
by	O
named	O
pipe	O
.	O
It	O
is	O
by	O
far	O
a	O
more	O
complex	O
userland	O
design	O
than	O
Agent.BTZ	O
.	O
These	O
differences	O
,	O
mainly	O
the	O
more	O
complex	O
design	O
,	O
lead	O
us	O
to	O
give	O
this	O
malware	O
a	O
new	O
name	O
.	O
The	O
analyzed	O
dropper	O
of	O
v3.25	O
has	O
a	O
compilation	O
date	O
of	O
February	O
6th	O
2014	O
.	O
The	O
more	O
recent	O
dropper	O
of	O
v3.26	O
,	O
which	O
has	O
all	O
the	O
mentioned	O
changes	O
implemented	O
,	O
reveals	O
a	O
compilation	O
date	O
of	O
January	O
3rd	O
2013	O
.	O
We	O
suspect	O
that	O
this	O
date	O
is	O
spoofed	O
in	O
order	O
to	O
disguise	O
that	O
this	O
is	O
in	O
fact	O
a	O
newer	O
version	O
.	O
This	O
analysis	O
shows	O
that	O
even	O
after	O
the	O
Uroburos	O
publication	O
in	O
February	O
2014	O
,	O
the	B-Entity
group	I-Entity
behind	I-Entity
this	I-Entity
piece	I-Entity
of	I-Entity
malware	I-Entity
seems	O
to	O
be	O
still	O
active	O
.	O
In	O
any	O
case	O
,	O
the	O
ComRAT	O
developers	O
implemented	O
new	O
mechanisms	O
,	O
changed	O
keys	O
,	O
removed	O
log	O
files	O
to	O
hide	O
their	O
activities	O
and	O
tried	O
to	O
disguise	B-Action
the	B-Entity
connections	I-Entity
between	I-Entity
the	I-Entity
RAT	I-Entity
ComRAT	I-Entity
,	O
the	O
rootkit	O
Uroburos	O
and	O
the	O
RAT	O
Agent.BTZ	O
as	O
much	O
as	O
possible	O
.	O
However	O
,	O
we	O
can	O
still	O
follow	O
the	O
evolution	O
of	O
the	O
malware	O
by	O
comparing	O
the	O
versions	O
.	O
The	B-Entity
persistence	I-Entity
mechanism	I-Entity
discovered	I-Entity
in	I-Entity
October	I-Entity
2014	I-Entity
makes	B-Action
it	B-Entity
possible	O
to	O
intrude	O
into	O
a	O
system	O
in	O
a	O
really	O
discreet	O
manner	O
and	O
we	O
estimate	O
that	O
other	O
actors	O
will	O
use	B-Action
the	B-Entity
same	I-Entity
persistence	I-Entity
mechanism	I-Entity
in	I-Entity
the	I-Entity
near	I-Entity
future	I-Entity
.	O
We	O
will	O
definitely	O
keep	O
our	O
ears	O
and	O
eyes	O
open	O
and	O
continue	O
analyzing	O
.	O
Cyber	O
Squared	O
Inc.	O
's	O
ThreatConnect	O
Intelligence	O
Research	O
Team	O
(	O
TCIRT	O
)	O
tracks	O
a	O
number	O
of	O
threat	O
groups	O
around	O
the	O
world	O
.	O
Beginning	O
in	O
the	O
summer	O
of	O
2013	O
,	O
TCIRT	O
identified	O
a	O
suspected	O
Pakistani-origin	O
threat	O
group	O
.	O
This	O
group	O
was	O
revealed	O
by	O
TCIRT	O
publicly	O
in	O
August	O
2013	O
.	O
In	O
the	O
months	O
following	O
the	O
disclosure	O
,	O
we	O
identified	O
new	O
activity	O
.	O
Cyber	O
Squared	O
partnered	O
with	O
experts	O
at	O
FireEye	O
Labs	O
to	O
examine	O
these	O
new	O
observations	O
in	O
an	O
attempt	O
to	O
discover	O
new	O
research	O
and	O
insight	O
into	O
the	O
group	O
and	O
its	O
Operation	O
''	O
Arachnophobia	O
''	O
.	O
The	O
following	O
report	O
is	O
a	O
product	O
of	O
collaborative	O
research	O
and	O
threat	O
intelligence	O
sharing	O
between	O
Cyber	O
Squared	O
Inc.	O
's	O
TCIRT	O
and	O
FireEye	O
Labs	O
.	O
•	O
While	O
we	O
are	O
not	O
conclusively	O
attributing	O
BITTERBUG	O
activity	O
to	O
Tranchulas	O
or	O
a	O
specific	O
Pakistani	O
entity	O
,	O
we	O
can	O
confidently	O
point	O
to	O
many	O
characteristics	O
of	O
a	O
Pakistan-based	O
cyber	O
exploitation	O
effort	O
that	O
is	O
probably	O
directed	O
against	O
Indian	O
targets	O
and/or	O
those	O
who	O
are	O
involved	O
in	O
India-Pakistan	O
issues	O
.	O
•	O
The	O
threat	O
actors	O
utilized	O
a	O
hosting	O
provider	O
that	O
is	O
a	O
Pakistani-based	O
company	O
with	O
subleased	O
VPS	O
space	O
within	O
the	O
U.S.	O
for	O
command	O
and	O
control	O
(	O
C2	O
)	O
.	O
•	O
The	O
customized	O
malware	O
(	O
BITTERBUG	O
)	O
used	O
by	O
these	O
threat	O
actors	O
has	O
only	O
been	O
observed	O
hosted	O
on	O
and	O
communicating	B-Action
with	B-Modifier
two	B-Entity
IP	I-Entity
addresses	I-Entity
operated	I-Entity
by	O
a	O
Pakistan-based	O
hosting	O
provider	O
.	O
•	O
Early	O
variants	O
of	O
the	O
BITTERBUG	O
malware	O
had	O
build	O
paths	O
containing	O
the	O
strings	O
''	O
Tranchulas	O
''	O
and	O
''	O
umairaziz27	O
''	O
.	O
Tranchulas	O
is	O
the	O
name	O
of	O
a	O
Pakistani	O
security	O
firm	O
;	O
Umair	O
Aziz	O
is	O
the	O
name	O
of	O
a	O
Tranchulas	O
employee	O
.	O
•	O
Following	O
the	O
release	O
of	O
our	O
blog	O
post	O
highlighting	O
this	O
activity	O
and	O
the	O
malware	O
's	O
build	O
strings	O
,	O
the	O
threat	O
actors	O
appear	O
to	O
have	O
modified	O
their	O
binary	O
file	O
paths	O
to	O
make	O
them	O
more	O
generic	O
.	O
•	O
Employees	O
at	O
both	O
the	O
Pakistan-based	O
hosting	O
provider	O
and	O
Tranchulas	O
appear	O
within	O
each	O
others	O
'	O
social	O
networks	O
.	O
On	O
August	O
2	O
,	O
2013	O
,	O
the	O
TCIRT	O
published	O
the	O
blog	O
''	O
Where	O
There	O
is	O
Smoke	O
,	O
There	O
is	O
Fire	O
:	O
South	O
Asian	O
Cyber	O
Espionage	O
Heats	O
Up	O
''	O
in	O
which	O
TCIRT	O
identified	O
custom	O
malware	O
,	O
later	O
dubbed	O
BITTERBUG	O
by	O
FireEye	O
,	O
suspected	O
to	O
be	O
linked	O
to	O
Pakistani-based	O
exploitation	O
activity	O
directed	O
against	O
Indian	O
entities	O
.	O
We	O
found	O
debug	O
path	O
references	O
to	O
''	O
Tranchulas	O
''	O
,	O
which	O
is	O
also	O
the	O
name	O
of	O
a	O
Pakistani	O
security	O
company	O
.	O
Tranchulas	O
claims	O
to	O
support	O
''	O
national	O
level	O
cyber	O
security	O
programs	O
''	O
and	O
the	O
development	O
of	O
offensive	O
and	O
defensive	O
cyber	O
capabilities	O
.	O
At	O
the	O
time	O
,	O
the	O
incident	O
seemed	O
to	O
be	O
an	O
isolated	O
one	O
for	O
TCIRT	O
,	O
but	O
it	O
was	O
only	O
the	O
beginning	O
.	O
Our	O
suspicions	O
of	O
Tranchulas	O
'	O
involvement	O
in	O
the	O
activity	O
began	O
to	O
mount	O
,	O
based	O
on	O
a	O
series	O
of	O
events	O
that	O
occurred	O
both	O
before	O
and	O
after	O
the	O
release	O
of	O
our	O
blog	O
post	O
.	O
During	O
the	O
past	O
year	O
,	O
we	O
communicated	O
with	O
Tranchulas	O
and	O
the	O
Pakistan-based	O
hosting	O
provider	O
.	O
Suspicious	O
responses	O
and	O
oddly	O
similar	O
replies	O
received	O
from	O
both	O
companies	O
to	O
our	O
inquiries	O
,	O
as	O
well	O
as	O
anomalies	O
in	O
their	O
email	O
headers	O
,	O
prompted	O
us	O
to	O
research	O
the	O
companies	O
further	O
.	O
Our	O
research	O
revealed	O
:	O
•	O
The	O
C2	O
hosting	O
provider	O
(	O
VPSNOC	O
)	O
has	O
likely	O
been	O
conducting	O
business	O
operations	O
from	O
within	O
Pakistan	O
,	O
subleasing	O
infrastructure	O
from	O
U.S.	O
providers	O
.	O
•	O
VPNSOC	O
and	O
Tranchulas	O
employees	O
have	O
maintained	O
some	O
type	O
of	O
undefined	O
relationship	O
given	O
connections	O
via	O
social	O
media	O
.	O
•	O
Both	O
organizations	O
have	O
employed	O
or	O
are	O
affiliated	O
with	O
personnel	O
who	O
have	O
offensive	O
cyber	O
expertise	O
.	O
•	O
When	O
TCIRT	O
was	O
initially	O
contacted	O
by	O
Tranchulas	O
following	O
our	O
original	O
blog	O
post	O
,	O
they	O
denied	O
any	O
involvement	O
in	O
the	O
activity	O
.	O
Tranchulas	O
maintained	O
that	O
they	O
were	O
being	O
framed	O
,	O
and	O
that	O
they	O
were	O
already	O
aware	O
of	O
the	O
activity	O
prior	O
to	O
both	O
our	O
blog	O
post	O
and	O
our	O
contact	O
.	O
However	O
,	O
inconsistencies	O
in	O
their	O
claims	O
and	O
their	O
responses	O
made	O
such	O
a	O
scenario	O
questionable	O
.	O
TCIRT	O
began	O
tracking	O
a	O
set	O
of	O
activity	O
involving	O
a	O
BITTERBUG	O
variant	O
in	O
May	O
2013	O
.	O
To	O
our	O
knowledge	O
this	O
customized	O
malware	O
has	O
only	O
ever	O
been	O
observed	O
hosted	O
on	O
and	O
communicating	B-Action
with	B-Modifier
two	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
nodes	I-Entity
:	O
199.91.173.43	O
and	O
199.91.173.45	O
.	O
According	O
to	O
Whois	O
records	O
,	O
those	O
IP	O
addresses	O
were	O
registered	O
to	O
a	O
web-hosting	O
firm	O
in	O
Kansas	O
City	O
,	O
Missouri	O
.	O
Based	O
on	O
public	O
records	O
,	O
this	O
organization	O
appears	O
to	O
be	O
a	O
legal	O
entity	O
chartered	O
to	O
conduct	O
business	O
in	O
Missouri	O
.	O
On	O
July	O
24	O
,	O
2013	O
,	O
TCIRT	O
contacted	O
the	O
Kansas	O
City-based	O
hosting	O
provider	O
to	O
notify	O
them	O
of	O
the	O
malicious	O
activities	O
emanating	O
from	O
IP	O
address	O
199.91.173.43	O
.	O
The	O
hosting	O
provider	O
subsequently	O
introduced	O
TCIRT	O
to	O
their	O
client	O
VPNSOC	O
,	O
the	O
customer	O
responsible	O
for	O
subleasing	O
the	O
IP	O
address	O
.	O
Later	O
that	O
day	O
,	O
TCIRT	O
received	O
a	O
response	O
from	O
support	O
@	O
vpsnoc.com	O
providing	O
limited	O
information	O
on	O
the	O
server	O
and	O
related	O
traffic	O
(	O
Figure	O
2	O
)	O
.	O
When	O
TCIRT	O
sent	O
follow-up	O
communications	O
,	O
VPSNOC	O
did	O
not	O
respond	O
,	O
further	O
increasing	O
our	O
suspicions	O
.	O
While	O
reviewing	O
the	O
metadata	O
of	O
VPSNOC	O
's	O
July	O
24	O
,	O
2013	O
email	O
response	O
,	O
we	O
noticed	O
the	O
email	O
was	O
sent	O
from	O
a	O
+0500	O
time	O
zone	O
.	O
This	O
time	O
zone	O
usage	O
is	O
consistent	O
with	O
Pakistan	O
's	O
time	O
zone	O
.	O
The	O
TCIRT	O
published	O
details	O
of	O
the	O
initial	O
activity	O
in	O
the	O
aforementioned	O
blog	O
post	O
on	O
August	O
2	O
,	O
2013	O
.	O
Four	O
days	O
later	O
on	O
August	O
,	O
2013	O
,	O
the	O
Tranchulas	O
Chief	O
Executive	O
Officer	O
,	O
Zubair	O
Khan	O
,	O
contacted	O
us	O
regarding	O
the	O
blog	O
post	O
and	O
its	O
subsequent	O
press	O
coverage	O
.	O
Khan	O
submitted	O
''	O
ResponseThreatConnect.docx	O
''	O
as	O
an	O
explanation	O
of	O
the	O
observed	O
activity	O
to	O
both	O
the	O
media	O
and	O
the	O
TCIRT	O
indicating	O
that	O
the	O
debug	O
paths	O
using	O
''	O
Tranchulas	O
''	O
and	O
''	O
umairaziz27	O
''	O
was	O
''	O
done	O
by	O
developer	O
of	O
malware	O
to	O
portray	O
wrong	O
impression	O
about	O
Tranchulas	O
and	O
mislead	O
malware	O
analysts	O
''	O
.	O
Notably	O
,	O
Khan	O
included	O
a	O
screenshot	O
of	O
an	O
email	O
message	O
.	O
The	O
message	O
was	O
reportedly	O
a	O
response	O
from	O
VPSNOC	O
to	O
an	O
email	O
message	O
from	O
Tranchulas	O
sent	O
on	O
July	O
21	O
,	O
2013	O
,	O
purportedly	O
to	O
notify	O
VPSNOC	O
of	O
the	O
same	O
malicious	O
activity	O
identified	O
by	O
TCIRT	O
.	O
However	O
,	O
we	O
noted	O
certain	O
anomalies	O
in	O
this	O
message	O
.	O
As	O
seen	O
in	O
Figure	O
3	O
the	O
''	O
email	O
message	O
''	O
was	O
''	O
sent	O
''	O
to	O
VPSNOC	O
from	O
an	O
unidentified	O
tranchulas.com	O
email	O
address	O
on	O
''	O
Tue	O
,	O
Jul	O
21	O
,	O
2013	O
at	O
11:36	O
PM	O
.	O
''	O
July	O
21	O
,	O
2013	O
was	O
not	O
a	O
Tuesday	O
and	O
in	O
fact	O
was	O
a	O
Sunday	O
.	O
The	O
mismatched	O
date	O
suggests	O
that	O
this	O
email	O
message	O
was	O
potentially	O
modified	O
in	O
order	O
to	O
support	O
the	O
claim	O
that	O
Tranchulas	O
was	O
aware	O
of	O
,	O
and	O
had	O
already	O
reported	O
the	O
exploitation	O
activity	O
.	O
TCIRT	O
speculates	O
that	O
''	O
Tuesday	O
''	O
was	O
hastily	O
chosen	O
because	O
our	O
own	O
official	O
notification	O
to	O
VPSNOC	O
was	O
sent	O
on	O
Wednesday	O
the	O
24th	O
.	O
In	O
addition	O
,	O
the	O
''	O
response	O
''	O
received	O
by	O
Tranchulas	O
is	O
nearly	O
identical	O
to	O
that	O
received	O
by	O
TCIRT	O
.	O
We	O
believe	O
that	O
Tranchulas	O
may	O
have	O
obtained	O
information	O
about	O
TCIRT	O
's	O
notification	O
to	O
VPSNOC	O
through	O
a	O
pre-established	O
relationship	O
.	O
The	O
TCIRT	O
responded	O
to	O
Mr.	O
Khan	O
's	O
official	O
explanation	O
with	O
a	O
follow-up	O
inquiry	O
,	O
offering	O
Khan	O
an	O
opportunity	O
to	O
explain	O
the	O
notable	O
date	O
inconsistency	O
within	O
the	O
email	O
screenshot	O
.	O
The	O
TCIRT	O
also	O
requested	O
that	O
Mr.	O
Khan	O
share	O
the	O
actual	O
email	O
message	O
with	O
the	O
original	O
attached	O
headers	O
.	O
Mr.	O
Khan	O
did	O
not	O
address	O
the	O
TCIRT	O
question	O
,	O
but	O
rather	O
deferred	O
our	O
request	O
to	O
Mr.	O
Hamza	O
Qamar	O
,	O
a	O
Penetration	O
Testing	O
Team	O
Lead	O
at	O
Tranchulas	O
.	O
On	O
August	O
15	O
,	O
2013	O
,	O
three	O
days	O
later	O
,	O
Qamar	O
responded	O
to	O
TCIRT	O
with	O
a	O
brief	O
denial	O
of	O
any	O
modifications	O
to	O
the	O
screenshot	O
(	O
other	O
than	O
email	O
address	O
anonymization	O
)	O
and	O
specifically	O
referred	O
TCIRT	O
back	O
to	O
VPSNOC	O
support	O
(	O
support	O
@	O
vpsnoc.com	O
)	O
for	O
any	O
follow	O
up	O
questions	O
.	O
Astonished	O
by	O
this	O
dismissal	O
and	O
deflection	O
,	O
TCIRT	O
immediately	O
began	O
to	O
explore	O
the	O
relationship	O
between	O
VPSNOC	O
and	O
Tranchulas	O
.	O
During	O
our	O
research	O
into	O
VPSNOC	O
,	O
we	O
identified	O
that	O
it	O
is	O
actually	O
based	O
in	O
,	O
or	O
conducts	O
partial	O
operations	O
from	O
within	O
,	O
Pakistan	O
.	O
The	O
company	O
only	O
gives	O
the	O
impression	O
of	O
operating	O
from	O
Kansas	O
City	O
through	O
marketing	O
and	O
the	O
use	O
of	O
leased	O
IP	O
space	O
(	O
Figure	O
4	O
)	O
.	O
The	O
Whois	O
records	O
for	O
vpsnoc.com	O
revealed	O
that	O
the	O
domain	O
was	O
registered	O
by	O
Digital	O
Linx	O
Hosting	O
.	O
Digital	O
Linx	O
is	O
also	O
a	O
Pakistan-based	O
hosting	O
company	O
(	O
Figure	O
5	O
)	O
.	O
As	O
seen	O
in	O
Figure	O
6	O
,	O
the	O
administrative	O
email	O
address	O
is	O
admin	O
@	O
digitallinx.org	O
.	O
This	O
is	O
the	O
same	O
registrant	O
record	O
for	O
the	O
digitallinx.net	O
domain	O
.	O
The	O
domains	O
digitillinx.org	O
,	O
digitallinx.net	O
,	O
and	O
digitallinx.com	O
share	O
current	O
and	O
historical	O
similarities	O
in	O
their	O
WHOIS	O
records	O
and	O
sitemap.xml	O
files	O
that	O
imply	O
they	O
are	O
all	O
controlled	O
by	O
the	O
same	O
individual	O
or	O
entity	O
.	O
The	O
domain	O
digitallinx.com	O
is	O
registered	O
to	O
Muhammad	O
Naseer	O
Bhatti	O
(	O
Digital	O
Linx	O
Founder	O
)	O
who	O
uses	O
email	O
addresses	O
naseer	O
@	O
digitallinx.com	O
and	O
nbhatti	O
@	O
gmail.com	O
.	O
The	O
domain	O
is	O
also	O
registered	O
to	O
the	O
address	O
638-F	O
Johar	O
Town	O
,	O
Lahore	O
Pakistan	O
.	O
The	O
contact	O
telephone	O
number	O
listed	O
on	O
Digital	O
Linx	O
'	O
web	O
site	O
is	O
925-665-1427	O
(	O
Figure	O
6	O
)	O
,	O
and	O
is	O
also	O
used	O
in	O
the	O
WHOIS	O
record	O
for	O
defiantmarketing.com	O
.	O
The	O
domain	O
defiantmarketing.com	O
is	O
registered	O
to	O
Abunasar	O
Khan	O
.	O
The	O
registration	O
lists	O
VPSNOC	O
as	O
the	O
registrant	O
organization	O
,	O
abunasar	O
@	O
yahoo.com	O
as	O
the	O
registration	O
email	O
address	O
,	O
and	O
House	O
12	O
,	O
Street	O
21	O
,	O
F-8/1	O
Islamabad	O
Federal	O
44000	O
as	O
the	O
registration	O
address	O
.	O
Abunasar	O
Khan	O
has	O
been	O
observed	O
using	O
the	O
aliases	O
''	O
agnosticon	O
''	O
and	O
''	O
agnostic	O
''	O
.	O
From	O
this	O
we	O
were	O
able	O
to	O
locate	O
an	O
advertisement	O
in	O
the	O
Blackhatworld	O
forum	O
from	O
April	O
2012	O
posted	O
by	O
agnosticon	O
promoting	O
VPSNOC	O
and	O
identifying	O
it	O
as	O
a	O
subdivision	O
of	O
Digital	O
Linx	O
Hosting	O
(	O
Figure	O
7	O
)	O
.	O
Though	O
none	O
of	O
this	O
information	O
is	O
surprising	O
,	O
it	O
further	O
suggests	O
that	O
both	O
Bhatti	O
and	O
Abunasar	O
Khan	O
work	O
or	O
worked	O
for	O
Digital	O
Linx	O
and	O
VPSNOC	O
and	O
during	O
that	O
time	O
were	O
both	O
located	O
in	O
Pakistan	O
.	O
Additional	O
research	O
into	O
Abunasar	O
Khan	O
identified	O
several	O
registered	O
domains	O
and	O
fragments	O
of	O
his	O
online	O
presence	O
.	O
Based	O
on	O
his	O
websites	O
and	O
account	O
information	O
,	O
he	O
appears	O
to	O
have	O
an	O
interest	O
or	O
participated	O
in	O
the	O
Antisec	O
and	O
Anonymous	O
movements	O
(	O
Figure	O
8	O
)	O
.	O
He	O
also	O
used	O
''	O
anony	O
mo	O
us	O
''	O
in	O
the	O
registration	O
name	O
field	O
of	O
a	O
personal	O
account	O
.	O
In	O
addition	O
,	O
Abunasar	O
Khan	O
's	O
Google+	O
profile	O
revealed	O
connections	O
to	O
at	O
least	O
one	O
Tranchulas	O
employee	O
,	O
Hamza	O
Qamar	O
and	O
a	O
Digital	O
Linx	O
employee	O
,	O
Shoaib	O
Riaz	O
.	O
Hamza	O
Qamar	O
,	O
the	O
Team	O
Lead	O
for	O
Penetration	O
Testing	O
at	O
Tranchulas	O
,	O
with	O
whom	O
TCIRT	O
last	O
spoke	O
.	O
Visiting	O
Hamza	O
Qamar	O
's	O
Google+	O
page	O
(	O
Figure	O
9	O
)	O
,	O
the	O
only	O
directly	O
connected	O
person	O
was	O
Abunasar	O
Khan	O
.	O
At	O
this	O
point	O
,	O
it	O
shows	O
that	O
a	O
probable	O
VPNSOC	O
employee	O
with	O
ties	O
or	O
interests	O
in	O
hacking	O
has	O
an	O
undefined	O
but	O
potentially	O
close	O
relationship	O
with	O
Hamza	O
Qamar	O
,	O
the	O
Penetration	O
Testing	O
employee	O
from	O
Tranchulas	O
.	O
Qamar	O
indicated	O
on	O
his	O
public	O
LinkedIn	O
profile	O
that	O
he	O
''	O
engaged	O
in	O
system	O
and	O
enterprise	O
level	O
network	O
and	O
Web	O
application	O
security	O
testing	O
for	O
clients	O
ranging	O
from	O
large	O
federal	O
agencies	O
,	O
DoD	O
,	O
and	O
commercial	O
clients	O
''	O
,	O
though	O
it	O
is	O
unclear	O
which	O
''	O
DoD	O
''	O
is	O
referenced	O
(	O
e.g.	O
,	O
whether	O
the	O
Pakistani	O
Ministry	O
of	O
Defense	O
or	O
some	O
other	O
nation	O
's	O
defense	O
department	O
)	O
.	O
Tranchulas	O
identifies	O
government	O
(	O
presumably	O
Pakistan	O
's	O
government	O
)	O
as	O
an	O
operational	O
sector	O
for	O
its	O
work	O
.	O
Tranchulas	O
'	O
offensive	O
cyber	O
initiative	O
services	O
are	O
offered	O
to	O
''	O
national-level	O
cyber	O
security	O
programs	O
''	O
indicating	O
commercial	O
demand	O
from	O
''	O
national-level	O
''	O
customers	O
.	O
Though	O
Tranchulas	O
brands	O
itself	O
as	O
a	O
multi-national	O
company	O
,	O
with	O
respective	O
addresses	O
within	O
the	O
United	O
Kingdom	O
,	O
the	O
United	O
States	O
,	O
and	O
New	O
Zealand	O
.	O
We	O
found	O
evidence	O
that	O
these	O
addresses	O
are	O
all	O
associated	O
with	O
either	O
virtual	O
office	O
spaces	O
or	O
address	O
forwarding	O
services	O
.	O
For	O
further	O
background	O
information	O
on	O
these	O
personas	O
,	O
please	O
see	O
Appendix	O
F	O
:	O
Personas	O
.	O
The	O
following	O
is	O
a	O
summary	O
of	O
the	O
relationships	O
between	O
the	O
hosting	O
organizations	O
and	O
Tranchulas	O
:	O
•	O
VPNSOC	O
IP	O
space	O
was	B-Action
used	I-Action
as	B-Modifier
command	B-Entity
and	I-Entity
control	I-Entity
nodes	I-Entity
for	I-Entity
attackers	I-Entity
using	I-Entity
variants	I-Entity
of	I-Entity
the	I-Entity
BITTERBUG	I-Entity
malware	I-Entity
that	O
contained	O
build	O
strings	O
that	O
referenced	O
''	O
Tranchulas	O
''	O
and	O
a	O
Tranchulas	O
employee	O
.	O
•	O
Tranchulas	O
and	O
VPNSOC	O
were	O
in	O
direct	O
communication	O
at	O
some	O
point	O
in	O
July-August	O
2013	O
.	O
•	O
VPNSOC	O
is	O
a	O
subsidiary	O
of	O
Digital	O
Linx	O
.	O
•	O
Tranchulas	O
,	O
VPNSOC	O
,	O
Digital	O
Linx	O
were	O
all	O
physically	O
located	O
in	O
Pakistan	O
but	O
maintained	O
virtual	O
presence	O
within	O
the	O
U.S.	O
•	O
Hamza	O
Qamar	O
was	O
an	O
employee	O
of	O
Tranchulas	O
.	O
•	O
Muhammad	O
Naseer	O
Bhatti	O
was	O
the	O
self-proclaimed	O
founder	O
of	O
Digital	O
Linx	O
.	O
•	O
Abunasar	O
Khan	O
was	O
affiliated	O
with	O
AntiSec	O
and	O
VPNSOC	O
.	O
•	O
Digital	O
Linx	O
founder	O
Muhammad	O
Naseer	O
Bhatti	O
had	O
at	O
least	O
a	O
working	O
relationship	O
with	O
VPNSOC	O
employee	O
Abunasar	O
Khan	O
–	O
connected	O
through	O
domain	O
registrations	O
and	O
a	O
common	O
Google+	O
profile	O
for	O
Shoaib	O
Riaz	O
(	O
another	O
Digital	O
Linx	O
employee	O
)	O
.	O
•	O
VPNSOC	O
employee	O
Abunasar	O
Khan	O
had	O
a	O
direct	O
connection	O
to	O
Tranchulas	O
employee	O
Hamza	O
Qamar	O
through	O
Google+	O
.	O
Note	O
:	O
A	O
walkthrough	O
of	O
our	O
research	O
is	O
available	O
in	O
Appendices	O
C	O
,	O
D	O
and	O
E.	O
Metadata	O
Analysis	O
:	O
As	O
mentioned	O
earlier	O
,	O
during	O
the	O
email	O
exchanged	O
with	O
Zubair	O
Khan	O
,	O
he	B-Entity
sent	I-Entity
TCIRT	I-Entity
a	I-Entity
Microsoft	I-Entity
Word	I-Entity
document	I-Entity
(	I-Entity
.docx	I-Entity
)	I-Entity
.	O
In	O
reviewing	O
the	O
document	O
metadata	O
for	O
''	O
ResponseThreatConnect.docx	O
''	O
,	O
TCIRT	O
identified	O
that	O
it	O
contained	O
the	O
creator	O
properties	O
of	O
''	O
hp	O
.	O
''	O
TCIRT	O
compared	O
the	O
metadata	O
of	O
two	O
benign	B-Entity
BITTERBUG-associated	I-Entity
decoy	I-Entity
documents	I-Entity
from	O
July	O
2013	O
and	O
found	O
that	O
both	O
also	O
had	O
the	O
author	O
of	O
''	O
hp	O
''	O
(	O
Figure	O
10	O
)	O
.	O
While	O
the	O
author	O
field	O
of	O
''	O
hp	O
''	O
does	O
n't	O
conclusively	O
prove	O
a	O
relationship	O
,	O
it	O
contributes	O
to	O
the	O
body	O
of	O
circumstantial	O
evidence	O
which	O
links	O
properties	O
of	O
the	O
official	O
Tranchulas	O
response	O
to	O
the	O
properties	O
of	O
decoy	O
documents	O
that	O
were	O
used	O
in	O
conjunction	O
with	O
BITTERBUG	O
targeting	O
campaigns	O
.	O
CyberSquared	O
Inc.	O
partnered	O
with	O
FireEye	O
for	O
a	O
second	O
technical	O
review	O
of	O
the	O
malware	O
associated	O
with	O
this	O
activity	O
.	O
FireEye	O
analyzed	O
the	O
malware	O
,	O
which	O
they	O
call	O
BITTERBUG	O
,	O
and	O
determined	O
it	O
to	O
be	O
a	O
custom	O
backdoor	O
.	O
The	B-Entity
backdoor	I-Entity
relies	B-Action
on	B-Modifier
various	B-Entity
support	I-Entity
components	I-Entity
,	O
including	O
the	O
non-malicious	O
,	O
publically	O
available	O
Libcurl	O
for	O
installation	O
,	O
launch	O
,	O
and	O
communications	O
.	O
In	O
some	O
variants	O
,	O
BITTERBUG	O
has	O
the	O
ability	O
to	O
automatically	O
target	O
and	O
exfiltrate	B-Action
files	B-Entity
with	O
extensions	O
such	O
as	O
.doc	O
,	O
.xls	O
,	O
.pdf	O
,	O
.ppt	O
,	O
.egm	O
,	O
and	O
.xml	O
.	O
The	O
full	O
malware	O
report	O
is	O
included	O
in	O
Appendix	O
A	O
:	O
Malware	O
Details	O
.	O
The	O
earliest	O
evidence	O
of	O
the	O
malware	O
family	O
dates	O
to	O
April	O
2013	O
,	O
based	O
on	O
the	O
Portable	O
Executable	O
(	O
PE	O
)	O
compile	O
times	O
,	O
with	O
more	O
than	O
10	O
BITTERBUG	O
variants	O
observed	O
to	O
date	O
.	O
The	O
earliest	O
samples	O
of	O
BITTERBUG	O
contain	O
the	O
''	O
Tranchulas	O
''	O
debug	O
path	O
(	O
below	O
)	O
,	O
as	O
mentioned	O
in	O
the	O
August	O
2013	O
TCIRT	O
blog	O
post	O
.	O
These	O
BITTERBUG	O
variants	O
were	O
probably	O
used	O
in	O
attacks	O
around	O
summer	O
2013	O
,	O
using	O
possible	O
lures	O
related	O
to	O
the	O
then-recent	O
death	O
of	O
''	O
Sarabjit	O
Singh	O
''	O
(	O
an	O
Indian	O
national	O
imprisoned	O
in	O
Pakistan	O
)	O
and	O
an	O
Indian	O
Government	O
pension	O
memorandum	O
.	O
As	O
stated	O
in	O
the	O
original	O
blog	O
(	O
and	O
raised	O
in	O
the	O
formal	O
Tranchulas	O
response	O
)	O
,	O
several	O
binaries	O
contain	O
references	O
to	O
''	O
Cath	O
''	O
in	O
the	O
debug	O
path	O
.	O
It	O
is	O
important	O
to	O
note	O
that	O
the	O
''	O
Cath	O
''	O
files	O
are	O
support	O
components	O
and	O
not	O
BITTERBUG	O
variants	O
,	O
so	O
it	O
is	O
probable	O
that	O
these	O
were	O
developed	O
by	O
another	O
party	O
but	O
are	O
a	O
required	O
component	O
of	O
the	O
family	O
.	O
Additional	O
BITTERBUG	O
variants	O
were	O
compiled	O
in	O
June	O
and	O
July	O
2013	O
that	O
contained	O
different	O
identifiers	O
in	O
the	O
debug	O
paths	O
:	O
''	O
Cert-India	O
''	O
(	O
3	B-Entity
samples	I-Entity
)	I-Entity
and	I-Entity
''	I-Entity
umairaziz27	I-Entity
''	I-Entity
(	I-Entity
1	I-Entity
sample	I-Entity
)	I-Entity
.	O
The	O
presence	O
of	O
''	O
umairaziz27	O
''	O
in	O
a	O
debug	O
path	O
from	O
one	O
sample	O
makes	O
us	O
wonder	O
if	O
this	O
represents	O
an	O
operational	O
security	O
mistake	O
.	O
The	O
debug	O
path	O
of	O
''	O
umairaziz27	O
''	O
led	O
us	O
to	O
Twitter	O
and	O
LinkedIn	O
accounts	O
(	O
on	O
which	O
a	O
matching	O
alias	O
is	O
used	O
)	O
that	O
belong	O
to	O
a	O
Tranchulas	O
employee	O
named	O
Umair	O
Aziz	O
,	O
who	O
identified	O
himself	O
as	O
an	O
Information	O
Security	O
Analyst	O
and	O
graduate	O
of	O
National	O
University	O
of	O
Sciences	O
and	O
Technology	O
(	O
NUST	O
)	O
.	O
One	O
of	O
these	O
samples	O
was	O
probably	O
used	O
in	O
attacks	O
in	O
late	O
summer	O
2013	O
,	O
using	O
a	O
''	O
leaked	O
report	O
''	O
lure	O
which	O
contained	B-Action
a	B-Entity
decoy	I-Entity
document	I-Entity
related	I-Entity
to	I-Entity
Pakistan	I-Entity
's	O
alleged	O
inability	O
to	O
locate	O
Osama	O
Bin	O
Laden	O
.	O
After	O
publication	O
of	O
the	O
TCIRT	O
blog	O
and	O
our	O
communications	O
with	O
Tranchulas	O
occurred	O
in	O
August	O
2013	O
,	O
no	O
new	O
samples	O
of	O
BITTERBUG	O
or	O
its	O
support	O
components	O
(	O
based	O
on	O
compile	O
times	O
)	O
were	O
identified	O
until	O
September	O
(	O
various	O
support	O
components	O
)	O
and	O
October	O
(	O
a	O
new	O
BITTERBUG	O
variant	O
)	O
.	O
Interestingly	O
,	O
the	O
samples	O
compiled	O
following	O
the	O
blog	O
publication	O
used	O
entirely	O
new	O
and	O
generic	O
debug	O
paths	O
(	O
Figure	O
11	O
)	O
as	O
well	O
as	O
a	O
compilation	O
tactic	O
to	O
conceal	B-Action
the	B-Entity
C2	I-Entity
address	I-Entity
from	O
static	O
analysis	O
.	O
Between	O
September	O
and	O
December	O
,	O
we	O
observed	O
more	O
variations	O
of	O
BITTERBUG	O
and	O
its	O
support	O
components	O
in	O
terms	O
of	O
packaging	O
,	O
host-based	O
activities	O
,	O
and	O
decoys	O
(	O
or	O
the	O
lack	O
of	O
them	O
)	O
compared	O
to	O
the	O
samples	O
before	O
our	O
blog	O
post	O
.	O
This	O
could	O
indicate	O
that	O
the	O
threat	O
actors	O
were	O
aware	O
of	O
the	O
blog	O
post	O
and	O
modified	O
their	O
malware	O
and	O
related	O
components	O
to	O
distance	O
them	O
from	O
prior	O
indicators	O
.	O
Between	O
December	O
2013	O
and	O
late	O
March	O
2014	O
,	O
we	O
observed	O
several	O
new	O
lures	O
used	O
in	O
BITTERBUG	O
self-extracting	O
RAR	O
(	O
SFXRAR	O
)	O
files	O
.	O
One	O
from	O
December	O
contained	O
several	O
BITTERBUG	O
variants	O
and	O
used	B-Action
a	B-Entity
decoy	I-Entity
PDF	I-Entity
document	I-Entity
(	O
Figure	O
12	O
)	O
related	O
to	O
the	O
December	O
arrest	O
of	O
Devyani	O
Khobragade	O
,	O
an	O
Indian	O
diplomat	O
in	O
the	O
United	O
States	O
.	O
In	O
spring	O
2014	O
,	O
we	O
observed	O
a	O
SFXRAR	O
file	O
with	O
a	O
filename	O
lure	O
related	O
to	O
the	O
March	O
2014	O
disappearance	O
of	O
Malaysis	O
Airlines	O
Flight	O
370	O
(	O
cast	O
as	O
a	O
Pakistan-related	O
hijacking	O
)	O
.	O
This	O
SFXRAR	O
contained	O
the	O
latest	O
BITTERBUG	O
variant	O
,	O
which	O
had	O
new	O
dependencies	O
on	O
support	O
components	O
.	O
Interestingly	O
,	O
this	O
SFXRAR	O
's	O
filename	O
was	O
the	O
only	O
lure	O
element	O
related	O
to	O
the	O
MH370	O
event	O
;	O
it	O
did	O
not	O
contain	B-Action
a	B-Entity
decoy	I-Entity
document	I-Entity
.	O
We	O
provide	O
a	O
more	O
detailed	O
report	O
on	O
this	O
SFX	O
and	O
the	O
related	O
variant	O
in	O
Appendix	O
A	O
:	O
Malware	O
Details	O
.	O
BITTERBUG	O
continued	O
to	O
rely	O
on	O
the	O
same	O
network	O
behaviors	O
to	O
communicate	O
with	O
its	O
C2s	O
.	O
Connections	I-Entity
to	B-Modifier
its	B-Entity
C2	I-Entity
nodes	I-Entity
relied	I-Entity
on	I-Entity
PHP	I-Entity
and	O
used	O
communications	O
that	O
included	O
''	O
.php	O
?	O
compname=	O
''	O
and	O
''	O
.php	O
?	O
srs=	O
''	O
,	O
as	O
well	O
as	O
direct	O
file/component	O
retrieval	O
from	O
the	O
C2s	O
.	O
Though	O
many	O
of	O
the	O
samples	O
that	O
we	O
have	O
observed	O
use	O
direct	O
IPs	O
for	O
HTTP	O
communications	O
,	O
we	O
have	O
observed	O
more	O
limited	O
use	O
of	O
a	O
No-IP	O
domain	O
.	O
Operation	O
Arachnophobia	O
consists	O
of	O
an	O
apparent	O
targeted	O
exploitation	O
campaign	O
,	O
dating	O
back	O
to	O
early	O
2013	O
,	O
using	O
the	O
BITTERBUG	O
malware	O
family	O
and	O
seemingly	O
directed	O
against	O
entities	O
involved	O
in	O
India-Pakistan	O
issues	O
.	O
The	O
threat	O
actor	O
appears	O
to	O
have	O
exclusively	O
used	O
VPSNOC	O
,	O
a	O
probable	O
Pakistan-based	O
VPS	O
service	O
provider	O
who	O
leased	O
U.S.	O
hosting	O
services	O
,	O
for	O
both	O
the	O
delivery	O
and	O
C2	O
phases	O
of	O
attack	O
.	O
Research	O
later	O
identified	O
that	O
a	O
Pakistan-based	O
VPSNOC	O
representative	O
had	O
a	O
social	O
network	O
affiliation	O
with	O
a	O
Tranchulas	O
employee	O
as	O
well	O
as	O
apparent	O
affiliations	O
with	O
the	O
Anonymous	O
and	O
AntiSec	O
movements	O
.	O
After	O
the	O
August	O
6	O
,	O
2013	O
blog	O
,	O
Tranchulas	O
provided	O
TCIRT	O
and	O
the	O
media	O
an	O
official	O
statement	O
and	O
explanation	O
of	O
BITTERBUG	O
activity	O
,	O
however	O
,	O
this	O
explanation	O
contained	O
discrepancies	O
.	O
The	O
TCIRT	O
addressed	O
some	O
of	O
these	O
discrepancies	O
with	O
Tranchulas	O
personnel	O
,	O
who	O
were	O
unresponsive	O
,	O
increasing	O
our	O
suspicion	O
of	O
the	O
activity	O
.	O
We	O
later	O
observed	O
BITTERBUG	O
activity	O
following	O
August	O
2013	O
with	O
subtle	O
changes	O
that	O
further	O
generalized	O
debug	O
paths	O
.	O
It	O
was	O
this	O
chain	O
of	O
events	O
that	O
served	O
as	O
a	O
catalyst	O
for	O
extra	O
scrutiny	O
of	O
the	O
activity	O
and	O
collaboration	O
between	O
the	O
ThreatConnect	O
and	O
FireEye	O
Labs	O
teams	O
to	O
share	O
information	O
.	O
While	O
we	O
are	O
not	O
conclusively	O
attributing	O
BITTERBUG	O
activity	O
to	O
Tranchulas	O
or	O
a	O
specific	O
Pakistani	O
entity	O
,	O
we	O
can	O
confidently	O
point	O
to	O
many	O
characteristics	O
of	O
a	O
Pakistan-based	O
cyber	O
exploitation	O
effort	O
that	O
is	O
probably	O
directed	O
against	O
Indian	O
targets	O
or	O
those	O
who	O
are	O
involved	O
in	O
India-Pakistan	O
issues	O
.	O
Many	O
of	O
the	O
notable	O
characteristics	O
of	O
the	O
BITTERBUG	O
activity	O
suggest	O
that	O
this	O
is	O
indeed	O
part	O
of	O
a	O
Pakistan-based	O
cyber	O
exploitation	O
effort	O
that	O
has	O
apparently	O
attempted	O
to	O
obfuscate	B-Action
its	B-Entity
malware	I-Entity
characteristics	I-Entity
and	I-Entity
origins	I-Entity
(	I-Entity
behind	I-Entity
U.S.	I-Entity
infrastructure	I-Entity
)	I-Entity
,	O
before	O
and	O
after	O
public	O
disclosure	O
in	O
August	O
2013	O
.	O
On	O
the	O
surface	O
,	O
BITTERBUG	O
serves	B-Action
as	B-Modifier
an	B-Entity
example	I-Entity
of	I-Entity
how	I-Entity
threat	I-Entity
actors	I-Entity
mask	I-Entity
their	I-Entity
operations	I-Entity
across	I-Entity
social	I-Entity
,	O
cultural	O
and	O
geographic	O
boundaries	O
.	O
More	O
importantly	O
,	O
it	O
demonstrates	O
the	O
value	O
of	O
threat	O
intelligence	O
sharing	O
and	O
industry	O
collaboration	O
.	O
As	O
one	O
organization	O
begins	O
to	O
pull	O
at	O
a	O
thread	O
of	O
evidence	O
and	O
share	O
their	O
findings	O
with	O
another	O
,	O
a	O
larger	O
understanding	O
and	O
shared	O
perspective	O
is	O
revealed	O
.	O
It	O
is	O
through	O
this	O
process	O
that	O
a	O
shared	O
awareness	O
emerges	O
into	O
a	O
larger	O
,	O
more	O
comprehensive	O
story	O
that	O
explains	O
what	O
we	O
are	O
seeing	O
and	O
why	O
-	O
ultimately	O
it	O
is	O
this	O
story	O
that	O
better	O
serves	O
us	O
all	O
.	O
BITTERBUG	O
is	O
a	O
backdoor	O
executable	O
capable	O
of	O
uploading	O
and	O
downloading	B-Action
files	B-Entity
,	I-Entity
listing	I-Entity
running	I-Entity
processes	I-Entity
,	O
generating	O
file	O
listings	O
,	O
and	O
automatically	O
transferring	O
selected	O
files	O
to	O
its	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
(	I-Entity
C2	I-Entity
)	I-Entity
server	I-Entity
.	O
BITTERBUG	O
appears	O
to	O
be	O
virtual	O
machine	O
aware	O
and	O
may	O
not	O
execute	O
on	O
a	O
VMWare	O
or	O
VirtualBox	O
VM	O
.	O
We	O
have	O
observed	O
BITTERBUG	O
installed	O
by	O
a	O
self-extracting	O
RAR	O
archive	O
disguised	O
as	O
a	O
screensaver	O
.	O
Upon	O
execution	O
,	O
the	O
self-extracting	O
RAR	O
archive	O
may	O
extract	O
configuration	O
files	O
,	O
dependency	O
DLLs	O
,	O
and	O
the	O
BITTERBUG	O
executable	O
.	O
The	O
timeline	O
below	O
is	O
of	O
BITTERBUG	O
activity	O
from	O
May	O
2013	O
through	O
March	O
2014	O
.	O
Upon	O
execution	O
the	O
self-extracting	O
RAR	O
may	O
install	O
<	O
BITTERBUG	O
>	O
.exe	O
and	O
the	O
following	O
DLLs	O
:	O
The	O
self-extracting	O
RAR	O
may	O
install	B-Action
the	B-Entity
following	I-Entity
benign	I-Entity
configuration	I-Entity
files	I-Entity
:	O
BITTERBUG	O
first	O
may	O
execute	B-Action
the	B-Entity
following	I-Entity
Windows	I-Entity
Management	I-Entity
Instrumentation	I-Entity
(	I-Entity
WMI	I-Entity
)	I-Entity
command	I-Entity
to	I-Entity
detect	I-Entity
the	I-Entity
presence	I-Entity
of	I-Entity
a	I-Entity
virtual	I-Entity
machine	I-Entity
(	I-Entity
VM	I-Entity
)	I-Entity
:	O
BITTERBUG	O
then	O
may	O
open	B-Action
recovery.txt	B-Entity
and	I-Entity
check	I-Entity
for	I-Entity
the	I-Entity
presence	I-Entity
of	I-Entity
strings	I-Entity
VBox	I-Entity
or	I-Entity
VMware	I-Entity
.	O
The	O
backdoor	O
then	O
may	O
enter	O
an	O
infinite	O
sleep	O
loop	O
if	O
recovery.txt	O
contains	O
either	O
one	O
of	O
the	O
aforementioned	O
strings	O
(	O
Example	O
in	O
Figure	O
13	O
)	O
.	O
Next	O
BITTERBUG	O
typically	O
will	O
beacon	O
to	O
the	O
C2	O
server	O
by	O
sending	B-Action
the	B-Entity
computer	I-Entity
name	I-Entity
and	I-Entity
username	I-Entity
of	I-Entity
the	I-Entity
compromised	I-Entity
system	I-Entity
.	O
An	O
example	O
beacon	O
request	O
is	O
shown	O
in	O
Figure	O
14	O
.	O
BITTERBUG	O
then	O
may	O
perform	O
an	O
HTTP	O
GET	O
request	O
for	O
the	O
following	O
URI	O
:	O
If	O
the	O
C2	O
server	O
responds	O
with	O
a	O
filename	O
,	O
the	O
filename	O
received	O
is	O
deleted	B-Action
from	B-Modifier
%	B-Entity
APPDATA	I-Entity
%	I-Entity
\Microsoft	I-Entity
<	I-Entity
FILENAMEFROM	I-Entity
C2	I-Entity
>	O
.	O
The	O
purpose	O
of	O
this	O
command	O
might	O
be	O
to	O
delete	O
older	O
versions	O
of	O
BITTERBUG	O
,	O
although	O
we	O
have	O
not	O
observed	O
this	O
command	O
occurring	O
in	O
the	O
wild	O
.	O
BITTERBUG	O
then	O
may	O
attempt	O
to	O
download	B-Action
the	B-Entity
files	I-Entity
listed	O
in	O
Table	O
1	O
.	O
The	O
purpose	O
of	O
the	O
first	O
three	O
files	O
is	O
unknown	O
.	O
The	B-Entity
final	I-Entity
two	I-Entity
files	I-Entity
are	B-Action
downloaded	I-Action
to	B-Modifier
the	B-Entity
user	I-Entity
's	I-Entity
Startup	I-Entity
directory	I-Entity
and	I-Entity
executed	I-Entity
at	I-Entity
startup	I-Entity
in	B-Modifier
order	I-Modifier
to	I-Modifier
maintain	B-Entity
persistence	I-Entity
.	O
Next	O
,	O
BITTERBUG	O
may	O
scan	O
through	O
each	O
drive	O
letter	O
and	O
search	O
recursively	O
for	O
files	O
with	O
the	O
following	O
file	O
extensions	O
:	O
BITTERBUG	O
then	O
typically	O
creates	B-Action
a	B-Entity
file	I-Entity
list	I-Entity
containing	I-Entity
all	I-Entity
documents	I-Entity
(	O
excluding	O
those	O
whose	O
filename	O
contains	O
MediaUtils	O
)	O
to	O
the	O
following	O
locations	O
:	O
BITTERBUG	O
may	O
also	O
write	B-Action
a	B-Entity
list	I-Entity
of	I-Entity
all	I-Entity
running	I-Entity
processes	I-Entity
to	O
:	O
Finally	O
,	O
BITTERBUG	O
typically	O
uploads	B-Action
the	B-Entity
running	I-Entity
process	I-Entity
list	I-Entity
,	I-Entity
document	I-Entity
file	I-Entity
list	I-Entity
,	O
and	O
all	O
documents	O
to	O
the	O
following	O
URI	O
:	O
BITTERBUG	O
may	O
be	O
extracted	O
along	O
with	O
the	O
following	O
embedded	O
files	O
:	O
The	O
malware	O
may	O
create	O
the	O
following	O
files	O
:	O
•	O
The	B-Entity
malware	I-Entity
typically	I-Entity
communicates	I-Entity
on	I-Entity
TCP	I-Entity
port	I-Entity
80	I-Entity
:	O
•	O
The	O
malware	O
may	O
perform	B-Action
HTTP	B-Entity
requests	I-Entity
for	I-Entity
the	I-Entity
following	I-Entity
URIs	I-Entity
:	I-Entity
We	I-Entity
observed	I-Entity
other	I-Entity
interesting	I-Entity
operational	I-Entity
security-oriented	I-Entity
challenges	I-Entity
in	I-Entity
the	I-Entity
post-blog	I-Entity
post	I-Entity
samples	I-Entity
.	O
In	O
one	O
case	O
,	O
an	O
actor	O
appeared	O
to	O
manually	O
null	O
out	O
the	O
''	O
Cert-India	O
''	O
user	O
directory	O
in	O
one	O
of	O
the	O
file	O
paths	O
(	O
see	O
figures	O
15	O
and	O
16	O
below	O
)	O
contained	O
in	O
two	O
binaries	O
(	O
support	O
components	O
)	O
.	O
These	O
files	O
shared	O
the	O
same	O
import	O
hash	O
(	O
4e96e86db5a8a025b996aefdc218ff74	O
)	O
and	O
were	O
virtually	O
the	O
same	O
files	O
minus	O
modification	O
to	O
a	O
few	O
bytes	O
in	O
the	O
second	O
sample	O
.	O
As	O
these	O
samples	O
point	O
to	O
,	O
we	O
also	O
observed	O
use	O
of	O
the	O
C++	O
Boost	O
libraries	O
,	O
which	O
introduced	O
a	O
new	O
file	O
path	O
to	O
monitor	O
for	O
operational	O
security	O
purposes	O
.	O
We	O
observed	O
at	O
least	O
one	O
case	O
in	O
which	O
files	O
mixed	O
old	O
and	O
new	O
file	O
paths	O
,	O
as	O
seen	O
in	O
the	O
figures	O
17	O
and	O
18	O
below	O
.	O
In	O
both	O
cases	O
,	O
it	O
is	O
possible	O
that	O
the	O
actors	O
intentionally	O
did	O
this	O
in	O
an	O
attempt	O
to	O
mislead	O
further	O
research	O
efforts	O
into	O
post-blog	O
samples	O
or	O
cast	O
suspicion	O
on	O
''	O
Cert-India	O
''	O
as	O
a	O
more-revealing	O
element	O
.	O
For	O
example	O
,	O
analysis	O
of	O
files	O
deployed	O
alongside	O
the	O
nulled-out	O
''	O
Cert-India	O
''	O
sample	O
mentioned	O
above	O
revealed	O
a	O
lack	O
of	O
concern	O
over	O
the	O
same	O
string	O
.	O
Alternatively	O
,	O
these	O
inconsistencies	O
could	O
also	O
indicate	O
sloppy	O
tradecraft	O
and/or	O
teamwork	O
.	O
BITTERBUG	O
Hashes	O
BITTERBUG	O
and	O
Support	O
Component	O
Debug	O
Strings	O
(	O
in	O
order	O
of	O
first	O
use	O
)	O
BITTERBUG	O
Import	O
Hashes	B-Action
HTTP	B-Entity
Requests	I-Entity
BITTERBUG	I-Entity
Domain	I-Entity
&	I-Entity
IPs	I-Entity
The	O
Kansas-City-based	O
hosting	O
provider	O
sent	O
an	O
introductory	O
email	O
message	O
on	O
July	O
24th	O
,	O
2013	O
at	O
1500	O
CDT	O
and	O
would	O
be	O
received	O
by	O
TCIRT	O
at	O
1400	O
EDT	O
and	O
VPSNOC	O
on	O
Thursday	O
July	O
25th	O
,	O
2013	O
at	O
1200	O
PKT	O
.	O
Analysis	O
of	O
the	O
VPSNOC	O
email	O
header	O
indicated	O
that	O
the	O
message	O
was	O
sent	O
on	O
Thursday	O
25	O
July	O
at	O
02:28:41	O
+0500	O
GMT	O
,	O
which	O
is	O
consistent	O
with	O
Pakistan	O
's	O
time	O
zone	O
.	O
Of	O
note	O
,	O
the	O
email	O
message	O
was	O
sent	O
with	O
an	O
X-Originating	O
IP	O
Address	O
of	O
184.75.214.10	O
corresponding	O
to	O
a	O
Private	B-Entity
Internet	I-Entity
Access	I-Entity
Canadian	I-Entity
proxy	I-Entity
.	O
VPSNOC	O
's	O
use	O
of	O
this	O
commercial	O
proxy	O
service	O
likely	O
demonstrates	O
the	O
intent	O
to	O
mask	O
the	O
apparent	O
origin	O
of	O
the	O
sender	O
.	O
These	O
two	O
examples	O
highlight	O
that	O
VPSNOC	O
's	O
inbound	O
and	O
outbound	O
email	O
communications	O
consistently	O
utilized	O
a	O
+0500	O
Pakistani	O
timezone	O
.	O
Due	O
to	O
the	O
apparent	O
Pakistani	O
nexus	O
within	O
the	O
BITTERBUG	O
malware	O
and	O
the	O
Pakistan	O
time	O
zone	O
consistently	O
observed	O
within	O
the	O
VPSNOC	O
emails	O
,	O
the	O
TCIRT	O
applied	O
additional	O
scrutiny	O
and	O
research	O
of	O
the	O
content	O
within	O
the	O
Tranchulas	O
''	O
Response	O
ThreatConnect.docx	O
''	O
to	O
validate	O
their	O
claims	O
.	O
In	O
the	O
following	O
section	O
we	O
will	O
examine	O
the	O
inconsistencies	O
observed	O
.	O
Within	O
the	O
response	O
we	O
observed	O
the	O
following	O
inconsistencies	O
:	O
Our	O
review	O
of	O
the	O
''	O
ResponseThreatConnect.docx	O
''	O
focused	O
in	O
on	O
the	O
email	O
screenshot	O
(	O
Figure	O
3	O
)	O
image1.png	O
that	O
Khan	O
provided	O
revealing	O
that	O
the	O
date	O
probably	O
had	O
been	O
modified	O
to	O
appear	O
as	O
though	O
they	O
were	O
the	O
first	O
to	O
notify	O
VPSNOC	O
.	O
Within	O
the	O
official	O
response	O
,	O
Zubair	O
Khan	O
indicated	O
that	O
Tranchulas	O
was	O
''	O
already	O
aware	O
of	O
this	O
incident	O
...	O
and	O
contacted	O
hosting	O
company	O
.	O
''	O
The	O
official	O
response	O
included	O
a	O
screenshot	O
depicting	O
an	O
email	O
sent	O
to	O
VPSNOC	O
from	O
an	O
unidentified	O
(	O
redacted	O
)	O
tranchulas.com	O
email	O
address	O
that	O
was	O
sent	O
on	O
''	O
Tue	O
,	O
Jul	O
21	O
,	O
2013	O
at	O
11:36	O
PM	O
''	O
with	O
no	O
evidence	O
of	O
the	O
date	O
in	O
which	O
it	O
was	O
received	O
by	O
or	O
responded	O
to	O
by	O
VPSNOC	O
.	O
This	O
message	O
contained	O
a	O
notable	O
misalignment	O
between	O
the	O
date	O
and	O
day	O
of	O
the	O
week	O
.	O
July	O
21	O
,	O
2013	O
was	O
a	O
Sunday	O
,	O
not	O
a	O
Tuesday	O
.	O
''	O
Tuesday	O
''	O
would	O
have	O
pre-dated	O
our	O
official	O
notification	O
that	O
occurred	O
on	O
Wednesday	O
July	O
24	O
,	O
2013	O
,	O
and	O
could	O
indicate	O
that	O
Tranchulas	O
may	O
have	O
obtained	O
insight	O
into	O
the	O
original	O
TCIRT	O
notification	O
through	O
Pakistan-	O
based	O
contacts	O
within	O
VPSNOC	O
.	O
The	O
TCIRT	O
subsequently	O
responded	O
to	O
Mr.	O
Khan	O
's	O
official	O
explanation	O
with	O
a	O
follow-up	O
inquiry	O
,	O
offering	O
Khan	O
an	O
opportunity	O
to	O
explain	O
the	O
date	O
inconsistency	O
within	O
the	O
email	O
screenshot	O
.	O
Mr.	O
Khan	O
deferred	O
our	O
request	O
to	O
Mr.	O
Hamza	O
Qamar	O
,	O
a	O
Penetration	O
Testing	O
Team	O
Lead	O
at	O
Tranchulas	O
,	O
who	O
later	O
responded	O
with	O
a	O
simple	O
denial	O
that	O
the	O
email	O
message	O
had	O
not	O
been	O
altered	O
apart	O
from	O
blurring	O
the	O
name	O
of	O
the	O
original	O
sender	O
.	O
The	O
email	O
screenshot	O
(	O
image1.png	O
)	O
from	O
within	O
the	O
Tranchulas	O
response	O
demonstrated	O
awareness	O
of	O
information	O
that	O
we	O
initially	O
withheld	O
and	O
later	O
released	O
in	O
our	O
blog	O
post	O
:	O
one	O
malware	O
variant	O
that	O
contained	O
a	O
debug	O
string	O
with	O
''	O
umairaziz27	O
''	O
the	O
same	O
username	O
as	O
a	O
Tranchulas	O
employee	O
.	O
The	O
Tranchulas	O
message	O
to	O
VPSNOC	O
incorrectly	O
claimed	O
to	O
identify	O
malware	O
on	O
199.91.173.43	O
that	O
contained	O
the	O
''	O
company	O
's	O
name	O
and	O
...	O
employee	O
's	O
name	O
''	O
.	O
While	O
it	O
is	O
possible	O
that	O
Tranchulas	O
'	O
analysts	O
discovered	O
this	O
variant	O
independent	O
of	O
the	O
blog	O
post	O
,	O
it	O
added	O
to	O
the	O
inconsistent	O
elements	O
of	O
the	O
response	O
and	O
further	O
suggested	O
that	O
the	O
blog	O
post	O
may	O
have	O
inspired	O
its	O
communications	O
with	O
VPSNOC	O
.	O
We	O
note	O
that	O
we	O
requested	O
additional	O
information	O
such	O
as	O
the	O
''	O
detailed	O
analysis	O
report	O
''	O
within	O
the	O
exchange	O
from	O
Tranchulas	O
but	O
did	O
not	O
receive	O
a	O
response	O
.	O
The	O
Tranchulas	O
response	O
indicates	O
that	O
''	O
Tranchulas	O
'	O
research	O
team	O
was	O
already	O
aware	O
of	O
this	O
incident	O
before	O
publication	O
of	O
this	O
report	O
.	O
Our	O
team	O
contacted	O
hosting	O
company	O
of	O
server	O
to	O
seek	O
an	O
explanation	O
.	O
''	O
Considering	O
there	O
are	O
no	O
public	O
references	O
to	O
the	O
identified	O
infrastructure	O
identifying	O
VPSNOC	O
as	O
the	O
''	O
hosting	O
company	O
''	O
.	O
The	O
only	O
way	O
for	O
Tranchulas	O
to	O
identify	O
VPSNOC	O
as	O
the	O
hosting	O
company	O
was	O
to	O
either	O
have	O
previous	O
insider	O
knowledge	O
of	O
the	O
activity	O
,	O
or	O
to	O
have	O
been	O
privately	O
introduced	O
by	O
the	O
Kansas-City-based	O
service	O
provider	O
to	O
their	O
''	O
client	O
''	O
VPSNOC	O
,	O
of	O
which	O
was	O
never	O
mentioned	O
or	O
discussed	O
when	O
we	O
initially	O
exchanged	O
with	O
either	O
the	O
Kansas-City	O
or	O
Pakistan-based	O
hosting	O
providers	O
.	O
Public	O
registration	O
of	O
the	O
199.91.173.43	O
reveals	O
the	O
Kansas-City-based	O
hosting	O
provider	O
as	O
the	O
official	O
registrant	O
and	O
owner	O
of	O
the	O
infrastructure	O
.	O
The	O
only	O
way	O
to	O
know	O
that	O
VPSNOC	O
was	O
subleasing	O
the	O
infrastructure	O
was	O
to	O
obtain	O
this	O
information	O
directly	O
from	O
them	O
.	O
There	O
was	O
no	O
public	O
reference	O
which	O
would	O
have	O
revealed	O
VPSNOC	O
as	O
the	O
entity	O
which	O
maintained	O
root	O
access	O
to	O
the	O
199.91.173.43	O
.	O
Had	O
Tranchulas	O
legitimately	O
conducted	O
an	O
initial	O
victim	O
notification	O
sometime	O
in	O
late	O
July	O
2013	O
,	O
they	O
would	O
have	O
likely	O
done	O
so	O
through	O
the	O
Kansas-City-based	O
hosting	O
provider	O
and	O
not	O
VPSNOC	O
.	O
On	O
August	O
15	O
,	O
2013	O
,	O
Hamza	O
Qamar	O
's	O
response	O
to	O
TCIRT	O
's	O
follow	O
up	O
inquiry	O
to	O
the	O
observed	O
inconsistencies	O
redirected	O
TCIRT	O
personnel	O
to	O
VPSNOC	O
to	O
obtain	O
an	O
explanation	O
versus	O
attempting	O
to	O
explain	O
the	O
observed	O
day	O
date	O
inconsistency	O
and	O
document	O
properties	O
within	O
the	O
Tranchulas	O
email	O
.	O
The	O
TCIRT	O
's	O
suspicion	O
mounted	O
when	O
presenting	O
Tranchulas	O
with	O
the	O
opportunity	O
to	O
set	O
the	O
record	O
straight	O
,	O
that	O
Tranchulas	O
could	O
not	O
substantiate	O
their	O
claims	O
,	O
rather	O
deferring	O
the	O
TCIRT	O
inquiry	O
to	O
a	O
third	O
party	O
(	O
VPSNOC	O
)	O
.	O
Within	O
the	O
''	O
ResponseThreatConnect.docx	O
''	O
the	O
image	O
''	O
image1.png	O
''	O
contains	O
an	O
undated	O
response	O
from	O
VPSNOC	O
to	O
the	O
''	O
Tue	O
,	O
Jul	O
21	O
,	O
2013	O
''	O
Tranchulas	O
notification	O
.	O
The	O
undated	O
VPSNOC	O
response	O
that	O
Tranchulas	O
received	O
is	O
nearly	O
identical	O
to	O
the	O
response	O
that	O
TCIRT	O
and	O
the	O
Kansas-City-based	O
service	O
provider	O
obtained	O
on	O
July	O
24th	O
.	O
Tranchulas	O
does	O
not	O
include	O
the	O
date	O
or	O
time	O
as	O
to	O
when	O
they	O
obtained	O
a	O
response	O
from	O
VPSNOC	O
.	O
The	O
TCIRT	O
found	O
it	O
unusual	O
that	O
neither	O
the	O
Kansas-City-based	O
service	O
provider	O
or	O
VPSNOC	O
personnel	O
ever	O
indicated	O
either	O
way	O
that	O
they	O
knew	O
about	O
the	O
activity	O
or	O
had	O
been	O
previously	O
contacted	O
by	O
either	O
party	O
.	O
When	O
considering	O
all	O
of	O
the	O
inconsistencies	O
,	O
order	O
of	O
events	O
and	O
studying	O
,	O
Gmail	O
webmail	O
layout	O
,	O
similarities	O
of	O
keywords	O
,	O
salutations	O
and	O
closings	O
within	O
the	O
''	O
Tue	O
,	O
Jul	O
21	O
,	O
2013	O
''	O
Tranchulas	O
notification	O
and	O
the	O
respective	O
VPSNOC	O
response	O
.	O
The	O
TCIRT	O
grew	O
increasingly	O
suspicious	O
of	O
the	O
exchanges	O
with	O
VPSNOC	O
and	O
subsequent	O
exchanges	O
with	O
Tranchulas	O
personnel	O
.	O
Analysis	O
of	O
metadata	O
within	O
two	O
benign	B-Entity
decoy	I-Entity
documents	I-Entity
that	O
were	O
originally	O
used	O
within	O
July	O
2013	O
BITTERBUG	O
operations	O
,	O
Report.docx	O
and	O
NaxalitesFundedbyPakistan.docx	O
,	O
both	O
maintained	O
the	O
author	O
properties	O
of	O
''	O
hp	O
''	O
.	O
In	O
reviewing	O
the	O
document	O
metadata	O
within	O
the	O
''	O
ResponseThreatConnect.docx	O
''	O
that	O
was	O
sent	O
from	O
Mr.	O
Zubair	O
Khan	O
on	O
August	O
6	O
,	O
2013	O
,	O
the	O
TCIRT	O
also	O
identified	O
that	O
this	O
document	O
maintained	O
the	O
creator	O
properties	O
of	O
''	O
hp	O
.	O
''	O
(	O
Figure	O
10	O
)	O
While	O
the	O
author	O
field	O
of	O
''	O
hp	O
''	O
does	O
n't	O
conclusively	O
prove	O
a	O
relationship	O
,	O
it	O
contributes	O
to	O
a	O
body	O
of	O
circumstantial	O
evidence	O
which	O
matches	O
the	O
document	O
properties	O
of	O
the	O
official	O
Tranchulas	O
response	O
to	O
the	O
document	O
properties	O
that	O
were	O
also	O
found	O
within	O
decoy	O
documents	O
that	O
were	O
bundled	O
with	O
BITTERBUG	O
implants	O
.	O
According	O
to	O
the	O
vpsnoc.com	O
website	O
''	O
In	O
2007	O
five	O
VPS	O
experts	O
decided	O
to	O
invest	O
in	O
their	O
very	O
own	O
private	O
rack	O
space	O
in	O
the	O
heart	O
of	O
Kansas	O
,	O
the	O
United	O
States	O
.	O
Their	O
aim	O
?	O
To	O
bring	O
service-oriented	O
,	O
quality	O
managed	O
and	O
unmanaged	O
VPS	O
solutions	O
to	O
clients	O
all	O
over	O
the	O
world	O
.	O
Just	O
1	O
year	O
later	O
,	O
after	O
beginning	O
their	O
enterprise	O
on	O
3	O
servers	O
they	O
had	O
filled	O
2	O
server	O
racks	O
with	O
happy	O
clients	O
receiving	O
quality	O
U.S	O
support	O
.	O
Their	O
company	O
continued	O
to	O
build	O
momentum	O
.	O
''	O
Whois	O
records	O
for	O
vpsnoc.com	O
indicate	O
that	O
another	O
individual	O
registered	O
the	O
domain	O
and	O
listed	O
Digital	O
Linx	O
Hosting	O
as	O
the	O
registrant	O
organization	O
with	O
a	O
Kansas	O
City-based	O
address	O
,	O
telephone	O
number	O
925-665-1427	O
,	O
and	O
administrative	O
email	O
address	O
admin	O
@	O
digitallinx	O
.	O
org	O
.	O
This	O
is	O
the	O
same	O
registrant	O
record	O
for	O
the	O
digitallinx.net	O
domain	O
.	O
The	O
digitallinx.net/sitemap.xml	O
and	O
the	O
corresponding	O
Google	O
cache	O
for	O
digitallinx.net/sitemap.xml	O
indiciate	O
that	O
both	O
digitallinx.net	O
and	O
digitallinx.com	O
have	O
shared	O
the	O
same	O
sitemap.xml	O
at	O
the	O
same	O
time	O
.	O
The	O
digitallinx.net/Contact.html	O
identified	O
similar	O
overlaps	O
with	O
data	O
across	O
the	O
.org	O
,	O
.net	O
,	O
and	O
.com	O
domains	O
.	O
The	O
domain	O
digitallinx.com	O
is	O
registered	O
to	O
Perasona	O
#	O
1	O
.	O
He	O
uses	O
email	O
addresses	O
naseer	O
@	O
digitallinx.com	O
and	O
nbhatti	O
@	O
gmail.com	O
as	O
the	O
domain	O
registrant	O
email	O
address	O
,	O
along	O
with	O
address	O
638-F	O
Johar	O
Town	O
,	O
Lahore	O
Pakistan	O
and	O
telephone	O
966.548805579	O
.	O
The	O
DigitalLinx	O
(	O
digitallinx.com	O
)	O
website	O
states	O
that	O
it	O
is	O
''	O
a	O
web	O
hosting	O
/	O
Web	O
Solutions	O
&	O
Processing	O
Outsourcing	O
Company	O
based	O
in	O
Pakistan	O
''	O
.	O
Open	O
source	O
research	O
of	O
the	O
phone	O
number	O
925-665-1427	O
indicates	O
that	O
it	O
is	O
also	O
used	O
within	O
site	O
content	O
as	O
a	O
phone	O
number	O
for	O
defiantmarketing.com	O
.	O
This	O
domain	O
is	O
registered	O
by	O
Persona	O
#	O
2	O
who	O
uses	O
the	O
aliases	O
''	O
agnosticon	O
''	O
and	O
''	O
agnostic	O
''	O
.	O
Persona	O
#	O
2	O
lists	O
VPSNOC	O
as	O
the	O
registrant	O
organization	O
,	O
and	O
uses	O
the	O
registration	O
email	O
address	O
of	O
abunasar	O
@	O
yahoo.com	O
with	O
an	O
address	O
of	O
House	O
12	O
,	O
Street	O
21	O
,	O
F-8/1	O
Islamabad	O
Federal	O
44000	O
.	O
The	O
domain	O
defiantmarketing.com	O
domain	O
has	O
used	O
ns1.abunasar.net	O
and	O
ns2.abunasar.net	O
for	O
name	O
services	O
.	O
Within	O
a	O
January	O
2009	O
posting	O
to	O
a	O
Debian	O
users	O
forum	O
,	O
Persona	O
#	O
2	O
sends	O
an	O
email	O
from	O
the	O
abunasar	O
@	O
yahoo.com	O
with	O
a	O
reply-to	O
as	O
abunasar	O
@	O
army.com	O
.	O
Within	O
the	O
post	O
,	O
Persona	O
#	O
2	O
responds	O
to	O
the	O
question	O
''	O
Who	O
's	O
using	O
Debian	O
''	O
listing	O
DigitalLinx	O
,	O
Kansas	O
City	O
MO	O
and	O
the	O
link	O
to	O
digitallinx.com	O
.	O
Also	O
,	O
the	O
seemingly	O
abandoned	O
Twitter	O
profile	O
for	O
Persona	O
#	O
2	O
is	O
only	O
following	O
the	O
Twitter	O
profile	O
for	O
@	O
VPSNOC	O
.	O
In	O
an	O
April	O
2012	O
post	O
to	O
blackhatworld.com	O
,	O
a	O
user	O
with	O
the	O
alias	O
''	O
agnosticon	O
''	O
posted	O
promotional	O
codes	O
for	O
VPSNOC	O
hosting	O
services	O
,	O
engaging	O
with	O
customers	O
,	O
providing	O
them	O
feedback	O
regarding	O
VPS	O
services	O
and	O
thanking	O
them	O
for	O
positive	O
reviews	O
.	O
Within	O
the	O
posting	O
the	O
user	O
''	O
agnosticon	O
''	O
included	O
an	O
image	O
which	O
was	O
an	O
actual	O
advertisement	O
that	O
was	O
hosted	O
at	O
http	O
:	O
//vpsnoc	O
.	O
com/order.png	O
.	O
Within	O
the	O
posted	O
image	O
it	O
states	O
''	O
VPSNOC	O
is	O
a	O
subdivision	O
of	O
Digital	O
Linx	O
Hosting	O
.	O
We	O
have	O
been	O
in	O
business	O
since	O
2008	O
''	O
.	O
The	O
posting	O
concludes	O
with	O
''	O
If	O
you	O
have	O
any	O
further	O
questions/queries	O
please	O
contact	O
us	O
directly	O
at	O
:	O
support	O
@	O
vpsnoc.com	O
''	O
Muhammad	O
Naseer	O
Bhatti	O
's	O
LinkedIn	O
profile	O
indicates	O
that	O
he	O
is	O
currently	O
the	O
founder	O
for	O
Digital	O
Linx	O
LLC	O
and	O
vBilling	O
(	O
vbilling.org	O
)	O
as	O
well	O
as	O
a	O
consultant	O
for	O
a	O
U.S.	O
company	O
.	O
Both	O
Bhatti	O
and	O
Digital	O
Linx	O
are	O
listed	O
as	O
the	O
registrants	O
for	O
vbilling.org	O
,	O
v-billing	O
.	O
com	O
,	O
vgriffins.com	O
and	O
my-server.co	O
,	O
which	O
use	O
P.O	O
.	O
Box	O
295658	O
,	O
Riyadh	O
Saudi	O
Arabia	O
as	O
the	O
registration	O
address	O
.	O
This	O
is	O
also	O
the	O
address	O
for	O
two	O
U.S.	O
companies	O
'	O
local	O
operations	O
.	O
Bhatti	O
is	O
also	O
listed	O
as	O
the	O
owner	O
of	O
the	O
netblock	O
46.4.139.224/28	O
.	O
Both	O
passive	O
DNS	O
sources	O
as	O
well	O
as	O
Robtex	O
highlight	O
this	O
overlapping	O
infrastructure	O
.	O
From	O
September	O
7	O
-	O
9	O
,	O
2011	O
,	O
Tranchulas	O
in	O
cooperation	O
with	O
the	O
Pakistan	O
National	O
University	O
of	O
Sciences	O
and	O
Technology	O
(	O
NUST	O
)	O
,	O
offered	O
a	O
Certified	O
Penetration	O
Testing	O
Profession	O
(	O
CPTP	O
)	O
Workshop	O
(	O
Figure	O
17	O
)	O
.	O
During	O
the	O
workshop	O
,	O
basic	O
penetration	O
techniques	O
and	O
skills	O
were	O
presented	O
.	O
It	O
is	O
likely	O
that	O
CPTP	O
workshops	O
and	O
alignment	O
with	O
NUST	O
have	O
allowed	O
Tranchulas	O
the	O
opportunity	O
to	O
recruit	O
student	O
interns	O
.	O
Within	O
the	O
CPTP	O
event	O
registration	O
contact	O
information	O
for	O
Muhammad	O
Naseer	O
was	O
listed	O
next	O
to	O
a	O
Tranchulas	O
office	O
number	O
(	O
051-	O
2871433	O
)	O
.	O
It	O
is	O
important	O
to	O
note	O
that	O
Muhammad	O
Naseer	O
Bhatti	O
has	O
been	O
previously	O
known	O
to	O
drop	B-Action
the	B-Entity
family	I-Entity
name	I-Entity
''	I-Entity
Bhatti	I-Entity
''	I-Entity
within	O
online	O
correspondence	O
(	O
Figure	O
18	O
)	O
.	O
In	O
a	O
June	O
2012	O
episode	O
of	O
Engineering	O
and	O
Technology	O
Magazine	O
podcast	O
a	O
Mohammed	O
Nasser	O
,	O
Penetration	O
Tester	O
at	O
Tranchulas	O
was	O
interviewed	O
.	O
A	O
Mohammed	O
Nasser	O
may	O
also	O
be	O
directly	O
affiliated	O
with	O
Tranchulas	O
.	O
This	O
links	O
Tranchulas	O
to	O
a	O
Pakistani	O
employee	O
or	O
consultant	O
also	O
named	O
Muhammad	O
Naseer	O
.	O
It	O
is	O
unknown	O
if	O
this	O
is	O
the	O
same	O
Muhammad	O
Naseer	O
that	O
is	O
associated	O
with	O
VPSNOC	O
's	O
parent	O
company	O
Digital	O
Linx	O
,	O
the	O
Pakistan-based	O
service	O
provider	O
which	O
hosted	O
the	O
original	O
BITTERBUG	O
malware	O
.	O
Abunasar	O
Khan	O
also	O
maintains	O
the	O
aliases	O
''	O
agnosticon	O
''	O
and	O
''	O
agnostic	O
''	O
in	O
addition	O
to	O
the	O
email	O
addresses	O
abunasar	O
@	O
yahoo	O
.	O
com	O
and	O
abunasar	O
@	O
army.com	O
.	O
He	O
has	O
been	O
previously	O
associatedwith	O
VPSNOC	O
&	O
Digital	O
Linx	O
.	O
An	O
April	O
2012	O
Whois	O
registrant	O
record	O
for	O
the	O
domain	O
zeusadnetwork.com	O
includes	O
the	O
first	O
and	O
last	O
name	O
Khan	O
along	O
with	O
the	O
same	O
(	O
925	O
)	O
665-1427	O
phone	O
number	O
seen	O
within	O
the	O
Digial	O
Linx	O
Hosting	O
domains	O
.	O
Khan	O
registered	O
a	O
variety	O
of	O
domains	O
,	O
many	O
of	O
which	O
use	O
his	O
abunasar.net	O
for	O
name	O
services	O
and	O
abunasar.yahoo.com	O
within	O
the	O
Start	O
of	O
Authority	O
(	O
SOA	O
)	O
records	O
.	O
For	O
example	O
a	O
July	O
2014	O
record	O
(	O
Figure	O
19	O
)	O
for	O
defiantmarketing.com	O
and	O
an	O
August	O
2013	O
record	O
(	O
Figure	O
20	O
)	O
for	O
ns2.vpsnoc.com	O
both	O
maintain	O
these	O
references	O
.	O
Abunasar	O
Khan	O
registered	O
abunasar.net	O
and	O
previously	O
(	O
May	O
2007	O
)	O
and	O
maintained	O
whitehate.org	O
,	O
which	O
have	O
both	O
been	O
used	O
to	O
demonstrate	O
an	O
affinity	O
for	O
and	O
alignment	O
with	O
AntiSec	O
and	O
Anonymous	O
movements	O
.	O
The	O
abunasar.net	O
website	O
prominently	O
displays	O
ascii	O
art	O
of	O
the	O
term	O
''	O
antisec	O
''	O
with	O
antisec	O
related	O
content	O
''	O
Blend	O
in	O
.	O
Get	O
trusted	O
.	O
Trust	O
nobody	O
.	O
Own	O
everybody	O
.	O
Disclose	O
nothing	O
.	O
Destroy	O
everything	O
.	O
Take	O
back	O
the	O
scene	O
.	O
''	O
This	O
is	O
a	O
shared	O
affinity	O
that	O
is	O
also	O
reflected	O
amongst	O
with	O
the	O
culture	O
of	O
Tranchulas	O
employees	O
.	O
The	O
pure.whitehate.org	O
domain	O
has	O
also	O
been	O
previously	O
associated	O
with	O
Khan	O
,	O
examples	O
can	O
be	O
found	O
within	O
#	O
phrack	O
and	O
#	O
darknet	O
IRC	O
sessions	O
.	O
Ironically	O
,	O
in	O
February	O
2011	O
,	O
Khan	O
's	O
Rootkit.com	O
user	O
profile	O
was	O
compromised	O
revealing	O
his	O
profile	O
's	O
username	O
,	O
password	O
hash	O
,	O
email	O
(	O
abunasar	O
@	O
army.com	O
)	O
,	O
and	O
the	O
registration	O
IP	O
address	O
of	O
202.125.143.67	O
(	O
Islamabad	O
,	O
Pakistan	O
)	O
.	O
During	O
his	O
registration	O
,	O
Khan	O
specified	O
the	O
name	O
''	O
anony	O
mo	O
us	O
''	O
when	O
registering	O
the	O
profile	O
.	O
As	O
of	O
16	O
August	O
2013	O
,	O
a	O
Pastebin	O
post	O
contained	O
details	O
of	O
a	O
customer	O
database	O
compromise	O
for	O
nowclothing.pk	O
,	O
which	O
included	O
Khan	O
's	O
name	O
,	O
email	O
abunasar	O
@	O
army.com	O
,	O
and	O
cell	O
phone	O
number	O
03215488881	O
.	O
Research	O
of	O
the	O
03215488881	O
cell	O
phone	O
number	O
yields	O
a	O
user	O
profile	O
''	O
abunasark	O
''	O
in	O
an	O
April	O
2009	O
posting	O
.	O
Khan	O
posts	O
pictures	O
of	O
his	O
blue	O
Baleno	O
and	O
includes	O
another	O
phone	O
number	O
03234764838	O
.	O
In	O
a	O
secondary	O
profile	O
user	O
''	O
Ak	O
''	O
uses	O
the	O
same	O
cell	O
phone	O
number	O
03215488881	O
in	O
a	O
2009	O
sales	O
posting	O
for	O
a	O
2004	O
blue	O
Baleno	O
.	O
Khan	O
's	O
affinity	O
for	O
Suzuki	O
Baleno	O
cars	O
is	O
made	O
obvious	O
in	O
a	O
May	O
2009	O
registration	O
for	O
clubaleno.co.uk	O
that	O
was	O
registered	O
by	O
Khan	O
at	O
VPSNOC	O
using	O
the	O
name	O
services	O
of	O
ns1.abunasar.net	O
and	O
ns2.abunasar.net	O
with	O
a	O
SOA	O
record	O
of	O
abunasar.yahoo.com	O
.	O
Later	O
in	O
a	O
June	O
2009	O
posting	O
,	O
Khan	O
using	O
the	O
alias	O
''	O
agnostic	O
''	O
attempts	O
to	O
sell	O
the	O
domain	O
clubaleno.co.uk	O
and	O
uses	O
his	O
abunasar	O
@	O
army.com	O
email	O
address	O
as	O
a	O
point	O
of	O
contact	O
.	O
Khan	O
is	O
also	O
observed	O
using	O
the	O
alias	O
''	O
agnosticon	O
''	O
and	O
a	O
Toyota	O
Racing	O
Development	O
avitar	O
within	O
posts	O
to	O
blackhatworld.com	O
and	O
again	O
within	O
a	O
2011	O
post	O
where	O
he	O
posts	O
a	O
cpanel	O
error	O
that	O
also	O
includes	O
his	O
''	O
abunasar	O
''	O
username	O
within	O
system	O
output	O
.	O
The	O
Google+	O
profile	O
for	O
Khan	O
reveals	O
established	O
social	O
network	O
links	O
to	O
a	O
Team	O
Lead	O
for	O
Penetration	O
Testing	O
at	O
Tranchulas	O
and	O
a	O
Digital	O
Linx	O
employee	O
Shoaib	O
Riaz	O
who	O
also	O
maintains	O
a	O
social	O
network	O
association	O
with	O
the	O
Digital	O
Linx	O
founder	O
Muhammad	O
Nasser	O
Bhatti	O
.	O
The	O
Tranchulas	O
website	O
states	O
that	O
they	O
provide	O
a	O
range	O
of	O
security	O
services	O
and	O
training	O
to	O
include	O
penetration	O
and	O
offensive	O
cyber	O
initiative	O
(	O
OCI	O
)	O
,	O
in	O
which	O
they	O
''	O
help	O
national	O
level	O
cyber	O
security	O
programs	O
on	O
strategies	O
for	O
managing	O
offensive	O
technical	O
threats	O
''	O
.	O
In	O
a	O
September	O
2011	O
YouTube	O
user	O
''	O
tranchulascert	O
''	O
posted	O
a	O
video	O
titled	O
''	O
Tranchulas	O
Cyber	O
Ranges	O
-	O
P	O
@	O
sha	O
ICT	O
Awards	O
2011	O
''	O
,	O
where	O
they	O
awarded	O
runner	O
up	O
.	O
Within	O
the	O
video	O
,	O
the	O
cyber	O
ranges	O
were	O
referenced	O
as	O
being	O
developed	O
for	O
''	O
defense	O
forces	O
''	O
that	O
were	O
aimed	O
to	O
''	O
help	O
them	O
in	O
developing	O
offensive	O
and	O
defensive	O
warfare	O
skills	O
''	O
and	O
''	O
combating	O
anti-state	O
hackers	O
''	O
.	O
Although	O
Tranchulas	O
brands	O
itself	O
as	O
a	O
multi-national	O
company	O
,	O
their	O
respective	O
operating	O
addresses	O
within	O
United	O
Kingdom	O
the	O
United	O
States	O
and	O
New	O
Zealand	O
are	O
all	O
associated	O
with	O
either	O
virtual	O
office	O
spaces	O
or	O
address	O
forwarding	O
services	O
.	O
The	O
Tranchulas	O
website	O
lists	O
its	O
Pakistan	O
address	O
within	O
the	O
2nd	O
floor	O
of	O
the	O
Evacuee	O
Trust	O
Complex	O
on	O
Sir	O
Agha	O
Khan	O
Road	O
F-5/1	O
Islamabad	O
44000	O
.	O
The	O
Evacuee	O
Trust	O
Complex	O
is	O
also	O
known	O
as	O
Software	O
Technology	O
Park	O
2	O
or	O
STP2	O
and	O
hosts	O
a	O
variety	O
of	O
other	O
commercial	O
and	O
government	O
offices	O
.	O
The	O
Tranchulas	O
employee	O
,	O
Hamza	O
Qamar	O
,	O
that	O
handled	O
the	O
response	O
to	O
our	O
inquiry	O
has	O
a	O
public	O
LinkedIn	O
profile	O
that	O
states	O
that	O
he	B-Entity
''	I-Entity
Engaged	I-Entity
in	I-Entity
system	I-Entity
and	I-Entity
enterprise	I-Entity
level	I-Entity
network	I-Entity
and	I-Entity
Web	I-Entity
application	I-Entity
security	I-Entity
testing	I-Entity
for	I-Entity
clients	I-Entity
ranging	O
from	O
large	O
federal	O
agencies	O
,	O
DoD	O
,	O
and	O
commercial	O
clients	O
.	O
''	O
The	O
profile	O
does	O
not	O
specify	O
if	O
DoD	O
is	O
a	O
reference	O
to	O
the	O
U.S.	O
Department	O
of	O
Defense	O
or	O
another	O
country	O
's	O
Ministry	O
of	O
Defense	O
.	O
Interestingly	O
,	O
Qamar	O
's	O
Google+	O
page	O
showed	O
one	O
''	O
friend	O
''	O
in	O
his	O
circle	O
despite	O
more	O
than	O
40	O
followers	O
,	O
Abunasar	O
Khan	O
a	O
VPSNOC	O
employee	O
.	O
It	O
is	O
likely	O
that	O
Tranchulas	O
provides	O
services	O
to	O
the	O
Pakistani	O
government	O
.	O
The	O
offensive	O
cyber	O
initiative	O
services	O
offered	O
by	O
Tranchulas	O
is	O
offered	O
to	O
''	O
national-level	O
cyber	O
security	O
programs	O
''	O
suggesting	O
a	O
commercial	O
demand	O
from	O
''	O
national-level	O
''	O
customers	O
.	O
The	O
stated	O
purpose	O
and	O
intent	O
of	O
the	O
Tranchulas	O
''	O
Cyber	O
Ranges	O
''	O
P	O
@	O
sha	O
ICT	O
2011	O
awards	O
video	O
suggests	O
the	O
ranges	O
were	O
specifically	O
developed	O
in	O
support	O
of	O
national	O
interests	O
for	O
offensive	O
and	O
defensive	O
purposes	O
.	O
The	O
domain	O
registration	O
by	O
Zubair	O
Khan	O
using	O
an	O
official	O
Pakistani	O
government	O
address	O
with	O
his	O
zubair	O
@	O
tranchulas.com	O
email	O
address	O
indicates	O
that	O
Khan	O
may	O
have	O
or	O
currently	O
maintains	O
a	O
physical	O
address	O
at	O
a	O
location	O
where	O
other	O
Pakistani	O
government	O
officials	O
reside	O
.	O
Historic	O
Whois	O
registration	O
records	O
for	O
the	O
domains	O
textcrypter.com	O
,	O
taggnation.com	O
,	O
bookadoconline.com	O
and	O
saadiakhan	O
.	O
net	O
lists	O
Tranchulas	O
CEO	O
Zubair	O
Khan	O
(	O
zubair	O
@	O
tranchulas.com	O
)	O
as	O
the	O
registrant	O
for	O
the	O
domains	O
.	O
At	O
the	O
time	O
of	O
registration	O
Khan	O
used	O
the	O
address	O
15-B	O
,	O
Mehran	O
Block	O
of	O
the	O
Gulshan-e-Jinnah	O
F-5/1	O
Islamabad	O
Pakistan	O
for	O
the	O
domains	O
.	O
In	O
an	O
April	O
2008	O
Request	O
for	O
Proposals	O
,	O
the	O
Pakistan	O
Public	O
Works	O
Department	O
issued	O
a	O
tender	O
for	O
the	O
Constriction	O
of	O
Government	O
Servant	O
Quarters	O
and	O
Garages	O
at	O
Gulshan-e-Jinnah	O
Complex	O
F-5/1	O
Islamabad	O
.	O
Later	O
in	O
May	O
of	O
2010	O
within	O
a	O
Pakistani	O
Senate	O
question	O
and	O
answer	O
session	O
,	O
the	O
Gulshan-e-Jinnah	O
Complex	O
was	O
cited	O
under	O
Federal	O
Lodges	O
/	O
Hostels	O
in	O
Islamabad	O
under	O
the	O
control	O
of	O
Pakistan	O
Ministry	O
for	O
Housing	O
and	O
Works	O
.	O
A	O
December	O
2010	O
TheNews	O
Pakistan	O
ran	O
a	O
story	O
that	O
detailed	O
the	O
differential	O
in	O
rents	O
between	O
commoners	O
within	O
Islamabad	O
and	O
Pakistani	O
government	O
officers	O
accommodated	O
at	O
Gulshan-e-Jinnah	O
.	O
According	O
to	O
Google	O
Maps	O
it	O
is	O
approximately	O
650	O
meters	O
(	O
8	O
minute	O
walk	O
)	O
from	O
the	O
Gulshan-e-Jinnah	O
Complex	O
to	O
the	O
Tranchulas	O
offices	O
within	O
the	O
Evacuee	O
Trust	O
Complex	O
.	O
Within	O
a	O
May	O
2013	O
interview	O
Khan	O
specified	O
that	O
he	O
comes	O
from	O
a	O
family	O
with	O
a	O
strong	O
military	O
background	O
.	O
He	O
detailed	O
his	O
interest	O
in	O
''	O
the	O
world	O
of	O
hacking	O
''	O
grew	O
during	O
his	O
teen	O
years	O
,	O
referencing	O
his	O
father	O
's	O
diplomatic	O
assignment	O
to	O
the	O
Philippines	O
in	O
2003	O
.	O
Khan	O
would	O
go	O
on	O
to	O
establish	O
Tranchulas	O
in	O
February	O
2006	O
after	O
an	O
independent	O
audit	O
of	O
Pakistani	O
Governments	O
National	O
Database	O
and	O
Registration	O
Authority	O
(	O
NADRA	O
)	O
.	O
Digital	O
Appendix	O
1	O
contains	O
additional	O
research	O
collateral	O
collected	O
when	O
conducting	O
Operation	O
Arachnophobia	O
research	O
.	O
Digital	O
Appendix	O
2	O
contains	O
raw	O
email	O
communications	O
.	O
These	O
.eml	O
files	O
include	O
raw	O
SMTP	O
headers	O
,	O
content	O
and	O
attachments	O
.	O
Digital	O
Appendix	O
3	O
contains	O
screenshots	O
of	O
web	O
content	O
used	O
to	O
conduct	O
analysis	O
.	O
Digital	O
Appendix	O
4	O
contains	O
visualization	O
files	O
that	O
depict	O
relationships	O
and	O
contain	O
metadata	O
associated	O
with	O
our	O
Operation	O
Arachnophobia	O
research	O
.	O
