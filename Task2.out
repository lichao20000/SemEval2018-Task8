Over	O
the	O
last	O
10	O
months	O
,	O
Kaspersky	O
Lab	O
researchers	O
have	O
analyzed	O
a	O
massive	O
cyber	O
-	O
espionage	O
operation	O
which	O
we	O
call	O
''	O
Epic	O
Turla	O
''	O
.	O
The	O
attackers	B-Entity
behind	O
Epic	O
Turla	O
have	O
infected	O
several	O
hundred	O
computers	O
in	O
more	O
than	O
45	O
countries	O
,	O
including	O
government	O
institutions	O
,	O
embassies	B-Entity
,	O
military	O
,	O
education	B-Entity
,	O
research	B-Action
and	O
pharmaceutical	O
companies	O
.	O
The	O
attacks	O
are	O
known	O
to	O
have	O
used	O
at	O
least	O
two	O
zero	O
-	O
day	O
exploits	O
:	O
We	B-Entity
also	O
observed	O
exploits	B-Entity
against	O
older	O
(	O
patched	O
)	O
vulnerabilities	B-Entity
,	O
social	O
engineering	O
techniques	O
and	O
watering	O
hole	O
strategies	O
in	O
these	B-Entity
attacks	I-Entity
.	O
The	O
primary	O
backdoor	O
used	O
in	O
the	O
Epic	O
attacks	O
is	O
also	O
known	O
as	O
''	O
WorldCupSec	O
''	O
,	O
''	O
TadjMakhal	O
''	O
,	O
''	O
Wipbot	O
''	O
or	O
''	O
Tavdig	O
''	O
.	O
When	O
G	O
-	O
Data	O
published	O
on	O
Turla	O
/	O
Uroburos	O
back	O
in	O
February	O
,	O
several	O
questions	O
remained	O
unanswered	O
.	O
One	O
big	O
unknown	O
was	O
the	O
infection	O
vector	O
for	O
Turla	O
(	O
aka	O
Snake	B-Entity
or	O
Uroburos	B-Entity
)	O
.	O
Our	O
analysis	O
indicates	O
that	O
victims	O
are	O
infected	O
via	O
a	O
sophisticated	O
multi	O
-	O
stage	O
attack	O
,	O
which	O
begins	B-Action
with	O
the	O
Epic	O
Turla	O
.	O
In	O
time	O
,	O
as	O
the	O
attackers	B-Entity
gain	O
confidence	O
,	O
this	B-Entity
is	B-Action
upgraded	I-Action
to	B-Modifier
more	O
sophisticated	O
backdoors	O
,	O
such	O
as	O
the	O
Carbon	O
/	O
Cobra	O
system	O
.	O
Sometimes	O
,	O
both	B-Entity
backdoors	I-Entity
are	O
run	O
in	O
tandem	O
,	O
and	O
used	B-Action
to	B-Modifier
''	O
rescue	O
''	O
each	O
other	O
if	O
communications	B-Entity
are	O
lost	O
with	O
one	O
of	O
the	O
backdoors	O
.	O
Once	O
the	O
attackers	O
obtain	O
the	O
necessary	O
credentials	O
without	O
the	O
victim	O
noticing	O
,	O
they	B-Entity
deploy	O
the	O
rootkit	B-Entity
and	O
other	O
extreme	O
persistence	O
mechanisms	O
.	O
The	O
attacks	O
are	O
still	O
ongoing	O
as	O
of	O
July	O
2014	O
,	O
actively	O
targeting	B-Action
users	O
in	O
Europe	O
and	O
the	O
Middle	O
East	O
.	O
Note	O
:	O
A	O
full	O
analysis	O
of	O
the	O
Epic	O
attacks	O
is	O
available	B-Entity
to	B-Modifier
the	O
Kaspersky	O
Intelligent	O
Services	O
subscribers	O
.	O
Contact	O
:	O
intelreports	O
@	O
kaspersky.com	O
The	O
attacks	O
in	O
this	O
campaign	O
fall	O
into	O
several	O
different	O
categories	O
depending	O
on	O
the	O
vector	O
used	O
in	O
the	O
initial	O
compromise	O
:	O
The	O
attackers	B-Entity
use	O
both	O
direct	O
spearphishing	O
and	O
watering	O
hole	O
attacks	O
to	O
infect	B-Action
their	B-Entity
victims	I-Entity
.	O
Watering	O
holes	O
(	O
waterholes	O
)	O
are	O
websites	O
of	O
interest	B-Entity
to	B-Modifier
the	O
victims	O
that	O
have	O
been	B-Action
compromised	I-Action
by	O
the	O
attackers	B-Entity
and	O
injected	B-Action
to	O
serve	B-Action
malicious	B-Entity
code	I-Entity
.	O
So	O
far	O
we	O
have	O
n't	O
been	O
able	O
to	O
locate	B-Action
any	O
e	O
-	O
mail	B-Entity
used	O
against	O
the	O
victims	O
,	O
only	O
the	O
attachments	O
.	O
The	O
PDF	O
attachments	O
do	O
not	O
show	O
any	O
''	O
lure	O
''	O
to	O
the	O
victim	O
when	O
opened	O
,	O
however	O
,	O
the	O
SCR	O
packages	O
sometime	O
show	O
a	O
clean	O
PDF	O
upon	O
successful	O
installation	O
.	O
Some	O
of	O
known	O
attachment	O
names	O
used	O
in	O
the	O
spearphishing	O
attacks	O
are	O
:	O
In	O
some	O
cases	O
,	O
these	B-Entity
filenames	I-Entity
can	O
provide	B-Action
clues	B-Entity
about	O
the	O
type	O
of	O
victims	O
the	O
attackers	O
are	O
targeting	O
.	O
Currently	O
,	O
the	O
Epic	O
attackers	B-Entity
run	O
a	O
vast	O
network	O
of	O
watering	O
holes	O
that	O
target	B-Action
visitors	B-Entity
with	O
surgical	O
precision	O
.	O
Some	O
of	O
the	O
injected	B-Action
websites	B-Entity
include	O
:	O
In	O
total	O
,	O
we	O
observed	O
more	O
than	O
100	O
injected	B-Action
websites	B-Entity
.	O
Currently	O
,	O
the	O
largest	O
number	O
of	O
injected	B-Action
sites	B-Entity
is	O
in	O
Romania	O
.	O
Here	O
's	O
a	O
statistic	O
on	O
the	O
injected	B-Action
websites	B-Entity
:	O
The	O
distribution	O
is	O
obviously	O
not	O
random	O
,	O
and	O
it	B-Entity
reflects	O
some	O
of	O
the	O
interests	O
of	O
the	O
attackers	B-Entity
.	O
For	O
instance	O
,	O
in	O
Romania	O
many	O
of	O
the	O
infected	O
sites	O
are	O
in	O
the	O
Mures	O
region	O
,	O
while	O
many	O
of	O
the	O
Spanish	O
infected	O
sites	O
belong	O
to	B-Modifier
local	O
governments	O
(	O
City	O
Hall	O
)	O
.	O
Most	O
of	O
the	O
infected	O
sites	O
use	O
the	O
TYPO3	O
CMS	O
(	O
see	O
:	O
http	O
:	O
//typo3.org/	O
)	O
,	O
which	O
could	O
indicate	O
the	O
attackers	O
are	O
abusing	O
a	O
specific	O
vulnerability	O
in	O
this	O
publishing	O
platform	O
.	O
Injected	O
websites	B-Entity
load	B-Action
a	O
remote	O
JavaScript	O
into	O
the	O
victim	O
's	O
browser	O
:	O
The	O
script	O
''	O
sitenavigatoin.js	O
''	O
is	O
a	O
Pinlady	O
-	O
style	O
browser	O
and	O
plugin	O
detection	O
script	B-Entity
,	O
which	O
in	O
turn	O
,	O
redirects	B-Action
to	B-Modifier
a	O
PHP	O
script	B-Entity
sometimes	O
called	B-Action
main.php	B-Entity
or	O
wreq.php	O
.	O
Sometimes	O
,	O
the	O
attackers	B-Entity
register	O
the	O
.JPG	O
extension	O
with	O
the	O
PHP	O
handler	O
on	O
the	O
server	O
,	O
using	B-Modifier
''	O
JPG	O
''	O
files	B-Entity
to	O
run	B-Action
PHP	B-Entity
scripts	B-Action
:	O
The	O
main	O
exploitation	O
script	O
''	O
wreq.php	O
''	O
,	O
''	O
main.php	O
''	O
or	O
''	O
main.jpg	O
''	O
performs	O
a	O
numbers	O
of	O
tasks	O
.	O
We	O
have	O
located	O
several	O
versions	O
of	O
this	O
script	B-Entity
which	O
attempt	B-Action
various	O
exploitation	O
mechanisms	O
.	O
One	O
version	O
of	O
this	O
script	B-Entity
attempts	O
to	O
exploit	B-Action
Internet	O
Explorer	O
versions	O
6	O
,	O
7	O
and	O
8	O
:	O
Unfortunately	O
,	O
the	O
Internet	O
Explorer	O
exploits	O
have	O
not	O
yet	O
been	O
retrieved	O
.	O
Another	O
more	O
recent	O
version	O
attempts	O
to	O
exploit	B-Action
Oracle	O
Sun	O
Java	O
and	O
Adobe	O
Flash	O
Player	O
:	O
Although	O
the	O
Flash	O
Player	O
exploits	O
could	O
n't	O
be	O
retrieved	O
,	O
we	B-Entity
did	O
manage	O
to	O
obtain	B-Action
the	O
Java	O
exploits	O
:	O
The	O
Java	O
files	B-Entity
exploit	B-Action
a	O
popular	O
vulnerability	O
,	O
CVE-2012	B-Entity
-	O
1723	O
,	O
in	B-Modifier
various	B-Entity
configurations	I-Entity
.	O
The	O
payload	O
dropped	B-Action
by	O
these	O
Java	O
exploits	O
is	O
the	O
following	O
:	O
The	O
Java	O
exploit	O
use	O
a	O
special	O
loader	O
that	O
attempts	O
to	O
inject	B-Action
the	O
final	O
Epic	O
backdoor	O
payload	O
into	B-Modifier
explorer.exe	B-Entity
.	O
The	O
backdoor	O
extracted	O
from	O
the	O
Java	O
exploits	B-Entity
has	O
the	O
following	O
C	O
&	O
C	O
hardcoded	O
inside	O
:	O
This	O
C	O
&	O
C	O
is	O
still	O
online	O
at	O
the	O
moment	O
although	O
it	B-Entity
redirects	B-Action
to	B-Modifier
a	O
currently	O
suspended	O
page	O
at	O
''	O
hxxp	O
:	O
//busandcoachdirectory.com	O
[	O
.	O
]	O
au	O
''	O
.	O
For	O
a	O
full	O
list	O
of	O
C	O
&	O
C	O
servers	O
,	O
please	O
see	O
the	O
Appendix	O
.	O
The	O
Epic	O
Turla	O
attackers	B-Entity
are	O
extremely	O
dynamic	O
in	O
using	B-Action
exploits	B-Entity
or	O
different	O
methods	O
depending	O
on	O
what	O
is	O
available	O
at	O
the	O
moment	O
.	O
Most	O
recently	O
,	O
we	O
observed	O
them	B-Entity
using	B-Action
yet	O
another	O
technique	O
coupled	O
with	O
watering	O
hole	O
attacks	O
.	O
This	O
takes	O
advantage	O
of	O
social	O
engineering	O
to	O
trick	O
the	O
user	O
into	O
running	O
a	O
fake	O
Flash	O
Player	O
(	O
MD5	O
:	O
030f5fdb78bfc1ce7b459d3cc2cf1877	B-Entity
)	O
:	O
In	O
at	O
least	O
one	O
case	O
,	O
they	B-Entity
tried	O
to	O
trick	O
the	O
user	O
into	O
downloading	B-Action
and	O
running	B-Action
a	O
fake	O
Microsoft	O
Security	O
Essentials	O
app	O
(	O
MD5	O
:	O
89b0f1a3a667e5cd43f5670e12dba411	O
)	O
:	O
The	O
fake	O
application	O
is	O
signed	O
by	O
a	O
valid	O
digital	O
certificate	O
from	O
Sysprint	O
AG	O
:	O
This	B-Entity
file	I-Entity
was	O
distributed	O
from	O
the	O
Ministry	O
of	O
Foreign	O
Affairs	O
of	O
Tajikistan	O
's	O
website	O
,	O
at	O
''	O
hxxp	O
:	O
//mfa	O
[	O
.	O
]	O
tj	O
/	O
upload	O
/	O
security.php	O
''	O
.	O
The	O
file	B-Entity
is	O
a	O
.NET	O
application	I-Entity
that	O
contains	B-Action
an	B-Entity
encrypted	B-Action
resource	B-Entity
.	O
This	B-Entity
drops	B-Action
the	O
malicious	O
file	O
with	O
the	O
MD5	O
7731d42b043865559258464fe1c98513	O
.	O
This	O
is	O
an	O
Epic	O
backdoor	O
which	O
connects	B-Action
to	B-Modifier
the	O
following	O
C	O
&	O
Cs	O
,	O
with	O
a	O
generic	O
internal	O
ID	O
of	O
1156fd22-	O
3443	O
-	O
4344-c4ffff	O
:	O
A	O
full	O
list	O
with	O
all	O
the	O
C	O
&	O
C	O
server	O
URLs	O
that	O
we	O
recovered	O
from	O
the	O
samples	O
can	O
be	O
found	O
in	O
the	O
technical	O
Appendix	O
.	O
The	O
Epic	O
backdoors	O
are	O
commanded	O
by	O
a	O
huge	O
network	O
of	O
hacked	O
servers	O
that	O
deliver	B-Action
command	B-Entity
and	O
control	B-Action
functionality	B-Entity
.	O
The	O
huge	O
network	O
commanded	B-Action
by	O
the	O
Epic	O
Turla	O
attackers	B-Entity
serves	B-Action
multiple	O
purposes	O
.	O
For	O
instance	O
,	O
the	O
motherships	O
function	O
as	O
both	O
exploitation	O
sites	O
and	O
command	B-Action
and	O
control	O
panels	O
for	O
the	O
malware	O
.	O
Here	O
's	O
how	O
the	O
big	O
picture	O
looks	O
like	O
:	O
The	O
first	O
level	O
of	O
command	O
and	O
control	B-Action
proxies	B-Entity
generally	O
talk	B-Action
to	B-Modifier
a	O
second	O
level	O
of	O
proxies	O
,	O
which	O
in	O
turn	O
,	O
talk	B-Action
to	B-Modifier
the	O
''	O
mothership	O
''	O
server	B-Entity
.	O
The	O
mothership	O
server	O
is	O
generally	O
a	O
VPS	O
,	O
which	O
runs	B-Action
the	O
Control	O
panel	O
software	O
used	O
to	O
interact	B-Action
with	O
the	O
victims	O
.	O
The	O
attackers	B-Entity
operate	O
the	O
mothership	O
using	O
a	O
network	O
of	O
proxies	O
and	O
VPN	O
servers	O
for	O
anonymity	O
reasons	O
.	O
The	O
mothership	O
also	O
work	O
as	O
the	O
exploitation	O
servers	O
used	O
in	O
the	O
watering	O
hole	O
attacks	O
,	O
delivering	B-Action
Java	B-Entity
,	O
IE	B-Entity
or	O
fake	B-Action
applications	B-Entity
to	B-Modifier
the	O
victim	O
.	O
We	O
were	O
able	O
to	O
get	O
a	O
copy	O
of	O
one	O
of	O
the	O
motherships	O
,	O
which	O
provided	O
some	O
insight	O
into	O
the	O
operation	O
.	O
It	O
runs	O
a	O
control	O
panel	O
which	O
is	B-Action
password	B-Entity
protected	B-Action
:	O
Once	O
logged	O
into	O
the	O
Control	O
panel	O
,	O
the	O
attackers	B-Entity
can	O
see	O
a	O
general	O
overview	O
of	O
the	O
system	O
including	O
the	O
number	O
of	O
interesting	O
potential	O
targets	O
:	O
A	O
very	O
interesting	O
file	O
on	O
the	O
servers	O
is	O
task.css	O
,	O
where	O
the	O
attackers	O
define	O
the	O
IP	O
ranges	O
they	O
are	O
interested	O
in	O
.	O
To	O
change	O
the	O
file	O
,	O
they	B-Entity
are	O
using	O
the	O
''	O
Task	O
editor	O
''	O
from	O
the	O
menu	O
.	O
Depending	O
on	O
the	O
''	O
tasks	O
''	O
,	O
they	B-Entity
will	O
decide	O
whether	O
to	O
infect	B-Action
the	O
visitors	O
or	O
not	O
.	O
In	O
this	O
case	O
,	O
we	O
found	O
they	B-Entity
targeted	O
two	O
ranges	O
belonging	B-Action
to	B-Modifier
:	O
It	B-Entity
should	O
be	O
noted	O
though	O
,	O
the	O
fact	O
that	O
the	O
attackers	B-Entity
were	O
targeting	O
these	O
ranges	O
does	O
n't	O
necessarily	O
mean	B-Action
they	B-Entity
also	O
got	O
infected	O
.	O
Some	O
other	O
unknown	O
IPs	O
were	O
also	O
observed	O
in	O
the	O
targeting	O
schedules	O
.	O
There	O
is	O
also	O
an	O
''	O
except.css	O
''	O
file	O
where	O
attackers	B-Entity
log	O
the	O
reasons	O
they	B-Entity
did	O
n't	O
try	O
to	O
exploit	B-Action
certain	B-Entity
visitors	I-Entity
.	O
There	O
are	O
three	O
possible	O
values	O
:	O
These	O
are	O
the	O
''	O
do	O
n't	O
meet	O
the	O
conditions	O
''	O
reasons	O
observed	O
in	O
the	O
logs	O
:	O
For	O
this	O
first	O
stage	O
of	O
the	O
attack	O
,	O
the	O
threat	O
actor	O
uses	O
a	O
custom	O
backdoor	O
.	O
In	O
some	O
cases	O
,	O
the	O
backdoor	O
is	O
packaged	O
together	O
with	O
the	O
CVE-2013	O
-	O
5065	O
EoP	O
exploit	O
and	O
heavily	O
obfuscated	B-Action
.	O
This	B-Entity
makes	B-Action
the	O
analysis	O
more	O
difficult	O
.	O
The	O
CVE-2013	O
-	O
5065	O
exploit	O
allows	O
the	O
backdoor	O
to	O
achieve	O
administrator	O
privileges	O
on	O
the	O
system	O
and	O
run	B-Action
unrestricted	B-Entity
.	O
This	O
exploit	O
only	O
works	O
on	O
unpatched	O
Microsoft	O
Windows	O
XP	O
systems	O
.	O
Other	O
known	O
detection	O
names	O
for	O
the	O
backdoor	O
is	O
Trojan	O
.	O
Wipbot	O
(	O
Symantec	O
)	O
or	O
Tavdig	O
.	O
The	O
main	O
backdoor	O
is	O
about	O
60	O
KB	O
in	O
size	O
and	O
implements	B-Action
a	O
C	O
&	O
C	O
protocol	O
on	O
top	O
of	O
normal	O
HTTP	B-Entity
requests	I-Entity
.	O
The	O
communication	O
protocol	O
uses	B-Action
requests	B-Entity
in	B-Modifier
the	O
C	O
&	O
C	O
replies	O
,	O
which	O
the	O
malware	O
decrypts	O
and	O
processes	B-Entity
.	O
The	O
replies	O
are	O
sent	O
back	B-Action
to	B-Modifier
the	O
C	O
&	O
C	O
through	O
the	O
same	O
channel	O
.	O
The	O
malware	O
behavior	O
is	O
defined	O
by	O
a	O
configuration	O
block	O
.	O
The	O
configuration	O
block	O
usually	O
contains	B-Action
two	O
hard	O
-	O
coded	O
C	O
&	O
C	O
URLs	O
.	O
He	O
have	O
also	O
seen	O
one	O
case	O
where	O
the	O
configuration	O
block	O
contains	O
just	O
one	O
URL	O
.	O
The	O
configuration	O
can	O
also	O
be	O
updated	O
on	O
the	O
fly	O
by	O
the	O
attackers	B-Entity
,	O
via	B-Modifier
the	O
C	O
&	O
C	O
.	O
The	O
backdoor	O
attempts	O
to	O
identify	O
the	O
following	B-Action
processes	B-Entity
and	O
,	O
if	O
found	O
,	O
it	B-Entity
will	O
terminate	B-Action
itself	B-Entity
:	O
It	B-Entity
contains	O
an	O
internal	O
unique	O
ID	O
,	O
which	O
is	B-Action
used	I-Action
to	O
identify	O
the	O
victim	O
to	O
the	O
C	O
&	O
C	O
.	O
Most	O
samples	O
,	O
especially	O
old	O
ones	O
,	O
have	O
the	O
ID	O
1156fd22	O
-	O
3443	O
-	O
4344-c4ffff	O
.	O
Once	O
a	O
victim	O
is	O
confirmed	O
as	O
''	O
interesting	O
''	O
,	O
the	O
attackers	B-Entity
upload	B-Action
another	B-Entity
Epic	O
backdoor	O
which	O
has	O
a	O
unique	O
ID	O
used	O
to	O
control	O
this	O
specific	O
victim	O
.	O
During	O
the	O
first	O
C	O
&	O
C	O
call	O
,	O
the	O
backdoor	O
sends	O
a	O
pack	O
with	O
the	O
victim	O
's	O
system	O
information	B-Entity
.	O
All	O
further	O
information	B-Entity
sent	B-Action
to	B-Modifier
the	O
C	O
&	O
C	B-Entity
is	B-Action
encrypted	I-Action
with	O
a	O
public	O
key	O
framework	O
,	O
making	O
decryption	O
impossible	O
.	O
The	O
commands	B-Entity
from	B-Modifier
the	O
C	O
&	O
C	O
are	O
encrypted	O
in	O
a	O
simpler	O
manner	O
and	O
can	O
be	O
decrypted	O
if	O
intercepted	O
because	O
the	O
secret	O
key	O
is	O
hardcoded	O
in	O
the	O
malware	O
.	O
Through	B-Modifier
monitoring	B-Entity
,	O
we	O
were	O
able	O
to	O
capture	O
a	O
large	O
amount	O
of	O
commands	B-Entity
sent	B-Action
to	B-Modifier
the	O
victims	O
by	O
the	O
attackers	B-Entity
,	O
providing	O
an	O
unique	O
view	O
into	O
this	O
operation	O
.	O
Here	O
's	O
a	O
look	O
at	O
one	O
of	O
the	O
encrypted	B-Action
server	B-Entity
replies	B-Action
:	O
Once	O
a	O
victim	O
is	O
infected	B-Action
and	O
''	O
checks	O
in	O
''	O
with	O
the	O
server	O
,	O
the	O
attackers	B-Entity
send	B-Action
a	O
template	O
of	O
commands	B-Entity
:	O
Next	O
,	O
the	O
attackers	B-Entity
try	O
to	O
move	O
through	O
the	O
victim	O
's	O
network	O
using	O
pre	O
-	O
defined	O
or	O
collected	B-Action
passwords	B-Entity
:	O
Listing	O
all	O
.doc	O
files	B-Entity
recursively	O
is	O
also	O
a	O
common	O
''	O
theme	O
''	O
:	O
In	O
total	O
,	O
we	B-Entity
have	O
decoded	O
several	O
hundreds	O
of	O
these	O
command	O
packages	O
delivered	B-Action
to	B-Modifier
the	O
victims	O
,	O
providing	O
an	O
unique	O
insight	O
into	O
the	O
inner	O
workings	O
of	O
the	O
attackers	B-Entity
.	O
In	O
addition	O
to	O
generic	O
searches	O
,	O
some	O
very	O
specific	O
lookups	O
have	O
been	O
observed	O
as	O
well	O
.	O
These	O
include	O
searches	B-Action
for	O
:	O
In	O
this	O
case	O
,	O
the	O
attackers	B-Entity
were	O
interested	O
to	O
find	O
e	O
-	O
mails	B-Entity
related	B-Action
to	B-Modifier
''	O
NATO	O
''	O
,	O
''	O
Energy	O
Dialogue	O
within	O
European	O
Unition	O
''	O
and	O
so	O
on	O
.	O
For	O
some	O
of	O
the	O
C	O
&	O
C	O
servers	O
,	O
the	O
attackers	B-Entity
implemented	O
RSA	O
encryption	O
for	O
the	O
C	O
&	O
C	O
logs	B-Entity
,	O
which	O
makes	B-Action
it	B-Entity
impossible	O
to	O
decrypt	B-Action
them	B-Entity
.	O
This	O
scheme	O
was	O
implemented	O
in	O
April	O
2014	O
.	O
Once	O
a	O
victim	O
is	O
compromised	O
,	O
the	O
attackers	B-Entity
upload	B-Action
several	B-Entity
tools	I-Entity
that	O
are	O
used	O
for	O
lateral	O
movement	O
.	O
One	O
such	O
tool	O
observed	O
in	O
the	O
attacks	O
and	O
saved	B-Action
as	O
''	O
C	O
:	O
\Documents	O
and	O
Settings\All	O
users\Start	O
Menu\Programs\Startup\winsvclg.exe	O
''	O
is	O
:	O
This	B-Entity
is	O
a	O
keylogger	O
tool	O
that	O
creates	B-Action
%	O
temp	O
%	O
\~DFD3O8.tmp	O
.	O
Note	O
:	O
the	O
filename	O
can	O
change	O
across	O
victims	O
.	O
On	O
one	O
Central	O
Asian	O
government	O
's	O
Ministry	O
of	O
Foreign	O
Affairs	O
victim	O
system	B-Entity
,	O
the	O
filename	B-Entity
used	B-Action
was	O
''	O
adobe32updt.exe	O
''	O
.	O
In	O
addition	O
to	O
these	O
custom	O
tools	O
,	O
we	O
observed	O
the	O
usage	O
of	O
standard	O
administration	O
utilities	O
.	O
For	O
instance	O
,	O
another	B-Entity
tool	I-Entity
often	O
uploaded	B-Action
by	O
the	O
attackers	B-Entity
to	B-Modifier
the	O
victim	O
's	O
machine	O
is	O
''	O
winrs.exe	O
''	O
:	O
This	B-Entity
is	O
an	O
UPX	O
packed	O
binary	O
,	O
which	O
contains	B-Action
the	O
genuine	O
''	O
dnsquery.exe	O
''	O
tool	O
from	O
Microsoft	O
,	O
unpacked	B-Action
MD5	B-Entity
:	O
c0c03b71684eb0545ef9182f5f9928ca	B-Entity
.	O
In	O
several	O
cases	O
,	O
an	O
interesting	O
update	O
has	O
been	O
observed	O
--	O
a	O
malware	O
from	O
a	O
different	O
,	O
yet	O
related	B-Action
family	B-Entity
.	O
This	O
backdoor	O
is	O
more	O
sophisticated	O
and	O
belongs	B-Action
to	B-Modifier
the	O
next	O
level	O
of	O
cyber	O
-	O
espionage	O
tools	O
called	O
the	O
''	O
Carbon	O
system	O
''	O
or	O
Cobra	O
by	O
the	O
Turla	O
attackers	B-Entity
.	O
Several	O
plugins	O
for	O
the	O
''	O
Carbon	O
system	O
''	O
are	O
known	O
to	O
exist	B-Action
.	O
Note	O
:	O
the	O
command	O
and	O
control	O
servers	O
www.losguayaberos	O
[	O
.	O
]	O
com	B-Entity
and	O
thebesttothbrushes	O
[	O
.	O
]	O
com	B-Entity
have	O
been	B-Action
sinkholed	I-Action
by	O
Kaspersky	O
Lab	O
.	O
Other	O
packages	O
delivered	B-Action
to	B-Modifier
the	O
victims	O
include	O
:	O
These	O
top	O
level	O
packages	O
deploy	B-Action
both	O
updated	O
Epic	O
backdoors	O
and	O
Turla	O
Carbon	O
system	O
backdoors	B-Entity
to	B-Modifier
confirmed	O
victims	O
,	O
effectively	O
linking	O
the	O
Epic	O
and	O
Turla	O
Carbon	O
operations	O
together	O
.	O
The	O
Turla	O
Carbon	O
dropper	B-Entity
from	O
these	O
packages	O
has	O
the	O
following	O
properties	O
:	O
This	B-Entity
is	O
called	O
internally	O
by	O
the	O
authors	O
''	O
Carbon	O
System	O
''	O
,	O
part	B-Action
of	O
the	O
''	O
Cobra	O
''	O
project	O
,	O
as	B-Modifier
it	B-Entity
can	O
be	O
seen	O
from	O
the	O
debug	O
path	O
inside	O
:	O
This	B-Entity
acts	O
as	O
a	O
dropper	O
for	O
the	O
following	O
modules	O
,	O
both	O
32	O
and	O
64	O
bit	O
:	O
The	O
Carbon	O
system	O
is	O
in	O
essence	O
an	O
extensible	O
platform	O
,	O
very	O
similar	O
to	B-Modifier
other	O
attack	O
platforms	O
such	O
as	O
the	O
Tilded	O
platform	O
or	O
the	O
Flame	O
platform	O
.	O
The	O
plugins	O
for	O
the	O
Carbon	O
system	B-Entity
can	O
be	O
easily	O
recognized	B-Action
as	B-Modifier
they	B-Entity
always	O
feature	O
at	O
least	O
two	O
exports	O
named	O
:	O
Several	O
Epic	O
backdoors	O
appear	O
to	O
have	O
been	O
designed	O
to	O
work	O
as	O
Carbon	O
system	O
plugins	O
as	O
well	O
-	O
they	B-Entity
require	O
a	O
specialized	O
loader	O
to	O
start	B-Action
in	B-Modifier
victim	B-Entity
systems	I-Entity
that	O
do	O
not	O
have	O
the	O
Carbon	O
system	O
deployed	O
.	O
Some	O
modules	O
have	O
artifacts	B-Action
which	O
indicate	O
the	O
Carbon	O
system	O
is	O
already	O
at	O
version	O
3.x	O
,	O
although	O
the	O
exact	O
Carbon	O
system	O
version	O
is	O
very	O
rarely	O
seen	O
in	O
samples	O
:	O
The	O
author	O
of	O
the	O
Carbon	O
module	O
above	O
can	O
be	O
also	O
seen	O
in	O
the	O
code	B-Entity
,	O
as	O
''	O
gilg	O
''	O
,	O
which	O
also	O
authored	O
several	O
other	O
Turla	O
modules	O
.	O
We	O
are	O
planning	O
to	O
cover	O
the	O
Turla	O
Carbon	O
system	O
with	O
more	O
details	O
in	O
a	O
future	O
report	O
.	O
The	O
payload	O
recovered	O
from	O
one	O
of	O
the	O
mothership	O
servers	O
(	O
at	O
newsforum.servehttp	O
[	O
.	O
]	O
com	O
/	O
wordpress	O
/	O
wp	O
-	O
includes	O
/	O
css	O
/	O
img	O
/	O
upload.php	B-Action
,	O
MD5	O
:	O
4dc22c1695d1f275c3b6e503a1b171f5	B-Entity
,	O
Compiled	O
:	O
Thu	O
Sep	O
06	O
14:09:55	O
2012	O
)	O
contains	B-Action
two	B-Entity
modules	I-Entity
,	O
a	O
loader	O
/	O
injector	B-Action
and	O
a	O
backdoor	O
.	O
Internally	O
,	O
the	O
backdoor	O
is	O
named	O
''	O
Zagruzchick.dll	O
''	O
:	O
The	O
word	O
''	O
Zagruzchick	O
''	O
means	O
''	O
boot	O
loader	O
''	O
in	O
Russian	O
.	O
The	O
Control	O
panel	O
for	O
the	O
Epic	O
motherships	O
also	O
sets	B-Action
the	O
language	O
to	O
codepage	O
''	O
1251	O
''	O
:	O
Codepage	O
1251	O
is	O
commonly	O
used	B-Action
to	O
render	B-Action
Cyrillic	B-Entity
characters	I-Entity
.	O
There	O
are	O
other	O
indications	O
that	O
the	O
attackers	O
are	O
not	O
native	O
English	O
language	O
speakers	O
:	O
The	O
sample	O
e9580b6b13822090db018c320e80865f	O
that	O
was	B-Action
delivered	I-Action
to	B-Modifier
several	O
Epic	O
victims	O
as	O
an	O
upgraded	O
backdoor	O
,	O
has	O
the	O
compilation	O
code	O
page	O
language	O
set	B-Action
to	B-Modifier
''	O
LANGRUSSIAN	O
''	O
.	O
The	O
threat	O
actor	O
behind	O
the	O
''	O
Epic	O
''	O
operation	O
uses	O
mainly	O
hacked	O
servers	O
to	O
host	O
their	O
proxies	O
.	O
The	O
hacked	O
servers	O
are	O
controlled	O
through	O
the	O
use	B-Action
of	O
a	O
PHP	O
webshell	O
.	O
This	O
shell	O
is	O
password	O
protected	O
;	O
the	O
password	O
is	O
checked	O
against	O
an	O
MD5	O
hash	O
:	O
The	O
MD5	O
''	O
af3e8be26c63c4dd066935629cf9bac8	O
''	O
has	O
been	O
solved	B-Action
by	O
Kaspersky	O
Lab	O
as	O
the	O
password	O
''	O
kenpachi	O
''	O
.	O
In	O
February	O
2014	O
we	O
observed	O
the	O
Miniduke	O
threat	O
actor	O
using	O
the	O
same	O
backdoor	O
on	O
their	O
hacked	O
servers	O
,	O
although	O
using	O
a	O
much	O
stronger	O
password	O
.	O
Once	O
again	O
,	O
it	B-Entity
is	O
also	O
interesting	O
to	O
point	O
out	O
the	O
usage	O
of	O
Codepage	O
1251	O
in	O
the	O
webshell	O
,	O
which	O
is	B-Action
used	I-Action
to	O
render	B-Action
Cyrillic	B-Entity
characters	I-Entity
.	O
There	O
appears	O
to	O
be	O
several	O
links	O
between	O
Turla	O
and	O
Miniduke	B-Entity
,	O
but	O
we	B-Entity
will	O
leave	O
that	O
for	O
a	O
future	O
blogpost	O
.	O
On	O
some	O
of	O
the	O
C	O
&	O
C	O
servers	B-Entity
used	B-Action
in	O
the	O
Epic	O
attacks	O
,	O
we	O
were	O
able	O
to	O
identify	O
detailed	O
victim	O
statistics	O
,	O
which	O
were	O
saved	B-Action
for	B-Modifier
debugging	B-Entity
purposes	I-Entity
by	O
the	B-Entity
attackers	I-Entity
.	O
This	O
is	O
the	O
country	O
distribution	O
for	O
the	O
top	O
20	O
affected	O
countries	O
by	O
victim	O
's	O
IP	O
:	O
According	B-Entity
to	B-Modifier
the	O
public	O
information	O
available	O
for	O
the	O
victims	O
'	O
IPs	O
,	O
targets	B-Action
of	O
''	O
Epic	O
''	O
belong	O
to	O
the	O
following	O
categories	O
:	O
When	O
G	O
-	O
Data	O
published	O
their	O
Turla	O
paper	O
,	O
there	O
were	O
few	O
details	O
publicly	O
available	O
on	O
how	O
victims	B-Entity
get	O
infected	B-Action
with	O
this	O
malware	O
campaign	O
.	O
Our	O
analysis	O
indicates	O
this	O
is	O
a	O
sophisticated	O
multi	O
-	O
stage	O
infection	O
;	O
which	O
begins	B-Action
with	O
Epic	O
Turla	O
.	O
This	O
is	O
used	O
to	O
gain	B-Action
a	O
foothold	O
and	O
validate	O
the	O
high	O
profile	O
victim	O
.	O
If	O
the	O
victim	O
is	O
interesting	O
,	O
they	B-Entity
get	O
upgraded	B-Action
to	B-Modifier
the	O
Turla	O
Carbon	O
system	B-Entity
.	O
Most	O
recently	O
,	O
we	O
observed	O
this	O
attack	O
against	O
a	O
Kaspersky	O
Lab	O
user	O
on	O
August	O
5	O
,	O
2014	O
,	O
indicating	O
the	O
operation	O
remains	O
fresh	O
and	O
ongoing	B-Action
.	O
Note	O
:	O
A	O
full	O
analysis	O
of	O
the	O
Epic	O
attacks	O
is	O
available	B-Entity
to	B-Modifier
the	O
Kaspersky	O
Intelligent	O
Services	O
customers	O
.	O
Contact	O
:	O
intelreports	O
@	O
kaspersky.com	O
We	O
would	O
like	O
to	O
add	O
the	O
following	O
at	O
the	O
end	O
of	O
the	O
blogpost	O
,	O
right	O
before	O
the	O
detection	O
names	O
:	O
If	O
you	O
'd	O
like	O
to	O
read	B-Action
more	O
about	O
Turla	O
/	O
Uroburos	B-Entity
,	O
here	O
's	O
a	O
few	O
recommendations	O
:	O
Downloaders	B-Entity
,	O
injectors	B-Entity
,	O
infostealers	O
Example	O
md5s	O
of	O
files	B-Entity
detected	O
with	O
Kaspersky	O
's	O
Virus	O
.	O
Win32.Pioneer.dx	O
and	O
Symantec	O
's	O
Infostealer	O
.	O
Nemim	O
!	O
inf	O
:	O
To	O
ensure	B-Action
only	O
single	O
instance	O
of	O
the	O
module	O
is	O
running	B-Action
,	O
the	O
module	O
verifies	B-Entity
if	B-Modifier
system	B-Entity
mutex	O
named	O
«	O
132DF6E	O
»	O
exists	O
.	O
If	O
it	B-Entity
exists	O
the	O
module	O
exits	O
,	O
if	O
not	O
­the	O
module	O
creates	O
one	O
.	O
The	O
module	O
implements	O
a	O
method	O
to	O
resist	B-Action
running	B-Entity
in	B-Modifier
virtual	B-Entity
environment	I-Entity
.	O
It	O
gets	O
CPU	O
name	O
and	O
identifier	O
from	O
the	O
registry	O
at	O
HKLM\HARDWARE\DESCRIPTION\	O
System\CentralProcessor\0	O
and	O
collects	B-Action
IP	B-Entity
and	O
MAC	O
addresses	O
of	O
local	O
network	O
adapters	O
.	O
After	O
that	O
it	B-Entity
compiles	O
a	O
string	O
describing	O
the	O
system	O
in	O
the	O
following	O
format	O
:	O
«	O
C	O
P	O
U	O
:	O
%	O
CPUNAME	O
%	O
<	O
br	O
>	O
Net	O
card	O
:	O
%	O
IP	O
%	O
(	O
%	O
MACADDR	O
%	O
)	O
<	O
br	O
>	O
»	O
.	O
Next	O
it	B-Entity
checks	B-Action
if	O
this	O
string	O
contains	O
one	O
of	O
the	O
following	O
substrings	O
:	O
If	O
any	O
of	O
these	O
strings	O
is	O
found	O
,	O
the	B-Entity
module	I-Entity
terminates	B-Action
.	O
After	O
that	O
,	O
there	O
is	O
a	O
hardcoded	O
value	O
of	O
10	O
,	O
which	O
delays	B-Action
further	B-Entity
execution	O
of	O
the	O
module	O
for	O
10	O
seconds	O
.	O
Then	O
the	O
module	B-Entity
attempts	O
to	O
delete	B-Action
some	B-Entity
other	O
,	O
prob-	O
ably	O
older	O
,	O
components	B-Entity
which	O
might	O
be	O
present	O
on	O
the	O
system	B-Entity
.	O
The	O
list	O
of	O
deleted	B-Action
files	B-Entity
includes	O
the	O
following	O
:	O
The	O
next	O
is	O
step	O
is	O
to	O
check	B-Action
if	O
current	O
directory	O
has	O
a	O
file	O
named	O
«	O
U	O
»	O
.	O
If	O
not	O
,	O
the	O
module	B-Entity
proceeds	O
with	O
network	O
communication	O
routine	O
.	O
But	O
if	O
this	B-Entity
file	I-Entity
is	O
found	O
it	B-Entity
does	B-Action
some	O
additional	O
checks	B-Action
.	O
If	O
«	O
U	O
»	O
file	B-Entity
is	O
older	O
than	O
180	O
days	O
,	O
the	O
module	O
wipes	O
the	O
file	O
.	O
If	O
not	O
,	O
it	B-Entity
triggers	O
a	O
special	O
variable	O
that	O
makes	B-Action
module	B-Entity
dormant	B-Entity
and	O
dis-	O
ables	O
further	O
communication	O
with	O
C	O
&	O
C	O
server	B-Entity
.	O
After	O
all	O
,	O
if	O
the	O
module	O
is	O
ready	O
and	O
allowed	O
to	O
communicate	B-Action
with	O
C	O
&	O
C	O
server	B-Entity
it	B-Entity
does	B-Action
that	O
in	O
the	O
following	O
manner	O
.	O
1	O
.	O
The	O
module	B-Entity
connects	B-Action
to	B-Modifier
autolace.twilightparadox.com	B-Entity
(	O
or	O
automachine	B-Action
.	O
servequake.com	O
)	O
and	O
issues	O
a	O
HTTP	O
GET	O
request	O
with	O
hardcoded	O
User­Agent	O
string	O
:	O
The	O
server	O
response	O
should	O
contain	O
«	O
DEXT87	O
»	O
string	B-Action
which	O
is	B-Action
used	I-Action
to	B-Modifier
rec-	O
ognize	O
valid	O
response	O
.	O
The	O
malware	B-Entity
locates	B-Action
«	O
DEXT87	O
»	O
and	O
reads	B-Action
the	O
data	O
appended	O
to	B-Modifier
it	B-Entity
.	O
The	O
appended	O
data	O
should	O
be	O
an	O
IP	O
address	O
in	O
plaintext	O
.	O
This	O
is	O
used	O
a	O
real	O
C	O
&	O
C	O
IP	O
address	O
.	O
Reading	O
stops	O
when	O
non­digit	O
or	O
dot	O
symbol	O
is	O
found	O
.	O
Here	O
is	O
an	O
example	O
of	O
shortest	O
possible	O
valid	O
server	O
response	O
:	O
2	O
.	O
If	O
the	O
real	O
C	O
&	O
C	O
IP	O
address	O
is	O
not	O
valid	O
the	O
module	B-Entity
may	O
try	O
to	O
send	B-Action
identical	O
request	O
again	B-Entity
but	O
using	B-Modifier
a	O
different	O
HTTP	O
path	O
:	O
If	O
the	O
C	O
&	O
C	O
IP	O
address	O
is	O
valid	O
,	O
the	O
module	O
issues	O
another	O
HTTP	O
request	O
:	O
The	O
server	O
response	O
can	O
be	O
one	O
of	O
the	O
following	O
:	O
Where	O
<	O
DATASIZE	O
>	O
is	O
a	O
decimal	O
integer	O
that	O
represents	O
length	O
of	O
<	O
DATA	O
>	O
field	O
in	O
bytes;	O
<	O
DATA	O
>	O
is	O
a	O
binary	O
data	O
separated	O
from	O
<	O
DATASIZE	O
>	O
field	O
by	O
semicolon	B-Entity
.	O
Please	O
note	O
,	O
that	O
after	O
receiving	O
<	O
DATA	O
>	O
,	O
it	B-Entity
is	O
XORed	O
with	O
byte	O
value	O
0x55	O
and	O
saved	B-Action
to	B-Modifier
a	O
disk	O
in	O
a	O
file	O
named	O
«	O
ctfmon.exe	O
»	O
(	O
current	O
directory	O
is	O
used	B-Action
)	O
.	O
Upon	O
successful	O
receiving	O
of	O
the	O
file	O
it	O
is	O
started	O
in	O
a	O
new	O
process	O
.	O
This	O
module	O
is	O
relatively	O
large	O
(	O
455Kb	O
)	O
and	O
comes	B-Action
as	O
a	O
part	O
of	O
WinRar	O
SFX	O
file	B-Entity
that	O
drops	B-Action
and	O
starts	O
the	O
module	O
from	O
%	O
APPDATA	O
%	O
\Microsoft\Display\DmaUp3	O
.	O
exe	O
.	O
The	O
main	O
purpose	O
of	O
the	O
module	O
is	O
to	O
collect	B-Action
various	B-Entity
secrets	I-Entity
stored	B-Action
on	B-Modifier
a	O
local	O
system	O
.	O
This	O
module	O
is	O
designed	O
not	O
to	O
run	B-Action
on	B-Modifier
Windows	B-Entity
with	B-Modifier
system	B-Entity
default	O
codepage	O
set	O
to	O
Korean	O
.	O
From	O
the	O
very	O
beginning	O
this	O
module	O
checks	B-Entity
if	O
«	O
bdagent.exe	O
»	O
process	O
is	O
running	B-Action
on	B-Modifier
current	B-Entity
system	I-Entity
.	O
Bdagent.exe	B-Entity
is	O
a	O
name	O
for	O
BitDefender	O
Antivirus	O
component	O
.	O
If	O
it	B-Entity
is	B-Action
running	I-Action
,	O
it	B-Entity
uses	B-Action
simple	O
AV	O
heuristics	O
evasion	O
technique	O
.	O
The	O
code	B-Entity
starts	O
a	O
thread	O
that	O
simulates	B-Action
keystrokes	B-Entity
of	O
ESC	O
keyboard	O
key	B-Entity
and	O
then	O
shows	O
a	O
system	O
modal	O
message	O
box	O
.	O
Pushing	O
ESC	O
key	O
closes	O
the	O
modal	O
message	O
box	O
.	O
Right	O
after	O
that	O
keystroke	O
generation	O
thread	O
is	O
terminated	B-Action
and	O
the	O
module	B-Entity
continues	O
normal	O
execution	O
as	O
if	O
«	O
bdagent.exe	O
»	O
was	O
not	O
running	B-Action
.	O
Next	O
the	O
module	B-Entity
makes	B-Action
sure	B-Entity
only	O
one	O
instance	O
of	O
current	O
code	O
is	O
running	B-Action
by	O
checking	B-Action
if	B-Modifier
system	B-Entity
mutex	O
object	O
named	O
«	O
920111215	O
»	O
exists	O
.	O
After	O
that	O
,	O
the	O
mod-	O
ule	O
collects	B-Action
information	B-Entity
about	O
current	O
system	O
which	O
includes	O
the	O
following	O
:	O
If	O
the	O
module	O
reveals	O
that	O
current	O
System	O
default	O
codepage	O
is	O
0412	O
(	O
Korean	O
)	O
it	B-Entity
terminates	B-Action
.	O
There	O
is	O
one	O
interesting	O
specifics	O
in	O
Microsoft	O
IntelliForms	O
which	O
reveals	B-Action
attack-	B-Entity
er	O
's	O
interests	O
.	O
IntelliForms	O
technology	O
keeps	O
login	O
/	O
password	O
information	O
in	O
the	O
registry	B-Entity
in	O
encrypted	B-Action
form	B-Entity
.	O
However	O
,	O
there	O
is	O
no	O
clear	O
information	O
about	O
the	O
corre-	O
sponding	O
website	O
which	O
requires	O
given	O
login	O
and	O
password	B-Entity
.	O
The	O
only	O
information	O
Intelliforms	O
offers	O
about	O
the	O
place	O
where	O
given	O
login	O
/	O
password	O
should	O
be	O
used	O
is	O
a	O
hash	O
of	O
the	O
webpage	O
URL	O
.	O
So	O
far	O
,	O
the	O
attackers	B-Entity
can	O
steal	B-Action
logins	B-Entity
and	O
pass-	O
words	O
but	O
to	O
understand	O
where	O
they	B-Entity
are	O
from	O
they	B-Entity
must	O
guess	O
the	O
string	O
which	O
produced	O
given	O
hash	O
.	O
They	B-Entity
have	O
implemented	O
this	O
logics	O
in	O
the	O
malware	O
.	O
When	O
IntelliForms	O
information	O
is	O
stolen	B-Action
the	O
malware	B-Entity
tries	O
to	O
check	O
the	O
list	O
of	O
known	O
login	O
page	O
URLs	O
to	O
recover	O
the	O
originating	O
webpage	O
address	O
.	O
Here	O
is	O
the	O
list	O
of	O
URLs	O
that	O
are	O
checked	O
by	O
the	O
malware	O
:	O
The	O
list	O
of	O
targeted	O
services	B-Entity
includes	O
some	O
local	O
services	O
specifically	O
popular	O
in	O
:	O
The	O
module	O
uses	O
several	O
simple	O
XOR­based	O
algorithms	O
to	O
encrypt	B-Action
embedded	O
string	O
data	O
.	O
String	O
encryption	O
/	O
decryption	O
functions	O
use	O
the	O
following	B-Action
keys	B-Entity
:	O
The	O
module	O
works	O
with	O
all	O
Firefox	O
versions	O
prior	O
to	O
Mozilla	O
Firefox	O
12.0	O
.	O
Depend-	O
ing	O
on	O
version	O
of	O
Firefox	O
,	O
it	B-Entity
can	O
read	B-Action
Firefox	O
database	O
directly	O
to	O
dump	O
stored	O
se-	O
crets	O
or	O
utilize	O
one	O
Firefox	O
libraries	B-Entity
to	O
access	O
the	O
configuration	O
data	O
.	O
In	O
addition	O
it	B-Entity
makes	B-Action
use	B-Entity
of	O
the	O
following	O
Mozilla	O
Firefox	O
libraries	O
depending	O
on	O
Firefox	O
version	O
:	O
When	O
stealing	B-Action
secrets	B-Entity
from	O
Firefox	O
and	O
Chrome	O
it	B-Entity
uses	B-Action
built­in	O
SQLite	O
library	O
code	B-Entity
.	O
The	O
module	O
is	O
linked	O
with	O
SQLite	O
version	O
3.7.5	O
release	O
candidate	O
2	O
,	O
release	O
hash	O
ed759d5a9edb3bba5f48f243df47be29e3fe8cd7	O
dated	O
as	O
2011­01­28	O
17:03:50	O
.	O
After	O
stealing	B-Action
secrets	B-Entity
from	B-Modifier
local	O
system	O
the	O
malware	B-Entity
executes	B-Action
some	O
kind	O
of	O
embedded	B-Action
script	B-Entity
.	O
It	B-Entity
is	O
logging	B-Action
all	B-Entity
actions	I-Entity
to	B-Modifier
inform	O
the	O
operator	O
what	O
exactly	O
was	O
executed	B-Action
by	O
this	O
variant	O
of	O
the	O
malware	O
.	O
The	O
result	O
of	O
this	O
execution	O
is	O
appended	B-Action
to	B-Modifier
the	O
stolen	B-Action
data	B-Entity
and	O
uploaded	B-Action
to	B-Modifier
the	O
C	O
&	O
C	O
server	B-Entity
.	O
The	O
module	B-Entity
uploads	B-Action
all	B-Entity
collected	B-Action
information	B-Entity
to	B-Modifier
one	B-Entity
of	O
the	O
following	O
URLs	O
via	O
POST	O
request	O
:	O
It	B-Entity
's	O
the	O
first	O
time	O
we	O
see	O
.pn	O
domain	B-Entity
used	B-Action
in	B-Modifier
malware	B-Entity
.	O
This	O
top	O
level	O
country	O
code	O
domain	O
is	O
quite	O
exotic	O
and	O
is	B-Action
assigned	I-Action
to	B-Modifier
Pitcairn	O
Islands	O
,	O
which	O
is	O
Overseas	O
ter-	O
ritory	O
of	O
the	O
United	O
Kingdom	O
in	O
the	O
Pacific	O
.	O
As	O
of	O
2013	O
estimated	O
population	O
of	O
Pitcairn	O
Islands	O
is	O
only	O
56	O
people	O
.	O
An	O
official	O
.pn	O
domain	O
costs	O
$	O
100/year	O
from	O
the	O
registry	B-Entity
,	O
however	O
.eu.pn	O
domains	O
seem	O
to	O
be	O
given	O
away	O
for	O
free	O
.	O
The	O
malware	B-Entity
uses	O
fixed	O
User­Agent	O
string	O
:	O
The	O
data	B-Entity
is	O
uploaded	B-Action
as	O
a	O
POST	O
request	O
binary	O
in	O
the	O
following	O
format	O
:	O
where	O
<	O
UserId	O
>	O
is	O
hardcoded	O
identifier	O
(	O
i.e	O
.	O
«	O
user2	O
»	O
in	O
current	O
sample	O
)	O
;	O
<	O
UniqueMachineId	O
>	O
is	O
a	O
32	O
characters	O
long	O
hex	O
string	O
which	O
derived	B-Action
from	B-Modifier
net-	O
work	O
card	O
MAC	O
address;	O
<	O
EncryptionKey	O
>	O
is	O
symmetrical	O
encryption	O
key	O
used	O
to	O
encrypt	B-Action
<	O
UserId	O
>	O
and	O
<	O
GeneralSysInfo	O
>	O
values	O
.	O
The	O
malware	B-Entity
uses	O
text	O
protocol	O
,	O
which	O
is	O
why	O
potentially	O
binary	O
values	O
of	O
<	O
UserId	O
>	O
and	O
<	O
GeneralSysInfo	O
>	O
are	O
ad-	O
ditionally	O
encoded	B-Action
using	B-Modifier
Base64	B-Entity
algorithm	I-Entity
.	O
<	O
GeneralSysInfo	O
>	O
field	O
contains	O
only	O
basic	O
information	O
about	O
the	O
system	B-Entity
,	O
i.e	B-Entity
.	O
:	O
If	O
the	O
server	O
reply	O
contains	O
a	O
keyword	O
«	O
minmei	O
»	O
it	B-Entity
continues	O
sending	B-Action
additional	B-Entity
in-	O
formation	O
.	O
«	O
Minmei	O
»	O
may	O
be	O
a	O
reference	O
to	O
a	O
popular	O
Japanese	O
anime	O
and	O
manga	B-Entity
known	O
as	O
«	O
The	O
Super	O
Dimension	O
Fortress	O
Macross	O
»	O
.	O
A	O
quote	O
from	O
Wikipedia	O
:	O
«	O
Born	O
in	O
Yokohama	O
Chinatown	O
,	O
Japan	O
(	O
though	O
she	O
is	O
of	O
partial	O
Chinese	O
descent	O
)	O
as	O
Linn	O
Minmei	O
,	O
Minmay	O
moved	O
in	O
with	O
her	O
uncle	O
Shaochin	O
(	O
少江	O
)	O
and	O
aunt	O
Feic-	O
hun	O
(	O
慧中	O
)	O
on	O
South	O
Ataria	O
Island	O
in	O
hopes	O
of	O
finding	O
the	O
path	O
to	O
fulfill	O
her	O
dream	O
of	O
becoming	O
a	O
star	O
.	O
»	O
The	O
trojan	O
iterates	O
through	O
running	O
processes	O
and	O
looks	B-Action
for	B-Modifier
security	O
software	O
basing	O
on	O
executable	O
filenames	O
from	O
the	O
list	O
below	O
.	O
If	O
the	O
process	O
is	O
found	O
it	B-Entity
keeps	B-Action
a	O
record	O
of	O
the	O
software	O
name	O
using	O
short	O
AV	O
Identifier	O
string	O
from	O
the	O
fol-	O
lowing	O
table	O
of	O
rules	O
The	O
malware	B-Entity
uses	O
a	O
trick	O
to	O
evade	B-Action
running	B-Entity
on	B-Modifier
a	O
VMware	O
.	O
First	O
,	O
it	B-Entity
checks	B-Action
if	O
cur-	O
rent	O
process	O
is	O
running	O
in	O
WOW64	O
environment	O
.	O
If	O
yes	O
it	B-Entity
does	B-Action
additional	O
port	O
I	O
/	O
O	O
specific	O
to	O
VMWare	O
virtual	O
machine	O
(	O
the	O
VMware	O
hypervisor	O
port	O
:	O
0x5658;	O
VMware	O
hypervisor	O
magic	O
value	O
:	O
0x564D5868	O
)	O
.	O
Another	O
method	O
to	O
detect	B-Action
VM	O
en-	O
vironment	O
is	O
to	O
check	O
local	O
network	O
adapter	O
's	O
IP	O
address	O
.	O
If	O
it	B-Entity
belongs	B-Action
to	B-Modifier
subnet	O
192.168.100	O
.	O
*	B-Entity
then	O
the	O
malware	B-Entity
believes	B-Action
it	B-Entity
's	O
running	O
in	O
a	O
VM	O
.	O
If	O
VM	O
is	O
detected	O
the	O
process	O
instantly	O
terminates	B-Action
.	O
Next	O
the	O
malware	O
submits	O
collected	B-Action
information	B-Entity
to	B-Modifier
the	O
C	O
&	O
C	O
server	O
using	O
HTTP	O
GET	O
request	O
and	O
the	O
following	O
URL	O
format	O
:	O
http	O
:	O
//	O
<	O
C2DOMAIN	O
>	O
/bin	O
/	O
readi.php	O
?	O
a1=	O
%	O
STEPID	O
%	O
&	O
a2=	O
%	O
HOSTID	O
%	O
&	O
a3=	O
%	O
SYSINFO	O
%	O
&	O
a4=	O
%	O
AVSOFTID	O
%	O
,	O
where	O
%	O
C2DOMAIN	O
%	O
is	O
one	O
of	O
the	O
following	O
C	O
&	O
C	O
domains	O
:	O
%	O
STEPID	O
%	O
is	O
special	O
text	O
string	O
indicating	O
stage	O
of	O
malware	O
operation	O
.	O
This	O
string	O
varies	O
depending	O
on	O
the	O
local	O
system	O
language	O
and	O
may	O
be	O
one	O
of	O
the	O
following	O
:	O
%	O
HOSTID	O
%	O
is	O
a	O
special	O
value	O
generated	B-Action
from	B-Modifier
local	O
network	O
card	O
MAC	O
address;	O
%	O
SYSINFO	O
%	O
is	O
a	O
string	O
with	O
general	O
system	O
information	O
(	O
please	O
see	O
description	O
above	O
)	O
;	O
%	O
AVSOFTID	O
%	O
is	O
a	O
string	O
that	O
contains	B-Action
indexes	B-Entity
of	O
AV	O
software	O
names	O
in	O
internal	O
table	O
of	O
AV	O
Identifiers	O
(	O
please	O
see	O
the	O
table	O
above	O
)	O
.	O
Igfxext.exe	B-Entity
can	O
download	B-Action
a	O
file	O
and	O
drop	B-Action
it	B-Entity
to	B-Modifier
%	O
APPDATA	O
%	O
\microsoft\dis-	O
play\ctfmon.exe	O
(	O
md5=	O
e8bfb82b0dd5cef46116d61f62c25060	O
)	O
.	O
After	O
execution	O
,	O
the	O
downloaded	B-Action
file	B-Entity
drops	B-Action
SMAGENT.EXE	B-Entity
(	O
md5	O
0306f9ae-	O
7786570139f78e78bc940597	O
)	O
to	B-Modifier
%	O
APPDATA	O
%	O
\MICROSOFT\DISPLAY	O
and	O
ex-	O
ecutes	O
it	B-Entity
.	O
This	O
component	O
is	O
a	O
virus	O
,	O
and	O
is	B-Action
used	I-Action
to	O
selectively	O
infiltrate	B-Action
into	B-Modifier
other	B-Entity
computers	I-Entity
via	B-Modifier
USB	B-Entity
or	O
network	O
shares	O
.	O
A	O
large	O
number	O
of	O
files	B-Entity
are	O
detected	O
by	O
Kaspersky	O
Lab	O
scanners	O
as	O
Virus	O
.	O
Win32	O
.	O
Pioneer.dx	I-Entity
.	O
These	B-Entity
files	I-Entity
are	O
all	O
legitimate	O
files	B-Entity
that	O
have	O
been	O
infected	B-Action
by	O
another	B-Entity
Darkhotel	O
component	O
.	O
All	O
of	O
these	O
infected	O
files	B-Entity
drop	B-Action
a	O
63	O
kb	O
self	O
injecting	B-Action
compo-	B-Entity
nent	I-Entity
.	O
This	O
malware	O
is	O
63	O
kb	O
in	O
size	O
.	O
It	B-Entity
is	B-Action
bound	I-Action
to	B-Modifier
a	O
variety	O
of	O
other	O
software	O
packages	O
that	O
vary	O
in	O
name	O
,	O
but	O
the	O
host	O
package	O
is	O
consistently	O
detected	O
as	O
''	O
Virus	O
.	O
Win32	O
.	O
Pioneer.dx	O
''	O
.	O
The	O
igfxext.exe	O
component	O
is	O
dropped	B-Action
to	B-Modifier
disk	B-Entity
and	O
run	B-Action
.	O
It	O
spawns	O
an-	O
other	O
suspended	O
process	O
with	O
its	O
own	O
igfxext.exe	O
image	O
,	O
but	O
decrypts	O
a	O
smaller	O
32	O
kb	O
executable	O
(	O
cf1319d94f33380622ba000b7d8ad6e9	O
,	O
Trojan­Downloader	B-Entity
.	O
Win32.Agent.xwge	O
)	O
from	B-Modifier
its	B-Entity
.data	I-Entity
section	O
in	O
memory	O
with	O
a	O
simple	O
xor	O
0xbb	O
.	O
The	O
running	O
process	O
overwrites	O
the	O
igfxext.exe	O
image	O
in	O
the	O
suspended	O
process	O
with	O
this	O
smaller	O
chunk	O
of	O
code	B-Entity
.	O
It	B-Entity
then	O
resumes	B-Action
the	O
thread	O
in	O
the	O
new	O
process	O
.	O
This	O
smaller	O
code	O
section	O
maintains	O
similar	O
functionality	O
to	O
the	O
''	O
worm	O
''	O
compo-	O
nent	O
:	O
Host	O
package	O
files	O
detected	O
as	O
''	O
Virus	O
.	O
Win32.Pioneer.dx	O
''	O
are	O
infected	O
legitimate	O
files	O
,	O
that	O
do	O
not	O
have	O
any	O
self­propagation	O
routines	O
.	O
It	B-Entity
is	O
signed	O
with	O
the	O
familiar	O
''	O
''	O
digital	O
certificate	O
.	O
This	O
sample	O
is	O
started	B-Action
by	O
code	B-Entity
running	B-Action
within	B-Modifier
svchost.exe	B-Entity
on	O
WinXP	O
SP3	O
.	O
It	B-Entity
drops	B-Action
a	O
keylogger	O
.	O
The	O
debug	O
path	O
inside	O
:	O
The	O
dropper	B-Entity
above	O
maintains	B-Action
,	O
drops	B-Action
and	O
installs	B-Action
this	O
kernel	O
mode	O
keylogger	O
:	O
Likely	O
,	O
it	B-Entity
was	O
developed	O
as	O
a	O
part	O
of	O
a	O
mid­to­late	O
2009	O
project	O
:	O
This	O
driver	O
package	O
is	O
built	O
to	O
look	O
like	O
a	O
legitimate	O
low	O
level	O
Microsoft	O
system	O
device	O
.	O
It	B-Entity
is	O
installed	B-Action
as	O
a	O
system	O
kernel	O
driver	O
''	O
Ndiskpro	O
''	O
service	O
,	O
described	O
as	O
a	O
''	O
Microcode	O
Update	O
Device	O
''	O
.	O
It	B-Entity
is	O
somewhat	O
surprising	O
that	O
there	O
is	O
no	O
rootkit	O
functionality	O
hiding	O
this	O
service	O
:	O
When	O
loaded	B-Action
,	O
the	O
NDISKPRO.SYS	O
driver	B-Entity
hooks	B-Action
both	O
INT	O
0x01	O
and	O
INT	O
0xff	O
,	O
and	O
retrieves	B-Action
keystroke	B-Entity
data	B-Entity
directly	O
from	O
port	O
0x60	O
,	O
the	O
motherboard	O
keyboard	O
con-	O
troller	O
itself	O
.	O
Here	O
we	O
see	O
the	O
local	O
port	O
variables	O
assigned	O
values	O
And	O
here	O
,	O
the	O
ports	O
are	O
directly	O
being	O
read	O
with	O
READPORTUCHAR	O
(	O
0x64	O
)	O
and	O
then	O
READPORTUCHAR	O
(	O
0x60	O
)	O
:	O
It	B-Entity
buffers	O
,	O
then	O
communicates	B-Action
the	O
data	B-Entity
to	B-Modifier
the	O
running	O
user	O
mode	O
component	O
.	O
This	O
component	O
then	O
encrypts	B-Action
and	O
writes	B-Action
the	O
retrieved	O
values	O
ondisk	O
to	B-Modifier
a	O
ran-	O
domly	O
named	O
.tmp	O
,	O
file	B-Entity
like	O
ffffz07131101.tmp	O
.	O
This	O
file	O
is	O
located	O
in	O
the	O
same	O
directory	O
as	O
the	O
original	O
dropper	B-Entity
,	O
which	O
maintains	B-Action
persistence	B-Entity
across	O
reboots	O
with	O
a	O
simple	O
addition	O
to	O
the	O
HKCU	O
run	B-Action
key	B-Entity
.	O
Here	O
is	O
debug	O
output	O
demonstrating	O
this	O
component	O
's	O
data	O
retrieval	O
when	O
the	O
letter	O
''	O
D	O
''	O
is	O
repeatedly	O
pressed	O
on	O
the	O
keyboard	O
.	O
Keyscan	O
make	O
and	O
break	B-Action
codes	B-Entity
are	O
''	O
0x20	O
''	O
and	O
''	O
0xA0	O
''	O
and	O
for	O
the	O
key	O
press	O
and	O
key	O
release	O
for	O
the	O
''	O
D	O
''	O
key	O
.	O
The	O
''	O
0x1D	O
''	O
value	O
from	O
port	O
0x64	O
that	O
you	O
see	O
below	O
is	O
basically	O
an	O
indication	O
that	O
the	O
output	O
buffer	O
is	O
full	B-Entity
and	O
the	O
keyboard	O
is	O
locked	O
,	O
so	O
it	B-Entity
is	O
safe	O
for	O
the	O
driver	O
to	O
access	O
the	O
key	O
value	O
in	O
port	O
0x60	O
:	O
These	O
debug	O
messages	O
and	O
code	B-Entity
style	O
are	O
duplicates	O
of	O
what	O
chpie	O
posted	O
in	O
the	O
past	O
.	O
This	O
keylogger	O
module	O
encrypts	B-Action
and	O
stores	B-Entity
gathered	B-Action
data	B-Entity
in	O
a	O
log	O
file	O
,	O
as	O
men-	O
tioned	O
previously	O
.	O
Its	O
encryption	O
algorithm	O
is	O
similar	B-Entity
to	B-Modifier
RC4	B-Entity
.	O
Interesting	O
part	O
is	O
that	O
the	O
module	O
randomly	O
generates	O
the	O
key	O
and	O
stores	B-Action
it	B-Entity
in	O
an	O
unexpected	O
place	O
:	O
in	O
the	O
middle	O
of	O
the	O
log	O
file	O
name	O
.	O
Hence	O
,	O
the	O
numeric	O
part	O
of	O
the	O
filename	O
is	O
used	O
as	O
a	O
seed	O
for	O
the	O
pseudorandom	O
number	O
generator	O
.	O
Rand	O
function	O
is	O
statically	O
linked	O
to	O
insure	O
same	O
results	O
on	O
different	O
computers	O
.	O
Here	O
is	O
the	O
commented	O
RC4	O
encryption	O
code	O
:	O
In	O
this	O
day	O
and	O
age	B-Action
of	O
interconnected	O
cloud	O
services	B-Entity
and	O
distributed	B-Action
content	O
delivery	O
networks	O
(	O
CDNs	O
)	O
,	O
it	B-Entity
is	O
important	O
for	O
both	O
CDN	O
service	O
providers	O
and	O
security	O
professionals	O
alike	O
to	O
recognize	B-Action
and	O
understand	O
the	O
risks	O
that	O
these	B-Entity
systems	I-Entity
can	O
introduce	O
within	O
an	O
modern	O
enterprise	O
.	O
For	O
organizations	O
within	O
both	O
public	O
and	O
private	O
sectors	O
that	O
leverage	O
CDN	O
platforms	O
to	O
dynamically	O
deliver	B-Action
web	B-Entity
content	I-Entity
,	O
it	B-Entity
is	O
important	O
that	O
the	O
content	O
is	O
also	O
routinely	O
monitored	B-Action
.	O
Otherwise	O
,	O
malicious	O
third	O
-	O
party	O
content	O
can	O
be	B-Action
loaded	I-Action
into	B-Modifier
a	O
target	O
organization	O
's	O
website	O
without	O
their	O
knowledge	O
,	O
delivering	B-Action
untold	B-Entity
risks	I-Entity
to	B-Modifier
unwitting	B-Entity
visitors	I-Entity
.	O
The	O
ThreatConnect	O
Intelligence	O
Research	O
Team	O
(	O
TCIRT	O
)	O
recently	O
observed	O
a	O
targeted	O
cross	O
-	O
site	O
scripting	O
(	O
XSS	O
)	O
''	O
drive	O
-	O
by	O
''	O
attack	O
that	O
leveraged	O
a	O
single	O
content	O
delivery	O
network	O
resource	O
to	O
distribute	B-Action
a	O
malicious	O
Java	O
applet	O
via	O
nearly	O
all	O
of	O
the	O
major	O
official	O
Government	O
of	O
Afghanistan	O
websites	O
.	O
The	O
compromised	O
CDN	O
resource	O
in	O
question	O
is	O
a	O
JavaScript	O
file	O
hosted	O
at	O
[	O
http	O
:	O
]	O
//cdn.afghanistan	O
[	O
.	O
]	O
af	O
/	O
scripts	O
/	O
gop	O
-	O
script.js	O
The	O
domain	O
cdn.afghanistan	O
[	O
.	O
]	O
af	B-Entity
is	O
a	O
legitimate	O
CDN	O
site	O
used	B-Action
by	O
the	O
Afghan	O
Ministry	O
of	O
Communications	O
and	O
IT	B-Entity
(	O
MCIT	O
)	O
to	B-Modifier
host	O
web	O
content	O
that	O
is	O
displayed	B-Action
and	O
used	B-Action
on	B-Modifier
many	O
official	O
gov.af	O
websites	O
.	O
The	O
javascript	O
URL	O
(	O
[	O
http	O
:	O
]	O
//cdn.afghanistan	O
[	O
.	O
]	O
af	O
/	O
scripts	O
/	O
gop	O
-	O
script.js	O
)	O
is	B-Action
called	I-Action
from	B-Modifier
numerous	O
official	O
Afghan	O
Government	O
websites	O
,	O
including	O
the	O
following	O
:	O
It	B-Entity
is	O
likely	O
that	O
this	O
javascript	O
URL	O
itself	O
is	O
normally	O
legitimate	O
,	O
but	O
the	O
attackers	B-Entity
obtained	B-Action
access	B-Entity
to	B-Modifier
the	B-Entity
file	I-Entity
and	O
prepended	O
the	O
following	O
malicious	O
JavaScript	O
functions	O
to	O
the	O
beginning	O
of	O
the	O
script	O
:	O
Note	O
that	O
the	O
gov.af	O
websites	O
would	O
not	O
need	O
to	O
be	O
compromised	O
individually	O
for	O
this	O
attack	O
to	O
be	O
delivered	B-Action
to	B-Modifier
visitors	B-Entity
of	O
the	O
sites	O
,	O
because	O
it	B-Entity
is	O
the	O
backend	O
CDN	O
infrastructure	O
that	O
is	O
serving	O
up	O
the	O
malicious	O
script	O
.	O
Judging	O
by	O
the	O
last	O
modified	O
timestamp	O
on	O
the	O
HTTP	O
response	O
of	O
gop-script.js	O
,	O
which	O
is	O
Tue	O
,	O
16	O
Dec	O
2014	O
08:07:06	O
GMT	O
,	O
this	O
malicious	O
CDN	O
compromise	O
was	O
very	O
recent	O
in	O
nature	O
.	O
In	O
fact	O
,	O
it	B-Entity
occurred	O
on	O
the	O
very	O
same	O
day	O
that	O
China	O
's	O
Prime	O
Minister	O
Li	O
Keqiang	O
would	O
meet	O
with	O
Abdullah	O
Abdullah	O
,	O
the	O
Chief	O
Executive	O
Officer	O
of	O
Afghanistan	O
in	O
Astana	O
Kazakhstan	O
,	O
they	B-Entity
would	O
discuss	O
infrastructure	O
development	O
and	O
bilateral	O
cooperation	O
issues	O
.	O
Looking	O
at	O
the	O
EXIF	O
metadata	O
of	O
the	O
image	O
of	O
Keqiang	O
meeting	O
with	O
Abdullah	O
that	O
is	O
hosted	O
on	O
the	O
Chinese	O
embassy	O
website	O
we	O
note	O
a	O
Tue	O
,	O
16	O
December	O
2014	O
07:43:31	O
modify	O
time	O
as	O
well	O
as	O
the	O
www.news	O
[	O
.	O
]	O
cn	O
watermark	O
in	O
the	O
bottom	O
righthand	O
corner	O
.	O
This	O
indicates	O
that	O
the	O
image	O
of	O
Keqiang	O
and	O
Abdullah	O
was	O
likely	O
taken	O
and	O
edited	B-Action
sometime	O
prior	O
to	B-Modifier
07:43:31	B-Entity
.	O
While	O
it	B-Entity
is	O
ambiguous	O
as	O
to	O
which	O
timezone	O
the	O
edits	O
actually	O
took	O
place	O
in	O
(	O
Kazakhstan	O
or	O
China	O
)	O
we	B-Entity
assume	O
the	O
date	O
timestamp	O
references	O
GMT	O
because	O
the	O
press	O
release	O
states	O
''	O
In	O
the	O
afternoon	O
of	O
December	O
15	O
local	O
time	O
…	O
''	O
If	O
we	O
assume	O
the	O
photograph	O
and	O
afternoon	O
meeting	O
took	O
place	O
sometime	O
prior	O
to	B-Modifier
13:43	O
Alma	O
-	O
Ata	O
standard	O
time	O
(	O
+	O
0600	O
)	O
this	B-Entity
would	O
closely	O
correspond	O
with	O
a	O
07:43	O
GMT	O
time	O
stamp	O
.	O
The	O
modification	O
of	O
the	O
gop-script.js	O
by	O
the	O
attackers	O
at	O
08:07:06	O
GMT	O
likely	O
tracks	O
extremely	O
close	O
to	O
a	O
window	O
of	O
a	O
few	O
hours	O
in	O
which	O
Keqiang	O
met	O
with	O
Abdullah	O
.	O
It	B-Entity
is	O
worth	O
mentioning	O
that	O
a	O
similar	O
scenario	O
occurred	O
on	O
June	O
20th	O
when	O
security	O
researcher	O
PhysicalDrive0	O
observed	O
a	O
malicious	O
Java	O
file	O
hosted	O
on	O
the	O
Embassy	O
of	O
Greece	O
in	O
Beijing	O
.	O
At	O
the	O
time	O
,	O
a	O
Chinese	O
delegation	O
led	O
by	O
Keqiang	B-Entity
was	O
visiting	O
Greek	O
Prime	O
Minister	O
Antonis	O
Samaras	O
in	O
Athens	O
.	O
Security	O
researcher	O
R136a1	O
aka	O
''	O
thegoldenmessenger	O
''	O
released	O
a	O
followup	O
blog	O
with	O
detailed	O
analysis	O
of	O
the	O
Greek	O
embassy	O
compromise	O
.	O
While	O
these	O
two	O
separate	O
events	O
are	O
not	O
directly	O
related	B-Action
,	O
additional	O
research	O
into	O
the	O
status	O
of	O
ministerial	O
and	O
official	O
government	O
websites	O
on	O
or	O
around	O
the	O
dates	O
of	O
notable	O
Chinese	O
delegations	O
and	O
or	O
bilateral	O
meetings	O
may	O
yield	O
additional	O
patterns	O
of	O
interest	O
.	O
Upon	O
closer	O
inspection	O
of	O
the	O
prepended	O
malicious	O
JavaScript	O
code	B-Entity
,	O
one	B-Entity
will	O
notice	O
the	O
similarity	O
in	O
the	O
update.javaplug-in	O
[	O
.	O
]	O
com	O
naming	O
convention	O
and	O
URL	O
structure	O
to	O
the	O
C2	O
domain	O
java	O
-	O
se	O
[	O
.	O
]	O
com	O
found	O
in	O
the	O
Palo	O
Alto	O
Networks	O
blog	O
post	O
Attacks	O
on	O
East	O
Asia	O
using	O
Google	O
Code	O
for	O
Command	O
and	O
Control	B-Entity
and	O
associated	O
with	O
Operation	O
Poisoned	O
Hurricane	O
.	O
However	O
,	O
the	O
malicious	O
document.write	O
driveby	O
URLs	O
listed	O
above	O
both	O
result	O
in	O
403	O
Forbidden	O
errors	O
as	O
of	O
December	O
18	O
,	O
2014	O
.	O
While	O
the	O
403	O
Forbidden	O
errors	O
may	O
seem	O
like	O
an	O
analytic	O
dead	O
end	O
,	O
the	O
TCIRT	O
also	O
identified	O
a	O
malicious	O
Java	O
applet	O
submission	O
to	O
VirusTotal	O
that	O
confirms	O
the	O
nature	O
of	O
this	O
malicious	O
activity	O
.	O
This	O
Java	O
applet	O
,	O
SHA1	O
:	O
388E6F41462774268491D1F121F333618C6A2C9A	B-Entity
,	O
has	O
no	O
antivirus	O
detections	O
as	O
of	O
December	O
21st	O
.	O
The	O
applet	O
contains	B-Action
its	B-Entity
malicious	O
class	O
file	O
at	O
the	O
path	O
''	O
jre7u61windows	O
/	O
x86/Update.class	O
''	O
.	O
This	O
class	O
file	O
downloads	B-Action
and	O
decodes	O
an	O
XOR	O
0xC8	O
encoded	O
Windows	O
PE	O
executable	O
payload	O
from	O
[	O
http	O
:	O
]	O
//mfa.gov	O
[	O
.	O
]	O
af	O
/	O
content	O
/	O
images	O
/	O
icon35.png	O
,	O
hosted	B-Action
on	B-Modifier
the	O
official	O
Afghan	O
Ministry	O
of	O
Foreign	O
Affairs	O
site	O
,	O
which	O
was	O
also	O
affected	B-Action
by	O
the	O
gop	O
-	O
script	O
XSS	O
.	O
Using	O
historic	O
context	O
archived	O
within	O
ThreatConnect	O
,	O
the	O
TCIRT	O
concluded	O
that	O
this	O
Java	O
applet	O
is	O
from	O
the	O
same	O
source	O
code	O
as	O
the	O
applet	O
SHA1	O
:	O
ADC162DD909283097E72FC50B7AB0E04AB8A2BCC	B-Entity
,	O
which	O
was	O
previously	O
observed	O
by	O
the	O
TCIRT	O
at	O
the	O
Operation	O
Poisoned	O
Hurricane	O
related	O
URL	O
[	O
http	O
:	O
]	O
//jre7.java	O
-	O
se	O
[	O
.	O
]	O
com	O
/	O
java.jar	O
on	O
August	O
15	O
,	O
2014	O
.	O
This	O
applet	O
has	O
the	O
same	O
class	O
path	O
,	O
and	O
downloads	B-Action
an	O
XOR	O
0xFF	O
encoded	O
payload	O
executable	O
from	O
the	O
URL	O
[	O
https	O
:	O
]	O
//amco-	O
triton.co	O
[	O
.	O
]	O
jp	O
/	O
js	O
/	O
dl	O
/	O
in.jpg	O
.	O
Additional	O
indicators	O
and	O
context	O
associated	O
with	O
this	O
particular	O
Java	O
driveby	O
activity	O
can	O
be	O
found	O
in	O
the	O
ThreatConnect	O
Common	O
Community	O
Incident	O
20140815A	O
:	O
The	O
XOR	O
0xC8	O
encoded	O
payload	O
downloaded	B-Action
from	B-Modifier
[	O
http	O
:	O
]	O
//mfa.gov	O
[	O
.	O
]	O
af	O
/	O
content	O
/	O
images	O
/	O
icon35.png	O
decodes	O
into	O
the	O
Windows	O
PE	O
executable	O
SHA1	O
:	O
This	B-Entity
executable	I-Entity
is	O
a	O
self	O
-	O
extracting	O
(	O
SFX	O
)	O
Microsoft	O
Cabinet	O
executable	O
that	O
is	O
digitally	O
signed	O
with	O
a	O
valid	O
certificate	O
from	O
''	O
OnAndOn	O
Information	O
System	O
Co.	O
,	O
Ltd.	O
''	O
,	O
serial	O
number	O
''	O
1F	O
F7	O
D8	O
64	O
18	O
1C	O
55	O
5E	O
70	O
CF	O
DD	O
3A	O
59	O
34	O
C4	O
7D	O
''	O
.	O
This	O
same	O
certificate	O
was	O
also	O
used	B-Action
to	O
sign	O
the	O
Java	O
applet	O
that	O
downloaded	B-Action
this	B-Entity
malware	I-Entity
.	O
This	O
executable	B-Entity
drops	B-Action
the	O
following	O
files	O
:	O
Malicious	O
DLL	O
that	O
loads	B-Action
into	B-Modifier
the	O
above	O
dllhost.exe	O
,	O
using	B-Modifier
a	O
similar	O
DLL	O
sideloading	O
technique	O
to	O
that	O
most	O
commonly	O
associated	B-Action
with	O
the	O
PlugX	O
backdoor	O
.	O
This	O
backdoor	O
connects	O
to	O
the	O
faux	O
Oracle	O
Java	O
themed	O
command	O
and	O
control	B-Entity
(	O
C2	O
)	O
domain	O
oracle0876634.javaplug-in	O
[	O
.	O
]	O
com	B-Entity
.	O
Note	O
that	O
javaplug	O
-	O
in	O
[	O
.	O
]	O
com	O
is	O
the	O
same	O
root	O
domain	O
found	O
in	O
the	O
compromised	O
version	O
of	O
[	O
http	O
:	O
]	O
//cdn.afghanistan	O
[	O
.	O
]	O
af	O
/	O
scripts	O
/	O
gop	O
-	O
script.js	O
as	O
[	O
http	O
:	O
]	O
//update.javaplug-	B-Entity
in	O
[	O
.	O
]	O
com	O
/	O
o	O
/	O
j.js	O
,	O
confirming	B-Action
that	O
this	O
Java	O
malware	O
is	O
in	O
fact	O
directly	O
associated	O
with	O
the	O
Afghan	O
MCIT	O
CDN	O
XSS	O
compromise	O
.	O
Full	O
indicators	O
of	O
this	O
activity	O
and	O
a	O
YARA	O
rule	O
to	O
detect	O
the	O
malware	O
certificate	O
can	O
be	O
found	O
in	O
the	O
ThreatConnect	O
Common	O
Community	O
under	O
Incident	O
20141217A	O
:	O
Afghan	O
Government	O
Java	O
Driveby	O
and	O
signature	O
APTOnAndOncert.yara	O
.	O
As	O
the	O
US	O
and	O
NATO	O
reduce	O
their	O
troop	O
levels	O
in	O
Afghanistan	O
,	O
China	O
is	O
posturing	O
to	O
fill	O
the	O
gap	O
of	O
influence	O
that	O
the	O
west	O
is	O
leaving	O
behind	O
.	O
With	O
plans	O
to	O
facilitate	O
multilateral	O
peace	O
talks	O
with	O
the	O
Taliban	O
and	O
establish	B-Action
major	O
transportation	O
projects	O
which	O
aim	O
to	O
bolster	O
the	O
Afghan	O
economy	O
,	O
Beijing	O
has	O
been	O
eyeing	O
Afghanistan	O
as	O
part	B-Action
of	O
its	O
broader	O
South	O
Asian	O
strategy	O
.	O
By	O
exploiting	B-Action
and	O
co	O
-	O
opting	O
Afghan	O
network	O
infrastructure	O
that	O
is	O
used	B-Action
by	O
multiple	O
ministerial	O
level	O
websites	O
,	O
Chinese	O
intelligence	O
services	O
would	O
be	O
able	O
to	O
widely	O
distribute	B-Action
malicious	B-Entity
payloads	I-Entity
to	B-Modifier
a	O
variety	O
of	O
global	O
targets	O
using	O
Afghanistan	O
's	O
government	O
websites	O
as	O
a	O
topical	O
and	O
trusted	O
distribution	O
platform	O
,	O
exploiting	O
a	O
single	O
hidden	O
entry	O
point	O
.	O
This	O
being	O
a	O
variant	O
of	O
a	O
typical	O
''	O
watering	O
-	O
hole	O
''	O
attack	O
,	O
the	O
attackers	B-Entity
will	O
most	O
likely	O
infect	B-Action
victims	B-Entity
outside	O
the	O
Afghan	O
government	O
who	O
happened	O
to	O
be	O
browsing	O
any	O
one	O
of	O
the	O
CDN	O
client	O
systems	O
,	O
specifically	O
,	O
partner	O
states	O
involved	O
in	O
the	O
planned	O
troop	O
reduction	O
.	O
It	B-Entity
is	O
important	B-Entity
to	O
consider	O
that	O
corporate	O
enterprises	O
are	O
not	O
immune	O
to	O
this	O
tactic	O
,	O
and	O
this	O
is	O
not	O
just	O
a	O
technique	O
that	O
is	O
used	B-Action
by	O
APT	O
threat	O
actors	O
.	O
If	O
an	O
enterprise	O
's	O
website	O
leverages	O
a	O
CDN	O
to	O
speed	O
up	O
content	O
delivery	O
,	O
unintended	O
consequences	O
must	O
be	O
anticipated	O
.	O
Fortunately	O
,	O
modern	O
browsers	O
now	O
implement	O
a	O
security	O
concept	O
called	O
''	O
Content	O
Security	O
Policy	O
''	O
.	O
As	O
long	O
as	O
the	O
server	O
's	O
response	O
headers	O
are	O
configured	O
properly	O
,	O
third	O
party	O
content	O
may	O
be	B-Action
restricted	I-Action
to	B-Modifier
originating	B-Entity
from	B-Modifier
a	O
narrow	O
whitelist	O
.	O
Just	O
as	O
attackers	B-Entity
distribute	O
malicious	O
content	O
to	O
users	O
en	O
masse	O
or	O
CDN	O
services	O
distribute	O
web	O
content	O
to	O
users	O
,	O
security	O
professionals	O
must	O
be	O
able	O
to	O
quickly	O
distribute	O
actionable	O
Threat	O
Intelligence	O
in	O
formats	O
readable	O
by	O
both	O
humans	O
and	O
machines	B-Entity
.	O
ThreatConnect	O
is	O
the	O
industry	O
's	O
first	O
comprehensive	O
Threat	O
Intelligence	O
Platform	O
that	O
enables	B-Action
enterprises	B-Entity
to	O
orchestrate	O
the	O
aggregation	O
of	O
Threat	O
Intelligence	O
from	O
multiple	O
sources	O
,	O
use	B-Action
integrated	O
analytics	O
and	O
a	O
robust	O
API	O
that	O
gives	O
enterprises	O
the	O
control	O
to	O
action	O
their	O
own	O
Threat	O
Intelligence	O
,	O
in	O
the	O
cloud	O
and	O
on	B-Modifier
premises	B-Entity
.	O
Register	O
for	O
a	O
free	O
account	O
now	O
to	O
view	O
the	O
Common	O
Community	O
shares	O
and	O
more	O
.	O
by	O
John	O
Scott	O
-	O
Railton	O
and	O
Seth	O
Hardy	O
With	O
the	O
collaboration	O
of	O
Cyber	O
Arabs	O
.	O
Media	O
coverage	O
:	O
Associated	O
Press	O
,	O
Forbes	O
This	O
report	O
describes	O
a	O
malware	O
attack	O
with	O
circumstantial	O
links	O
to	O
the	O
Islamic	O
State	O
in	O
Iraq	O
and	O
Syria	O
.	O
In	O
the	O
interest	O
of	O
highlighting	O
a	O
developing	O
threat	O
,	O
this	O
post	O
analyzes	O
the	O
attack	O
and	O
provides	B-Action
a	O
list	O
of	O
Indicators	O
of	O
Compromise	O
.	O
A	O
Syrian	O
citizen	O
media	O
group	O
critical	O
of	O
Islamic	O
State	O
of	O
Iraq	O
and	O
Syria	O
(	O
ISIS	O
)	O
was	O
recently	O
targeted	O
in	O
a	O
customized	O
digital	O
attack	O
designed	O
to	O
unmask	O
their	O
location	O
.	O
The	O
Syrian	O
group	O
,	O
Raqqah	O
is	O
being	O
Slaughtered	O
Silently	O
(	O
RSS	O
)	O
,	O
focuses	O
its	O
advocacy	B-Action
on	B-Modifier
documenting	O
human	O
rights	O
abuses	O
by	O
ISIS	O
elements	O
occupying	O
the	O
city	O
of	O
Ar-	O
Raqah	O
.	O
In	O
response	O
,	O
ISIS	O
forces	O
in	O
the	O
city	O
have	O
reportedly	O
targeted	O
the	O
group	O
with	O
house	O
raids	O
,	O
kidnappings	B-Entity
,	O
and	O
an	O
alleged	O
assassination	O
.	O
The	O
group	O
also	O
faces	O
online	O
threats	O
from	O
ISIS	O
and	O
its	B-Entity
supporters	I-Entity
,	O
including	O
taunts	O
that	O
ISIS	O
is	O
spying	O
on	O
the	O
group	O
.	O
Though	O
we	O
are	O
unable	O
to	O
conclusively	O
attribute	O
the	O
attack	O
to	O
ISIS	O
or	O
its	B-Entity
supporters	I-Entity
,	O
a	O
link	O
to	O
ISIS	O
is	O
plausible	O
.	O
The	O
malware	B-Entity
used	B-Action
in	O
the	O
attack	O
differs	O
substantially	O
from	O
campaigns	O
linked	O
to	O
the	O
Syrian	O
regime	O
,	O
and	O
the	O
attack	O
is	O
focused	O
against	O
a	O
group	O
that	O
is	O
an	O
active	O
target	O
of	O
ISIS	O
forces	O
.	O
As	O
the	O
Syrian	O
Civil	O
War	O
continues	O
,	O
Syrian	O
citizen	O
journalists	O
and	O
nonviolent	O
activists	O
operate	O
in	O
an	O
increasingly	O
unsafe	O
environment	O
.	O
The	O
regime	O
has	O
never	O
welcomed	O
their	O
work	O
,	O
and	O
has	O
often	O
targeted	B-Action
them	B-Entity
for	B-Modifier
arrest	B-Entity
and	O
detention	B-Entity
,	O
and	O
a	O
multi	O
-	O
year	O
hacking	O
campaign	O
(	O
see	O
Pro	O
-	O
Regime	O
/	O
Regime	O
Linked	O
Groups	O
)	O
.	O
Additionally	O
,	O
not	O
all	O
elements	O
of	O
the	O
Syrian	O
opposition	O
have	O
uniformly	O
supported	O
nonviolent	O
activists	O
and	O
citizen	O
journalists	O
.	O
More	O
recently	O
,	O
in	O
areas	O
like	O
Raqqah	O
,	O
nonviolent	O
activists	O
face	O
a	O
new	O
and	O
exceptionally	O
grave	O
threat	O
:	O
ISIS	B-Entity
.	O
A	O
growing	O
number	O
of	O
reports	O
suggest	O
that	O
ISIS	O
is	O
systematically	O
targeting	B-Action
groups	B-Entity
that	O
document	B-Action
atrocities	B-Entity
,	O
or	O
that	O
communicate	O
with	O
Western	O
media	O
and	O
aid	O
organizations	O
,	O
sometimes	O
under	O
the	O
pretext	O
of	O
finding	O
''	O
spies	O
''	O
.	O
Ar	O
-	O
Raqqah	O
,	O
the	O
city	O
in	O
which	O
the	O
case	O
study	O
is	O
located	O
,	O
is	O
situated	O
in	O
northern	O
Syria	O
and	O
continues	O
to	O
be	O
a	O
key	O
conflict	O
flashpoint	O
of	O
the	O
Syrian	O
Civil	O
War	O
.	O
In	O
the	O
spring	O
of	O
2013	O
,	O
Islamists	O
and	O
Free	O
Syrian	O
Army	O
(	O
FSA	O
)	O
fighters	B-Entity
took	O
over	O
Ar-	O
Raqqah	O
from	O
regime	O
forces	O
.	O
As	O
ISIS	O
gained	O
momentum	O
,	O
they	B-Entity
consolidated	O
their	O
control	O
over	O
the	O
city	O
,	O
edging	B-Action
out	B-Modifier
FSA-	B-Entity
affiliated	O
groups	O
through	O
attacks	B-Entity
,	O
summary	O
executions	O
,	O
and	O
kidnappings	O
against	O
a	O
range	O
of	O
groups	O
,	O
including	O
ethnic	O
and	O
religious	O
minorities	O
.	O
During	O
2014	O
,	O
there	O
were	O
a	O
number	O
of	O
reports	O
-	O
many	O
unconfirmed	O
-	O
that	O
ISIS	O
confiscated	O
smartphones	O
and	O
laptops	B-Action
from	B-Modifier
captured	O
activists	O
.	O
According	O
to	B-Modifier
Syrians	O
who	O
experienced	O
these	O
searches	O
and	O
spoke	B-Action
with	O
one	O
of	O
the	O
reports	O
'	O
authors	O
,	O
ISIS	O
sometimes	O
extracts	B-Action
data	B-Entity
from	B-Modifier
confiscated	O
smartphones	O
and	O
laptops	B-Entity
to	O
collect	B-Action
information	B-Entity
about	O
people	O
and	O
groups	O
they	O
are	O
targeting	O
,	O
as	O
well	O
as	O
to	O
seek	O
evidence	O
of	O
''	O
un	O
-	O
Islamic	O
''	O
activities	O
.	O
As	O
ISIS	O
cements	O
their	O
control	O
of	O
Ar	O
-	O
Raqqah	O
and	O
other	O
territories	O
,	O
reports	O
have	O
emerged	O
recently	O
(	O
though	O
not	O
all	O
of	O
them	B-Entity
confirmed	B-Action
)	O
suggesting	O
that	O
elements	O
within	O
ISIS	O
are	O
growing	O
increasingly	O
sophisticated	O
at	O
imposing	B-Action
control	B-Entity
and	O
targeting	B-Action
opponents	O
using	O
digital	O
methods	O
.	O
Reports	O
about	O
ISIS	O
targeting	O
Internet	O
cafés	O
have	O
grown	O
increasingly	O
common	O
,	O
and	O
in	O
some	O
cases	O
reports	O
point	O
to	O
the	O
possible	O
use	O
of	O
keyloggers	B-Entity
as	O
well	O
as	O
unspecified	O
''	O
IP	O
sniffers	O
''	O
to	O
track	B-Action
behaviour	B-Entity
in	O
Internet	O
cafes	O
.	O
Nonviolent	O
activists	O
and	O
citizen	O
journalists	O
based	O
in	O
Ar	O
-	O
Raqqah	O
have	O
provided	O
the	O
outside	O
world	O
with	O
much	O
of	O
what	O
we	O
know	O
about	O
how	O
ISIS	O
treats	O
the	O
population	O
.	O
These	O
activists	O
and	O
journalists	O
face	O
mortal	O
danger	O
for	O
their	O
actions	O
,	O
and	O
reports	O
have	O
emerged	B-Action
of	O
their	O
detention	O
and	O
torture	O
at	O
the	O
hands	O
of	O
ISIS	O
.	O
As	O
ISIS	B-Entity
continues	O
to	O
use	B-Action
social	B-Entity
media	O
to	O
push	O
the	O
message	O
that	O
it	B-Entity
is	O
welcomed	O
by	O
the	O
population	O
of	O
Ar	O
-	O
Raqqah	O
,	O
groups	O
like	O
Raqqah	O
is	O
being	O
Slaughtered	O
Silently	O
(	O
RSS	O
)	O
provide	B-Action
a	O
compelling	O
counter	O
narrative	O
.	O
RSS	O
has	O
n't	O
escaped	O
ISIS	O
'	O
notice	O
,	O
and	O
the	O
group	O
has	O
been	O
targeted	O
for	O
kidnappings	O
,	O
house	O
raids	O
,	O
and	O
at	O
least	O
one	O
alleged	O
targeted	O
killing	O
.	O
At	O
the	O
time	O
of	O
writing	B-Action
,	O
ISIS	O
is	O
allegedly	O
holding	O
several	O
citizen	O
journalists	O
in	O
Ar	O
-	O
Raqqah	O
.	O
In	O
addition	O
,	O
RSS	B-Entity
is	O
targeted	O
online	O
by	O
ISIS	O
supporters	O
with	O
harassment	O
,	O
including	O
threats	B-Entity
to	B-Modifier
the	O
physical	O
safety	O
of	O
its	B-Entity
members	I-Entity
.	O
For	O
example	O
,	O
ISIS	O
supporters	O
have	O
claimed	O
that	O
ISIS	O
has	O
established	O
a	O
system	O
of	O
CCTV	O
cameras	O
in	O
Ar	O
-	O
Raqqah	O
to	O
observe	O
residents	O
'	O
movements	O
.	O
While	O
this	O
claim	O
may	O
be	O
a	O
bluff	O
or	O
exaggeration	B-Entity
,	O
at	O
least	O
one	O
ISIS	O
supporter	O
has	O
indicated	O
on	O
social	O
media	O
that	O
this	B-Entity
system	I-Entity
could	O
be	O
used	O
to	O
look	O
for	O
members	O
of	O
RSS	O
.	O
This	O
section	O
describes	O
a	O
highly	O
targeted	B-Action
attack	B-Entity
sent	B-Action
to	B-Modifier
an	O
e	O
-	O
mail	O
address	O
belonging	O
to	B-Modifier
RSS	B-Entity
.	O
The	O
Citizen	O
Lab	O
analyzed	O
this	O
attack	O
with	O
the	O
consent	O
of	O
RSS	O
,	O
which	O
requested	B-Action
that	O
their	O
name	O
be	O
used	O
in	O
this	O
report	O
.	O
The	O
attack	O
took	O
the	O
form	O
of	O
an	O
unsolicited	O
e	O
-	O
mail	O
containing	O
a	O
download	B-Action
link	B-Entity
to	B-Modifier
a	O
decoy	O
file	O
.	O
The	O
file	O
contained	O
custom	O
malware	B-Entity
that	O
profiled	O
the	O
victim	O
's	O
computer	O
and	O
beaconed	B-Action
its	B-Entity
IP	I-Entity
address	I-Entity
to	B-Modifier
an	O
e	O
-	O
mail	O
account	O
under	O
the	O
attacker	O
's	O
control	O
.	O
The	O
unsolicited	O
message	O
below	O
was	B-Action
sent	I-Action
to	B-Modifier
RSS	B-Entity
at	O
the	O
end	O
of	O
November	O
2014	O
from	O
a	O
Gmail	O
email	O
address	O
.	O
The	O
message	O
was	O
carefully	O
worded	O
,	O
and	O
contained	O
references	O
specific	O
to	O
the	O
work	O
and	O
interests	B-Action
of	O
RSS	O
.	O
Thank	O
you	O
for	O
your	O
efforts	O
to	O
deliver	B-Action
a	O
true	O
picture	O
of	O
the	O
reality	B-Action
of	O
life	O
in	O
Raqqah	O
.	O
As	O
Syrians	O
residing	O
in	O
Canada	O
we	O
are	O
working	O
with	O
media	O
because	O
we	O
believe	O
in	O
the	O
importance	O
of	O
shedding	O
light	O
on	O
the	O
realities	O
of	O
life	O
in	O
Syria	O
,	O
and	O
Raqqah	O
in	O
particular	O
.	O
We	O
are	O
preparing	O
a	O
lengthy	O
news	O
report	O
on	O
the	O
realities	O
of	O
life	O
in	O
Raqqah	O
.	O
We	O
are	O
sharing	O
some	O
information	O
with	O
you	O
with	O
the	O
hope	O
that	O
you	O
will	O
correct	B-Action
it	B-Entity
in	O
case	O
it	B-Entity
contains	B-Action
errors	B-Entity
.	O
We	O
have	O
prepared	O
a	O
map	O
of	O
the	O
city	O
of	O
Raqqah	O
,	O
in	B-Modifier
addition	B-Entity
to	B-Modifier
a	O
preliminary	O
report	O
.	O
We	O
hope	O
that	O
you	O
have	O
a	O
look	O
at	O
it	B-Entity
with	B-Modifier
them	B-Entity
and	O
inform	O
us	O
of	O
any	O
errors	O
.	O
We	O
also	O
hope	O
that	O
if	O
you	O
happen	O
to	O
be	O
on	O
Facebook	O
,	O
you	O
could	O
provide	O
us	O
with	O
the	O
account	O
of	O
the	O
person	O
responsible	O
for	O
the	O
campaign	O
,	O
if	O
you	O
do	O
n't	O
mind	O
,	O
so	O
that	O
we	B-Entity
can	O
communicate	B-Action
with	O
him	O
directly	O
.	O
You	O
can	O
see	O
a	O
preliminary	O
copy	O
of	O
the	O
report	O
on	O
this	O
linkhttp	O
:	O
//tempsend	O
[	O
DOT	O
]	O
com/	O
[	O
Redacted	O
]	O
With	O
all	O
respect	O
[	O
Name	O
Redacted	O
]	O
We	O
are	O
unsure	O
why	O
the	O
attacker	O
specifically	O
mentions	O
Canada	O
in	O
the	O
email	O
lure	O
.	O
However	O
,	O
it	B-Entity
is	O
well	O
known	O
that	O
Syria	O
's	O
extensive	O
diaspora	O
(	O
including	O
in	O
Canada	O
)	O
regularly	O
engages	O
in	O
advocacy	O
,	O
sometimes	O
in	O
coordination	O
with	O
groups	O
within	O
Syria	O
.	O
Thus	O
,	O
the	O
message	O
is	O
not	O
on	O
its	O
face	O
implausible	O
.	O
However	O
,	O
we	O
note	O
that	O
the	O
attacker	O
also	O
attempts	B-Action
to	B-Modifier
social	O
engineer	O
the	O
identity	O
of	O
individuals	O
working	O
with	O
RSS	O
,	O
by	O
requesting	O
a	O
personal	O
Facebook	O
page	O
.	O
The	O
custom	O
malware	B-Entity
used	B-Action
in	O
this	O
attack	O
infects	O
a	O
user	O
who	O
views	O
the	O
decoy	O
''	O
slideshow	O
,	O
''	O
and	O
beacons	B-Action
home	B-Entity
with	O
the	O
IP	O
address	O
of	O
the	O
victim	O
's	O
computer	O
and	O
details	O
about	O
his	O
or	O
her	O
system	O
each	O
time	O
the	O
computer	O
restarts	O
.	O
Unlike	O
Syrian	O
regime	O
-	O
linked	O
malware	B-Entity
,	O
it	B-Entity
contains	B-Action
no	B-Entity
Remote	O
Access	O
Trojan	O
(	O
RAT	O
)	O
functionality	B-Entity
,	O
suggesting	O
it	B-Entity
is	O
intended	B-Action
for	B-Modifier
identifying	O
and	O
locating	B-Action
a	O
target	O
.	O
Further	O
,	O
because	O
the	O
malware	B-Entity
sends	B-Action
data	B-Entity
captured	O
by	O
the	O
malware	B-Entity
to	B-Modifier
an	O
e	O
-	O
mail	O
address	O
,	O
it	B-Entity
does	B-Action
not	O
require	O
that	O
the	O
attackers	B-Entity
maintain	O
a	O
command	O
-	O
and	O
-	O
control	O
server	O
online	O
.	O
This	O
functionality	O
would	O
be	O
especially	O
useful	B-Action
to	B-Modifier
an	O
adversary	O
unsure	O
of	O
whether	O
it	B-Entity
can	O
maintain	B-Action
uninterrupted	O
Internet	O
connectivity	O
.	O
Accessing	O
the	O
link	O
provided	O
in	O
the	O
malicious	O
e	O
-	O
mail	B-Entity
sends	B-Action
the	O
user	O
to	O
a	O
.zip	O
file	I-Entity
hosted	B-Action
on	B-Modifier
file	B-Entity
-	O
sharing	O
site	O
tempsend.com	O
.	O
At	O
the	O
time	O
of	O
writing	B-Action
the	B-Entity
file	I-Entity
had	O
been	O
downloaded	B-Action
only	O
10	O
times	O
This	O
file	O
is	O
a	O
self	O
-	O
extracting	O
archive	O
with	O
an	O
icon	O
intended	O
to	O
suggest	B-Action
to	B-Modifier
the	O
victim	O
that	O
it	B-Entity
is	B-Action
itself	B-Entity
a	O
slideshow	O
.	O
When	O
run	B-Action
,	O
the	O
file	O
opens	O
a	O
slideshow	O
of	O
Google	O
Earth	O
screen	O
captures	O
to	O
the	O
victim	O
,	O
displaying	O
a	O
series	O
of	O
locations	O
in	O
Syria	O
,	O
and	O
highlighting	O
an	O
''	O
ISIS	O
HQ	O
''	O
and	O
other	O
images	O
showing	O
the	O
alleged	O
locations	O
of	O
US	O
airstrikes	O
.	O
Examples	O
of	O
images	O
in	O
the	O
slideshow	O
as	O
follows	B-Action
:	O
When	B-Modifier
opened	B-Entity
,	O
the	O
''	O
slideshow.zip	O
''	O
file	B-Entity
writes	B-Action
and	O
executes	B-Action
several	B-Entity
files	I-Entity
:	O
''	O
AdobeR1.exe	O
''	O
is	O
malicious	O
,	O
while	O
''	O
pictures.exe	O
''	O
is	O
the	O
genuine	O
slideshow	O
displayed	B-Action
to	B-Modifier
the	O
victim	O
.	O
When	O
the	O
slideshow	O
is	O
closed	O
both	O
AdobeR1.exe	B-Entity
and	O
pictures.exe	B-Entity
are	O
deleted	O
.	O
The	O
AdobeR1	O
file	O
writes	O
a	O
series	O
of	O
executable	O
files	B-Entity
that	O
perform	B-Action
information	B-Entity
collection	O
and	O
communication	B-Entity
functions	O
,	O
including	O
:	O
The	O
program	O
sequence	O
of	O
data	O
collection	O
and	O
sending	B-Action
is	O
somewhat	O
unusual	O
,	O
with	B-Modifier
each	O
program	O
performing	O
a	O
single	O
task	O
and	O
communicating	B-Action
via	B-Modifier
markers	B-Entity
left	O
in	O
the	O
registry	B-Entity
.	O
Programs	B-Entity
appear	O
to	O
make	B-Action
use	B-Entity
of	O
the	O
Visual	O
C++	O
Runtime	O
Library	O
.	O
First	O
,	O
the	O
program	O
nvidrv	O
adds	B-Action
itself	B-Entity
to	B-Modifier
autorun	B-Entity
:	O
It	B-Entity
also	O
creates	B-Action
a	O
series	O
of	O
registry	O
keys	O
that	O
the	O
individual	O
programs	O
use	O
to	O
communicate	B-Action
:	O
Registry	B-Entity
keys	I-Entity
and	O
programs	B-Entity
using	B-Action
them	B-Entity
:	O
It	B-Entity
then	O
runs	B-Action
GooglUpd	B-Entity
,	O
which	O
cleans	B-Action
up	I-Action
the	O
program	O
files	O
if	O
they	B-Entity
exist	O
,	O
and	O
runs	B-Action
AdbrRader	B-Entity
.	O
AdbrRader	B-Entity
(	O
communicating	B-Action
through	B-Modifier
registry	B-Entity
key	O
''	O
2	O
''	O
)	O
writes	B-Action
the	O
file	O
vgadmysadm.tmp	O
with	O
the	O
name	O
of	O
another	O
registry	O
key	O
''	O
2	O
''	O
with	O
startup	O
info	O
.	O
Next	O
,	O
nvidrv	B-Entity
runs	B-Action
GoogleUpate	B-Entity
,	O
which	O
collects	B-Action
system	B-Entity
information	B-Entity
and	O
writes	B-Action
it	B-Entity
to	O
:	O
Then	O
nvidrv	B-Entity
runs	B-Action
nvisdvr	B-Entity
(	O
registry	O
key	O
''	O
4	O
''	O
)	O
that	O
collects	B-Action
a	O
list	O
of	O
running	O
processes	O
,	O
which	O
are	B-Action
written	I-Action
to	B-Modifier
:	O
Finally	O
,	O
nvidrv	B-Entity
runs	B-Action
svhosts	B-Entity
,	O
which	O
tests	O
Internet	O
connectivity	O
by	O
doing	O
a	O
DNS	O
query	O
for	O
windowsupdate.microsoft.com	O
.	O
It	B-Entity
then	O
runs	B-Action
rundl132	B-Entity
if	B-Modifier
it	B-Entity
has	O
not	O
before	O
,	O
by	O
checking	B-Action
whether	B-Modifier
registry	B-Entity
key	O
name	O
''	O
6	O
''	O
is	O
present	O
.	O
It	B-Entity
sets	B-Action
the	B-Entity
key	I-Entity
to	B-Modifier
''	O
0	O
''	O
and	O
runs	B-Action
it	B-Entity
.	O
Next	O
,	O
''	O
rundl132.exe	O
''	O
performs	O
an	O
HTTP	O
GET	O
request	B-Entity
to	B-Modifier
myexternalip.com	B-Entity
and	O
collects	B-Action
the	O
external	O
IP	O
of	O
the	O
infected	O
machine	O
:	O
Next	O
,	O
rundl132	B-Entity
writes	B-Action
:	O
Then	O
rundl132	B-Entity
writes	B-Action
the	O
external	O
IP	O
to	O
:	O
Finally	O
,	O
rundl132	B-Entity
runs	B-Action
AdobeIns	B-Entity
,	O
which	O
zips	O
the	O
contents	O
of	O
the	O
win32.tmp	O
folder	O
.	O
Program	O
''	O
AdobeIns.exe	O
''	O
takes	O
the	O
files	B-Entity
written	B-Action
by	O
the	O
other	O
programs	B-Entity
and	O
zips	B-Action
them	B-Entity
in	O
an	O
encrypted	B-Action
,	O
password-	B-Entity
protected	B-Action
file	B-Entity
:	O
Data	B-Entity
is	O
transmitted	O
by	O
e	O
-	O
mail	B-Entity
to	B-Modifier
an	O
account	O
presumably	O
controlled	B-Action
by	O
the	O
attacker	O
.	O
AdobeIns	B-Entity
connects	B-Action
to	B-Modifier
an	O
account	O
at	O
the	O
online	O
e	O
-	O
mail	O
provider	O
inbox.com	O
via	B-Modifier
smtp	B-Entity
using	B-Modifier
hardcoded	O
credentials	O
.	O
The	O
malware	B-Entity
then	O
sends	B-Action
an	O
e	O
-	O
mail	B-Entity
to	B-Modifier
the	O
same	O
inbox	O
containing	O
the	O
text	O
''	O
Hello	O
''	O
and	O
with	O
mxtd	O
file	O
attached	O
.	O
SMTP	O
traffic	B-Entity
generated	B-Action
by	O
the	O
malware	B-Entity
to	B-Modifier
inbox.com	B-Entity
(	O
with	O
redactions	O
)	O
The	O
malware	O
seen	O
in	O
this	O
case	O
study	O
is	O
unusual	O
as	O
it	B-Entity
relies	O
on	O
a	O
half	O
-	O
dozen	O
separate	O
executable	O
files	O
,	O
each	O
with	O
a	O
single	O
task	O
,	O
and	O
each	B-Modifier
communicating	B-Entity
via	B-Modifier
markers	B-Entity
dropped	B-Action
in	O
the	O
Registry	O
.	O
The	O
malware	B-Entity
is	O
also	O
interesting	O
because	O
it	O
does	O
not	O
provide	B-Action
remote	B-Entity
access	I-Entity
,	O
but	O
only	O
sends	B-Action
an	O
e	O
-	O
mail	O
containing	O
the	O
victim	O
's	O
IP	O
address	O
and	O
miscellaneous	O
system	O
information	O
.	O
The	O
malware	O
resends	O
the	O
information	O
each	O
time	O
the	O
computer	O
is	O
restarted	O
,	O
but	O
it	B-Entity
does	B-Action
not	O
refresh	O
the	O
sent	O
information	O
on	O
restart	O
(	O
which	O
may	O
be	O
a	O
bug	O
)	O
.	O
This	O
behaviour	O
strongly	O
suggests	O
that	O
the	O
function	O
of	O
this	O
malware	O
is	O
to	O
serve	O
as	O
a	O
beacon	O
.	O
The	O
system	O
information	B-Entity
could	O
be	O
used	O
to	O
identify	B-Action
processes	B-Entity
to	O
exploit	B-Action
in	O
the	O
future	O
,	O
however	O
since	O
the	O
attacker	O
has	O
already	O
triggered	O
the	O
execution	O
of	O
a	O
file	O
on	O
the	O
victim	O
's	O
system	O
,	O
it	B-Entity
is	O
surprising	O
that	O
more	O
was	O
not	O
taken	O
,	O
or	O
that	O
a	O
RAT	O
(	O
custom	O
or	O
widely	O
available	O
)	O
was	O
not	O
used	B-Action
.	O
A	O
RAT	O
would	O
have	O
provided	O
much	O
greater	O
access	O
alongside	O
IP	O
information	O
By	O
not	O
providing	B-Action
remote	B-Entity
access	I-Entity
and	O
other	O
RAT	O
functionality	O
,	O
the	O
program	O
looks	O
less	O
like	O
malware	B-Entity
,	O
and	O
may	O
attract	O
less	O
attention	O
from	O
endpoint	O
protection	O
tools	O
and	O
scanners	B-Entity
.	O
Detections	O
were	O
low	O
when	O
the	O
file	O
was	O
first	O
submitted	B-Action
to	B-Modifier
VirusTotal	B-Entity
,	O
for	B-Modifier
example	B-Entity
.	O
It	O
registered	O
only	O
6/55	O
detections	O
by	O
anti	O
virus	O
scanners	O
,	O
or	O
a	O
10	O
%	O
detection	O
rate	O
.	O
Transmitting	O
the	O
malware	B-Entity
via	B-Modifier
e	B-Entity
-	O
mail	B-Entity
also	O
provides	O
a	O
degree	O
of	O
obscurity	O
,	O
and	O
has	O
the	O
additional	O
advantage	O
of	O
providing	O
a	O
layer	O
of	O
abstraction	O
between	O
the	O
attacker	O
and	O
the	O
target	O
:	O
there	O
is	O
no	O
need	O
to	O
maintain	B-Action
a	O
RAT	O
command	O
-	O
and	O
-	O
control	B-Entity
server	I-Entity
.	O
The	O
malware	B-Entity
transmits	B-Action
autonomously	O
,	O
leaving	O
the	O
material	O
in	O
an	O
inbox	O
for	O
the	O
attacker	O
to	O
collect	B-Action
at	O
a	O
later	O
time	O
.	O
The	O
malware	B-Entity
has	O
no	O
obfuscation	O
processes	O
and	O
is	O
not	O
highly	O
technical	O
in	O
its	O
development	O
or	O
interaction	O
with	O
Windows	O
.	O
Nevertheless	O
,	O
we	O
believe	O
that	O
the	O
author	O
of	O
the	O
program	O
is	O
aware	O
of	O
certain	O
techniques	O
to	O
reduce	O
the	O
visibility	O
of	O
malware	O
on	O
a	O
network	O
,	O
including	O
transmitting	B-Action
data	B-Entity
via	B-Modifier
encrypted	I-Action
e	O
-	O
mail	O
communications	O
.	O
However	O
,	O
the	O
attacker	O
has	O
not	O
correctly	O
implemented	B-Action
encrypted	I-Action
e	O
-	O
mail	O
:	O
the	O
malware	B-Entity
will	O
not	O
attempt	O
to	O
use	B-Action
a	O
TLS	O
connection	O
in	O
certain	O
cases	O
.	O
As	O
a	O
result	O
,	O
account	O
login	O
credentials	O
may	O
be	O
readily	O
available	O
in	O
network	O
traffic	O
.	O
In	O
addition	O
,	O
the	O
malware	O
uses	O
the	O
old	O
PKWARE	O
implementation	O
of	O
zip	O
encryption	B-Entity
,	O
which	O
is	O
not	O
particularly	O
secure	O
.	O
The	O
password	O
for	O
the	O
zipped	B-Action
file	B-Entity
is	O
also	O
present	O
in	O
the	O
binary	O
without	O
encryption	B-Entity
or	O
obfuscation	B-Entity
.	O
Citizen	O
Lab	O
researchers	O
have	O
developed	O
the	O
Targeted	O
Threat	O
Index	O
(	O
TTI	O
)	O
as	O
a	O
tool	O
to	O
standardize	B-Action
information	B-Entity
about	O
the	O
sophistication	O
of	O
targeted	O
threats	O
against	O
civil	O
society	O
groups	O
in	O
our	O
research	O
.	O
The	O
index	O
captures	O
information	O
about	O
the	O
level	O
of	O
social	O
engineering	O
used	O
(	O
''	O
Targeting	O
Sophistication	O
''	O
)	O
,	O
and	O
adds	B-Action
a	O
Technical	O
Sophistication	O
value	O
for	O
the	O
attack	O
as	O
a	O
multiplier	O
.	O
This	O
attack	O
,	O
which	O
has	O
little	O
technical	O
sophistication	O
(	O
i.e.	O
,	O
it	B-Entity
uses	B-Action
no	B-Entity
exploits	I-Entity
,	O
code	B-Entity
obfuscation	I-Entity
,	O
or	O
techniques	O
to	O
frustrate	B-Action
reversing	B-Entity
,	O
etc	B-Entity
.	O
)	O
,	O
nevertheless	O
has	O
carefully	O
developed	O
social	O
engineering	O
in	O
the	O
seeding	O
materials	O
and	O
bait	O
document	O
.	O
Taken	O
together	O
it	O
rates	O
a	O
3	O
for	O
Targeting	O
Sophistication	O
and	O
a	O
1.25	O
for	O
Technical	O
Sophistication	O
by	O
our	O
metric	O
,	O
yielding	O
a	O
TTI	O
score	O
of	O
3.75	O
.	O
Citizen	O
Lab	O
research	O
using	O
the	O
TTI	O
has	O
found	O
that	O
,	O
despite	O
low	O
levels	O
of	O
technical	O
sophistication	O
,	O
with	O
well	O
-	O
crafted	O
social	O
engineering	O
malware	O
attacks	O
remain	O
highly	O
effective	O
against	O
civil	O
society	O
groups	O
.	O
More	O
information	O
is	O
available	O
about	O
the	O
TTI	O
in	O
a	O
recent	O
Usenix	O
Security	O
paper	O
.	O
There	O
are	O
at	O
least	O
three	O
possible	O
sources	O
for	O
this	O
malware	O
attack	O
:	O
We	O
evaluate	O
each	O
of	O
these	O
possibilities	O
in	O
turn	O
,	O
drawing	B-Action
on	B-Modifier
the	O
information	O
available	O
to	O
us	O
after	O
almost	O
three	O
years	O
of	O
tracking	O
regime	O
-	O
linked	O
malware	B-Entity
.	O
Pro	O
-	O
regime	O
malware	O
actors	O
have	O
continually	O
targeted	O
the	O
Syrian	O
opposition	O
with	O
waves	O
of	O
malware	O
since	O
at	O
least	O
late	O
2011	O
.	O
Those	O
campaigns	O
have	O
been	O
extensively	O
reported	B-Action
on	B-Modifier
by	O
a	O
range	O
of	O
groups	O
,	O
including	O
Kaspersky	O
,	O
FireEye	B-Entity
,	O
Citizen	O
Lab	O
,	O
the	O
Electronic	O
Frontier	O
Foundation	O
,	O
and	O
many	O
others	O
.	O
Regime	O
-	O
linked	O
malware	B-Entity
has	O
a	O
number	O
of	O
common	O
features	O
that	O
typically	O
serve	O
as	O
distinguishing	B-Action
characteristics	B-Entity
:	O
Social	O
engineering	O
focusing	O
on	O
the	O
needs	O
and	O
interests	B-Action
of	O
the	O
opposition	O
.	O
Although	O
targeted	O
,	O
the	O
malware	O
seeding	O
often	O
aims	O
at	O
classes	O
of	O
people	O
(	O
e.g.	O
,	O
people	O
interested	O
in	O
'	O
shocking	O
'	O
news	O
about	O
a	O
fighter	O
,	O
or	O
'	O
leaked	O
'	O
information	O
about	O
the	O
Assad	O
regime	O
)	O
rather	O
than	O
carefully	O
written	O
spear	O
phishing	O
targeting	O
a	O
single	O
individual	O
or	O
small	O
group	O
.	O
Use	B-Action
of	O
widely	O
available	O
RATs	B-Entity
(	O
njRAT	O
,	O
Xtreme	O
Rat	O
,	O
ShadowTech	O
Rat	O
,	O
DarkComet	O
RAT	O
,	O
and	O
Blackshades	O
RAT	O
,	O
among	O
others	O
)	O
.	O
At	O
least	O
one	O
command	O
-	O
and	O
-	O
control	O
server	O
located	O
within	O
Syrian	O
IP	O
space	O
(	O
often	O
from	O
a	O
limited	O
range	O
of	O
addresses	B-Entity
)	O
.	O
Frequent	O
use	O
of	O
Dynamic	O
DNS	O
providers	O
like	O
no	O
-	O
ip	O
.	O
Use	B-Action
of	O
''	O
crypters	O
''	O
to	O
obscure	O
the	O
binary	O
.	O
These	O
characteristics	O
are	O
not	O
all	O
present	O
in	O
every	O
sample	O
,	O
but	O
we	O
have	O
typically	O
found	O
one	B-Entity
or	O
more	O
in	O
almost	O
every	O
binary	O
we	O
have	O
examined	O
that	O
is	O
Syrian	O
regime	O
-	O
linked	O
.	O
This	O
malware	O
attack	O
differs	O
from	O
known	O
regime	O
-	O
linked	O
groups	O
in	O
each	O
of	O
these	O
elements	O
.	O
Not	O
only	O
is	O
it	B-Entity
exceptionally	O
targeted	O
,	O
but	O
it	B-Entity
is	O
also	O
not	O
a	O
commonly	O
available	O
RAT	O
.	O
Nor	O
does	O
it	O
have	O
RAT	O
functionality	O
.	O
The	O
function	O
of	O
the	O
malware	O
appears	O
to	O
be	O
:	O
identify	O
and	O
unmask	O
the	O
IP	O
address	O
of	O
target	O
(	O
s	O
)	O
,	O
and	O
resend	B-Action
them	B-Entity
to	B-Modifier
the	O
attacker	O
with	O
each	O
reboot	O
.	O
In	O
addition	O
,	O
data	B-Entity
is	O
sent	B-Action
to	B-Modifier
an	O
Internet	O
e	O
-	O
mail	O
address	O
,	O
and	O
no	O
crypter	O
is	O
used	O
to	O
obscure	O
the	O
binary	O
.	O
We	O
are	O
aware	O
of	O
only	O
one	O
previous	O
case	O
in	O
Syria	O
in	O
which	O
e	O
-	O
mail	B-Entity
was	O
used	O
to	O
transmit	B-Action
data	B-Entity
,	O
and	O
that	O
we	O
believed	O
was	O
regime	O
linked	O
.	O
That	O
incident	O
,	O
observed	O
in	O
2012	O
,	O
also	O
used	B-Action
hardcoded	O
e	O
-	O
mail	B-Entity
to	O
exfiltrate	B-Action
.	O
However	O
,	O
that	O
malware	B-Entity
had	O
substantially	O
more	O
functionality	O
than	O
this	O
case	O
:	O
not	O
only	O
did	O
it	B-Entity
drop	B-Action
a	O
second	O
stage	O
from	O
a	O
compromised	O
site	O
,	O
but	O
was	O
also	O
included	O
a	O
mechanism	O
for	O
exfiltrating	B-Action
credentials	B-Entity
from	B-Modifier
Facebook	B-Entity
and	O
hooking	B-Action
programs	B-Entity
like	O
Skype	O
.	O
The	O
lack	O
of	O
overlap	O
in	O
Tactics	O
,	O
Techniques	O
,	O
and	O
Procedures	O
(	O
TTPs	O
)	O
between	O
this	O
attack	O
and	O
prior	O
attacks	O
does	O
not	O
rule	O
out	O
Syrian	O
regime	O
-	O
linked	B-Action
attackers	B-Entity
.	O
It	B-Entity
is	O
possible	O
that	O
regime	O
-	O
linked	O
groups	O
are	O
trying	O
a	O
new	O
approach	O
.	O
However	O
,	O
given	B-Action
that	O
known	O
regime	O
-	O
linked	O
groups	O
continued	O
to	O
remain	O
active	O
during	O
the	O
same	O
date	O
range	O
using	O
familiar	O
TTPs	O
,	O
this	O
scenario	O
seems	O
unlikely	O
.	O
In	O
addition	O
,	O
it	B-Entity
would	O
be	O
strange	O
for	O
regime	O
-	O
linked	O
malware	O
groups	O
to	O
undertake	O
significant	O
effort	O
to	O
prepare	B-Action
and	O
send	B-Action
an	O
implant	B-Entity
that	O
has	O
significantly	O
less	O
functionality	O
than	O
what	O
they	B-Entity
commonly	O
use	B-Action
.	O
Taken	O
together	O
,	O
we	O
find	O
this	O
evidence	O
supports	O
the	O
hypothesis	O
that	O
familiar	O
regime	O
-	O
linked	O
groups	O
did	O
not	O
conduct	O
the	O
attack	O
.	O
RSS	B-Entity
operates	B-Action
in	B-Modifier
territory	B-Entity
controlled	B-Action
by	O
ISIS	B-Entity
,	O
and	O
has	O
faced	B-Action
extensive	B-Entity
targeting	B-Action
by	O
ISIS	B-Entity
.	O
Currently	O
,	O
they	B-Entity
appear	O
to	O
be	O
directly	O
targeted	O
by	O
ISIS	B-Entity
for	B-Modifier
kidnappings	B-Entity
and	O
other	O
retaliation	O
,	O
including	O
executions	O
.	O
In	O
addition	O
,	O
ISIS	O
supporters	O
have	O
explicitly	O
suggested	O
that	O
the	O
group	O
is	O
under	O
surveillance	O
and	O
actively	O
hunted	O
.	O
Together	O
this	O
evidence	O
suggests	O
that	O
ISIS	O
has	O
a	O
strong	O
motivation	O
for	B-Modifier
using	B-Modifier
social	B-Entity
engineering	I-Entity
and/or	O
malware	B-Entity
to	O
locate	O
the	O
members	O
of	O
RSS	O
.	O
We	O
think	O
there	O
are	O
several	O
features	O
of	O
the	O
malware	O
attack	O
that	O
align	O
with	O
the	O
needs	O
and	O
constraints	O
of	O
ISIS	O
and	O
its	O
supporters	O
in	O
Ar	O
-	O
Raqqah	O
,	O
more	O
so	O
than	O
other	O
groups	O
,	O
as	O
we	O
understand	O
them	B-Entity
.	O
For	O
example	O
:	O
The	O
malware	O
beacons	O
location	O
but	O
does	O
not	O
provide	B-Action
RAT	B-Entity
functionality	I-Entity
.	O
The	O
seeding	B-Entity
attempts	O
to	O
obtain	B-Action
a	O
'	O
private	O
'	O
Facebook	O
identity	O
from	O
RSS	O
through	O
social	O
engineering	O
.	O
The	O
malware	B-Entity
exfiltrates	B-Action
to	B-Modifier
an	O
online	O
e	O
-	O
mail	O
account	O
,	O
thus	O
not	O
requiring	O
the	O
attacker	O
to	O
maintain	B-Action
a	O
command	O
-	O
and-	O
control	O
server	O
online	O
.	O
The	O
social	O
media	O
activity	O
of	O
members	O
of	O
RSS	O
is	O
often	O
highly	O
public	O
.	O
Their	O
location	O
and	O
exact	O
membership	O
,	O
however	O
,	O
is	O
secret	O
.	O
We	O
speculate	O
that	O
if	O
an	O
attacker	O
were	O
interested	O
in	O
maintaining	B-Action
long	O
-	O
term	O
surveillance	O
of	O
the	O
activities	O
of	O
RSS	O
they	B-Entity
could	O
have	O
employed	O
a	O
RAT	O
.	O
However	O
,	O
if	O
the	O
attacker	O
were	O
interested	O
in	O
unmasking	O
the	O
location	O
of	O
its	O
targets	O
so	O
they	B-Entity
could	O
be	O
physically	O
tracked	O
down	O
,	O
collecting	B-Action
IP	B-Entity
data	I-Entity
and	O
system	B-Action
info	B-Entity
would	O
be	O
a	O
more	O
reasonable	O
approach	O
.	O
ISIS	O
or	O
its	O
supporters	O
clearly	O
have	O
a	O
strong	O
interest	O
in	O
the	O
(	O
rudimentary	O
)	O
location	O
tracking	O
of	O
the	O
members	O
of	O
RSS	O
that	O
this	O
malware	O
provides	O
.	O
Internet	O
connectivity	O
in	O
Raqqah	O
is	O
extremely	O
limited	O
,	O
and	O
some	O
of	O
it	B-Entity
is	O
under	O
ISIS	O
control	O
.	O
Knowing	O
the	O
IP	O
address	O
of	O
a	O
target	O
could	O
quickly	O
narrow	O
down	O
targets	B-Entity
to	B-Modifier
specific	O
locations	O
,	O
and	O
specific	O
Internet	O
services	B-Entity
,	O
or	O
Internet	O
cafes	O
in	O
Raqqah	O
.	O
Given	O
that	O
the	O
identities	O
and	O
locations	B-Action
of	O
RSS	O
members	O
are	O
closely	O
guarded	O
,	O
such	O
information	O
would	O
hold	O
significant	O
intelligence	O
value	O
for	O
ISIS	O
.	O
Armed	O
with	O
this	O
kind	O
of	O
information	O
,	O
ISIS	B-Entity
could	O
physically	O
harm	O
people	O
within	O
Raqqah	O
(	O
and	O
it	B-Entity
is	O
also	O
possible	O
that	O
they	B-Entity
have	O
the	O
ability	O
to	O
operate	O
in	O
some	O
capacity	O
in	O
border	O
areas	O
of	O
Turkey	O
)	O
.	O
Little	O
is	O
publicly	O
known	O
about	O
the	O
technical	O
capabilities	O
of	O
ISIS	O
and	O
its	O
supporters	O
;	O
however	O
,	O
reports	O
have	O
begun	O
to	O
emerge	O
suggesting	O
that	O
ISIS	O
is	O
interested	O
in	O
expanding	B-Action
its	B-Entity
abilities	I-Entity
.	O
In	O
addition	O
,	O
ISIS	B-Entity
has	O
reportedly	O
gained	O
the	O
support	O
of	O
at	O
least	O
one	O
individual	O
with	O
some	O
experience	O
with	O
social	O
engineering	O
and	O
hacking	B-Action
:	O
Junaid	O
Hussain	O
(	O
aka	O
TriCk	O
)	O
,	O
a	O
former	O
member	O
of	O
teamp0ison	O
hacking	O
team	O
.	O
While	O
Mr.	O
Hussain	O
and	O
associates	O
have	O
reportedly	O
made	O
threats	O
against	O
Western	O
governments	O
,	O
it	B-Entity
is	O
possible	O
that	O
he	B-Entity
or	O
others	O
working	O
with	O
ISIS	O
have	O
quietly	O
supported	O
an	O
effort	O
to	O
identify	O
the	O
targeted	O
organization	O
,	O
which	O
is	O
a	O
highly	O
visible	O
thorn	O
in	O
the	O
side	O
of	O
ISIS	O
.	O
It	B-Entity
is	O
possible	O
that	O
the	O
attack	O
is	O
the	O
product	O
of	O
actors	O
working	O
for	O
unknown	O
purposes	O
and	O
targeting	B-Action
RSS	B-Entity
.	O
Given	O
the	O
activities	O
of	O
RSS	O
,	O
however	O
,	O
it	B-Entity
is	O
unclear	O
who	O
this	O
might	O
be	O
.	O
It	B-Entity
is	O
not	O
possible	O
,	O
for	B-Modifier
example	B-Entity
,	O
to	O
reject	O
the	O
theory	O
that	O
some	O
unknown	O
group	O
within	O
the	O
FSA	O
,	O
or	O
other	O
groups	O
opposing	O
the	O
Assad	O
regime	O
are	O
responsible	O
.	O
Citizen	O
journalists	O
in	O
Ar	O
-	O
Raqqah	O
were	O
previously	O
critical	O
of	O
arbitrary	O
arrests	O
carried	O
out	O
by	O
non	O
-	O
ISIS	O
groups	O
in	O
2013	O
.	O
However	O
,	O
it	B-Entity
is	O
unclear	O
why	O
those	O
groups	O
,	O
which	O
no	O
longer	O
control	O
Ar	O
-	O
Raqqah	O
,	O
would	O
be	O
interested	O
in	O
RSS	O
in	O
November	O
2014	O
.	O
It	B-Entity
is	O
likely	O
that	O
third	O
party	O
actors	O
,	O
including	O
several	O
intelligence	O
services	B-Entity
,	O
are	O
closely	O
monitoring	B-Action
various	B-Entity
actors	I-Entity
in	O
the	O
conflict	O
through	O
a	O
range	O
of	O
electronic	O
means	O
.	O
However	O
,	O
there	O
is	O
little	O
reason	O
to	O
suggest	O
that	O
they	B-Entity
would	O
use	B-Action
a	O
tailored	O
but	O
technically	O
rudimentary	O
attack	O
to	O
target	B-Action
RSS	B-Entity
in	O
particular	O
.	O
After	O
considering	O
each	O
possibility	O
,	O
we	O
find	O
strong	O
but	O
inconclusive	O
circumstantial	O
evidence	O
to	O
support	B-Action
a	O
link	O
to	O
ISIS	O
.	O
However	O
,	O
we	O
are	O
unable	O
to	O
connect	B-Action
this	B-Entity
attack	I-Entity
directly	O
to	B-Modifier
ISIS	B-Entity
,	O
Mr.	O
Hussain	O
,	O
or	O
other	O
ISIS	O
supporters	O
.	O
If	O
indeed	O
ISIS	O
or	O
its	O
supporters	O
are	O
responsible	O
,	O
it	B-Entity
seems	B-Action
reasonable	B-Entity
that	O
such	O
an	O
offensive	O
capability	O
may	O
still	O
be	O
in	O
development	O
.	O
We	O
hope	O
that	O
publishing	O
this	O
report	O
will	O
draw	B-Action
attention	B-Entity
to	B-Modifier
a	O
new	O
and	O
concerning	B-Action
threat	B-Entity
that	O
includes	O
ISIS	O
critics	O
among	O
its	B-Entity
targets	I-Entity
.	O
If	O
ISIS	O
is	O
responsible	O
,	O
while	O
this	O
attack	O
targets	O
in	O
-	O
country	O
impediments	O
to	O
ISIS	O
objectives	O
,	O
other	O
targets	O
may	O
include	B-Action
ideological	B-Entity
or	O
military	O
adversaries	O
abroad	O
.	O
Whether	O
or	O
not	O
ISIS	O
is	O
responsible	O
,	O
this	B-Entity
attack	I-Entity
is	O
likely	O
the	O
work	O
of	O
a	O
non	O
-	O
regime	O
threat	O
actor	O
who	O
may	O
be	O
just	O
beginning	O
to	O
field	O
a	O
still	O
-	O
rudimentary	O
capability	O
in	O
the	O
Syrian	O
conflict	O
.	O
The	O
entry	O
costs	O
for	O
engaging	O
in	O
malware	O
attacks	O
in	O
a	O
conflict	O
like	O
the	O
Syrian	O
Civil	O
War	O
are	O
low	O
,	O
and	O
made	B-Action
lower	B-Entity
by	O
the	O
fact	O
that	O
the	O
rule	O
of	O
law	O
is	O
nonexistent	O
for	O
large	O
parts	O
of	O
the	O
country	O
.	O
In	O
still	O
other	O
parts	O
(	O
under	O
regime	O
control	O
)	O
,	O
malware	O
attacks	O
appear	O
to	O
be	O
state	O
sanctioned	O
.	O
Citizen	O
Lab	O
research	O
into	O
targeted	O
digital	O
threats	O
against	O
civil	O
society	O
confirms	O
that	O
civil	O
society	O
groups	O
face	O
grave	O
threats	O
from	O
targeted	O
malware	O
attacks	O
,	O
despite	O
being	O
under	O
-	O
resourced	O
to	O
defend	O
against	O
them	B-Entity
.	O
The	O
case	O
highlighted	O
here	O
is	O
no	O
exception	O
:	O
lack	O
of	O
IT	O
and	O
security	O
resources	O
have	O
made	O
it	B-Entity
difficult	O
for	O
the	O
Syrian	O
opposition	O
to	O
address	O
targeted	O
and	O
persistent	O
digital	O
threats	O
against	O
them	B-Entity
.	O
In	O
addition	O
,	O
if	O
ISIS	O
is	O
indeed	O
responsible	O
,	O
this	O
case	O
suggests	O
how	O
easy	O
it	O
is	O
for	O
belligerents	O
in	O
a	O
conflict	O
to	O
begin	O
fielding	O
basic	O
offensive	O
digital	O
capabilities	O
,	O
and	O
how	O
quickly	O
the	O
capabilities	O
can	O
be	O
pointed	O
at	O
unarmed	O
civil	O
society	O
groups	O
.	O
This	O
attack	O
was	O
exceptionally	O
targeted	O
,	O
and	O
clearly	O
reflected	O
the	O
work	O
of	O
an	O
actor	O
familiar	O
with	O
the	O
operations	O
of	O
the	O
targeted	O
organization	O
.	O
As	O
most	O
organizations	O
working	O
on	O
issues	O
surrounding	O
Syria	O
are	O
aware	O
,	O
malware	B-Entity
delivered	B-Action
with	B-Modifier
good	O
social	O
engineering	O
is	O
a	O
constant	O
source	O
of	O
danger	O
.	O
This	O
particular	O
attack	O
can	O
be	O
prevented	B-Action
by	O
not	O
opening	B-Action
files	B-Entity
sent	B-Action
by	O
unknown	O
persons	O
.	O
However	O
,	O
many	O
attacks	O
in	O
Syria	O
come	O
from	O
hijacked	O
accounts	O
and	O
impersonate	B-Action
people	B-Entity
known	B-Action
to	B-Modifier
the	B-Entity
targets	I-Entity
.	O
Social	O
engineering	O
remains	O
an	O
unsolved	O
problem	O
,	O
and	O
continues	O
to	O
compromise	B-Action
groups	B-Entity
throughout	O
the	O
Syrian	O
opposition	O
and	O
their	O
supporters	O
.	O
This	O
attack	O
reaffirms	O
the	O
dangers	O
posed	O
by	O
social	O
engineering	O
attacks	O
,	O
whether	O
they	B-Entity
deliver	B-Action
phishing	O
campaigns	O
or	O
malware	B-Entity
.	O
The	O
circumstantial	O
evidence	O
of	O
ISIS	O
involvement	O
suggests	O
that	O
groups	O
working	O
on	O
topics	O
that	O
ISIS	O
considers	O
a	O
threat	O
,	O
and	O
their	O
partner	O
organizations	O
and	O
supporters	B-Entity
,	O
should	O
urgently	O
examine	O
their	O
security	O
policies	O
and	O
assess	O
the	O
possible	O
risks	O
to	B-Modifier
their	B-Entity
operations	I-Entity
,	O
and	O
the	O
consequences	O
of	O
exposure	O
of	O
sensitive	B-Action
information	B-Entity
to	B-Modifier
ISIS	B-Entity
.	O
Even	O
if	O
the	O
link	O
to	O
ISIS	O
turns	O
out	O
to	O
be	O
incorrect	O
,	O
it	B-Entity
is	O
possible	O
that	O
this	B-Entity
will	O
be	O
a	O
threat	O
in	O
the	O
future	O
.	O
Individuals	O
and	O
groups	B-Action
at	B-Modifier
risk	B-Entity
can	O
also	O
consult	B-Action
materials	B-Entity
in	O
Arabic	O
provided	O
by	O
Cyber	O
Arabs	O
including	O
a	O
series	O
of	O
very	O
accessible	O
videos	O
on	O
digital	O
security	O
.	O
The	O
malware	B-Entity
files	B-Action
Files	B-Entity
dropped	B-Action
by	O
the	O
malware	O
Collected	O
Information	O
Files	O
(	O
unencrypted	O
)	O
Exfiltrated	B-Action
file	B-Entity
(	O
encrypted	B-Action
)	O
Registry	B-Entity
Keys	O
Acknowledgements	O
:	O
We	O
are	O
grateful	B-Entity
to	B-Modifier
Cyber	O
Arabs	O
and	O
the	O
Institute	O
for	O
War	O
and	O
Peace	O
Reporting	O
for	O
their	O
critical	O
work	O
and	O
assistance	O
.	O
Special	O
thanks	O
to	O
:	O
several	O
anonymous	O
Syrians	O
,	O
Masashi	O
Crete	O
-	O
Nishihata	O
,	O
Sarah	O
McKune	O
,	O
Morgan	O
Marquis	O
-	O
Boire	O
,	O
Ron	O
Deibert	O
,	O
Bill	O
Marczak	O
,	O
Nart	O
Villeneuve	O
,	O
Irene	O
Poetranto	O
,	O
and	O
Kristen	O
Dennesen	O
.	O
Support	O
for	O
this	O
research	O
is	O
provided	B-Action
by	O
grants	B-Entity
from	B-Modifier
the	O
John	O
D.	O
and	O
Catherine	O
T.	O
MacArthur	O
Foundation	O
and	O
the	O
Ford	O
Foundation	O
.	O
In	O
February	O
2014	O
,	O
the	O
experts	O
of	O
the	O
G	O
DATA	O
SecurityLabs	O
published	O
an	O
analysis	O
of	O
Uroburos	O
,	O
the	O
rootkit	B-Entity
with	O
Russian	O
roots	O
.	O
We	O
explained	O
that	O
a	O
link	O
exists	O
between	O
Uroburos	O
and	O
the	O
Agent	O
.	O
BTZ	O
malware	B-Entity
,	O
which	O
was	O
responsible	O
for	O
''	O
the	O
most	O
significant	O
breach	O
of	O
U.S.	O
military	O
computers	O
ever	O
.	O
''	O
Nine	O
months	O
later	O
,	O
after	O
the	O
buzz	O
around	O
Uroburos	O
,	O
aka	O
Snake	B-Entity
or	O
Turla	O
,	O
we	O
now	O
identified	O
a	O
new	O
generation	O
of	O
Agent	O
.	O
BTZ	O
.	O
We	O
dubbed	O
it	O
ComRAT	O
and	O
,	O
by	O
now	O
,	O
analyzed	O
two	O
versions	O
of	O
the	O
threat	O
(	O
v3.25	O
and	O
v3.26	O
)	O
.	O
As	O
reported	O
earlier	O
this	O
year	O
,	O
Agent	O
.	O
BTZ	B-Entity
used	O
the	O
same	O
encoding	O
key	O
and	O
the	O
installation	O
log	O
file	O
name	O
as	O
Uroburos	O
.	O
ComRAT	B-Entity
,	O
in	O
its	O
version	O
3.25	O
,	O
shows	O
the	O
same	O
behavior	O
.	O
Furthermore	O
,	O
the	O
attackers	B-Entity
also	O
shared	O
a	O
C	O
&	O
C	O
domain	O
.	O
The	O
latest	O
version	O
of	O
ComRAT	B-Entity
known	O
to	O
us	O
(	O
v3.26	O
)	O
uses	B-Action
a	O
new	O
key	O
and	O
does	B-Action
not	O
create	O
the	O
installation	O
log	O
file	O
,	O
in	O
order	O
to	O
complicate	O
the	O
analysis	O
and	O
to	O
disguise	B-Action
the	O
link	O
between	O
the	O
two	O
cases	O
.	O
Another	O
very	O
interesting	O
fact	O
:	O
the	O
attackers	B-Entity
use	B-Action
COM	O
Object	O
hijacking	B-Action
,	O
the	O
same	O
persistence	O
mechanism	O
as	O
COMpfun	O
,	O
which	O
we	O
described	O
recently	O
.	O
Taken	O
everything	O
into	O
consideration	O
,	O
the	O
indications	O
we	O
saw	O
during	O
our	O
analyzes	O
lead	O
to	O
the	O
supposition	O
that	O
the	O
group	O
behind	O
Agent	O
.	O
BTZ	O
and	O
Uroburos	B-Entity
is	O
still	O
active	O
and	O
is	O
pursuing	O
the	O
Agent	O
.	O
BTZ	O
path	O
once	O
more	O
to	O
improve	B-Action
and	O
change	O
the	O
RAT	O
.	O
The	B-Entity
analyzed	B-Action
file	B-Entity
is	O
the	O
latest	O
version	O
we	O
identified	O
:	O
v3.26	O
.	O
The	O
version	O
identification	O
is	O
described	O
in	O
the	O
chapter	O
''	O
Log	O
files	O
''	O
.	O
The	O
major	O
difference	O
between	O
this	O
version	O
and	O
the	O
older	O
version	O
(	O
s	O
)	O
will	O
be	O
described	O
there	O
.	O
The	O
first	O
task	O
of	O
the	O
malware	O
is	O
to	O
install	B-Action
the	O
file	O
credprov.tlb	O
in	O
%	O
APPDATA	O
%	O
\Microsoft\	O
.	O
This	O
file	O
is	O
the	O
main	O
payload	O
of	O
the	O
malware	O
.	O
The	O
dropper	B-Entity
executes	B-Action
the	O
following	O
command	O
in	O
order	O
to	O
install	B-Action
a	O
second	O
file	O
:	O
The	O
second	O
file	O
is	O
shdocw.tlp	O
.	O
The	O
two	O
files	O
are	O
Microsoft	O
Windows	O
dynamic	O
libraries	B-Entity
.	O
To	O
be	O
started	O
during	O
the	O
boot	O
process	O
of	O
the	O
infected	O
machine	O
,	O
the	O
malware	B-Entity
creates	B-Action
the	O
following	O
registry	B-Entity
key	I-Entity
:	O
This	O
registry	O
key	O
is	O
used	O
to	O
associate	O
the	O
library	O
shdocvw.tlp	O
to	O
the	O
object	O
42aedc87	O
-	O
2188	O
-	O
41fd	O
-	O
b9a3	O
-	O
0c966feabec1	O
as	O
previously	O
explained	O
in	O
the	O
article	O
about	O
COMpfun	O
.	O
The	O
purpose	O
is	O
to	O
load	B-Action
the	O
library	O
into	O
each	O
and	O
every	B-Entity
process	I-Entity
executed	B-Action
on	B-Modifier
the	O
infected	O
system	O
.	O
If	O
the	O
version	O
of	O
the	O
malware	O
is	O
older	O
than	O
3.26	O
,	O
the	O
dropper	B-Entity
creates	B-Action
an	O
additional	O
file	O
called	O
winview.ocx	O
.	O
We	O
noticed	O
that	O
the	O
file	O
name	O
is	O
still	O
the	O
same	O
as	O
the	O
file	O
name	O
used	B-Action
by	O
Agent	B-Entity
.	O
BTZ	O
in	O
the	O
past	O
.	O
The	O
file	B-Entity
is	O
xored	O
with	O
the	O
following	O
obfuscation	O
key	O
(	O
used	B-Action
by	O
both	O
,	O
Uroburos	B-Entity
and	O
Agent	O
.	O
BTZ	O
)	O
:	O
Here	O
is	O
the	O
decoded	O
log	O
file	O
content	O
:	O
We	B-Entity
can	O
notice	O
that	O
the	O
malware	B-Entity
checks	B-Action
if	O
an	O
older	O
version	O
is	O
installed	B-Action
on	B-Modifier
the	O
system	O
and	O
if	O
this	O
is	O
the	O
case	O
,	O
the	O
dropper	B-Entity
removes	O
the	O
older	O
version	O
.	O
In	O
contrast	O
to	O
this	O
,	O
in	O
our	O
Uroburos	O
analysis	O
,	O
we	O
found	O
out	O
that	O
Uroburos	O
does	O
not	O
install	B-Action
itself	B-Entity
in	O
case	O
a	O
version	O
of	O
Agent	O
.	O
BTZ	O
was	O
found	O
on	O
a	O
system	O
.	O
During	O
the	O
startup	O
of	O
the	O
infected	O
machine	O
,	O
the	O
shdocvw.tlp	O
library	O
is	O
loaded	B-Action
into	B-Modifier
all	B-Entity
processes	I-Entity
.	O
If	O
the	O
process	O
is	O
explorer.exe	B-Entity
,	O
this	B-Entity
library	I-Entity
will	O
load	B-Action
the	O
other	O
library	O
called	O
credprov.tlb	O
.	O
This	O
library	O
is	O
the	O
real	O
payload	O
.	O
Its	O
features	O
are	O
common	O
for	O
a	O
Remote	O
Administration	O
Tool	O
(	O
RAT	O
)	O
:	O
ComRAT	B-Entity
's	O
communication	B-Entity
to	B-Modifier
the	O
command	O
and	O
control	B-Action
server	B-Entity
is	O
performed	B-Action
by	O
the	O
browser	O
process	O
and	O
not	O
by	O
explorer.exe	B-Entity
in	O
order	O
to	O
avoid	B-Action
being	B-Entity
blocked	B-Action
by	O
a	O
firewall	O
on	O
the	O
system	O
or	O
any	O
additional	O
security	O
products	O
.	O
The	O
communication	O
between	O
the	O
processes	O
is	O
performed	B-Action
by	O
named	O
pipe	O
.	O
Two	O
log	O
files	O
are	O
created	O
during	O
the	O
malware	O
execution	O
:	O
mskfp32.ocx	B-Entity
and	O
msvcrtd.tlb	B-Entity
.	O
If	O
the	O
malware	O
version	O
is	O
older	O
than	O
3.26	O
,	O
the	O
xored	O
key	O
is	O
the	O
same	O
as	O
the	O
dropper	B-Action
key	B-Entity
.	O
Concerning	O
the	O
version	O
3.26	O
,	O
the	O
malware	O
uses	O
a	O
new	O
non	O
-	O
ASCII	B-Entity
key	I-Entity
.	O
Here	O
is	O
an	O
example	O
of	O
decoded	O
log	O
file	O
for	O
the	O
version	O
3.26	O
:	O
We	B-Entity
can	O
identify	O
the	O
version	O
of	O
the	O
malware	O
thanks	O
to	O
the	O
PVer	O
flag	O
.	O
The	O
command	O
and	O
control	O
server	O
information	O
is	O
stored	O
in	O
the	O
registry	B-Entity
,	O
not	O
in	O
an	O
XML	O
,	O
and	O
encoded	B-Action
:	O
For	O
example	O
,	O
in	O
the	O
analyzed	O
sample	O
the	O
CC	O
is	O
:	O
weather-online.hopto.org	B-Entity
.	O
This	O
domain	O
is	O
far	O
from	O
unknown	O
,	O
as	O
it	B-Entity
has	O
been	O
mentioned	O
in	O
BAE	O
System	O
's	O
Uroburos	O
(	O
aka	O
Snake	B-Entity
)	O
analysis	B-Entity
paper	O
as	O
C	O
&	O
C	O
server	O
domain	O
for	O
the	O
Uroburos	O
malware	B-Entity
.	O
Another	O
connection	O
between	O
the	O
cases	O
.	O
If	O
the	O
malware	O
version	O
in	O
lower	O
than	O
3.26	O
,	O
the	O
XML	O
log	O
file	O
contains	O
the	O
command	O
and	O
control	O
server	O
information	O
:	O
Let	O
us	O
summarize	O
the	O
similarities	O
and	O
differences	O
between	O
Agent	O
.	O
BTZ	O
,	O
Uroburos	B-Entity
and	O
ComRAT	B-Entity
as	O
far	O
as	O
we	O
can	O
:	O
Some	O
parts	O
of	O
the	O
code	O
are	O
exactly	O
the	O
same	O
(	O
appears	O
to	O
be	O
copy	O
&	O
paste	O
)	O
.	O
That	O
is	O
the	O
reason	O
why	O
the	O
sample	O
is	O
detected	O
as	O
Uroburos	O
(	O
aka	O
Turla	O
)	O
.	O
The	O
same	O
code	B-Entity
was	B-Action
used	I-Action
by	O
Agent	B-Entity
.	O
BTZ	O
and	O
also	O
the	O
dll	O
loaded	B-Action
into	B-Modifier
userland	O
during	O
the	O
Uroburos	O
analysis	O
.	O
Command	O
and	O
control	O
server	O
domains	O
are	O
shared	O
between	O
Uroburos	O
and	O
ComRAT	B-Entity
.	O
In	O
version	O
3.26	O
,	O
the	O
author	O
changed	O
the	O
key	O
and	O
remove	B-Action
the	B-Entity
known	O
file	O
name	O
.	O
This	O
action	O
can	O
be	O
an	O
indication	O
for	O
the	O
developer	O
's	O
effort	O
to	O
hide	B-Action
this	B-Entity
connection	I-Entity
.	O
The	O
main	O
difference	O
is	O
the	O
design	O
.	O
Agent	O
.	O
BTZ	O
is	O
a	O
common	O
RAT	O
,	O
a	O
simple	O
library	O
executed	B-Action
on	B-Modifier
an	O
infected	O
machine	O
.	O
ComRAT	B-Entity
is	O
more	O
complex	O
and	O
cleverer	B-Entity
.	O
The	O
malware	B-Entity
is	B-Action
loaded	I-Action
into	B-Modifier
each	B-Entity
and	O
every	O
process	O
of	O
the	O
infected	O
machine	O
and	O
the	O
main	O
part	O
(	O
payload	O
)	O
of	O
the	O
malware	O
is	O
only	O
executed	B-Action
in	B-Modifier
explorer.exe	B-Entity
.	O
Furthermore	O
,	O
the	O
C	O
&	O
C	O
communication	B-Entity
blends	O
into	O
the	O
usual	O
browser	O
traffic	O
and	O
the	O
malware	B-Entity
communicates	B-Action
to	B-Modifier
the	O
browser	O
by	O
named	O
pipe	O
.	O
It	B-Entity
is	O
by	O
far	O
a	O
more	O
complex	O
userland	O
design	O
than	O
Agent	O
.	O
BTZ	O
.	O
These	O
differences	O
,	O
mainly	O
the	O
more	O
complex	O
design	O
,	O
lead	O
us	O
to	O
give	O
this	O
malware	O
a	O
new	O
name	O
.	O
The	O
analyzed	O
dropper	B-Action
of	O
v3.25	O
has	O
a	O
compilation	O
date	O
of	O
February	O
6th	O
2014	O
.	O
The	O
more	O
recent	O
dropper	B-Action
of	O
v3.26	O
,	O
which	O
has	O
all	O
the	O
mentioned	O
changes	O
implemented	O
,	O
reveals	O
a	O
compilation	O
date	O
of	O
January	O
3rd	O
2013	O
.	O
We	O
suspect	O
that	O
this	O
date	O
is	O
spoofed	O
in	O
order	O
to	O
disguise	B-Action
that	O
this	O
is	O
in	O
fact	O
a	O
newer	O
version	O
.	O
This	O
analysis	O
shows	O
that	O
even	O
after	O
the	O
Uroburos	O
publication	O
in	O
February	O
2014	O
,	O
the	O
group	O
behind	O
this	O
piece	O
of	O
malware	O
seems	O
to	O
be	O
still	O
active	O
.	O
In	O
any	O
case	O
,	O
the	O
ComRAT	O
developers	O
implemented	O
new	O
mechanisms	O
,	O
changed	B-Action
keys	B-Entity
,	O
removed	O
log	B-Action
files	B-Entity
to	O
hide	B-Action
their	O
activities	O
and	O
tried	O
to	O
disguise	B-Action
the	O
connections	O
between	O
the	O
RAT	O
ComRAT	B-Entity
,	O
the	O
rootkit	O
Uroburos	O
and	O
the	O
RAT	O
Agent	O
.	O
BTZ	O
as	O
much	O
as	O
possible	O
.	O
However	O
,	O
we	B-Entity
can	O
still	O
follow	O
the	O
evolution	O
of	O
the	O
malware	O
by	O
comparing	O
the	O
versions	O
.	O
The	O
persistence	O
mechanism	O
discovered	O
in	O
October	O
2014	O
makes	B-Action
it	B-Entity
possible	O
to	O
intrude	O
into	O
a	O
system	O
in	O
a	O
really	O
discreet	O
manner	O
and	O
we	O
estimate	O
that	O
other	O
actors	O
will	O
use	B-Action
the	O
same	O
persistence	O
mechanism	O
in	O
the	O
near	O
future	O
.	O
We	O
will	O
definitely	O
keep	O
our	O
ears	O
and	O
eyes	B-Action
open	B-Entity
and	O
continue	O
analyzing	O
.	O
Cyber	O
espionage	B-Entity
has	O
been	O
a	O
hot	O
topic	O
through	O
the	O
last	O
years	O
.	O
Computer	O
attacks	B-Entity
known	O
as	O
''	O
APT	O
''	O
(	O
Advanced	O
Persistent	O
Threat	O
)	O
have	O
become	O
widely	O
reported	B-Action
and	O
emphasized	B-Action
by	O
the	O
media	O
,	O
damages	O
are	O
now	O
considered	O
as	O
real	B-Action
and	O
strategic	O
trends	O
are	O
moving	O
in	O
cyber	O
defense	O
.	O
AIRBUS	O
Defence	O
&	O
Space	O
–	O
CyberSecurity	B-Action
unit	B-Entity
responds	B-Action
to	B-Modifier
such	O
attacks	O
for	O
its	O
customers	O
every	O
day	O
,	O
developing	O
a	O
complete	O
range	O
of	O
solutions	O
.	O
Today	O
,	O
we	O
decided	O
to	O
release	O
publicly	O
information	O
on	O
a	O
specific	O
group	O
of	O
APT	O
attackers	B-Entity
known	O
as	O
''	O
Pitty	O
Tiger	O
''	O
.	O
This	O
information	O
comes	O
directly	O
from	O
investigations	O
led	O
by	O
our	O
Threat	O
Intelligence	O
.	O
Pitty	O
Tiger	O
is	O
a	O
group	O
of	O
attackers	B-Entity
that	O
have	O
been	O
active	O
since	O
at	O
least	O
2011	O
.	O
They	B-Entity
have	O
targeted	O
private	O
companies	O
in	O
several	O
sectors	O
,	O
such	O
as	O
defense	O
and	O
telecommunications	B-Entity
,	O
but	O
also	O
at	O
least	O
one	O
government	O
.	O
We	O
have	O
been	O
able	O
to	O
track	B-Action
down	O
this	O
group	O
of	O
attackers	B-Entity
and	O
can	O
provide	O
detailed	O
information	O
about	O
them	B-Entity
.	O
We	O
were	O
able	O
to	O
collect	B-Action
and	O
reveal	O
their	O
''	O
malware	O
arsenal	O
''	O
.	O
We	O
also	O
analyzed	O
their	O
technical	O
organization	O
.	O
Our	O
investigations	O
indicate	O
that	O
Pitty	O
Tiger	O
has	O
not	O
used	O
any	O
0day	O
vulnerability	O
so	O
far	O
,	O
rather	O
they	O
prefer	O
using	O
custom	O
malware	O
,	O
developed	O
for	O
the	O
group	O
's	O
exclusive	O
usage	O
.	O
Our	O
discoveries	O
indicate	O
that	O
Pitty	O
Tiger	O
is	O
a	O
group	O
of	O
attackers	B-Entity
with	O
the	O
ability	O
to	O
stay	B-Action
under	O
the	O
radar	O
,	O
yet	O
still	O
not	O
as	O
mature	O
as	O
other	O
groups	O
of	O
attackers	B-Entity
we	O
monitor	O
.	O
Pitty	O
Tiger	O
is	O
probably	O
not	O
a	O
state	O
-	O
sponsored	O
group	O
of	O
attackers	B-Entity
.	O
They	B-Entity
lack	O
the	O
experience	O
and	O
financial	O
support	O
that	O
one	B-Entity
would	O
expect	O
from	O
state	O
-	O
sponsored	B-Action
attackers	B-Entity
.	O
We	O
suppose	O
this	O
group	O
is	O
opportunistic	O
and	O
sells	B-Action
its	B-Entity
services	I-Entity
to	B-Modifier
probable	O
competitors	O
of	O
their	O
targets	O
in	O
the	O
private	O
sector	O
.	O
We	O
have	O
been	O
able	O
to	O
leverage	O
several	O
attackers	O
profiles	O
,	O
showing	O
that	O
the	O
Pitty	O
Tiger	O
group	O
is	O
fairly	O
small	O
compared	O
to	B-Modifier
other	O
APT	O
groups	O
,	O
which	O
is	O
probably	O
why	O
we	O
saw	O
them	O
work	O
on	O
a	O
very	O
limited	O
amount	O
of	O
targets	B-Entity
.	O
At	O
the	O
end	O
of	O
this	O
report	O
,	O
we	O
provide	O
indicators	O
of	O
compromise	O
to	O
help	O
people	O
detect	O
current	O
Pitty	O
Tiger	O
attacks	O
.	O
APT	O
attacks	O
follow	O
what	O
we	O
call	O
the	O
''	O
APT	O
kill	O
chain	O
''	O
.	O
The	O
kill	O
chain	O
describes	O
briefly	O
the	O
way	O
attackers	B-Entity
do	O
perform	B-Action
their	B-Entity
actions	I-Entity
.	O
It	B-Entity
can	O
be	O
summarized	O
by	O
the	O
following	O
scheme	O
:	O
The	O
reconnaissance	O
phase	O
commences	O
when	O
an	O
attacker	O
selects	O
a	O
new	O
target	O
and	O
involves	B-Action
the	O
acquisition	O
of	O
information	O
about	O
that	O
target	O
.	O
There	O
is	O
very	O
little	O
information	O
available	O
about	O
this	O
phase	O
,	O
and	O
there	O
is	O
little	O
data	O
about	O
it	B-Entity
.	O
The	O
only	O
way	O
to	O
collect	B-Action
information	B-Entity
about	O
this	O
phase	O
would	O
be	O
to	O
already	O
monitor	B-Action
all	B-Entity
attackers	I-Entity
'	O
actions	O
at	O
this	O
step	O
,	O
which	O
is	O
hardly	O
feasible	O
.	O
The	O
longer	O
the	O
attackers	B-Entity
spend	O
time	O
in	B-Modifier
attempting	B-Entity
to	O
understand	O
their	O
target	O
and	O
its	O
online	O
presence	O
,	O
the	O
easier	O
it	B-Entity
will	O
be	O
to	O
find	O
efficient	O
ways	O
to	O
penetrate	O
that	O
company	O
's	O
systems	O
.	O
This	O
reconnaissance	O
phase	O
is	O
both	O
about	B-Modifier
finding	O
information	O
to	O
break	O
into	O
the	O
targeted	O
network	B-Entity
successfully	O
and	O
about	O
searching	B-Action
for	B-Modifier
data	B-Entity
which	O
could	O
help	O
to	O
accelerate	O
sensitive	O
information	O
isolation	O
(	O
like	O
the	O
name	O
of	O
a	O
key	O
employee	O
for	O
example	O
)	O
.	O
This	O
phase	O
mostly	O
relies	O
on	O
open	O
sources	O
from	O
the	O
Internet	O
:	O
social	O
networks	O
,	O
press	O
releases	O
,	O
white	O
papers	O
,	O
corporate	O
websites	O
,	O
search	B-Action
engines	B-Entity
,	O
but	O
also	O
on	B-Modifier
some	O
active	O
tools	O
like	O
vulnerability	O
scanners	O
etc	O
.	O
At	O
this	O
stage	O
,	O
the	O
APT	O
attackers	B-Entity
have	O
a	O
solid	O
knowledge	O
of	O
their	O
target	O
and	O
its	O
key	O
employees	O
.	O
The	O
attackers	B-Entity
have	O
everything	O
they	B-Entity
need	O
to	O
start	O
looking	B-Action
for	B-Modifier
an	O
entry	O
point	O
to	O
the	O
company	O
's	O
network	O
and	O
establish	B-Action
one	B-Entity
or	O
several	O
permanent	O
backdoors	O
into	O
the	O
environment	O
.	O
The	O
attackers	B-Entity
mostly	O
rely	B-Action
on	B-Modifier
two	O
techniques	O
here	O
to	O
infect	B-Action
one	B-Entity
or	O
several	O
computers	O
,	O
usually	O
workstations	O
,	O
inside	O
the	O
target	O
's	O
network	O
:	O
spear	O
phishing	O
and	O
drive	O
-	O
by	O
downloads	B-Action
.	O
Spear	O
phishing	O
can	O
be	O
described	O
as	O
targeted	O
e	O
-	O
mail	O
phishing	O
.	O
In	O
a	O
spear	O
phishing	O
scheme	O
,	O
attackers	B-Entity
send	B-Action
very	O
few	O
e	O
-	O
mails	B-Entity
to	O
targeted	B-Action
people	B-Entity
.	O
In	O
fact	O
,	O
they	B-Entity
can	O
even	O
send	B-Action
just	O
a	O
single	O
e	O
-	O
mail	B-Entity
.	O
The	O
trick	O
is	O
to	O
target	B-Action
the	O
right	O
victim	O
and	O
provide	B-Action
it	B-Entity
with	O
the	O
right	O
content	O
,	O
so	O
that	O
they	B-Entity
will	O
click	O
on	O
a	O
link	O
leading	O
to	O
drive	O
-	O
by	O
download	B-Action
of	O
a	O
malware	O
,	O
or	O
open	B-Action
an	B-Entity
attached	B-Action
file	B-Entity
which	O
will	O
infect	B-Action
their	B-Entity
computer	I-Entity
.	O
Some	O
groups	O
of	O
attackers	B-Entity
also	O
use	B-Action
''	O
watering	O
hole	O
''	O
techniques	O
to	O
successfully	O
compromise	B-Action
their	B-Entity
targets	I-Entity
.	O
To	O
build	O
a	O
watering	O
hole	O
attack	O
,	O
attackers	B-Entity
do	O
compromise	O
the	O
website	O
of	O
a	O
third	O
party	O
,	O
generally	O
a	O
supplier	O
of	O
the	O
target	O
,	O
which	O
is	O
typically	O
visited	B-Action
by	O
a	O
specific	O
group	O
of	O
professionals	O
and	O
very	O
likely	O
by	O
the	O
target	O
.	O
Every	O
visitor	O
of	O
the	O
compromised	O
third	O
party	O
is	O
then	O
infected	B-Action
.	O
The	O
method	O
has	O
one	O
major	O
drawback	O
:	O
it	B-Entity
will	O
also	O
infect	B-Action
third	O
parties	O
who	O
visit	O
the	O
website	O
.	O
Attackers	B-Entity
have	O
developed	B-Action
ways	B-Entity
to	O
avoid	B-Action
this	B-Entity
.	O
If	O
their	O
reconnaissance	O
phase	O
has	O
been	O
done	B-Action
effectively	O
,	O
they	B-Entity
already	O
know	O
all	O
IP	O
ranges	O
used	B-Action
by	O
the	O
target	O
company	O
.	O
It	O
just	O
takes	O
a	O
few	O
lines	O
of	O
code	B-Entity
in	O
the	O
infecting	B-Action
script	B-Entity
to	B-Modifier
only	O
compromise	B-Action
visitors	B-Entity
coming	B-Action
from	B-Modifier
the	O
target	O
IP	O
ranges	O
.	O
Direct	O
attacks	O
against	O
servers	O
of	O
the	O
target	O
can	O
also	O
be	O
a	O
way	O
to	O
penetrate	O
the	O
target	O
's	O
network	O
.	O
Attackers	B-Entity
have	O
gained	B-Action
access	B-Entity
to	B-Modifier
one	B-Entity
or	O
several	O
machines	O
inside	O
the	O
target	O
's	O
corporate	O
network	O
.	O
They	B-Entity
need	O
to	O
install	B-Action
several	B-Entity
different	O
backdoors	O
in	O
order	O
to	O
be	O
able	O
to	O
always	O
access	O
the	O
network	O
.	O
In	O
case	O
one	O
backdoor	O
falls	O
,	O
there	B-Entity
will	O
be	O
others	O
.	O
As	O
soon	O
as	O
the	O
attackers	O
are	O
sure	O
they	B-Entity
have	O
enough	O
access	O
,	O
they	B-Entity
start	O
looking	B-Action
for	B-Modifier
two	O
things	O
:	O
intellectual	O
property	O
(	O
or	O
anything	O
else	O
they	O
want	O
to	O
know	B-Action
or	O
steal	B-Action
)	O
in	O
alignment	O
with	O
predefined	O
mission	O
objectives	O
,	O
and	O
a	O
means	O
of	O
privilege	O
escalation	O
to	O
facilitate	O
lateral	O
movement	O
within	O
the	O
compromised	O
environment	O
.	O
It	B-Entity
generally	O
does	O
not	O
take	O
long	O
before	O
the	O
attackers	B-Entity
gain	O
domain	O
administrator	O
privileges	O
and	O
dump	B-Action
all	O
the	O
Active	O
Directory	O
content	O
.	O
They	B-Entity
use	B-Action
lateral	O
moves	O
between	O
machines	O
inside	O
the	O
network	O
,	O
and	O
look	O
for	O
everything	O
they	B-Entity
need	O
.	O
This	O
step	O
is	O
very	O
hard	O
to	O
detect	B-Action
,	O
since	B-Modifier
they	B-Entity
only	O
use	B-Action
valid	O
credentials	O
and	O
legitimate	O
administration	O
tools	O
such	O
as	O
PsExec	B-Entity
.	O
Data	O
exfiltration	O
is	O
the	O
last	O
step	O
before	O
the	O
attackers	O
loop	O
to	O
the	O
lateral	O
moves	O
step	O
,	O
in	O
a	O
never	O
-	O
ending	O
circle	O
of	O
prolonged	O
access	O
and	O
information	O
theft	O
.	O
They	B-Entity
generally	O
create	O
archive	O
files	O
containing	O
the	O
content	O
they	O
want	O
to	O
exfiltrate	B-Action
,	O
which	O
are	O
then	O
sent	B-Action
to	B-Modifier
the	O
attackers	B-Entity
by	O
using	O
a	O
remote	O
administration	O
tool	O
(	O
RAT	O
)	O
or	O
transfer	B-Action
protocols	O
such	O
as	O
FTP	O
and	O
HTTP	B-Entity
.	O
This	O
phase	O
is	O
not	O
the	O
end	O
of	O
an	O
APT	O
attack	O
.	O
The	O
attackers	B-Entity
loop	O
to	O
the	O
access	O
strengthening	O
/	O
lateral	O
moves	O
stage	O
and	O
generally	O
keep	O
stealing	B-Action
more	O
information	O
and	O
stay	B-Action
inside	O
the	O
network	O
for	O
more	O
data	O
gathering	O
.	O
For	O
more	O
information	O
about	O
all	O
the	O
APT	O
phases	O
,	O
please	O
refer	O
to	O
our	O
APT	O
Kill	O
Chain	O
blog	O
post	O
serie	O
.	O
During	O
our	O
regular	O
investigations	O
on	O
APT	O
cases	O
,	O
one	O
particular	O
variant	O
of	O
malware	O
caught	O
our	O
attention	O
,	O
because	O
we	O
had	O
not	O
faced	O
it	B-Entity
before	O
.	O
We	O
decided	O
to	O
spend	O
some	O
time	O
to	O
investigate	B-Action
around	O
this	O
malware	O
and	O
found	O
out	O
that	O
it	B-Entity
was	O
used	O
exclusively	O
by	O
a	O
single	O
group	O
of	O
attackers	B-Entity
.	O
This	O
malware	O
family	O
is	O
known	O
as	O
''	O
PittyTiger	O
''	O
by	O
the	O
anti	O
-	O
virus	O
research	O
community	O
.	O
We	O
discovered	O
this	O
malware	O
sample	O
in	O
June	O
2014	O
,	O
leading	B-Action
to	B-Modifier
a	O
command	O
&	O
control	O
(	O
c	O
&	O
c	O
)	O
server	B-Entity
still	O
in	O
activity	O
.	O
Our	O
researches	O
around	O
this	O
particular	O
malware	O
family	O
revealed	O
the	O
''	O
Pitty	O
Tiger	O
''	O
group	O
has	O
been	O
active	O
since	O
2011	B-Entity
,	O
yet	O
we	O
found	O
other	O
publications	O
which	O
could	O
probably	O
be	O
attributed	O
to	O
the	O
same	O
group	O
of	O
attacker	O
back	O
in	O
2010	O
.	O
This	O
group	O
uses	O
other	O
malware	O
and	O
tools	O
during	O
their	O
APT	O
operations	O
,	O
in	B-Modifier
addition	B-Entity
to	B-Modifier
the	O
PittyTiger	O
RAT	O
.	O
A	O
variant	O
of	O
the	O
infamous	O
Gh0st	O
RAT	O
dubbed	O
''	O
Paladin	O
''	O
has	O
been	O
used	B-Action
repeatedly	O
by	O
the	O
PT	O
group	O
,	O
together	O
with	O
other	O
RATs	B-Entity
which	O
seem	O
to	O
be	O
developed	O
exclusively	O
for	O
the	O
PT	O
group	O
:	O
''	O
MM	O
RAT	O
''	O
(	O
aka	O
Troj	O
/	O
Goldsun	O
-	O
B	O
)	O
,	O
and	O
''	O
CT	O
RAT	O
''	O
.	O
Another	O
variant	O
of	O
Gh0st	O
RAT	O
named	O
''	O
Leo	O
''	O
has	O
been	O
found	O
inactive	O
on	O
a	O
c	O
&	O
c	O
server	O
.	O
We	O
also	O
found	O
another	B-Entity
malware	I-Entity
,	O
named	O
''	O
Troj	O
/	O
ReRol	O
.	O
A	O
''	O
.	O
This	O
one	O
is	O
also	O
used	B-Action
by	O
the	O
group	O
to	O
infect	B-Action
workstations	B-Entity
,	O
collect	B-Action
system	B-Entity
information	I-Entity
,	O
and	O
install	B-Action
more	O
malware	O
on	O
the	O
infected	O
computer	O
.	O
It	B-Entity
acts	O
as	O
a	O
first	O
stage	O
downloader	O
and	O
system	B-Action
data	B-Entity
collector	O
often	O
used	B-Action
in	O
the	O
initial	O
compromise	O
of	O
the	O
Pitty	O
Tiger	O
campaigns	O
,	O
generally	O
embedded	O
in	O
Microsoft	O
Office	O
documents	O
.	O
Thanks	B-Entity
to	B-Modifier
server	B-Entity
's	O
misconfigurations	O
,	O
we	O
managed	O
to	O
get	B-Action
information	B-Entity
from	B-Modifier
three	O
c	O
&	O
c	O
servers	B-Entity
used	B-Action
by	O
this	O
group	O
of	O
attackers	B-Entity
,	O
which	O
provided	O
us	O
with	O
insight	O
from	O
the	O
end	O
of	O
2013	O
to	B-Modifier
the	O
beginning	O
of	O
July	O
2014	O
.	O
Our	O
investigation	O
has	O
been	O
focused	O
on	O
the	O
data	O
we	O
could	O
get	O
from	O
these	O
c	O
&	O
c	O
servers	O
but	O
also	O
on	B-Modifier
the	O
Pitty	O
Tiger	O
environment	O
.	O
This	O
whitepaper	O
aims	O
to	O
expose	O
the	O
view	O
we	O
have	O
on	O
the	O
group	O
,	O
especially	O
on	O
their	O
infrastructure	O
and	O
capabilities	B-Entity
.	O
We	O
hope	O
this	O
publication	O
will	O
bring	B-Action
further	O
counter	O
analysis	O
from	O
the	O
research	O
community	O
to	O
enrich	O
the	O
global	O
common	O
threat	O
knowledge	O
.	O
Pitty	O
Tiger	O
,	O
like	O
most	O
other	O
APT	O
groups	O
,	O
use	B-Action
spear	O
phishing	O
e	O
-	O
mails	O
extensively	O
in	O
order	O
to	O
gain	B-Action
an	O
initial	O
foothold	O
within	O
the	O
targeted	O
environment	O
.	O
We	O
have	O
been	O
able	O
to	O
find	O
a	O
spear	O
phishing	O
e	O
-	O
mail	B-Entity
crafted	B-Action
by	O
the	B-Entity
attackers	I-Entity
.	O
This	O
e	O
-	O
mail	O
spoofed	O
the	O
identity	O
of	O
an	O
employee	O
of	O
a	O
targeted	O
company	O
:	O
The	O
attached	B-Action
file	B-Entity
is	O
a	O
Microsoft	O
Office	O
Word	O
document	O
triggering	O
CVE-2014	O
-	O
1761	O
to	O
infect	B-Action
the	O
computer	O
it	B-Entity
is	O
sent	B-Action
to	B-Modifier
:	O
While	O
this	O
example	O
looks	O
very	O
''	O
amateur	O
''	O
for	O
a	O
spear	O
phishing	O
attempt	O
,	O
we	O
suppose	O
the	O
group	O
has	O
conducted	B-Action
more	O
advanced	O
spear	O
phishing	O
campaigns	O
,	O
based	B-Action
on	B-Modifier
the	O
fact	O
that	O
we	O
found	O
infected	O
Word	O
documents	O
showing	O
content	B-Entity
stolen	B-Action
from	B-Modifier
victims	O
of	O
the	O
group	O
.	O
These	O
documents	O
were	O
infecting	O
the	O
system	O
with	O
Troj	O
/	O
ReRol	O
.	O
A	O
malware	O
,	O
which	O
we	B-Entity
will	O
detail	O
later	O
in	O
this	O
report	O
.	O
This	O
could	O
mean	O
that	O
the	O
Pitty	O
Tiger	O
group	O
is	O
using	O
stolen	O
material	O
as	O
spear	O
phishing	O
content	O
either	O
to	O
target	B-Action
other	O
persons	O
in	O
the	O
compromised	O
company	O
,	O
or	O
to	O
target	B-Action
other	O
persons	O
in	O
a	O
competitor	O
's	O
company	O
,	O
or	O
more	O
generally	O
to	O
compromise	B-Action
another	B-Entity
target	I-Entity
.	O
Pitty	O
Tiger	O
also	O
seem	O
to	O
use	B-Action
fake	O
Microsoft	O
Office	O
Excel	O
content	O
,	O
yet	O
we	O
could	O
only	O
find	O
empty	O
content	O
delivering	O
once	O
again	O
the	O
Troj	O
/	O
ReRol	O
.	O
A	O
malware	O
.	O
Although	O
we	B-Entity
have	O
not	O
been	O
able	O
to	O
find	O
evidences	O
of	O
any	O
attack	O
aimed	O
at	B-Modifier
exploiting	O
vulnerabilities	O
on	O
the	O
group	O
's	O
targets	O
servers	O
,	O
we	B-Entity
have	O
been	O
able	O
to	O
record	O
several	O
vulnerability	O
scanning	O
launched	O
from	O
one	O
c	O
&	O
c	O
server	O
straight	O
to	B-Modifier
the	B-Entity
targets	I-Entity
.	O
The	O
attackers	B-Entity
have	O
been	O
using	O
different	O
vulnerability	O
scanners	O
aimed	O
at	O
their	O
targets	O
.	O
While	O
some	O
targets	O
have	O
been	O
scanned	O
with	O
''	O
generic	O
''	O
vulnerability	O
scanning	O
tools	O
like	O
HScan	O
or	O
Fluxay	O
and	O
port	O
scanners	O
like	O
Nmap	O
,	O
some	O
other	O
targets	O
have	O
been	O
scanned	O
for	O
very	O
specific	O
vulnerabilities	O
,	O
like	O
a	O
ZyWALL	O
vulnerability	O
or	O
a	O
FORTINET	O
product	O
.	O
We	O
have	O
also	O
been	B-Action
able	B-Entity
to	O
testify	O
that	O
the	O
Pitty	O
Tiger	O
group	O
has	O
successfully	O
collected	B-Action
information	B-Entity
on	B-Modifier
some	O
of	O
their	O
targets	O
by	O
exploiting	O
the	O
HeartBleed	O
bug	O
.	O
This	O
vulnerability	O
which	O
exists	B-Action
on	B-Modifier
some	O
old	O
versions	O
of	O
OpenSSL	O
allows	O
attackers	B-Entity
to	O
collect	B-Action
data	B-Entity
from	O
chunks	O
of	O
memory	O
from	O
the	O
targeted	O
machine	O
.	O
It	O
allowed	O
the	O
Pitty	O
Tiger	O
group	O
to	O
get	O
admin	O
credentials	O
from	O
at	O
least	O
one	O
target	O
,	O
for	B-Modifier
example	B-Entity
.	O
Running	O
automated	O
vulnerability	O
scanners	O
on	O
whole	O
ranges	O
of	O
IP	O
addresses	B-Entity
used	B-Action
by	O
the	O
targets	O
or	O
on	B-Modifier
several	O
domains	O
is	O
a	O
very	O
noisy	O
way	O
to	O
collect	B-Action
information	B-Entity
and	O
find	B-Action
server	B-Entity
vulnerabilities	I-Entity
.	O
We	O
would	O
advocate	O
that	O
this	O
method	O
is	O
unwise	O
when	O
you	O
want	O
to	O
stay	B-Action
furtive	B-Entity
,	O
and	O
doing	B-Action
it	B-Entity
from	O
a	O
c	O
&	O
c	O
server	O
is	O
very	O
surprising	O
,	O
to	O
say	O
the	O
least	O
.	O
While	O
the	O
Pitty	O
Tiger	O
group	O
is	O
experienced	O
on	O
some	O
aspects	O
on	O
its	O
running	O
APT	O
campaigns	O
,	O
it	B-Entity
definitely	O
lacks	O
some	O
maturity	O
here	O
.	O
One	O
of	O
the	O
favorite	O
methods	B-Entity
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
group	O
to	O
infect	B-Action
users	B-Entity
is	O
to	O
use	B-Action
a	O
Microsoft	O
Office	O
Word	O
document	O
which	O
exploits	B-Action
a	O
specific	O
vulnerability	O
.	O
The	O
payload	O
infecting	O
the	O
system	O
is	O
malware	B-Entity
known	O
as	O
''	O
Troj	O
/	O
ReRol	O
.	O
A	O
''	O
.	O
It	B-Entity
is	O
generally	O
the	O
first	O
step	O
of	O
the	O
initial	O
compromise	O
for	O
Pitty	O
Tiger	O
campaigns	O
.	O
We	O
have	O
been	O
able	O
to	O
find	O
one	O
such	O
document	O
used	B-Action
by	O
that	O
group	O
of	O
attacker	O
,	O
exploiting	B-Action
CVE-	B-Entity
2012	O
-	O
0158	O
,	O
an	O
old	O
critical	O
vulnerability	O
impacting	O
Microsoft	O
Office	O
and	O
corrected	B-Action
by	O
Microsoft	O
's	O
MS12	O
-	O
027	O
fix	O
in	O
April	O
2012	O
.	O
This	O
vulnerability	O
affects	O
Microsoft	O
Office	O
versions	O
up	B-Action
to	B-Modifier
Office	O
2010	O
.	O
We	O
also	O
found	O
one	O
RTF	O
document	O
embedding	O
CVE-2014	O
-	O
1761	O
,	O
which	O
is	O
a	O
more	O
recent	O
exploit	O
.	O
We	O
discovered	O
several	O
different	O
documents	O
spreading	O
this	O
malware	O
by	O
triggering	B-Action
CVE-2012	B-Entity
-	O
0158	O
vulnerability	O
,	O
yet	O
we	O
could	O
not	O
share	O
them	B-Entity
in	O
this	O
report	O
,	O
since	O
these	O
documents	O
contain	O
information	O
about	O
victims	O
of	O
the	O
Pitty	O
Tiger	O
group	O
.	O
The	O
discovery	O
of	O
this	O
''	O
old	O
''	O
vulnerability	O
exploitation	O
in	O
June	O
2014	O
could	O
mean	O
that	O
the	O
Pitty	O
Tiger	O
group	O
has	O
no	O
direct	O
access	O
to	B-Modifier
0day	B-Entity
exploits	I-Entity
,	O
or	O
not	O
enough	O
budgets	O
to	O
buy	B-Action
some	B-Entity
.	O
It	B-Entity
could	O
also	O
mean	B-Action
they	B-Entity
use	O
their	O
low	O
range	O
exploit	O
by	O
default	O
because	O
it	B-Entity
is	O
working	B-Action
on	B-Modifier
their	O
targets	O
and	O
is	B-Action
sufficient	B-Entity
to	O
compromise	B-Action
their	B-Entity
workstations	I-Entity
.	O
The	O
Word	O
document	O
we	O
initially	O
found	O
was	O
probably	O
a	O
''	O
test	O
''	O
document	B-Entity
used	B-Action
by	O
the	O
group	O
.	O
When	B-Modifier
opened	B-Entity
,	O
it	B-Entity
shows	O
a	O
single	O
line	O
written	O
in	O
Chinese	O
language	O
,	O
which	O
can	O
be	O
translated	O
as	O
''	O
Hello	O
!	O
''	O
When	O
successfully	O
triggered	B-Action
,	O
the	O
exploit	O
infects	O
the	O
host	O
by	O
dropping	B-Action
and	O
executing	B-Action
a	O
file	O
named	O
''	O
svohost.exe	O
''	O
in	O
the	O
temporary	O
folder	O
of	O
the	O
currently	O
logged	O
-	O
in	O
user	B-Action
:	O
This	O
binary	O
is	O
''	O
Troj	O
/	O
ReRol	O
.	O
A	O
''	O
according	O
to	O
Sophos	O
naming	O
convention	O
.	O
It	B-Entity
immediately	O
triggers	O
alarms	O
on	O
our	O
sandbox	O
:	O
The	B-Entity
binary	I-Entity
drops	B-Action
a	O
copy	O
of	O
itself	B-Entity
in	O
the	O
Application	O
Data	O
folder	O
of	O
the	O
currently	O
logged	O
-	O
in	O
user	B-Action
:	O
The	O
malware	O
initiates	O
a	O
communication	B-Entity
to	B-Modifier
time.windows.com	B-Entity
to	O
check	B-Action
for	B-Modifier
connectivity	B-Entity
,	O
and	O
then	O
communicates	B-Action
with	O
the	O
c	O
&	O
c	O
server	O
at	O
mac.avstore.com.tw	O
.	O
Very	O
few	O
variants	O
of	O
Troj	O
/	O
ReRol	O
.	O
A	O
are	O
public	O
.	O
The	O
variants	O
we	O
have	O
seen	O
did	O
use	O
that	O
same	O
User-	O
Agent	O
:	O
The	O
persistence	O
mechanism	B-Entity
used	B-Action
by	O
the	O
malware	O
is	O
the	O
creation	O
of	O
a	O
registry	O
key	O
named	O
''	O
Shell	O
''	O
containing	O
the	O
path	O
to	O
the	O
malware	O
on	O
the	O
infected	O
system	O
:	O
The	O
payload	O
of	O
this	O
malware	O
is	O
used	O
to	O
collect	B-Action
information	B-Entity
on	B-Modifier
the	O
newly	O
infected	O
host	O
,	O
and	O
send	B-Action
it	B-Entity
back	B-Action
to	B-Modifier
the	O
c	O
&	O
c	O
server	O
.	O
It	B-Entity
can	O
also	O
download	B-Action
and	O
execute	B-Action
binaries	B-Entity
.	O
The	O
data	O
sent	O
in	O
the	O
POST	O
request	O
has	O
a	O
0x11	O
bytes	O
header	O
consisting	B-Action
of	O
a	O
fixed	O
-	O
value	O
byte	O
(	O
0xc3	O
)	O
followed	O
by	O
a	O
0x10	O
bytes	O
encryption	B-Entity
key	I-Entity
.	O
The	O
data	O
following	O
the	O
header	O
is	O
encrypted	B-Action
using	B-Modifier
RC4	B-Entity
with	O
the	O
previous	O
key	O
.	O
Once	O
the	O
data	O
is	O
deciphered	O
,	O
the	O
last	O
byte	O
of	O
the	O
clear	O
text	O
should	O
also	O
be	O
0xc3	O
.	O
We	O
have	O
been	O
able	O
to	O
decrypt	O
the	O
communications	O
and	O
confirmed	B-Action
what	B-Entity
is	B-Action
transmitted	I-Action
to	B-Modifier
the	O
c	O
&	O
c	O
server	O
.	O
Here	O
is	O
an	O
anonymized	O
sample	O
of	O
communication	O
showing	O
information	B-Entity
collected	B-Action
by	O
the	O
malware	O
:	O
This	O
information	O
is	O
very	O
useful	O
for	O
an	O
attacker	O
:	O
it	B-Entity
shows	B-Action
all	B-Entity
software	I-Entity
installed	B-Action
on	B-Modifier
the	O
system	O
,	O
and	O
running	B-Action
services	B-Entity
.	O
Once	O
this	O
data	B-Entity
has	O
been	B-Action
transferred	I-Action
to	B-Modifier
the	O
c	O
&	O
c	O
server	O
,	O
it	B-Entity
responds	B-Action
by	O
sending	B-Action
additional	O
malware	O
to	O
execute	B-Action
on	B-Modifier
the	O
machine	O
.	O
The	O
c	O
&	O
c	O
part	O
consists	O
of	O
two	O
files	O
:	O
The	O
dr.asp	O
registers	O
the	O
following	O
keywords	O
:	O
These	O
two	O
binaries	O
were	O
no	O
longer	O
available	O
on	O
the	O
server	O
.	O
However	O
,	O
we	O
found	O
various	O
files	B-Entity
which	O
could	O
have	O
been	O
used	O
as	O
''	O
32.exe	O
''	O
in	O
the	O
past	O
:	O
The	O
322.exe	O
file	O
is	O
a	O
legitimate	O
,	O
Chinese	O
,	O
calc.exe	B-Entity
tool	I-Entity
.	O
It	B-Entity
might	O
have	O
been	O
used	B-Action
by	O
the	O
attackers	B-Entity
to	O
perform	B-Action
tests	B-Entity
.	O
The	O
3	O
others	O
binaries	O
are	O
RATs	B-Entity
,	O
which	O
will	O
be	O
detailed	O
in	O
the	O
next	O
parts	O
.	O
This	O
RAT	O
is	O
the	O
origin	O
of	O
the	O
attackers	O
'	O
group	O
name	O
.	O
''	O
PittyTiger	O
''	O
is	O
a	O
mutex	O
used	B-Action
by	O
the	O
malware	O
.	O
''	O
Pitty	O
Tiger	O
''	O
is	O
also	O
a	O
string	O
transmitted	O
in	O
the	O
network	O
communications	O
of	O
the	O
RAT	O
,	O
as	O
you	O
will	O
see	O
in	O
this	O
chapter	O
.	O
The	O
malware	B-Entity
,	O
when	B-Modifier
running	B-Entity
in	B-Modifier
our	O
sandbox	O
,	O
triggers	O
the	O
following	O
alarms	O
:	O
The	B-Entity
binary	I-Entity
drops	B-Action
two	O
files	O
in	O
''	O
C	O
:	O
\Windows\System32	O
''	O
:	O
The	O
''	O
qmgrxp.exe	O
''	O
binary	O
is	O
a	O
simple	O
copy	O
of	O
the	O
original	O
binary	O
.	O
It	B-Entity
drops	B-Action
the	O
''	O
packet64.dll	O
''	O
,	O
and	O
injects	B-Action
it	B-Entity
in	O
''	O
explorer.exe	O
''	O
.	O
When	O
executed	B-Action
,	O
a	O
mutex	O
called	O
''	O
PittyTiger	O
''	O
is	O
created	B-Action
.	O
Persistence	O
is	O
achieved	O
by	O
adding	B-Action
the	O
path	O
to	O
the	O
binary	O
to	O
the	O
WinlogonUserInit	O
key	O
:	O
The	O
''	O
packet64.dll	O
''	O
is	O
the	O
main	O
payload	O
of	O
the	O
RAT	O
.	O
After	O
being	O
injected	B-Action
,	O
it	B-Entity
starts	O
sending	B-Action
its	B-Entity
Hello	B-Action
packet	B-Entity
to	B-Modifier
its	B-Entity
c	I-Entity
&	O
c	O
server	O
:	O
All	O
the	O
requests	B-Entity
sent	B-Action
to	B-Modifier
the	O
c	O
&	O
c	O
contains	O
the	O
string	O
''	O
/FC001/	O
''	O
followed	O
by	O
the	O
bot	O
i	O
d	O
.	O
This	O
i	O
d	O
consists	O
of	O
the	O
infected	O
computer	O
name	O
followed	O
by	O
a	O
dash	O
and	O
the	O
lower	O
word	O
of	O
the	O
disk	O
serial	O
i	O
d	O
.	O
The	O
data	O
sent	O
is	O
simply	O
encoded	B-Action
using	B-Modifier
base64	B-Entity
,	O
there	O
is	O
no	O
cipher	O
at	O
all	O
.	O
The	O
hello	O
packet	O
,	O
once	O
decoded	O
,	O
looks	O
like	O
the	O
following	O
:	O
Our	O
sample	O
had	O
3	O
c	O
&	O
c	O
servers	B-Entity
configured	B-Action
:	O
The	O
following	O
commands	B-Entity
are	O
implemented	O
:	O
Regarding	O
the	O
controller	O
part	O
,	O
we	O
found	O
two	O
different	O
versions	O
:	O
The	O
interface	O
handling	O
both	O
Pitty	O
TIGER	O
and	O
CT	O
connections	O
is	O
very	O
interesting	O
.	O
We	O
have	O
been	O
able	O
to	O
confirm	O
that	O
the	O
author	O
of	O
those	O
two	O
families	O
of	O
malware	B-Entity
is	O
the	O
same	O
person	O
,	O
as	B-Modifier
will	O
be	O
seen	O
in	O
the	O
next	O
chapter	O
about	O
''	O
CT	O
RAT	O
''	O
.	O
This	O
remote	O
administration	O
tool	O
is	O
often	O
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
group	O
.	O
We	O
have	O
been	O
able	O
to	O
acquire	B-Action
both	O
the	O
client	O
and	O
the	O
server	O
parts	O
.	O
We	O
found	O
two	O
instances	O
of	O
the	O
same	O
binary	O
with	O
different	O
names	O
–	O
32mm.exe	O
and	O
mm32.exe	B-Entity
.	O
This	O
RAT	O
seems	O
to	O
be	O
an	O
evolution	O
of	O
PittyTiger	O
,	O
since	O
a	O
specific	O
server	O
binary	O
we	O
found	O
could	O
handle	O
both	O
requests	B-Entity
from	B-Modifier
CT	B-Entity
and	O
PittyTiger	O
,	O
and	O
was	O
indicated	O
as	O
compatible	O
with	O
PittyTiger	O
.	O
Moreover	O
,	O
the	O
same	O
commands	O
are	O
implemented	O
in	O
both	O
RATs	B-Entity
.	O
Unsurprisingly	O
,	O
when	B-Modifier
running	B-Entity
in	B-Modifier
our	O
sandbox	O
,	O
the	O
RAT	O
triggers	O
the	O
same	O
alarms	O
as	O
PittyTiger	O
:	O
The	B-Entity
binary	I-Entity
drops	B-Action
two	O
files	O
in	O
''	O
C	O
:	O
\Program	O
Files\Internet	O
Explorer	O
''	O
:	O
The	O
''	O
ieupdate.exe	O
''	O
is	O
a	O
simple	O
binary	O
to	O
inject	B-Action
the	O
DLL	O
into	O
''	O
explorer.exe	O
''	O
.	O
Persistence	O
is	O
achieved	O
via	O
the	O
following	O
registry	B-Entity
key	I-Entity
:	O
After	O
injection	O
,	O
the	O
RAT	O
sends	O
a	O
first	O
login	O
packet	O
to	B-Modifier
its	B-Entity
c	I-Entity
&	O
c	O
:	O
The	O
RAT	O
communication	O
is	O
performed	O
through	O
HTTP	B-Entity
requests	I-Entity
.	O
The	O
data	B-Entity
is	O
sent	B-Action
encrypted	I-Action
with	B-Modifier
RC4	B-Entity
,	O
and	O
base64-encoded	B-Action
.	O
The	O
RC4	O
key	O
is	O
the	O
Unicode	O
form	O
of	O
the	O
requested	O
URL	O
.	O
The	O
Login	O
packet	O
contains	O
the	O
following	O
string	O
,	O
after	B-Modifier
decoding	O
and	O
deciphering	B-Action
:	O
It	B-Entity
contains	B-Action
the	O
computer	O
name	O
,	O
the	O
user	O
name	O
,	O
the	O
internal	O
IP	O
address	O
,	O
the	O
OS	O
version	O
,	O
the	O
RAT	O
internal	O
version	O
and	O
the	O
Language	O
ID	O
of	O
the	O
system	O
.	O
The	O
RAT	B-Entity
can	O
then	O
receive	B-Action
commands	B-Entity
from	B-Modifier
its	B-Entity
c	I-Entity
&	O
c	O
.	O
Usual	O
RAT	O
features	O
are	O
implemented	O
:	O
Regarding	O
the	O
configuration	O
,	O
our	O
sample	O
communicates	O
with	O
''	O
sop.avstore.com.tw	O
''	O
,	O
and	O
contains	B-Action
the	O
string	O
''	O
Nov	O
13	O
2013	O
''	O
,	O
which	O
should	O
be	O
a	O
version	O
identifier	O
.	O
The	O
c	O
&	O
c	O
part	O
is	O
a	O
Windows	O
binary	O
written	O
in	O
.NET	O
.	O
We	O
found	O
2	O
versions	O
:	O
The	O
About	O
form	O
gives	O
the	O
name	O
of	O
the	O
developer	O
(	O
s	O
)	O
:	O
The	O
version	O
of	O
the	O
controller	O
which	O
can	O
handle	O
both	O
PittyTiger	O
and	O
CT	O
shows	O
the	O
same	O
author	O
(	O
s	O
)	O
:	O
As	O
these	O
screenshots	O
show	O
,	O
the	O
switch	O
between	O
PittyTiger	O
and	O
CT	B-Entity
was	O
probably	O
in	O
the	O
last	O
semester	O
of	O
2013	O
.	O
The	O
text	O
can	O
be	O
translated	O
,	O
thanks	B-Entity
to	B-Modifier
Google	O
Translate	O
,	O
as	O
:	O
Further	O
discussion	O
about	O
this	O
author	O
is	O
provided	O
in	O
subsequent	O
sections	O
.	O
We	O
named	O
this	O
malware	O
''	O
MM	O
RAT	O
''	O
at	O
the	O
beginning	O
of	O
our	O
investigation	O
,	O
before	O
we	O
found	O
an	O
existing	O
name	O
for	O
it	B-Entity
,	O
''	O
Troj	O
/	O
Goldsun	O
-	O
B	O
''	O
according	O
to	B-Modifier
Sophos	B-Entity
.	O
This	O
is	O
another	B-Entity
remote	O
administration	O
tool	O
often	O
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
crew	O
.	O
We	O
have	O
been	O
able	O
to	O
acquire	B-Action
both	O
a	O
client	O
and	O
server	O
part	O
for	O
it	B-Entity
.	O
The	O
binary	O
we	O
found	O
is	O
named	O
3200.exe	O
,	O
and	O
triggers	O
the	O
following	O
alarms	O
in	O
our	O
sandbox	O
:	O
The	O
''	O
release.tmp	O
''	O
file	O
is	O
dropped	B-Action
on	B-Modifier
the	O
system	O
:	O
The	O
binary	O
is	O
also	O
copied	B-Action
to	B-Modifier
the	O
user	O
's	O
''	O
Application	O
Data	O
''	O
directory	O
,	O
and	O
injects	B-Action
the	O
''	O
release.tmp	O
''	O
file	O
in	O
''	O
explorer.exe	O
''	O
.	O
Persistence	O
is	O
achieved	O
by	O
adding	B-Action
the	O
path	O
to	O
the	O
binary	O
to	O
the	O
Winlogon	O
Shell	O
key	O
:	O
The	O
RAT	O
embeds	O
its	O
own	O
DNS	O
server	O
IP	O
addresses	O
to	O
make	O
the	O
c	O
&	O
c	O
domain	O
names	O
resolutions	O
.	O
These	O
addresses	O
are	O
listed	O
below	O
:	O
It	B-Entity
starts	O
resolving	B-Action
its	B-Entity
domains	I-Entity
after	B-Modifier
injection	B-Entity
,	O
and	O
immediately	O
sends	B-Action
requests	B-Entity
.	O
First	O
requests	O
are	O
used	O
to	O
check	B-Action
for	O
updates	O
(	O
GET	O
request	O
on	O
/httpdocs	O
/	O
update	O
/	O
update.ini	O
)	O
.	O
A	O
Hello	O
packet	O
is	O
then	O
sent	B-Action
:	O
The	O
bot	B-Entity
then	O
repeatedly	O
sends	B-Action
GET	B-Entity
requests	I-Entity
on	B-Modifier
''	O
/httpdocs	O
/	O
mm/	O
<	O
botid	O
>	O
/ComMand.sec	O
''	O
to	O
retrieve	B-Action
remote	B-Entity
commands	I-Entity
.	O
The	O
communication	O
protocol	O
is	O
quite	O
simple	O
:	O
GET	B-Entity
requests	I-Entity
are	O
used	O
to	O
receive	B-Action
data	B-Entity
from	O
the	O
c	O
&	O
c	O
,	O
and	O
POST	B-Entity
requests	B-Entity
to	O
send	B-Action
data	B-Entity
.	O
In	O
POST	O
commands	B-Entity
,	O
the	O
CGI	O
name	O
represents	O
the	O
command	O
.	O
The	O
following	O
features	O
are	O
implemented	O
:	O
The	O
following	O
CGI	O
files	B-Entity
can	O
be	O
requested	O
by	O
the	O
bot	B-Entity
:	O
The	O
configuration	O
is	O
stored	O
locally	O
in	O
a	O
file	O
called	O
''	O
schmup.sys	O
''	O
.	O
The	O
file	B-Entity
is	O
ciphered	O
using	O
RC4	O
,	O
using	B-Modifier
the	O
MD5	O
hash	O
of	O
''	O
rEdstArs	O
''	O
as	O
the	O
key	O
.	O
Our	O
sample	O
uses	O
''	O
mca.avstore.com.tw	O
''	O
,	O
''	O
star.yamn.net	O
''	O
and	O
''	O
bz.kimoo.com.tw	O
''	O
as	O
c	O
&	O
c	O
servers	O
.	O
It	O
contains	O
the	O
''	O
1.6.0	O
''	O
version	O
number	O
,	O
and	O
uses	B-Action
the	O
password	O
''	O
9ol.8ik	O
,	O
''	O
to	O
authenticate	B-Action
with	O
the	O
bots	O
.	O
Unlike	O
others	O
c	O
&	O
c	O
binaries	O
,	O
the	O
c	O
&	O
c	O
part	O
of	O
this	O
RAT	O
does	O
not	O
have	O
a	O
graphical	O
interface	O
,	O
but	O
can	O
be	O
remotely	O
requested	O
to	O
manage	O
the	O
bots	O
.	O
Furthermore	O
,	O
no	O
authentication	O
is	O
required	O
to	O
send	B-Action
commands	B-Entity
to	B-Modifier
the	O
c	O
&	O
c	O
(	O
but	O
you	O
need	O
to	O
know	O
the	O
configured	O
password	O
to	O
interact	O
with	O
the	O
bots	O
)	O
.	O
The	O
management	O
protocol	O
is	O
the	O
same	O
as	O
the	O
bots	O
protocol	O
,	O
with	O
different	O
CGI	O
files	O
:	O
The	O
bots	O
'	O
answers	B-Entity
to	B-Modifier
remote	O
commands	B-Entity
can	O
be	O
retrieved	O
by	O
requesting	O
the	O
''	O
Reply.sec	O
''	O
file	O
(	O
e.g	O
.	O
GET	B-Entity
/httpdocs	O
/	O
mm/	O
<	O
botid	O
>	O
/Reply.sec	O
)	O
These	O
network	O
patterns	O
might	O
ring	B-Action
bells	B-Entity
in	O
some	O
researcher	O
's	O
minds	O
.	O
The	O
network	O
communication	B-Entity
used	B-Action
by	O
this	B-Entity
binary	I-Entity
are	O
the	O
same	O
as	O
those	B-Entity
used	B-Action
by	O
the	O
Enfal	O
malware	O
,	O
which	O
has	O
been	O
used	O
in	O
the	O
past	O
by	O
the	O
Lurid	O
group	O
(	O
APT	O
attackers	B-Entity
)	O
and	O
by	O
other	O
threat	O
actors	O
in	O
China	O
.	O
An	O
examination	O
of	O
the	O
code	B-Entity
did	O
not	O
reveal	O
code	O
similarities	O
with	O
the	O
Enfal	O
malware	B-Entity
.	O
We	O
do	O
not	O
currently	O
know	O
why	O
this	O
malware	O
uses	O
the	O
same	O
patterns	O
to	O
communicate	B-Action
.	O
This	O
is	O
another	B-Entity
remote	O
administration	O
tool	O
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
group	O
.	O
We	O
have	O
been	O
able	O
to	O
get	O
both	O
a	O
client	O
and	O
server	O
part	O
of	O
it	B-Entity
.	O
The	O
binary	O
we	O
found	O
was	O
dropped	B-Action
by	O
a	O
malicious	O
Word	O
document	O
.	O
The	O
following	O
alarms	O
are	O
triggered	O
in	O
the	O
sandbox	O
:	O
The	O
shellcode	O
contained	O
in	O
the	O
Word	O
file	B-Entity
drops	B-Action
the	O
following	B-Action
file	B-Entity
,	O
and	O
executes	B-Action
it	B-Entity
:	O
This	B-Entity
one	I-Entity
drops	B-Action
in	O
turn	O
the	O
following	O
file	O
:	O
This	O
tmp	O
file	O
is	O
then	O
copied	B-Action
to	B-Modifier
''	O
C	O
:	O
\Windows\system32\Nwsapagentex.dll	O
''	O
and	O
registered	B-Action
as	O
a	O
service	O
called	O
''	O
Nwsapagent	O
''	O
.	O
This	O
malware	O
is	O
a	O
variant	O
of	O
the	O
infamous	O
Gh0st	O
RAT	O
.	O
Our	O
specific	O
sample	O
uses	O
''	O
ssss0	O
''	O
instead	O
of	O
the	O
usual	O
''	O
Gh0st	O
''	O
header	O
for	O
network	O
communications	O
.	O
The	O
commands	O
ID	O
used	O
in	O
the	O
communication	O
protocol	O
have	O
also	O
changed	B-Action
,	O
but	O
the	O
features	O
are	O
quite	O
the	O
same	O
.	O
The	O
configuration	O
is	O
directly	O
embedded	O
in	O
the	O
binary	O
,	O
and	O
deciphered	O
at	O
runtime	O
.	O
Up	O
to	O
5	O
c	O
&	O
c	O
servers	O
can	O
be	O
configured	O
,	O
but	O
our	O
sample	O
only	O
had	O
one	O
:	O
''	O
ey.avstore.com.tw:53	O
''	O
.	O
''	O
EY	O
''	O
could	O
stand	O
for	O
''	O
Ernst	O
&	O
Young	O
''	O
.	O
It	B-Entity
would	O
not	O
be	O
very	O
surprising	O
,	O
since	O
a	O
lot	O
of	O
different	O
attack	O
groups	O
do	O
use	B-Action
anti	B-Entity
-	O
virus	O
vendors	O
or	O
other	O
big	O
company	O
's	O
names	O
to	O
try	O
to	O
look	O
more	O
legitimate	O
.	O
Pitty	O
Tiger	O
is	O
no	O
exception	O
,	O
as	O
detailed	B-Action
later	O
in	O
this	O
report	O
.	O
We	O
also	O
found	O
two	O
c	O
&	O
c	O
binaries	O
,	O
claiming	O
to	O
be	O
versions	O
2.1	O
and	O
2.2	B-Action
of	O
the	O
Paladin	O
RAT	O
controller	O
.	O
Version	O
2.1	O
answers	O
to	O
the	O
''	O
ssss0	O
''	O
header	O
,	O
while	O
version	O
2.2	O
uses	O
the	O
classical	O
''	O
Gh0st	O
''	O
header	O
.	O
Additionally	O
to	B-Modifier
the	O
Paladin	O
RAT	O
,	O
we	O
found	O
another	B-Entity
variant	B-Action
of	O
Gh0st	O
RAT	O
,	O
named	O
''	O
Leo	O
''	O
.	O
Although	O
we	B-Entity
have	O
found	O
it	B-Entity
on	O
a	O
c	O
&	O
c	O
server	O
of	O
the	O
group	O
,	O
there	O
is	O
no	O
evidence	O
that	O
is	O
has	O
been	O
used	B-Action
by	O
the	O
group	O
,	O
in	B-Modifier
opposition	B-Entity
to	B-Modifier
Paladin	B-Entity
which	O
is	O
used	B-Action
often	O
by	O
Pitty	O
Tiger	O
.	O
Moreover	O
,	O
the	O
built	O
malware	O
we	O
found	O
in	O
the	O
same	O
folder	O
was	O
configured	O
to	O
connect	B-Action
to	B-Modifier
a	O
local	O
IP	O
address	O
,	O
probably	O
for	O
testing	B-Action
purposes	B-Entity
.	O
Our	O
investigation	O
has	O
focused	O
on	O
three	O
particular	O
c	O
&	O
c	O
servers	B-Entity
used	B-Action
by	O
the	O
group	O
.	O
These	O
c	O
&	O
c	O
servers	O
,	O
unlike	O
the	O
other	O
c	O
&	O
cs	B-Entity
used	B-Action
by	O
the	O
group	O
,	O
have	O
been	O
misconfigured	O
.	O
Once	O
parsed	B-Action
and	O
dumped	B-Action
,	O
it	B-Entity
provided	O
us	O
with	O
more	O
insight	O
.	O
We	O
found	O
several	O
domains	O
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
group	O
,	O
the	O
most	O
interesting	O
ones	O
being	O
detailed	O
in	O
this	O
chapter	O
.	O
Pitty	O
Tiger	O
,	O
like	O
other	O
APT	O
attackers	B-Entity
,	O
often	O
use	B-Action
anti	O
-	O
virus	O
''	O
familiar	O
names	O
''	O
when	O
registering	O
domains	O
or	O
creating	B-Action
subdomains	B-Entity
.	O
Some	O
examples	O
can	O
be	O
avstore.com.tw	O
,	O
sophos.skypetm.com.tw	B-Entity
,	O
symantecs.com.tw	O
,	O
trendmicro.org.tw	O
etc	O
.	O
The	O
registration	O
information	O
for	O
this	O
domain	O
has	O
been	O
the	O
same	O
since	O
2013	O
-	O
06	O
-	O
04	O
:	O
This	O
information	O
has	O
been	B-Action
used	I-Action
to	O
register	B-Action
another	B-Entity
domain	I-Entity
,	O
skypetm.com.tw	O
,	O
which	O
has	O
also	O
been	O
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
group	O
.	O
Our	O
research	O
also	O
led	B-Action
us	B-Entity
to	B-Modifier
the	O
discovery	O
of	O
four	O
different	O
malware	O
families	O
connected	B-Action
to	B-Modifier
subdomains	O
of	O
avstore.com.tw	O
:	O
This	O
domain	O
has	O
shown	O
two	O
different	O
WHOIS	O
entries	O
through	O
time	O
:	O
The	O
most	O
recent	O
registration	O
information	O
is	O
also	O
used	B-Action
for	B-Modifier
avstore.com.tw	B-Entity
.	O
Six	O
malware	O
families	O
have	O
been	O
identified	O
as	O
communicating	B-Action
with	O
subdomains	O
of	O
skypetm.com.tw	O
:	O
Avstore.com.tw	O
and	O
skypetm.com.tw	O
have	O
4	O
malware	O
families	O
in	O
common	O
,	O
communicating	B-Action
to	B-Modifier
subdomains	O
of	O
both	O
domains	O
:	O
Some	O
domains	O
registered	B-Action
by	O
the	O
group	O
are	O
very	O
old	O
.	O
There	O
is	O
an	O
increase	O
in	O
the	O
registrations	O
from	O
2010	O
on	B-Modifier
.	O
All	O
the	O
e	O
-	O
mail	B-Action
addresses	B-Entity
used	B-Action
are	O
connected	O
to	B-Modifier
the	O
Pitty	O
Tiger	O
group	O
.	O
Mapping	O
the	O
victims	O
of	O
such	O
a	O
targeted	O
campaign	O
is	O
not	O
an	O
easy	O
task	O
.	O
We	O
have	O
found	O
the	O
Pitty	O
Tiger	O
group	O
to	O
be	O
very	O
active	O
against	O
one	O
particular	O
private	O
company	O
from	O
the	O
defense	O
industry	O
and	O
one	O
academic	O
network	O
of	O
a	O
government	O
,	O
,	O
yet	O
we	O
think	O
it	B-Entity
was	O
done	O
to	O
be	O
used	O
as	O
a	O
proxy	O
for	O
some	O
of	O
the	O
group	O
's	O
operations	O
.	O
We	O
have	O
also	O
found	O
some	O
connections	O
from	O
other	O
companies	O
to	O
the	O
c	O
&	O
c	O
servers	O
,	O
yet	O
we	O
did	O
not	O
find	O
evidence	O
that	O
they	B-Entity
were	O
real	O
victims	O
.	O
These	O
alleged	O
victims	O
do	O
work	O
in	O
different	O
sectors	O
and	O
are	O
located	O
mostly	O
in	O
European	O
countries	O
.	O
It	B-Entity
might	O
be	O
surprising	O
to	O
see	O
a	O
company	O
specialized	O
in	O
web	O
development	O
here	O
,	O
yet	O
it	B-Entity
has	O
built	O
websites	O
for	O
interesting	O
potential	O
targets	O
.	O
We	O
suspect	O
Pitty	O
Tiger	O
to	O
use	B-Action
this	O
compromise	O
to	O
spear	O
phish	O
other	O
companies	O
which	O
are	O
in	O
commercial	O
relation	O
with	O
this	O
web	O
development	O
company	O
.	O
We	O
have	O
to	O
mention	O
that	O
we	O
only	O
had	B-Action
access	B-Entity
to	B-Modifier
three	O
of	O
the	O
several	O
attackers	O
'	O
servers	O
.	O
Therefore	O
,	O
we	O
suppose	O
the	O
Pitty	O
Tiger	O
group	O
could	O
have	O
more	O
targets	O
than	O
what	O
we	O
could	O
confirm	O
.	O
We	O
also	O
found	O
a	O
lot	O
of	O
vulnerability	O
scanners	O
launched	B-Action
by	O
the	O
attackers	O
at	O
different	O
targets	O
,	O
yet	O
there	O
was	O
no	O
sign	O
of	O
compromise	O
.	O
During	O
the	O
course	O
of	O
our	O
investigations	O
,	O
we	O
discovered	O
a	O
RAR	O
archive	O
on	O
the	O
attacker	O
's	O
server	O
containing	O
5	O
Word	O
documents	O
and	O
one	O
small	O
C	O
source	O
code	O
.	O
These	O
documents	O
belong	O
to	O
the	O
defense	O
company	O
which	O
has	O
been	B-Action
compromised	I-Action
.	O
According	O
to	O
the	O
name	O
of	O
the	O
files	B-Entity
and	O
the	O
general	O
feel	O
of	O
the	O
archive	O
,	O
we	B-Entity
do	O
think	O
it	B-Entity
was	O
extracted	O
by	O
the	O
attackers	B-Entity
to	O
''	O
show	O
''	O
someone	O
what	O
kind	O
of	O
data	O
they	O
could	O
get	O
from	O
the	O
compromise	B-Action
of	O
that	O
particular	O
target	O
.	O
The	O
documents	O
were	O
still	O
exhibiting	B-Action
comments	B-Entity
from	B-Modifier
various	B-Entity
users	I-Entity
,	O
showing	O
it	B-Entity
was	O
an	O
ongoing	O
work	O
and	O
not	O
old	O
documents	O
.	O
Interestingly	O
enough	O
,	O
we	O
saw	O
a	O
part	O
of	O
these	O
documents	O
appear	O
on	O
Virus	O
-	O
Total	O
,	O
with	O
an	O
additional	O
''	O
gift	O
''	O
from	O
the	O
attackers	B-Entity
,	O
a	O
payload	O
dropping	B-Action
a	O
malware	O
.	O
There	O
are	O
only	O
two	O
options	O
we	B-Entity
can	O
think	B-Action
of	O
here	O
:	O
	O
Someone	O
from	O
the	O
same	O
company	O
has	O
been	O
targeted	O
with	O
this	O
document	O
.	O
	O
Someone	O
from	O
another	O
company	O
has	O
been	O
targeted	O
with	O
this	O
document	O
.	O
This	O
other	O
company	O
could	O
be	O
a	O
partner	O
or	O
competitor	B-Entity
.	O
Since	O
we	O
were	O
unable	O
to	O
determine	O
the	O
intended	O
use	B-Action
of	O
this	O
specific	O
document	O
,	O
we	B-Entity
can	O
only	O
suppose	O
that	O
it	B-Entity
could	O
be	O
used	O
to	O
provide	B-Action
commercial	B-Entity
advantages	I-Entity
to	B-Modifier
competitors	B-Entity
of	O
that	O
company	O
,	O
or	O
used	B-Action
by	O
a	O
foreign	O
state	O
.	O
During	O
our	O
investigation	O
,	O
we	O
found	O
out	O
interesting	O
information	O
about	O
the	O
Pitty	O
Tiger	O
group	O
itself	O
.	O
After	O
analyzing	O
the	O
various	O
collected	B-Action
elements	B-Entity
,	O
we	B-Entity
have	O
tried	O
to	O
draw	O
a	O
portrait	O
of	O
this	O
particular	O
threat	O
.	O
We	O
have	O
been	O
able	O
to	O
get	O
all	O
the	O
RDP	O
connections	O
logs	B-Entity
to	B-Modifier
one	O
c	O
&	O
c	O
server	O
:	O
These	O
connections	O
are	O
either	O
VPS	B-Entity
or	O
dynamic	O
IP	O
addresses	O
,	O
mostly	O
from	O
China	O
.	O
A	O
computer	O
named	O
CHMXY	O
-	O
PC	B-Entity
connected	B-Action
to	B-Modifier
the	O
c	O
&	O
c	B-Entity
via	B-Modifier
RDP	B-Entity
with	O
IP	O
address	O
58.61.40.5	O
.	O
The	O
IP	O
is	O
in	O
an	O
ADSL	O
dynamic	O
pool	O
in	O
the	O
Gangzhou	O
area	O
(	O
Guangdong	O
province	O
)	O
:	O
A	O
few	O
connections	O
to	O
the	O
c	O
&	O
c	O
were	O
done	B-Action
by	O
a	O
computer	O
named	O
TIEWEISHIPC	O
with	O
IP	O
address	O
27.16.139.143	O
.	O
This	O
IP	O
address	O
belongs	O
to	O
an	O
ADSL	O
dynamic	O
pool	O
in	O
the	O
Wuhan	O
area	O
(	O
Hubei	O
's	O
provincial	O
capital	O
)	O
.	O
Some	O
connections	O
to	O
the	O
c	O
&	O
c	O
originated	O
from	O
a	O
computer	O
named	O
FLY	O
-	O
THINK	O
with	O
several	O
IP	O
addresses	O
,	O
all	O
located	O
in	O
Fuqing	O
(	O
Fujian	O
province	O
)	O
.	O
The	O
IP	O
addresses	O
are	O
in	O
an	O
ADSL	O
dynamic	O
pool	O
:	O
Most	O
of	O
the	O
connections	O
to	O
the	O
c	O
&	O
c	O
server	O
were	O
coming	O
from	O
a	O
computer	O
named	O
50PZ80C-	O
1DFDCB8	O
with	O
several	O
IP	O
addresses	O
.	O
There	O
are	O
11	O
IP	O
addresses	O
from	O
Chinese	O
dynamic	O
ADSL	O
ranges	O
:	O
9	O
from	O
Fuqing	O
(	O
Fujian	O
province	O
)	O
,	O
one	B-Entity
from	B-Modifier
Fuzhou	B-Entity
(	O
Fujian	O
's	O
province	O
capital	O
)	O
and	O
one	O
from	O
Nanchang	O
(	O
Jiangxi	O
's	O
province	O
capital	O
)	O
.	O
The	O
last	O
one	O
came	O
from	O
a	O
VPS	O
instance	O
located	O
in	O
Los	O
Angeles	O
(	O
California	O
,	O
USA	B-Entity
)	O
but	O
purchased	B-Action
by	O
a	O
China	O
based	O
VPS	O
provider	O
XeVPS	O
which	O
belong	B-Action
to	B-Modifier
the	O
AS38197	O
(	O
Sun	O
Network	O
Hong	O
Kong	O
Limited	O
)	O
.	O
The	O
two	O
computers	O
FLY	O
-	O
THINK	O
and	O
50PZ80C-1DFDCB8	B-Entity
have	O
used	O
distinct	O
IP	O
addresses	O
to	O
connect	B-Action
to	B-Modifier
the	O
c	O
&	O
c	O
,	O
yet	O
some	O
of	O
these	O
IP	O
addresses	O
come	O
from	O
the	O
same	O
IP	O
range	O
:	O
We	O
mapped	O
these	O
RDP	O
connections	O
to	O
have	O
a	O
graphical	O
view	O
:	O
We	O
found	O
that	O
a	O
member	O
of	O
this	O
group	O
of	O
attackers	B-Entity
used	O
some	O
tools	O
on	O
his	O
own	O
system	O
,	O
for	B-Modifier
testing	B-Entity
purposes	I-Entity
.	O
This	O
information	O
was	O
still	O
available	O
when	O
we	O
got	B-Action
access	B-Entity
to	B-Modifier
the	O
c	O
&	O
c	O
server	O
.	O
He	O
launched	O
some	O
tests	O
with	O
the	O
CT	O
RAT	O
we	O
exposed	O
earlier	O
:	O
Here	O
we	O
can	O
see	O
a	O
user	O
''	O
Toot	O
''	O
from	O
a	O
machine	O
named	O
''	O
toot-2a601225a8	O
''	O
logging	O
in	O
the	O
CT	O
RAT	O
and	O
executing	B-Action
some	B-Entity
commands	I-Entity
.	O
The	O
c	O
&	O
c	O
IP	O
address	O
,	O
198.100.113.27	O
,	O
can	O
be	O
seen	O
there	O
.	O
Other	O
log	O
files	O
showed	O
that	O
''	O
Toot	O
''	O
is	O
using	O
virtual	O
machines	O
for	O
his	O
tests	O
.	O
We	O
can	O
also	O
see	O
the	O
system	O
:	O
Microsoft	O
Windows	O
XP	O
SP3	O
.	O
The	O
''	O
P	O
''	O
field	O
is	O
the	O
language	O
ID	O
.	O
1028	O
means	O
''	O
Chinese	O
traditional	O
''	O
.	O
We	O
have	O
also	O
seen	O
tests	O
run	B-Action
by	O
''	O
toot	O
''	O
with	O
a	O
language	O
ID	O
of	O
2052	O
,	O
which	O
is	O
''	O
Chinese	O
simplified	O
''	O
.	O
The	O
''	O
M	O
''	O
field	O
is	O
probably	O
used	B-Action
for	B-Modifier
versioning	B-Entity
.	O
It	B-Entity
is	O
a	O
hardcoded	O
string	O
in	O
the	O
binary	O
.	O
After	O
these	B-Entity
tests	I-Entity
,	O
we	B-Entity
could	O
see	O
some	O
real	B-Action
connections	B-Entity
to	B-Modifier
a	O
victim	O
using	O
this	O
RAT	O
.	O
Here	O
is	O
a	O
follow	O
-	O
up	B-Action
of	O
the	O
commands	B-Entity
launched	B-Action
by	O
the	O
bot	O
controller	O
,	O
in	O
a	O
standard	O
command	O
-	O
line	O
shell	O
:	O
The	O
attacker	B-Entity
goes	O
on	O
like	O
this	O
,	O
using	B-Modifier
his	O
tools	O
,	O
and	O
then	O
ends	B-Action
the	O
communication	O
with	O
this	O
RAT	O
on	O
that	O
computer	O
.	O
Please	O
note	O
that	O
at	O
this	O
point	O
,	O
the	O
attacker	O
has	O
at	O
least	O
the	O
privileges	O
of	O
a	O
local	O
administrator	O
,	O
since	B-Modifier
he	B-Entity
is	O
allowed	O
to	O
write	B-Action
content	B-Entity
in	O
the	O
system32	O
folder	O
of	O
a	O
Windows	O
XP	O
system	B-Entity
.	O
He	O
could	O
also	O
gain	B-Action
the	O
credentials	B-Entity
to	B-Modifier
a	O
sensitive	O
e	O
-	O
mail	O
account	O
.	O
In	O
addition	O
to	O
all	O
information	O
already	O
shown	O
,	O
we	O
saw	O
Toot	O
connect	B-Action
to	B-Modifier
an	O
account	O
on	O
a	O
cloud	O
service	O
named	O
''	O
Baidu	O
Drive	O
''	O
.	O
The	O
e	O
-	O
mail	O
address	O
linked	O
to	O
this	O
account	O
is	O
dyanmips	O
@	O
qq.com	O
(	O
QQ	O
-	O
ID	O
:	O
2589315828	O
)	O
.	O
We	O
could	O
find	O
traces	O
of	O
two	O
other	O
e	O
-	O
mail	O
accounts	O
associated	O
to	O
Toot	O
,	O
ciscodyanmips	O
@	O
qq.com	O
(	O
QQ	O
ID	O
:	O
204156335	O
)	O
and	O
ciscodynamips	O
@	O
qq.com	O
(	O
QQ	O
ID	O
:	O
1878836793	O
)	O
.	O
We	O
did	O
not	O
find	O
more	O
information	O
about	O
user	O
''	O
Toot	O
''	O
,	O
yet	O
we	O
miss	O
Chinese	O
language	O
capabilities	O
.	O
The	O
controller	O
part	O
of	O
CT	O
RAT	O
/	O
PittyTiger	O
RAT	O
revealed	O
the	O
following	O
''	O
about	O
''	O
information	O
,	O
once	B-Entity
translated	B-Action
from	B-Modifier
Chinese	B-Entity
to	B-Modifier
English	O
language	O
:	O
CT	O
console	O
(	O
compatible	O
pittytiger	O
)	O
v1.3	O
2013.12	O
by	O
Trees	O
and	O
snow	O
We	O
believe	O
this	O
translation	O
of	O
the	O
author	O
's	O
name	O
might	O
not	O
be	O
accurate	O
due	O
to	O
the	O
use	B-Action
of	O
automated	O
translation	O
tools	O
.	O
Moreover	O
,	O
we	B-Entity
have	O
strong	O
suspicions	O
that	O
there	O
is	O
not	O
a	O
single	O
individual	O
nicknamed	O
''	O
Trees	O
and	O
snow	O
''	O
but	O
rather	O
two	O
programmers	O
nicknamed	O
''	O
Trees	O
''	O
and	O
''	O
Snow	O
''	O
.	O
''	O
Trees	O
''	O
could	O
also	O
be	O
''	O
Cold	O
''	O
.	O
We	O
noticed	O
that	O
the	O
symbol	O
for	O
this	O
word	O
is	O
translated	O
differently	O
according	B-Action
to	B-Modifier
the	O
context	O
it	O
is	O
used	B-Action
in	B-Modifier
.	O
Once	O
again	O
,	O
we	O
lack	O
Chinese	O
language	O
skills	O
.	O
We	O
identify	O
the	O
two	O
nicknames	O
on	O
the	O
current	O
campaign	O
as	O
Automn	O
Snow	O
(	O
秋雪	O
)	O
and	O
Cold	O
Air	O
Kiss	O
(	O
风吻寒	O
)	O
.	O
While	O
we	O
are	O
confident	O
that	O
these	O
people	O
are	O
indeed	O
the	O
developers	O
of	O
both	O
PittyTiger	O
and	O
CT	O
RAT	O
malware	O
,	O
we	O
are	O
not	O
sure	O
they	B-Entity
belong	B-Action
to	B-Modifier
the	O
PittyTiger	O
group	O
.	O
These	O
developers	O
might	O
just	O
have	O
been	O
hired	O
to	O
develop	B-Action
these	B-Entity
RATs	I-Entity
.	O
They	B-Entity
might	O
also	O
just	O
be	O
selling	B-Action
it	B-Entity
to	B-Modifier
the	O
PittyTiger	O
group	O
.	O
There	O
is	O
no	O
trace	O
of	O
usage	O
from	O
other	O
attacking	O
groups	O
,	O
we	O
believe	O
the	O
PittyTiger	O
RAT	O
is	O
exclusively	O
used	B-Action
by	O
this	O
group	O
of	O
attackers	B-Entity
.	O
According	O
to	O
indicators	O
we	O
gathered	O
and	O
threat	O
activities	O
profiling	O
we	O
have	O
some	O
hypothesis	O
on	O
the	O
way	O
the	O
group	O
is	O
conducting	B-Action
its	B-Entity
operations	I-Entity
.	O
We	O
have	O
strong	O
evidence	O
of	O
a	O
bot	O
operator	O
position	O
.	O
We	O
identify	O
one	O
nickname	O
for	O
this	O
position	O
,	O
the	O
user	O
known	O
as	O
TooT	O
.	O
As	O
we	O
did	O
not	O
see	O
other	O
nickname	O
,	O
we	O
think	O
that	O
TooT	O
is	O
one	O
person	O
and	O
not	O
a	O
group	O
of	O
persons	O
.	O
We	O
also	O
identified	O
a	O
malware	O
development	O
position	O
.	O
We	O
identified	O
two	O
nicknames	O
for	O
this	O
position	O
on	O
the	O
current	O
campaign	O
,	O
Automn	O
Snow	O
(	O
秋雪	O
)	O
and	O
Cold	O
Air	O
Kiss	O
(	O
风吻寒	O
)	O
.	O
Yet	O
we	O
are	O
unsure	O
that	O
they	B-Entity
belong	B-Action
to	B-Modifier
the	O
group	O
,	O
they	B-Entity
might	O
just	O
be	O
a	O
third	O
party	O
providing	O
or	O
selling	B-Action
their	B-Entity
malware	I-Entity
.	O
We	O
have	O
a	O
strong	O
suspicion	O
of	O
a	O
coordinator	O
position	O
,	O
which	O
coordinates	B-Action
the	O
bot	B-Entity
operator	I-Entity
,	O
provides	B-Action
him	B-Entity
with	O
some	O
logistics	O
support	O
(	O
weaponized	O
document	O
,	O
tools	O
…	O
)	O
and	O
reviews	O
the	O
programmers	O
work	O
.	O
This	O
position	O
could	O
imply	O
a	O
communication	O
channel	O
with	O
another	B-Entity
manager	I-Entity
.	O
We	O
named	O
this	O
position	O
'	O
Chen	O
'	O
,	O
in	O
relation	O
with	O
several	O
references	O
of	O
this	O
common	O
Chinese	O
name	O
in	O
c	O
&	O
c	O
WHOIS	O
and	O
other	O
investigation	O
materials	O
.	O
We	O
have	O
some	O
suspicion	O
of	O
a	O
customer	O
relationship	O
manager	O
position	O
that	O
may	O
act	O
as	O
an	O
interface	O
between	O
a	O
customer	O
and	O
Chen	O
.	O
We	O
named	O
this	O
position	O
'	O
Lilly	O
'	O
.	O
The	O
c	O
&	O
c	O
servers	B-Entity
used	B-Action
by	O
the	O
attackers	B-Entity
revealed	O
a	O
lot	O
of	O
interesting	B-Action
files	B-Entity
stored	B-Action
in	B-Modifier
various	B-Entity
folders	I-Entity
:	O
This	B-Entity
is	O
quite	O
the	O
usual	O
arsenal	O
for	O
a	O
group	O
of	O
APT	O
attackers	O
:	O
What	O
is	O
rare	O
to	O
find	O
is	O
the	O
controller	O
part	O
of	O
those	O
tools	O
.	O
We	O
have	O
been	O
lucky	O
enough	O
to	O
get	O
the	O
controller	O
part	O
of	O
Pitty	O
Tiger	O
and	O
CT	O
RAT	O
,	O
and	O
even	O
to	O
get	O
a	O
kind	O
of	O
hybrid	O
controller	O
made	O
for	O
CT	O
RAT	O
but	O
also	O
supporting	O
Pitty	O
Tiger	O
.	O
We	O
suppose	O
that	O
the	O
CT	O
RAT	O
is	O
the	O
new	O
evolution	O
of	O
Pitty	O
Tiger	O
and	O
that	O
it	B-Entity
will	O
replace	O
Pitty	O
Tiger	O
in	O
the	O
following	O
months	O
.	O
The	O
presence	O
of	O
a	O
Chinese	O
version	O
of	O
''	O
calc.exe	O
''	O
,	O
the	O
official	O
calculator	O
provided	O
in	O
Microsoft	O
Windows	O
,	O
is	O
interesting	O
.	O
Not	O
only	O
is	O
it	O
one	O
more	O
indicator	O
of	O
a	O
probable	O
Chinese	O
origin	O
,	O
but	O
also	O
an	O
indicator	O
that	O
this	B-Entity
server	I-Entity
was	O
probably	O
used	O
as	O
a	O
test	O
base	O
,	O
in	B-Modifier
addition	B-Entity
to	B-Modifier
being	O
operational	O
and	O
controlling	B-Action
infected	O
machines	O
from	O
different	O
targets	O
.	O
In	O
addition	O
to	O
those	O
tools	O
,	O
we	O
found	O
some	O
interesting	O
scripts	O
.	O
A	O
script	O
named	O
ipc.bat	O
uses	O
a	O
file	O
named	O
user.txt	O
to	O
try	O
to	O
brute	O
-	O
force	O
a	O
shared	O
folder	O
access	O
:	O
The	O
user.txt	O
file	O
contains	O
thousands	O
of	O
lines	O
,	O
each	O
one	O
being	O
a	O
couple	O
of	O
one	O
particular	O
username	O
and	O
one	O
password	O
attempt	O
:	O
This	O
user.txt	O
file	O
has	O
been	O
anonymized	B-Action
,	O
yet	O
we	O
wanted	O
to	O
give	O
you	O
the	O
feel	O
for	O
it	B-Entity
.	O
This	O
file	O
is	O
67320	O
lines	O
long	O
,	O
and	O
uses	O
5610	O
different	O
passwords	B-Entity
for	B-Modifier
each	O
of	O
12	O
users	O
contained	O
in	O
this	B-Entity
file	I-Entity
.	O
The	O
user	O
names	O
are	O
clearly	O
the	O
result	O
from	O
a	O
user	O
enumeration	O
and	O
are	B-Action
dedicated	I-Action
to	B-Modifier
a	O
particular	O
French	O
victim	O
.	O
The	O
passwords	B-Entity
listed	O
in	O
this	O
file	O
are	O
either	O
build	O
from	O
several	O
campaigns	O
or	O
from	B-Modifier
the	O
current	O
campaign	O
.	O
A	O
lot	O
of	O
passwords	B-Entity
are	O
related	O
to	O
the	O
targeted	O
company	O
and	O
might	O
be	O
previous	O
passwords	O
from	O
users	O
.	O
We	O
have	O
also	O
discovered	O
a	O
pack	O
of	O
files	B-Entity
which	O
can	O
be	O
used	O
to	O
trigger	O
an	O
Internet	O
Explorer	O
vulnerability	O
(	O
CVE-2014	O
-	O
0322	O
)	O
.	O
The	O
date	O
of	O
these	B-Entity
files	I-Entity
,	O
namely	O
Tope.swf	O
and	O
index.html	O
,	O
was	O
2014/02/18	O
,	O
a	O
few	O
days	O
after	O
the	O
revelation	O
of	O
existing	B-Action
exploits	B-Entity
in	O
the	O
wild	O
used	O
in	O
APT	O
attacks	O
.	O
We	O
do	O
not	O
know	O
if	O
the	O
Pitty	O
Tiger	O
group	B-Entity
used	B-Action
this	B-Entity
exploit	I-Entity
or	O
not	O
,	O
but	O
found	O
no	O
trace	O
indicating	O
they	B-Entity
did	O
.	O
A	O
lot	O
of	O
different	O
attackers	O
seem	O
to	O
have	O
used	O
that	O
vulnerability	O
since	O
.	O
Determining	O
who	O
is	O
exactly	O
behind	O
an	O
APT	O
campaign	O
is	O
difficult	O
.	O
We	O
tried	O
to	O
extract	O
different	O
technical	O
indicators	O
,	O
together	O
with	O
contextual	O
elements	O
.	O
Information	O
relating	B-Action
to	B-Modifier
the	B-Entity
tools	I-Entity
used	B-Action
by	O
the	O
attackers	B-Entity
has	O
been	O
leveraged	O
for	O
attribution	O
:	O
The	O
IP	O
addresses	O
used	O
for	O
the	O
hosting	O
of	O
the	O
c	O
&	O
c	O
domains	O
are	O
mainly	O
located	O
in	O
Taipei	O
(	O
Taïwan	O
)	O
and	O
Hong	O
Kong	O
City	O
(	O
Hong	O
Kong	O
Special	O
Administrative	O
Region	O
,	O
PRC	B-Entity
)	O
:	O
Most	O
RDP	O
connections	O
to	O
the	O
c	O
&	O
c	O
infrastructure	O
come	O
from	O
Chinese	O
IP	O
ranges	O
in	O
Fuqing	O
(	O
Fujian	O
province	O
,	O
PRC	B-Entity
)	O
.	O
Yet	O
some	O
IP	O
addresses	O
in	O
the	O
USA	O
and	O
in	O
Hong	O
Kong	O
have	O
also	O
been	O
found	O
;	O
All	O
the	O
items	O
listed	O
in	O
this	O
chapter	O
are	O
strong	O
indicators	O
that	O
the	O
attackers	B-Entity
might	O
be	O
Chinese	O
.	O
Pitty	O
Tiger	O
is	O
a	O
group	O
of	O
attackers	B-Entity
that	O
have	O
been	O
active	O
since	O
at	O
least	O
2011	O
.	O
Pitty	O
Tiger	O
is	O
effective	O
and	O
mature	O
in	O
the	O
use	B-Action
of	O
targeted	O
malware	B-Entity
,	O
the	O
use	B-Action
of	O
known	O
exploits	O
to	O
infect	B-Action
computers	B-Entity
with	B-Modifier
their	O
malware	O
and	O
the	O
creation	O
of	O
an	O
infrastructure	O
to	O
efficiently	O
conduct	O
APT	O
attacks	O
.	O
They	B-Entity
are	O
quite	O
unprofessional	O
in	O
their	O
way	O
of	O
using	O
their	O
infrastructure	O
:	O
they	B-Entity
do	O
launch	B-Action
vulnerability	O
scanners	O
directly	O
from	O
a	O
c	O
&	O
c	O
server	O
and	O
also	O
use	B-Action
their	O
connection	O
for	O
personal	O
activities	O
(	O
downloading	B-Action
pornographic	O
material	O
for	O
example	O
,	O
as	O
we	O
have	O
seen	O
a	O
whole	O
folder	O
on	O
a	O
c	O
&	O
c	O
server	O
full	O
of	O
xxx	O
torrent	O
links	O
)	O
.	O
Pitty	O
Tiger	O
is	O
probably	O
not	O
a	O
state	O
-	O
sponsored	O
group	O
of	O
attackers	B-Entity
.	O
The	O
attackers	B-Entity
lack	O
the	O
experience	O
and	O
financial	O
support	O
that	O
one	B-Entity
would	O
expect	O
from	O
state	O
-	O
sponsored	B-Action
attackers	B-Entity
.	O
We	O
suppose	O
this	O
group	O
is	O
opportunistic	O
and	O
sells	B-Action
its	B-Entity
services	I-Entity
to	B-Modifier
probable	O
competitors	O
of	O
their	O
targets	O
in	O
the	O
private	O
sector	O
.	O
One	O
governmental	O
network	O
has	O
been	O
targeted	O
by	O
the	O
group	O
,	O
yet	O
we	O
do	O
not	O
have	O
any	O
evidence	O
of	O
the	O
purpose	O
of	O
this	B-Entity
attack	I-Entity
.	O
We	O
suppose	O
this	O
particular	O
attack	O
has	O
been	B-Action
executed	I-Action
to	O
provide	B-Action
a	O
usable	O
bounce	O
for	O
the	O
group	O
.	O
The	O
campaign	O
we	O
studied	O
has	O
been	O
largely	O
focused	O
on	O
one	O
particular	O
target	O
.	O
We	O
suspect	O
the	O
Pitty	O
Tiger	O
group	O
to	O
work	O
according	B-Action
to	B-Modifier
an	O
opportunistic	O
business	O
model	O
:	O
this	O
group	O
might	O
offer	O
its	O
services	B-Entity
to	B-Modifier
third	O
parties	O
from	O
the	O
private	O
sector	O
.	O
This	O
group	O
seems	O
to	O
be	O
very	O
small	O
compared	O
to	B-Modifier
other	O
APT	O
groups	O
.	O
We	O
have	O
leveraged	O
several	O
profiles	O
and	O
could	O
identify	O
some	O
attackers	B-Entity
to	B-Modifier
a	O
certain	O
extent	O
.	O
We	O
believe	O
this	O
group	O
might	O
keep	O
working	O
as	O
it	B-Entity
is	O
now	O
,	O
with	O
limited	O
budgets	O
,	O
or	O
grow	O
to	O
extend	O
its	O
attacking	O
campaign	O
capabilities	O
.	O
This	O
list	O
of	O
indicators	O
is	O
provided	O
in	O
order	O
to	O
help	O
people	O
detect	O
Pitty	O
Tiger	O
APT	O
campaign	O
.	O
Domains	B-Entity
used	B-Action
by	O
the	O
Pitty	O
Tiger	O
group	O
:	O
(	O
please	O
note	O
several	O
subdomains	O
are	O
used	O
,	O
as	O
seen	O
in	O
the	O
report	O
)	O
A	O
few	O
days	O
ago	O
we	O
detected	O
a	O
watering	O
hole	O
campaign	O
in	O
a	O
website	O
owned	O
by	O
one	O
big	O
industrial	O
company	O
.	O
The	O
website	O
is	O
related	O
to	B-Modifier
software	B-Entity
used	B-Action
for	B-Modifier
simulation	B-Entity
and	O
system	B-Action
engineering	B-Entity
in	O
a	O
wide	O
range	O
of	O
industries	O
,	O
including	O
automotive	O
,	O
aerospace	O
,	O
and	O
manufacturing	B-Action
.	O
The	O
attackers	B-Entity
were	O
able	O
to	O
compromise	B-Action
the	O
website	O
and	O
include	B-Action
code	B-Entity
that	O
loaded	B-Action
a	O
malicious	O
Javascript	O
file	O
from	O
a	O
remote	O
server	B-Entity
.	O
This	O
Javascript	O
file	O
is	O
a	O
framework	O
for	O
reconnaissance	O
that	O
the	O
attackers	B-Entity
call	O
''	O
Scanbox	O
''	O
and	O
includes	O
some	O
of	O
the	O
techniques	O
we	O
described	O
in	O
a	O
previous	O
blog	O
post	O
:	O
The	O
Scanbox	O
framework	O
first	O
configures	O
the	O
remote	O
C	O
&	O
C	O
server	B-Entity
that	O
it	B-Entity
will	O
use	B-Action
and	O
collects	B-Action
a	O
small	O
amount	O
of	O
information	O
about	O
the	O
victim	O
that	O
is	O
visiting	O
the	O
compromised	O
website	O
including	O
:	O
Resulting	O
in	O
something	O
like	O
this	O
:	O
Before	O
sending	B-Action
the	O
information	B-Entity
to	B-Modifier
the	O
C	O
&	O
C	O
server	B-Entity
,	O
Scanbox	B-Entity
encodes	B-Action
and	O
encrypts	B-Action
the	O
data	O
with	O
the	O
following	O
function	O
:	O
Producing	O
the	O
following	O
request	O
:	O
If	O
we	O
decrypt	O
the	O
data	O
it	B-Entity
translates	B-Action
to	B-Modifier
:	O
After	O
the	O
first	O
request	O
,	O
the	O
framework	O
contains	O
several	O
plugins	O
to	O
extract	O
different	O
information	O
from	O
the	O
victim	O
.	O
While	O
the	O
user	O
is	O
browsing	O
the	O
compromised	O
website	O
,	O
all	B-Entity
keystrokes	I-Entity
are	O
being	O
recorded	B-Action
and	O
sent	B-Action
to	B-Modifier
the	O
C	O
&	O
C	O
periodically	B-Entity
.	O
It	B-Entity
will	O
also	O
send	B-Action
keystrokes	B-Entity
when	O
the	O
user	O
submits	O
web	O
forms	O
that	O
can	O
potentially	O
include	B-Action
passwords	B-Entity
and	O
other	O
sensitive	O
data	O
.	O
As	O
we	O
have	O
seen	O
,	O
this	B-Entity
is	O
a	O
very	O
powerful	O
framework	O
that	O
gives	B-Action
attackers	B-Entity
a	O
lot	O
of	O
insight	O
into	O
the	O
potential	O
targets	O
that	O
will	O
help	O
them	O
launching	B-Action
future	O
attacks	O
against	O
them	B-Entity
.	O
We	O
have	O
also	O
seen	O
several	O
Metasploit	O
-	O
produced	B-Action
exploits	B-Entity
that	O
target	O
different	O
versions	O
of	O
Java	O
in	O
the	O
same	O
IP	O
address	O
that	O
hosts	O
the	O
Scanbox	O
framework	O
(	O
122.10.9	O
[	O
.	O
]	O
109	O
)	O
.	O
We	O
recommend	O
you	O
look	O
for	O
this	O
type	O
of	O
activity	O
against	O
the	O
following	O
machines	O
in	O
your	O
network	O
:	O
Recently	O
,	O
research	B-Action
was	O
published	O
identifying	O
a	O
Tor	O
exit	O
node	O
,	O
located	O
in	O
Russia	O
,	O
that	O
was	O
consistently	O
and	O
maliciously	O
modifying	O
any	O
uncompressed	O
Windows	O
executables	O
downloaded	B-Action
through	B-Modifier
it	B-Entity
.	O
Naturally	O
this	O
piqued	O
our	O
interest	O
,	O
so	O
we	O
decided	O
to	O
peer	O
down	O
the	O
rabbit	O
hole	O
.	O
Suffice	O
to	O
say	B-Action
,	O
the	O
hole	O
was	O
a	O
lot	O
deeper	O
than	O
we	O
expected	O
!	O
In	O
fact	O
,	O
it	B-Entity
went	O
all	O
the	O
way	O
back	B-Action
to	B-Modifier
the	O
notorious	O
Russian	O
APT	O
family	O
MiniDuke	B-Entity
,	O
known	O
to	O
have	O
been	O
used	B-Action
in	B-Modifier
targeted	O
attacks	O
against	O
NATO	O
and	O
European	O
government	O
agencies	O
.	O
The	O
malware	B-Entity
used	B-Action
in	O
this	O
case	O
is	O
,	O
however	O
,	O
not	O
a	O
version	O
of	O
MiniDuke	B-Entity
.	O
It	B-Entity
is	O
instead	O
a	O
separate	O
,	O
distinct	O
family	O
of	O
malware	B-Entity
that	O
we	O
have	O
since	O
taken	B-Action
to	B-Modifier
calling	O
OnionDuke	B-Entity
.	O
But	O
lets	B-Entity
start	B-Action
from	B-Modifier
the	O
beginning	O
.	O
When	O
a	O
user	O
attempts	O
to	O
download	B-Action
an	O
executable	O
via	O
the	O
malicious	O
Tor	O
exit	O
node	O
,	O
what	O
they	B-Entity
actually	O
receive	O
is	O
an	O
executable	O
''	O
wrapper	O
''	O
that	O
embeds	B-Action
both	O
the	O
original	O
executable	O
and	O
a	O
second	O
,	O
malicious	B-Entity
executable	I-Entity
.	O
By	O
using	B-Action
a	O
separate	O
wrapper	O
,	O
the	O
malicious	O
actors	O
are	O
able	O
to	O
bypass	B-Action
any	O
integrity	O
checks	B-Action
the	O
original	O
binary	O
might	O
contain	O
.	O
Upon	O
execution	O
,	O
the	O
wrapper	O
will	O
proceed	O
to	O
write	B-Action
to	B-Modifier
disk	B-Entity
and	O
execute	B-Action
the	O
original	O
executable	O
,	O
thereby	O
tricking	O
the	O
user	O
into	O
believing	O
that	O
everything	O
went	O
fine	O
.	O
However	O
,	O
the	O
wrapper	O
will	O
also	O
write	B-Action
to	B-Modifier
disk	B-Entity
and	O
execute	B-Action
the	O
second	O
executable	O
.	O
In	O
all	O
the	O
cases	O
we	O
have	O
observed	O
,	O
this	O
malicious	O
executable	O
has	O
been	O
the	O
same	O
binary	O
(	O
SHA1	O
:	O
a75995f94854dea8799650a2f4a97980b71199d2	B-Entity
,	O
detected	O
as	O
Trojan	O
-	O
Dropper	O
:	O
W32/OnionDuke	B-Entity
.	O
A	O
)	O
.	O
This	O
executable	O
is	O
a	O
dropper	O
containing	O
a	O
PE	O
resource	O
that	O
pretends	O
to	O
be	O
an	O
embedded	O
GIF	O
image	O
file	O
.	O
In	O
reality	O
,	O
the	O
resource	O
is	O
actually	O
an	O
encrypted	B-Action
dynamically	O
linked	O
library	O
(	O
DLL	O
)	O
file	B-Entity
.	O
The	O
dropper	B-Entity
will	O
proceed	O
to	O
decrypt	O
this	O
DLL	O
,	O
write	B-Action
it	B-Entity
to	B-Modifier
disk	B-Entity
and	O
execute	B-Action
it	B-Entity
.	O
Once	O
executed	B-Action
,	O
the	O
DLL	O
file	O
(	O
SHA1	O
:	O
b491c14d8cfb48636f6095b7b16555e9a575d57f	B-Entity
,	O
detected	O
as	O
Backdoor	O
:	O
W32/OnionDuke	B-Entity
.	O
B	O
)	O
will	O
decrypt	O
an	O
embedded	O
configuration	O
(	O
shown	O
below	O
)	O
and	O
attempt	B-Entity
to	O
connect	B-Action
to	B-Modifier
hardcoded	O
C	O
&	O
C	O
URLs	O
specified	O
in	O
the	O
configuration	O
data	O
.	O
From	O
these	O
C	O
&	O
Cs	O
the	O
malware	B-Entity
may	O
receive	B-Action
instructions	B-Entity
to	O
download	B-Action
and	O
execute	B-Action
additional	B-Entity
malicious	O
components	O
.	O
It	O
should	O
be	O
noted	O
,	O
that	O
we	O
believe	O
all	O
five	O
domains	O
contacted	B-Action
by	O
the	O
malware	O
are	O
innocent	O
websites	O
compromised	O
by	O
the	O
malware	O
operators	O
,	O
not	B-Entity
dedicated	B-Action
malicious	B-Entity
servers	I-Entity
.	O
Through	O
our	O
research	O
,	O
we	B-Entity
have	O
also	O
been	B-Action
able	B-Entity
to	O
identify	O
multiple	O
other	O
components	O
of	O
the	O
OnionDuke	O
malware	O
family	O
.	O
We	O
have	O
,	O
for	B-Modifier
instance	B-Entity
,	O
observed	O
components	B-Entity
dedicated	B-Action
to	B-Modifier
stealing	O
login	O
credentials	O
from	O
the	O
victim	O
machine	O
and	O
components	B-Entity
dedicated	B-Action
to	B-Modifier
gathering	O
further	O
information	O
on	O
the	O
compromised	B-Action
system	B-Entity
like	O
the	O
presence	O
of	O
antivirus	O
software	O
or	O
a	O
firewall	O
.	O
Some	O
of	O
these	O
components	O
have	O
been	O
observed	O
being	O
downloaded	B-Action
and	O
executed	B-Action
by	O
the	O
original	O
backdoor	O
process	O
but	O
for	B-Modifier
other	B-Entity
components	I-Entity
,	O
we	B-Entity
have	O
yet	O
to	O
identify	O
the	O
infection	O
vector	B-Entity
.	O
Most	O
of	O
these	O
components	O
do	O
n't	O
embed	O
their	O
own	O
C	O
&	O
C	O
information	B-Entity
but	O
rather	O
communicate	O
with	O
their	O
controllers	O
through	O
the	O
original	O
backdoor	O
process	O
.	O
One	O
component	O
,	O
however	O
,	O
is	O
an	O
interesting	O
exception	O
.	O
This	O
DLL	O
file	O
(	O
SHA1	O
d433f281cf56015941a1c2cb87066ca62ea1db37	O
,	O
detected	O
as	O
Backdoor	O
:	O
W32/OnionDuke	B-Entity
.	O
A	O
)	O
contains	B-Action
among	O
its	O
configuration	O
data	O
a	O
different	O
hardcoded	O
C	O
&	O
C	O
domain	O
,	O
overpict.com	B-Action
and	O
also	O
evidence	O
suggesting	O
that	O
this	B-Entity
component	I-Entity
may	O
abuse	O
Twitter	O
as	O
an	O
additional	O
C	O
&	O
C	O
channel	O
.	O
What	O
makes	B-Action
the	O
overpict.com	O
domain	O
interesting	O
,	O
is	O
it	B-Entity
was	O
originally	O
registered	B-Action
in	O
2011	O
with	O
the	O
alias	O
of	O
''	O
John	O
Kasai	O
''	O
.	O
Within	O
a	O
two	O
-	O
week	O
window	O
,	O
''	O
John	O
Kasai	O
''	O
also	O
registered	B-Action
the	O
following	O
domains	O
:	O
airtravelabroad.com	O
,	O
beijingnewsblog.net	B-Entity
,	O
grouptumbler.com	O
,	O
leveldelta.com	O
,	O
nasdaqblog.net	B-Entity
,	O
natureinhome.com	O
,	O
nestedmail.com	O
,	O
nostressjob.com	O
,	O
nytunion.com	O
,	O
oilnewsblog.com	O
,	O
sixsquare.net	B-Entity
and	O
ustradecomp.com	O
.	O
This	O
is	O
significant	O
because	O
the	O
domains	O
leveldelta.com	O
and	O
grouptumbler.com	O
have	O
previously	O
been	O
identified	O
as	O
C	O
&	O
C	O
domains	B-Entity
used	B-Action
by	O
MiniDuke	B-Entity
.	O
This	O
strongly	O
suggests	O
that	O
although	O
OnionDuke	B-Entity
and	O
MiniDuke	B-Entity
are	O
two	O
separate	O
families	O
of	O
malware	B-Entity
,	O
the	O
actors	O
behind	O
them	O
are	O
connected	O
through	O
the	O
use	B-Action
of	O
shared	O
infrastructure	O
.	O
Based	O
on	O
compilation	O
timestamps	O
and	O
discovery	O
dates	O
of	O
samples	O
we	O
have	O
observed	O
,	O
we	O
believe	O
the	O
OnionDuke	O
operators	O
have	O
been	O
infecting	O
downloaded	O
executables	O
at	O
least	O
since	O
the	O
end	O
of	O
October	O
2013	O
.	O
We	O
also	O
have	O
evidence	O
suggesting	O
that	O
,	O
at	O
least	O
since	O
February	O
of	O
2014	O
,	O
OnionDuke	B-Entity
has	O
not	O
only	O
been	B-Action
spread	I-Action
by	O
modifying	O
downloaded	B-Action
executables	B-Entity
but	O
also	O
by	O
infecting	B-Action
executables	B-Entity
in	O
.torrent	O
files	O
containing	O
pirated	O
software	O
.	O
However	O
,	O
it	B-Entity
would	O
seem	O
that	O
the	O
OnionDuke	O
family	O
is	O
much	O
older	O
,	O
both	O
based	B-Action
on	B-Modifier
older	O
compilation	O
timestamps	O
and	O
also	O
on	B-Modifier
the	O
fact	O
that	O
some	O
of	O
the	O
embedded	O
configuration	O
data	B-Entity
make	B-Action
reference	B-Entity
to	B-Modifier
an	O
apparent	O
version	O
number	O
of	O
4	O
suggesting	O
that	O
at	O
least	O
three	O
earlier	O
versions	O
of	O
the	O
family	O
exist	O
.	O
During	O
our	O
research	O
,	O
we	B-Entity
have	O
also	O
uncovered	O
strong	O
evidence	O
suggesting	O
that	O
OnionDuke	B-Entity
has	O
been	B-Action
used	I-Action
in	B-Modifier
targeted	O
attacks	O
against	O
European	O
government	O
agencies	O
,	O
although	O
we	O
have	O
so	O
far	O
been	O
unable	O
to	O
identify	O
the	O
infection	O
vector	B-Entity
(	O
s	O
)	O
.	O
Interestingly	O
,	O
this	O
would	O
suggest	O
two	O
very	O
different	O
targeting	O
strategies	O
.	O
On	O
one	O
hand	O
is	O
the	O
''	O
shooting	O
a	O
fly	O
with	O
a	O
cannon	O
''	O
mass	O
-	O
infection	O
strategy	O
through	O
modified	O
binaries	O
and	O
,	O
on	B-Modifier
the	O
other	O
,	O
the	O
more	O
surgical	O
targeting	O
traditionally	O
associated	O
with	O
APT	O
operations	O
.	O
In	O
any	O
case	O
,	O
although	O
much	O
is	O
still	O
shrouded	B-Action
in	B-Modifier
mystery	B-Entity
and	O
speculation	O
,	O
one	O
thing	O
is	O
certain	O
.	O
While	O
using	O
Tor	O
may	O
help	O
you	O
stay	O
anonymous	O
,	O
it	B-Entity
does	B-Action
at	O
the	O
same	O
time	O
paint	O
a	O
huge	O
target	O
on	O
your	O
back	B-Action
.	O
It	O
's	O
never	O
a	O
good	O
idea	O
to	O
download	B-Action
binaries	B-Entity
via	B-Modifier
Tor	B-Entity
(	O
or	O
anything	O
else	O
)	O
without	B-Modifier
encryption	B-Entity
.	O
The	O
problem	O
with	O
Tor	O
is	O
that	O
you	O
have	O
no	O
idea	O
who	O
is	O
maintaining	O
the	O
exit	O
node	O
you	O
are	O
using	B-Modifier
and	O
what	O
their	O
motives	O
are	O
.	O
VPNs	O
(	O
such	O
as	O
our	O
Freedome	O
VPN	O
)	O
will	O
encrypt	B-Action
your	O
connection	O
all	O
the	O
way	O
through	O
the	O
Tor	O
network	O
,	O
so	O
the	O
maintainers	O
of	O
Tor	O
exit	O
nodes	O
will	O
not	O
see	O
your	O
traffic	O
and	O
ca	O
n't	O
tamper	O
with	O
it	B-Entity
.	O
Samples	O
:	O
