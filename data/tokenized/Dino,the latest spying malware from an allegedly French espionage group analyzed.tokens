Security NN O
news NN O
, , O
views NNS O
and CC O
insight NN O
from IN O
the DT O
ESET NNP O
experts NNS O
BY IN O
JOAN NNP O
CALVET NNP O
POSTED NNP O
30 CD O
JUN NNP O
2015 CD O
11:12AM NNP O
In IN O
this DT O
blog NN O
we PRP O
describe VBP O
a DT O
sophisticated JJ O
backdoor NN O
, , O
called VBN O
Dino NNP O
by IN O
its PRP$ O
creators NNS O
. . O

We PRP O
believe VBP O
this DT O
malicious JJ O
software NN O
has VBZ O
been VBN O
developed VBN O
by IN O
the DT O
Animal NNP O
Farm NNP O
espionage NN O
group NN O
, , O
who WP O
also RB O
created VBD O
the DT O
infamous JJ O
Casper NNP O
, , O
Bunny NNP O
and CC O
Babar NNP O
malware NN O
. . O

Dino NNP O
contains VBZ O
interesting JJ O
technical JJ O
features NNS O
, , O
and CC O
also RB O
a DT O
few JJ O
hints NNS O
that IN O
the DT O
developers NNS O
are VBP O
French JJ O
speaking VBG O
. . O

Animal NNP O
Farm NNP O
is VBZ O
the DT O
security NN O
industry NN O
's POS O
name NN O
for IN O
a DT O
group NN O
of IN O
attackers NNS O
first RB O
described VBN O
by IN O
Canada NNP O
's POS O
Communications NNPS O
Security NNP O
Establishment NNP O
( -LRB- O
CSE NNP O
) -RRB- O
in IN O
a DT O
set NN O
of IN O
slides NNS O
leaked VBN O
by IN O
Edward NNP O
Snowden NNP O
in IN O
March NNP O
2014 CD O
. . O

In IN O
those DT O
slides NNS O
CSE NNP O
assess VBP O
with IN O
" `` O
moderate JJ O
certainty NN O
" '' O
that WDT O
this DT O
group NN O
is VBZ O
a DT O
French JJ O
intelligence NN O
agency NN O
. . O

Since IN O
then RB O
, , O
several JJ O
examples NNS O
of IN O
malware NN O
created VBN O
by IN O
Animal NNP O
Farm NNP O
have VBP O
been VBN O
found VBN O
and CC O
publicly RB O
documented VBN O
, , O
in IN O
particular JJ O
. . O

Casper NNP O
, , O
a DT O
stealthy JJ O
first JJ O
stage NN O
implant NN O
, , O
documented VBN O
by IN O
ESET NNP O
in IN O
last JJ O
March NNP O
Bunny NNP O
, , O
a DT O
Lua NNP O
based VBN O
backdoor NN O
, , O
documented VBN O
by IN O
Marion NNP O
Marschalek NNP O
( -LRB- O
Cyphort NNP O
) -RRB- O
Babar NNP O
, , O
an DT O
espionage NN O
platform NN O
, , O
also RB O
analyzed VBN O
by IN O
Marion NNP O
Marschalek NNP O
The DT O
connection NN O
between IN O
those DT O
pieces NNS O
of IN O
malware NN O
and CC O
the DT O
group NN O
described VBD O
in IN O
CSE NNP O
slides NNS O
has VBZ O
been VBN O
convincingly RB O
established VBN O
, , O
for IN O
example NN O
by IN O
Paul NNP O
Rascagn NNP O
res NNS O
( -LRB- O
G NNP O
Data NNP O
) -RRB- O
. . O

In IN O
this DT O
blog NN O
post NN O
we PRP O
add VBP O
a DT O
new JJ O
piece NN O
to IN O
the DT O
puzzle NN O
with IN O
Dino NNP O
, , O
another DT O
malicious JJ O
program NN O
belonging VBG O
to IN O
Animal NNP O
Farm NNP O
's POS O
arsenal NN O
. . O

The DT O
sample NN O
of IN O
Dino NNP O
documented VBN O
in IN O
this DT O
blog NN O
post NN O
was VBD O
used VBN O
in IN O
2013 CD O
against IN O
targets NNS O
in IN O
Iran NNP O
. . O

The DT O
original JJ O
means NNS O
of IN O
infection NN O
is VBZ O
unknown JJ O
, , O
though IN O
we PRP O
believe VBP O
Dino NNP O
was VBD O
installed VBN O
by IN O
another DT O
program NN O
, , O
as IN O
it PRP O
contains VBZ O
an DT O
uninstallation NN O
command NN O
without IN O
the DT O
corresponding JJ O
installation NN O
procedure NN O
. . O

Given VBN O
the DT O
set NN O
of IN O
commands NNS O
it PRP O
can MD O
receive VB O
, , O
Dino NNP B-Entity
's POS I-Entity
main JJ I-Entity
goal NN I-Entity
seems VBZ O
to TO O
be VB B-Action
the DT O
exfiltration NN B-Entity
of IN I-Entity
files NNS I-Entity
from IN B-Modifier
its PRP$ O
targets NNS B-Entity
. . O

The DT O
binary NN O
's POS O
original JJ O
name NN O
, , O
" `` O
Dino.exe NN O
" '' O
, , O
has VBZ O
been VBN O
left VBN O
visible JJ O
by IN O
its PRP$ O
authors NNS O
, , O
as IN O
was VBD O
the DT O
case NN O
with IN O
Casper NNP O
. . O

Dino NNP O
– NFP O
which WDT O
could MD O
be VB O
referring VBG O
to IN O
the DT O
pet JJ O
character NN O
from IN O
The DT O
Flintstones NNP O
cartoon NN O
show NN O
– . O
was VBD O
already RB O
mentioned VBN O
in IN O
a DT O
recent JJ O
Kaspersky NNP O
blog NN O
as IN O
a DT O
" `` O
full JJ O
featured JJ O
espionage NN O
platform NN O
, , O
" '' O
but CC O
no DT O
technical JJ O
analysis NN O
has VBZ O
been VBN O
published VBN O
yet RB O
. . O

Roughly RB O
, , O
Dino NNP B-Entity
can MD O
be VB O
described VBN O
as IN O
an DT O
elaborate JJ O
backdoor NN O
built VBN O
in IN O
a DT O
modular JJ O
fashion NN O
. . O

Among IN O
its PRP$ B-Entity
technical JJ O
innovations NNS O
, , O
there EX O
is VBZ O
a DT O
custom NN O
file NN O
system NN O
to TO O
execute VB B-Action
commands VBZ B-Entity
in IN B-Modifier
a DT O
stealthy JJ B-Entity
fashion NN I-Entity
, , O
and CC O
a DT O
complex JJ O
task NN O
scheduling VBG O
module NN O
working VBG O
in IN O
a DT O
similar JJ O
way NN O
to IN O
the DT O
" `` O
cron NN O
" '' O
Unix NNP O
command NN O
. . O

Interestingly RB O
, , O
the DT O
binary NN O
contains VBZ O
a DT O
lot NN O
of IN O
verbose NN O
error NN O
messages NNS O
, , O
allowing VBG O
us PRP O
to TO O
see VB O
Dino NNP O
's POS O
developers NNS O
' POS O
choice NN O
of IN O
wording NN O
. . O

Also RB O
, , O
a DT O
few JJ O
technical JJ O
artefacts NNS O
suggest VBP O
that IN O
Dino NNP O
was VBD O
authored VBN O
by IN O
native JJ O
French JJ O
speakers NNS O
. . O

Dino NNP O
has VBZ O
been VBN O
developed VBN O
in IN O
C++ NNP O
and CC O
presents VBZ O
a DT O
well RB O
defined VBN O
modular JJ O
architecture NN O
. . O

The DT O
following JJ O
array NN O
lists VBZ O
the DT O
modules NNS O
contained VBN O
in IN O
this DT O
Dino NNP O
binary; VBD O
the DT O
module NN O
names NNS O
are VBP O
those DT O
assigned VBN O
by IN O
the DT O
developers NNS O
. . O

Dino NNP O
heavily RB O
relies VBZ O
on IN O
a DT O
custom NN O
data NNS O
structure NN O
named VBN O
" `` O
DataStore NNP O
" '' O
by IN O
the DT O
Animal NNP O
Farm NNP O
developers NNS O
. . O

In IN O
particular JJ O
, , O
all DT O
Dino NNP O
's POS O
modules NNS O
store VBP O
their PRP$ O
content NN O
inside IN O
this DT O
structure NN O
, , O
making VBG O
its PRP$ O
understanding VBG O
one CD O
of IN O
the DT O
keys NNS O
to IN O
analyzing VBG O
Dino NNP O
. . O

A DT O
DataStore NNP O
is VBZ O
a DT O
map NN O
from IN O
string VBG O
keys NNS O
to IN O
values NNS O
of IN O
8 CD O
possible JJ O
types NNS O
, , O
such JJ O
as IN O
integers NNS O
or CC O
strings NNS O
. . O

The DT O
implementation NN O
of IN O
this DT O
data NN O
structure NN O
is VBZ O
based VBN O
on IN O
a DT O
hash NN O
table NN O
. . O

It PRP O
means VBZ O
that IN O
to TO O
retrieve VB O
the DT O
value NN O
associated VBN O
with IN O
a DT O
key NN O
, , O
one PRP O
has VBZ O
to TO O
calculate VB O
the DT O
hash NN O
of IN O
the DT O
key NN O
to TO O
locate VB O
a DT O
bucket NN O
from IN O
which WDT O
the DT O
value NN O
can MD O
be VB O
retrieved VBN O
. . O

Dino NNP O
's POS O
hash NN O
is VBZ O
a DT O
one CD O
byte NN O
value NN O
calculated VBN O
with IN O
a DT O
series NN O
of IN O
XOR NNP O
operations NNS O
on IN O
the DT O
key NN O
, , O
and CC O
each DT O
bucket NN O
starts VBZ O
a DT O
linked VBN O
list NN O
containing VBG O
key JJ O
/ SYM O
value NN O
pairs NNS O
. . O

The DT O
code NN O
responsible JJ O
for IN O
retrieving VBG O
the DT O
value NN O
associated VBN O
with IN O
a DT O
key NN O
is VBZ O
shown VBN O
in IN O
Figure NN O
1 CD O
. . O

Finally RB O
, , O
DataStore NNP O
objects NNS O
can MD O
be VB O
serialized VBN O
in IN O
a DT O
custom NN O
format NN O
, , O
which WDT O
begins VBZ O
with IN O
the DT O
magic JJ O
word NN O
" `` O
DxSx NNP O
" '' O
. . O

This DT O
is VBZ O
used VBN O
in IN O
particular JJ O
by IN O
the DT O
PSM NNP B-Entity
module NN I-Entity
to IN O
save VB B-Action
the DT O
content NN B-Entity
of IN I-Entity
Dino NNP I-Entity
modules NNS I-Entity
in IN B-Modifier
an DT O
encrypted VBN B-Entity
file NN I-Entity
. . O

More RBR O
precisely RB O
, , O
when WRB O
a DT O
modification NN O
is VBZ O
made VBN O
to IN O
a DT O
module NN O
's POS O
content NN O
in IN O
memory NN O
, , O
the DT O
PSM NNP O
module NN O
saves VBZ O
it PRP O
as IN O
a DT O
serialized VBN O
DataStore NNP O
. . O

When WRB O
Dino NNP O
restarts VBZ O
, , O
the DT O
module NN O
is VBZ O
deserialized VBN O
from IN O
the DT O
file NN O
and CC O
loaded VBN O
into IN O
memory NN O
. . O

Funnily RB O
enough RB O
, , O
the DT O
key NN O
serving VBG O
to TO O
encrypt VB O
the DT O
file NN O
on IN O
disk NN O
is VBZ O
" `` O
PsmIsANiceM0du1eWith0SugarInside RB O
" '' O
. . O

Dino NNP O
's POS O
configuration NN O
is VBZ O
initially RB O
stored VBN O
in IN O
a DT O
serialized VBN O
DataStore NNP O
object NN O
contained VBN O
in IN O
a DT O
zip NN O
archive NN O
at IN O
the DT O
end NN O
of IN O
the DT O
Dino NNP O
binary NN O
. . O

At IN O
runtime NN O
this DT O
object NN O
is VBZ O
deserialized VBN O
and CC O
stored VBN O
inside IN O
the DT O
CORE NNP O
module NN O
. . O

We PRP O
can MD O
list VB O
the DT O
configuration NN O
's POS O
content NN O
with IN O
Dino NNP O
's POS O
" `` O
conf NN O
–l NNP O
CORE NNP O
" '' O
command NN O
– NFP O
described VBN O
later RB O
– . O
which WDT O
displays VBZ O
on IN O
separate JJ O
rows NNS O
each DT O
key NN O
's POS O
name NN O
, , O
its PRP$ O
associated VBN O
value NN O
and CC O
the DT O
type NN O
of IN O
this DT O
value NN O
. . O

Started:5523F782 NN O
QWORD NNP O
InitialWaitDone:00000001 NNP O
DWORD NNP O
InteractiveDelay:00000005 NNP O
DWORD NNP O
MaxNothingSaidCount:00000078 NNP O
DWORD NNP O
InstallDate NNP O
: : O
5523F782 CD O
QWORD NNP O
fields:78537844 NN O
… SYM O
[REDACTED] XX O
… NFP O
66B3900 XX O
BYTES NNS O
recID:11173 JJ O
01 CD O
PRS NNP O
WIDESTR NNP O
Version:1.2 NNP O
WIDESTR NNP O
BD_Keys NNS O
: : O
4D41474943424F58 LS O
… -RRB- O
[REDACTED] XX O
… NFP O
9EB3506 XX O
BYTES NNS O
CC_Keys NNS O
: : O
4D41474943424F58 LS O
… -RRB- O
[REDACTED] XX O
… NFP O
0000000 CD O
BYTES NNS O
MaxDelay:00000E10 NNP O
DWORD NNP O
ComServer0:hXXp://www.azhar.bf/ NNP O
… . O
[REDACTED] XX O
… NFP O
/postal.php XX O
STR NNP O
ComServer1:hXXp://www.rsvniima.org/ NNP O
… . O
[REDACTED] XX O
… NFP O
/din12/postal.php XX O
STR NNP O
ComServer2:hXXp://www.azhar.bf/ NNP O
… . O
[REDACTED] XX O
… NFP O
/postal.php XX O
STR NNP O
ComServer3:hXXp://www.rsvniima.org/ NNP O
… . O
[REDACTED] XX O
… NFP O
/din12/postal.php XX O
STR NNP O
ComServer4:hXXp://dneprorudnoe.info// NNP O
… . O
[REDACTED] XX O
… NFP O
/postal.php XX O
STR NNP O
ComServer5:hXXp://dneprorudnoe.info// NNP O
… . O
[REDACTED] XX O
… NFP O
/postal.php XX O
STR NNP O
ComServer6:hXXp://dneprorudnoe.info// NNP O
… . O
[REDACTED] XX O
… NFP O
/postal.php XX O
STR NNP O
NextSendReceive:5CC33097FB72D001 NNP O
BYTES NNP O
CC:000064F7 NNP O
72E4 CD O
3F7D CD O
C817 NN O
474D CD O
A9BDBDF7 NN O
STR NNP O
DaysOfLife:00000000 NNP O
DWORD NNP O
GUID:12FEB4A9EEDEE411B283000C29FD2872 NNP O
BYTES NNP O
InitialDelay:00000000 NNP O
DWORD NNP O
now:5523F78E NNP O
QWORD NNP O
hash NN O
: : O
A88E8181CA5CE35AE70C76145DFB820D ADD O
BYTES NNS O
InitialCommands:78537844 PRP O
… . O
[REDACTED] XX O
… NFP O
000000 CD O
BYTES NNS O
xT0rvwz CD O
: : O
DC188352A NNS O
… -RRB- O
[REDACTED] XX O
… NFP O
00000 CD O
BYTES NNS O
tr4qa589:K/[RAFtIP?ciD?:D JJ O
STR NNP O
jopcft4T NN O
: : O
a.ini ADD O
WIDESTR NN O
While IN O
most JJS O
of IN O
the DT O
keys NNS O
have VBP O
self NN O
explanatory JJ O
names NNS O
, , O
we PRP O
would MD O
like VB O
to TO O
focus VB O
on IN O
the DT O
following VBG O
keys NNS O
. . O

" `` O
recID NN O
" '' O
: : O
Animal NNP O
Farms NNPS O
binaries NNS O
contain VBP O
an DT O
ID NNP O
whose WP$ O
decimal JJ O
value NN O
appears VBZ O
to TO O
identify VB O
the DT O
target NN O
, , O
" '' O
11173 CD O
01 CD O
PRS NN O
" '' O
in IN O
this DT O
case NN O
. . O

For IN O
example NN O
Casper NNP O
used VBD O
an DT O
" `` O
ID NN O
" '' O
value NN O
set VBN O
to IN O
" `` O
13001 CD O
" '' O
, , O
whereas IN O
some DT O
Babar NNP O
samples NNS O
used VBN O
" `` O
12075 CD O
01 CD O
" `` O
and CC O
" `` O
11162 CD O
01 CD O
" '' O
. . O

We PRP O
do VBP O
not RB O
know VB O
the DT O
meaning NN O
of IN O
the DT O
" `` O
PRS NNP O
" '' O
suffix NN O
added VBN O
in IN O
the DT O
case NN O
of IN O
Dino NNP O
. . O

" `` O
ComServer NN O
" '' O
: : O
These DT B-Entity
keys NNS I-Entity
contain VBP B-Action
the DT O
command NN B-Entity
and CC I-Entity
control NN I-Entity
( -LRB- I-Entity
C&C NNP I-Entity
) -RRB- I-Entity
servers NNS I-Entity
' POS I-Entity
URLs NNS I-Entity
. . O

All PDT O
the DT O
URLs NNS O
were VBD O
down RB O
when WRB O
we PRP O
started VBD O
our PRP$ O
analysis NN O
. . O

Those DT O
C&Cs NNS O
were VBD O
compromised VBN O
legitimate JJ O
websites NNS O
, , O
which WDT O
is VBZ O
standard JJ O
operating VBG O
procedure NN O
for IN O
Animal NNP O
Farm NNP O
. . O

" `` O
Version NN O
" '' O
: : O
Dino NNP O
's POS O
code NN O
version; NN O
here RB O
set VBN O
to IN O
" `` O
1.2 CD O
" '' O
, , O
which WDT O
is VBZ O
confirmed VBN O
by IN O
the DT O
" `` O
din12 NN O
" '' O
folder NN O
used VBN O
in IN O
one CD O
of IN O
the DT O
C&C NNP O
URLs NNP O
. . O

For IN O
the DT O
record NN O
, , O
a DT O
" `` O
d13 NN O
" '' O
folder NN O
has VBZ O
been VBN O
seen VBN O
on IN O
another DT O
Animal NNP O
Farm NNP O
C&C NNP O
( -LRB- O
see VB O
" '' O
3.7 CD O
Calling VBG O
home RB O
" '' O
of IN O
Marschalek NNP O
's POS O
Babar NNP O
report NN O
) -RRB- O
, , O
indicating VBG O
that IN O
Dino NNP O
version NN O
1.3 CD O
has VBZ O
also RB O
likely RB O
been VBN O
deployed VBN O
at IN O
some DT O
point NN O
. . O

" `` O
BD_Keys NNS O
" '' O
and CC O
" `` O
CC_Keys NNS O
" '' O
contain VBP O
cryptographic JJ O
keys NNS O
to IN O
encrypt VB B-Action
the DT O
network NN B-Entity
communications NNS I-Entity
with IN B-Modifier
C&C NNP O
servers NNS B-Entity
. . O

Their PRP$ O
values NNS O
start VBP O
with IN O
the DT O
word NN O
" `` O
MAGICBOX NNP O
" '' O
. . O

The DT O
three CD O
last JJ O
keys NNS O
are VBP O
displayed VBN O
with IN O
obfuscated JJ O
names NNS O
( -LRB- O
" `` O
xT0rvwz FW O
" '' O
, , O
" `` O
tr4qa589 NN O
" '' O
and CC O
" `` O
jopcft4 JJ O
T NN O
" '' O
) -RRB- O
and CC O
store NN O
parameters NNS O
for IN O
the DT O
custom NN O
file NN O
system NN O
we PRP O
will MD O
describe VB O
later RB O
. . O

The DT O
following VBG O
Table JJ O
lists NNS O
the DT O
commands NNS O
accepted VBN O
by IN O
this DT O
Dino NNP O
binary NN O
with IN O
the DT O
names NNS O
chosen VBN O
by IN O
the DT O
developers NNS O
. . O

Each DT O
of IN O
those DT O
commands NNS O
can MD O
take VB O
one CD O
or CC O
more JJR O
arguments NNS O
. . O

One CD O
command NN O
of IN O
particular JJ O
interest NN O
is VBZ O
" `` O
search NN O
" '' O
, , O
which WDT O
allows VBZ O
the DT B-Entity
operators NNS I-Entity
to IN O
look VB B-Action
for IN I-Action
files NNS B-Entity
very RB O
precisely RB O
. . O

For IN O
example NN O
, , O
it PRP O
can MD O
provide VB O
all DT O
files NNS O
with IN O
a DT O
" `` O
.doc NN O
" '' O
extension NN O
, , O
the DT O
size NN O
of IN O
which WDT O
is VBZ O
bigger JJR O
than IN O
10 CD O
kilobytes NNS O
, , O
and CC O
that WDT O
were VBD O
modified VBN O
in IN O
the DT O
last JJ O
3 CD O
days NNS O
. . O

We PRP O
believe VBP O
this DT O
exfiltration NN O
of IN O
files NNS O
to TO O
be VB O
Dino NNP O
's POS O
end NN O
goal NN O
. . O

At IN O
startup NN O
Dino NNP O
executes VBZ O
successively RB O
the DT O
commands NNS O
stored VBN O
in IN O
the DT O
" `` O
InitialCommands NNP O
" '' O
field NN O
in IN O
its PRP$ O
configuration; NN O
in IN O
the DT O
sample NN O
we PRP O
analyzed VBD O
they PRP O
are VBP O
. . O

Those DT O
commands NNS O
serve VBP O
as IN O
a DT O
reconnaissance NN O
step NN O
for IN O
the DT O
operators NNS O
. . O

Their PRP$ O
execution NN O
is VBZ O
managed VBN O
by IN O
the DT O
CMDEXEC NNP O
module NN O
, , O
the DT O
commands NNS O
being VBG O
stored VBN O
in IN O
a DT O
queue NN O
inside IN O
the DT O
CMDEXECQ NNP O
module NN O
. . O

The DT O
result NN B-Entity
is VBZ O
reported VBD B-Action
to IN B-Modifier
the DT O
C&C NNP B-Entity
server NN I-Entity
. . O

After IN O
having VBG O
described VBD O
Dino NNP O
's POS O
basics NNS O
, , O
we PRP O
are VBP O
now RB O
going VBG O
to TO O
dig VB O
into IN O
two CD O
particularly RB O
interesting JJ O
components; NN O
first RB O
, , O
a DT O
custom NN O
file NN O
system NN O
used VBN O
by IN O
the DT O
malware NN O
, , O
and CC O
then RB O
the DT O
CRONTAB NNP O
module NN O
in IN O
charge NN O
of IN O
task NN O
scheduling NN O
. . O

Dino NNP O
contains VBZ O
a DT B-Entity
custom NN I-Entity
file NN I-Entity
system NN I-Entity
named VBN O
" `` O
ramFS NN O
" '' O
by IN O
its PRP$ O
developers NNS O
. . O

It PRP O
provides VBZ O
a DT O
complex JJ O
data NN O
structure NN O
to IN O
store NN B-Action
files VBZ B-Entity
in IN B-Modifier
memory NN B-Entity
, , O
each DT O
of IN O
them PRP O
bearing VBG O
a DT O
name NN O
corresponding VBG O
to IN O
filenames NNS O
used VBN O
by IN O
usual JJ O
file NN O
systems NNS O
. . O

RamFS NNP O
also RB O
comes VBZ O
with IN O
a DT O
set NN O
of IN O
custom NN O
commands NNS O
that WDT O
can MD O
be VB O
stored VBN O
in IN O
files NNS O
and CC O
executed VBN O
. . O

It PRP O
should MD O
be VB O
noticed VBN O
that IN O
ramFS NN O
is VBZ O
also RB O
present JJ O
in IN O
other JJ O
Animal NNP O
Farm NNP O
binaries NNS O
( -LRB- O
see VB O
attribution NN O
paragraph NN O
below RB O
) -RRB- O
, , O
but CC O
since IN O
we PRP O
are VBP O
unaware JJ O
of IN O
previous JJ O
analysis NN O
of IN O
ramFS NN O
, , O
we PRP O
are VBP O
describing VBG O
our PRP$ O
findings NNS O
here RB O
. . O

RamFS NNP O
content NN O
is VBZ O
initially RB O
stored VBN O
encrypted VBN O
in IN O
Dino NNP O
's POS O
configuration NN O
under IN O
the DT O
key NN O
" `` O
xT0rvwz NNP O
" '' O
, , O
whereas IN O
the DT O
corresponding VBG O
RC4 NNP O
key NN O
is VBZ O
stored VBN O
under IN O
the DT O
key NN O
" `` O
tr4qa589 NN O
" '' O
. . O

Once IN O
the DT O
file NN O
system NN O
has VBZ O
been VBN O
decrypted VBN O
, , O
it PRP O
is VBZ O
stored VBN O
in IN O
memory NN O
as IN O
a DT O
linked VBN O
list NN O
of IN O
512 CD O
byte NN O
memory NN O
chunks NNS O
, , O
each DT O
one CD O
of IN O
them PRP O
being VBG O
individually RB O
RC4 NNP O
encrypted VBD O
. . O

When WRB O
looking VBG O
for IN O
a DT O
file NN O
in IN O
ramFS NN O
, , O
each DT O
chunk NN O
is VBZ O
decrypted VBN O
, , O
processed VBN O
and CC O
then RB O
re IN O
encrypted NN O
. . O

Hence RB O
there EX O
are VBP O
very RB O
few JJ O
noticeable JJ O
traces NNS O
of IN O
ramFS NN O
during IN O
its PRP$ O
use NN O
. . O

Here RB O
are VBP O
some DT O
high JJ O
level NN O
characteristics NNS O
of IN O
this DT O
file NN O
system NN O
. . O

Several JJ O
commands NNS B-Entity
can MD O
be VB O
executed VBN B-Action
in IN B-Modifier
the DT O
context NN B-Entity
of IN I-Entity
ramFS NNP I-Entity
, , O
as IN O
listed VBN O
in IN O
the DT O
following VBG O
Table NNP O
. . O

In IN O
the DT O
case NN O
of IN O
Dino NNP B-Entity
, , O
ramFS NNP O
serves VBZ O
as IN O
protected VBN O
storage NN O
for IN O
one CD O
specific JJ O
file NN O
containing VBG O
the DT O
instructions NNS O
to IN O
remove VB B-Action
the DT O
malware NN B-Entity
from IN B-Modifier
the DT O
machine NN B-Entity
. . O

The DT O
developers NNS O
named VBD O
this DT O
file NN O
the DT O
" `` O
cleaner NN O
" '' O
and CC O
it PRP O
is VBZ O
executed VBN O
when WRB O
Dino NNP O
receives VBZ O
the DT O
command NN O
" `` O
killBD FW O
" '' O
( -LRB- O
the DT O
" `` O
BD NNP O
" '' O
acronym NN O
is VBZ O
the DT O
developers NNS O
' POS O
designation NN O
of IN O
the DT O
malware NN O
) -RRB- O
. . O

Figure NN O
2 CD O
shows VBZ O
the DT O
code NN O
responsible JJ O
for IN O
executing VBG O
this DT O
cleaner JJR O
file NN O
. . O

First RB O
, , O
it PRP O
retrieves VBZ O
the DT O
name NN O
of IN O
the DT O
file NN O
from IN O
Dino NNP O
's POS O
configuration NN O
( -LRB- O
" `` O
a.ini JJ O
" '' O
) -RRB- O
, , O
then RB O
it PRP O
retrieves VBZ O
the DT O
key NN O
to IN O
decrypt VB O
ramFS NNP O
, , O
and CC O
it PRP O
finally RB O
mounts VBZ O
the DT O
file NN O
system NN O
in IN O
memory NN O
in IN O
order NN O
to TO O
execute VB O
the DT O
cleaner JJR O
file NN O
stored VBN O
inside RB O
. . O

The DT O
verbosity NN O
of IN O
the DT O
error NN O
messages NNS O
makes VBZ O
it PRP O
particularly RB O
easy JJ O
to TO O
understand VB O
the DT O
purpose NN O
of IN O
the DT O
code NN O
. . O

The DT O
cleaner JJR B-Entity
file NN I-Entity
contains VBZ O
the DT O
string NN O
" `` O
INSTALL NNP O
A NNP O
" `` O
wusvcd NN O
" '' O
U NN O
" '' O
which WDT O
, , O
once RB O
executed VBN O
, , O
will MD O
uninstall VB B-Action
the DT O
malware NN B-Entity
from IN B-Modifier
the DT O
machine NN B-Entity
– . O
" `` O
wusvcd NN O
" '' O
being VBG O
the DT O
name NN O
used VBN O
to TO O
register VB O
Dino NNP O
on IN O
the DT O
machine NN O
. . O

Hence RB O
, , O
ramFS NNP B-Entity
serves VBZ B-Action
as IN B-Modifier
a DT O
protected VBN B-Entity
container NN I-Entity
for IN I-Entity
files NNS I-Entity
to TO I-Entity
be VB I-Entity
executed VBN I-Entity
on IN I-Entity
the DT I-Entity
machine NN I-Entity
, , O
offering VBG B-Action
a DT O
disposable JJ B-Entity
execution NN I-Entity
environment NN I-Entity
to IN I-Entity
the DT I-Entity
operators NNS I-Entity
and CC O
leaving VBG B-Action
very RB O
few JJ B-Entity
traces NNS I-Entity
on IN I-Entity
the DT I-Entity
system NN I-Entity
. . O

The DT O
commands NNS O
" `` O
cronadd NNS O
" '' O
, , O
" `` O
cronlist NN O
" '' O
and CC O
" `` O
crondel NN O
" '' O
serve VBP O
respectively RB O
to IN O
add VB B-Action
, , O
list NN O
, , O
and CC O
remove VB O
scheduled VBN B-Entity
tasks NNS I-Entity
registered VBN O
in IN O
the DT O
CRONTAB NNP O
module NN O
. . O

Those DT O
tasks NNS O
are VBP O
Dino NNP O
's POS O
commands NNS O
. . O

The DT O
syntax NN O
to TO O
define VB O
scheduled VBN O
tasks NNS O
is VBZ O
similar JJ O
to IN O
the DT O
one NN O
used VBN O
by IN O
the DT O
cron NN O
Unix NNP O
command NN O
. . O

In IN O
particular JJ O
the DT O
time NN O
at IN O
which WDT O
to TO O
run VB O
a DT O
command NN O
is VBZ O
given VBN O
by IN O
a DT O
string NN O
following VBG O
the DT O
format NN O
" `` O
minute JJ O
hour NN O
day NN O
month NN O
year NN O
dayofweek NN O
" '' O
. . O

Alternatively RB O
, , O
this DT O
string NN O
can MD O
be VB O
replaced VBN O
by IN O
" `` O
@boot NN O
" '' O
for IN O
a DT O
command NN O
to TO O
run VB O
at IN O
each DT O
startup NN O
– : O
whereas IN O
some DT O
Unix NNP O
cron NN O
implementations NNS O
accept VBP O
" `` O
@reboot NN O
" '' O
. . O

As IN O
an DT O
example NN O
, , O
here RB O
is VBZ O
the DT O
output NN O
of IN O
the DT O
" `` O
cronlist NN O
" '' O
command NN O
after IN O
a DT O
" `` O
wakeup NN O
" '' O
command NN O
has VBZ O
been VBN O
scheduled VBN O
to TO O
run VB O
on IN O
7th JJ O
April NNP O
2015 CD O
at IN O
15:44 CD O
. . O

As IN O
we PRP O
can MD O
see VB O
, , O
each DT O
entry NN O
is VBZ O
identified VBN O
by IN O
an DT O
" `` O
I PRP O
d MD O
" '' O
, , O
an DT O
incrementing VBG O
hexadecimal JJ O
number NN O
starting VBG O
at IN O
0xC0 NN O
. . O

The DT O
purpose NN O
of IN O
the DT O
" `` O
Local JJ O
" '' O
field NN O
remains VBZ O
unclear JJ O
( -LRB- O
the DT O
other JJ O
possible JJ O
value NN O
being VBG O
" `` O
l NN O
" '' O
) -RRB- O
. . O

The DT O
" `` O
Count NNP O
" '' O
parameter NN O
counts VBZ O
the DT O
number NN O
of IN O
times NNS O
a DT O
command NN O
has VBZ O
been VBN O
executed VBN O
, , O
" `` O
1 CD O
" '' O
indicating VBG O
the DT O
command NN O
will MD O
be VB O
executed VBN O
only RB O
once RB O
. . O

Finally RB O
, , O
the DT O
" `` O
Visibility NNP O
" '' O
field NN O
defines VBZ O
whether IN O
the DT O
command NN O
execution NN O
will MD O
be VB O
reported VBN O
to IN O
the DT O
C&C NNP O
( -LRB- O
the DT O
other JJ O
possible JJ O
value NN O
being VBG O
" `` O
Silent NNP O
" '' O
) -RRB- O
. . O

The DT O
amount NN O
of IN O
shared VBN O
code NN O
between IN O
Dino NNP O
and CC O
known VBN O
Animal NNP O
Farm NNP O
malware VBP O
leaves NNS O
very RB O
little JJ O
doubt NN O
that IN O
Dino NNP O
belongs VBZ O
to IN O
Animal NNP O
Farm NNP O
's POS O
arsenal NN O
. . O

Among IN O
these DT O
shared VBN O
features NNS O
, , O
we PRP O
can MD O
cite VB O
the DT O
following VBG O
. . O

At IN O
the DT O
very JJ O
beginning NN O
of IN O
Dino NNP B-Entity
execution NN O
, , O
the DT B-Entity
current JJ I-Entity
process NN I-Entity
name NN I-Entity
is VBZ O
checked VBD B-Action
against IN B-Modifier
process NN O
names NNS B-Entity
used VBN I-Entity
by IN I-Entity
some DT I-Entity
sandboxes NNS I-Entity
. . O

A DT O
very RB O
similar JJ O
check NN O
( -LRB- O
against IN O
" `` O
klavme NN O
" '' O
, , O
" `` O
myapp NN O
" '' O
, , O
" `` O
TESTAPP NNP O
" '' O
and CC O
" `` O
afyjevmv.exe JJ O
" '' O
) -RRB- O
is VBZ O
present JJ O
in IN O
Bunny NNP O
samples NNS O
, , O
and CC O
in IN O
some DT O
first JJ O
stage NN O
implants NNS O
deployed VBN O
by IN O
Animal NNP O
Farm NNP O
. . O

To TO O
hide VB O
its PRP$ O
calls NNS O
to IN O
certain JJ O
API NNP O
functions NNS O
, , O
Dino NNP O
employs VBZ O
a DT O
classic JJ O
Animal NNP O
Farm NNP O
ploy NN O
: : O
a DT O
hash NN O
is VBZ O
calculated VBN O
from IN O
the DT O
function NN O
's POS O
name NN O
and CC O
used VBD O
to TO O
look VB O
for IN O
the DT O
address NN O
of IN O
the DT O
API NNP O
function NN O
. . O

The DT O
actual JJ O
hashing NN O
algorithm NN O
used VBN O
in IN O
Dino NNP O
is VBZ O
the DT O
same JJ O
that WDT O
was VBD O
used VBN O
in IN O
Casper NNP O
, , O
namely RB O
a DT O
combination NN O
of IN O
rotate NN O
left VBN O
( -LRB- O
ROL NNP O
) -RRB- O
of IN O
7 CD O
bits NNS O
and CC O
exclusive JJ O
or CC O
( -LRB- O
XOR NNP O
) -RRB- O
operations NNS O
. . O

The DT O
Dino NNP O
's POS O
custom NN O
file NN O
system NN O
– : O
the DT O
so RB O
called VBN O
ramFS NN O
– . O
is VBZ O
present JJ O
in IN O
several JJ O
droppers NNS O
used VBN O
by IN O
Animal NNP O
Farm NNP O
. . O

In IN O
those DT O
binaries NNS O
the DT O
file NN O
system NN O
serves VBZ O
to TO O
set VB O
the DT O
persistence NN O
of IN O
the DT O
payload NN O
. . O

For IN O
example NN O
, , O
here RB O
is VBZ O
the DT O
command NN O
executed VBN O
by IN O
some DT O
NBOT NNP O
droppers NNS O
in IN O
the DT O
context NN O
of IN O
ramFS NN O
. . O

As IN O
a DT O
final JJ O
indication NN O
that IN O
Dino NNP O
belongs VBZ O
to IN O
Animal NNP O
Farm NNP O
menagerie NN O
, , O
it PRP O
is VBZ O
noticeable JJ O
that IN O
the DT O
output NN O
of IN O
Dino NNP O
's POS O
sysinfo NN O
command NN O
looks VBZ O
like IN O
an DT O
updated VBN O
version NN O
of IN O
the DT O
" `` O
beacon NN O
" '' O
from IN O
the DT O
SNOWBALL NNP O
implant NN O
described VBD O
in IN O
the DT O
leaked VBN O
CSE NNP O
slides NNS O
– . O
part NN O
of IN O
operation NN O
SNOWGLOBE NNP O
, , O
which WDT O
led VBD O
to IN O
the DT O
discovery NN O
of IN O
Babar NNP O
. . O

Dino NNP O
's POS O
sysinfo JJ O
example NN O
output NN O
Login NNP O
/ SYM O
Domain NNP O
( -LRB- O
owner NN O
) -RRB- O
: : O
Administrator NNP O
/ , O
JOHN NNP O
( -LRB- O
john NN O
) -RRB- O
Computer NN O
name NN O
: : O
JOHN NNP O
Organization NNP O
( -LRB- O
country NN O
) -RRB- O
. . O

( -LRB- O
United NNP O
States NNP O
) -RRB- O
RecId NNP O
: : O
11173 CD O
01 CD O
PRS NNP O
MaxDelay NNP O
: : O
3600 CD O
Version NN O
: : O
1.2 CD O
OS NN O
version NN O
( -LRB- O
SP NNP O
) -RRB- O
: : O
5.1 CD O
( -LRB- O
Service NNP O
Pack NNP O
3 CD O
) -RRB- O
WOW64 NN O
: : O
No DT O
Default JJ O
browser NN O
: : O
firefox.exe ADD O
IE NNP O
version NN O
: : O
Mozilla/4.0 NNP O
( -LRB- O
compatible; NNP O
MSIE NNP O
7.0; CD O
Win32 NNP O
) -RRB- O
First JJ O
launch NN O
: : O
04/01/2015 CD O
– -RRB- O
18:31:14 CD O
Time NN O
to TO O
kill VB O
: : O
N NNP O
/ -RRB- O
A DT O
Last JJ O
launch NN O
: : O
04/01/2015 CD O
– -RRB- O
19:21:44 CD O
Mode NNP O
: : O
N NNP O
/ NFP O
A DT O
| NNP O
Rights NNPS O
: : O
Admin NNP O
| -RRB- O
UAC NNP O
: : O
No DT O
ID NN O
: : O
4635BEF0 CD O
D89D NN O
11E4 CD O
B283 NN O
000C CD O
29FD2872 CD O
InstallAv NN O
: : O
0 NFP O
Inj NNP O
: : O
Yes UH O
SNOWBALL NNP O
implant JJ O
beacon NN O
All PDT O
these DT O
indicators NNS O
together RB O
make VBP O
us PRP O
very RB O
confident JJ O
that IN O
Dino NNP O
was VBD O
developed VBN O
by IN O
the DT O
Animal NNP O
Farm NNP O
group NN O
. . O

Dino NNP O
adds VBZ O
at IN O
least JJS O
two CD O
more JJR O
indicators NNS O
to IN O
those DT O
already RB O
documented VBN O
suggesting VBG O
that IN O
Animal NNP O
Farm NNP O
developers NNS O
are VBP O
French JJ O
speaking VBG O
. . O

Dino NNP O
's POS O
binary NN O
contains VBZ O
a DT O
resource NN O
whose WP$ O
language NN O
code NN O
value NN O
is VBZ O
1036 CD O
. . O

The DT O
original JJ O
purpose NN O
of IN O
this DT O
language NN O
code NN O
is VBZ O
to TO O
allow VB O
developers NNS O
to TO O
provide VB O
resources NNS O
( -LRB- O
menus NNS O
, , O
icons NNS O
, , O
version NN O
information NN O
… . O
) -RRB- O
for IN O
different JJ O
locations NNS O
in IN O
the DT O
world NN O
in IN O
the DT O
corresponding JJ O
language NN O
. . O

Interestingly RB O
, , O
when WRB O
a DT O
developer NN O
does VBZ O
not RB O
manually RB O
specify VB O
the DT O
language NN O
code NN O
, , O
the DT O
compiler NN O
sets VBZ O
it PRP O
to IN O
the DT O
language NN O
of IN O
the DT O
developer NN O
's POS O
machine NN O
. . O

So RB O
, , O
which WDT O
language NN O
corresponds VBZ O
to IN O
the DT O
value NN O
1036 CD O
, , O
or CC O
0x40c CD O
in IN O
hexadecimal JJ O
? . O
French JJ O
( -LRB- O
France NNP O
) -RRB- O
. . O

Of RB O
course RB O
a DT O
non AFX O
French NNP O
speaking VBG O
developer NN O
could MD O
have VB O
deliberately RB O
set VBN O
this DT O
value NN O
to TO O
mislead VB O
attribution NN O
efforts NNS O
. . O

But CC O
in IN O
more RBR O
recent JJ O
Animal NNP O
Farm NNP O
binaries NNS O
( -LRB- O
for IN O
example NN O
Casper NNP O
) -RRB- O
, , O
this DT O
language NN O
code NN O
has VBZ O
been VBN O
set VBN O
to IN O
the DT O
classical JJ O
English NNP O
( -LRB- O
USA NNP O
) -RRB- O
language NN O
code NN O
. . O

Therefore RB O
, , O
it PRP O
seems VBZ O
that IN O
Animal NNP O
Farm NNP O
developers NNS O
forgot VBD O
to TO O
set VB O
this DT O
value NN O
in IN O
their PRP$ O
first JJ O
creations NNS O
, , O
realized VBD O
their PRP$ O
mistake NN O
at IN O
some DT O
point NN O
, , O
and CC O
decided VBD O
to TO O
set VB O
a DT O
standard JJ O
value NN O
. . O

Someone NN O
using VBG O
the DT O
language NN O
code NN O
as IN O
a DT O
false JJ O
flag NN O
would MD O
have VB O
likely RB O
kept VBN O
the DT O
strategy NN O
going VBG O
. . O

For IN O
the DT O
record NN O
, , O
this DT O
Dino NNP O
sample NN O
is VBZ O
not RB O
the DT O
only JJ O
Animal NNP O
Farm NNP O
binary NN O
with IN O
1036 CD O
as IN O
language NN O
code NN O
. . O

Dino NNP O
's POS O
binary NN O
is VBZ O
statically RB O
linked VBN O
with IN O
the DT O
GnuMP NNP O
library NN O
, , O
which WDT O
is VBZ O
used VBN O
to TO O
manipulate VB O
big JJ O
numbers NNS O
in IN O
cryptography NN O
algorithms NN O
. . O

The DT O
GnuMP NNP O
code NN O
in IN O
Dino NNP O
contains VBZ O
file NN O
paths NNS O
coming VBG O
from IN O
the DT O
developer NN O
's POS O
machine NN O
. . O

As IN O
the DT O
attentive JJ O
reader NN O
has VBZ O
probably RB O
guessed VBN O
, , O
" `` O
arithmetique NN O
" '' O
is VBZ O
the DT O
French JJ O
translation NN O
of IN O
" `` O
arithmetic NN O
" '' O
. . O

Dino NNP O
's POS O
binary NN O
shows VBZ O
an DT O
intense JJ O
development NN O
effort NN O
, , O
from IN O
custom NN O
data NNS O
structures NNS O
to IN O
a DT O
homemade JJ O
file NN O
system NN O
. . O

As IN O
with IN O
other JJ O
Animal NNP O
Farm NNP O
binaries NNS O
, , O
it PRP O
bears VBZ O
the DT O
mark NN O
of IN O
professional JJ O
and CC O
experienced JJ O
developers NNS O
. . O

But CC O
Dino NNP O
also RB O
shows VBZ O
a DT O
poor JJ O
knowledge NN O
, , O
or CC O
interest NN O
, , O
from IN O
these DT O
developers NNS O
in IN O
anti JJ O
analysis NN O
techniques NNS O
– . O
contrary JJ O
to IN O
what WP O
was VBD O
seen VBN O
in IN O
Casper NNP O
– NFP O
as IN O
demonstrated VBN O
, , O
for IN O
example NN O
, , O
by IN O
the DT O
verbosity NN O
of IN O
some DT O
Dino NNP O
's POS O
log NN O
messages NNS O
. . O

All PDT O
those DT O
messages NNS O
provide VBP O
substantial JJ O
help NN O
in IN O
understanding VBG O
Dino NNP O
's POS O
internal JJ O
workings NNS O
. . O

One CD O
will MD O
also RB O
appreciate VB O
the DT O
numerous JJ O
misspellings NNS O
contained VBD O
in IN O
the DT O
messages NNS O
. . O

Regarding VBG O
Dino NNP O
's POS O
victims NNS O
, , O
we PRP O
know VBP O
very RB O
little JJ O
except IN O
that IN O
they PRP O
were VBD O
located VBN O
in IN O
Iran NNP O
in IN O
2013 CD O
. . O

This DT O
is VBZ O
in IN O
accordance NN O
with IN O
the DT O
victimology NN O
described VBN O
by IN O
Canada NNP O
's POS O
CSE NNP O
in IN O
its PRP$ O
presentation NN O
. . O

That DT O
leads VBZ O
us PRP O
to IN O
the DT O
final JJ O
point NN O
of IN O
this DT O
blog NN O
: : O
several JJ O
signs NNS O
suggest VBP O
that IN O
Dino NNP O
's POS O
creators NNS O
are VBP O
French JJ O
speaking VBG O
developers NNS O
. . O

These DT O
signs NNS O
add VBP O
to IN O
the DT O
pretty JJ O
long JJ O
list NN O
of IN O
indicators NNS O
already RB O
supporting VBG O
this DT O
hypothesis NN O
, , O
in IN O
particular JJ O
the DT O
ones NNS O
mentioned VBN O
by IN O
Canada NNP O
's POS O
CSE NNP O
. . O

Author NN O
Joan NNP O
Calvet NNP O
, , O
ESET NNP O

