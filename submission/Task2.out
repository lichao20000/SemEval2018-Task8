Over	O
the	O
last	O
10	O
months	O
,	O
Kaspersky	O
Lab	O
researchers	O
have	O
analyzed	O
a	O
massive	O
cyber-espionage	O
operation	O
which	O
we	O
call	O
''	O
Epic	O
Turla	O
''	O
.	O
	
The	O
attackers	O
behind	O
Epic	O
Turla	O
have	O
infected	O
several	O
hundred	O
computers	O
in	O
more	O
than	O
45	O
countries	O
,	O
including	O
government	O
institutions	O
,	O
embassies	O
,	O
military	O
,	O
education	O
,	O
research	O
and	O
pharmaceutical	O
companies	O
.	O
	
The	O
attacks	O
are	O
known	O
to	O
have	O
used	O
at	O
least	O
two	O
zero-day	O
exploits	O
:	O
We	O
also	O
observed	O
exploits	O
against	O
older	O
(	O
patched	O
)	O
vulnerabilities	O
,	O
social	O
engineering	O
techniques	O
and	O
watering	B-Verb
hole	B-Entity
strategies	I-Entity
in	I-Entity
these	I-Entity
attacks	I-Entity
.	O
	
The	B-Entity
primary	I-Entity
backdoor	I-Entity
used	B-Verb
in	B-Preposition
the	B-Entity
Epic	I-Entity
attacks	I-Entity
is	O
also	O
known	O
as	O
''	O
WorldCupSec	O
''	O
,	O
''	O
TadjMakhal	O
''	O
,	O
''	O
Wipbot	O
''	O
or	O
''	O
Tavdig	O
''	O
.	O
	
When	O
G-Data	O
published	O
on	O
Turla/Uroburos	O
back	O
in	O
February	O
,	O
several	O
questions	O
remained	O
unanswered	O
.	O
	
One	O
big	O
unknown	O
was	O
the	O
infection	O
vector	O
for	O
Turla	O
(	O
aka	O
Snake	O
or	O
Uroburos	O
)	O
.	O
	
Our	O
analysis	O
indicates	O
that	O
victims	O
are	O
infected	O
via	O
a	O
sophisticated	O
multi-stage	O
attack	O
,	O
which	O
begins	O
with	O
the	O
Epic	O
Turla	O
.	O
	
In	O
time	O
,	O
as	O
the	O
attackers	O
gain	O
confidence	O
,	O
this	O
is	O
upgraded	O
to	O
more	O
sophisticated	O
backdoors	O
,	O
such	O
as	O
the	O
Carbon/Cobra	O
system	O
.	O
	
Sometimes	O
,	O
both	O
backdoors	O
are	O
run	O
in	O
tandem	O
,	O
and	O
used	O
to	O
''	O
rescue	O
''	O
each	O
other	O
if	O
communications	O
are	O
lost	O
with	O
one	O
of	O
the	O
backdoors	O
.	O
	
Once	O
the	O
attackers	O
obtain	O
the	O
necessary	O
credentials	O
without	O
the	O
victim	O
noticing	O
,	O
they	O
deploy	O
the	O
rootkit	O
and	O
other	O
extreme	O
persistence	O
mechanisms	O
.	O
	
The	O
attacks	O
are	O
still	O
ongoing	O
as	O
of	O
July	O
2014	O
,	O
actively	O
targeting	O
users	O
in	O
Europe	O
and	O
the	O
Middle	O
East	O
.	O
	
Note	O
:	O
A	O
full	O
analysis	O
of	O
the	O
Epic	O
attacks	O
is	O
available	O
to	O
the	O
Kaspersky	O
Intelligent	O
Services	O
subscribers	O
.	O
	
Contact	O
:	O
intelreports	O
@	O
kaspersky.com	O
The	O
attacks	O
in	O
this	O
campaign	O
fall	O
into	O
several	O
different	O
categories	O
depending	O
on	O
the	O
vector	O
used	O
in	O
the	O
initial	O
compromise	O
:	O
The	O
attackers	O
use	O
both	O
direct	O
spearphishing	O
and	O
watering	O
hole	O
attacks	O
to	O
infect	O
their	O
victims	O
.	O
	
Watering	O
holes	O
(	O
waterholes	O
)	O
are	O
websites	O
of	O
interest	O
to	O
the	O
victims	O
that	O
have	O
been	O
compromised	O
by	O
the	B-Entity
attackers	I-Entity
and	O
injected	O
to	O
serve	O
malicious	O
code	O
.	O
	
So	O
far	O
we	O
have	O
n't	O
been	O
able	O
to	O
locate	O
any	O
e-mail	O
used	O
against	O
the	O
victims	O
,	O
only	O
the	O
attachments	O
.	O
	
The	O
PDF	O
attachments	O
do	O
not	O
show	O
any	O
''	O
lure	O
''	O
to	O
the	O
victim	O
when	O
opened	O
,	O
however	O
,	O
the	O
SCR	O
packages	O
sometime	O
show	O
a	O
clean	O
PDF	O
upon	O
successful	O
installation	O
.	O
	
Some	O
of	O
known	O
attachment	O
names	O
used	O
in	O
the	O
spearphishing	O
attacks	O
are	O
:	O
In	O
some	O
cases	O
,	O
these	O
filenames	O
can	O
provide	O
clues	O
about	O
the	O
type	O
of	O
victims	O
the	O
attackers	O
are	O
targeting	O
.	O
	
Currently	O
,	O
the	O
Epic	O
attackers	O
run	O
a	O
vast	O
network	O
of	O
watering	O
holes	O
that	O
target	O
visitors	O
with	O
surgical	O
precision	O
.	O
	
Some	O
of	O
the	O
injected	O
websites	O
include	O
:	O
In	O
total	O
,	O
we	O
observed	O
more	O
than	O
100	O
injected	O
websites	O
.	O
	
Currently	O
,	O
the	O
largest	O
number	O
of	O
injected	O
sites	O
is	O
in	O
Romania	O
.	O
	
Here	O
's	O
a	O
statistic	O
on	O
the	O
injected	O
websites	O
:	O
The	O
distribution	O
is	O
obviously	O
not	O
random	O
,	O
and	O
it	O
reflects	O
some	O
of	O
the	O
interests	O
of	O
the	O
attackers	O
.	O
	
For	O
instance	O
,	O
in	O
Romania	O
many	O
of	O
the	O
infected	O
sites	O
are	O
in	O
the	O
Mures	O
region	O
,	O
while	O
many	O
of	O
the	O
Spanish	O
infected	O
sites	O
belong	O
to	O
local	O
governments	O
(	O
City	O
Hall	O
)	O
.	O
	
Most	O
of	O
the	O
infected	O
sites	O
use	O
the	O
TYPO3	O
CMS	O
(	O
see	O
:	O
http	O
:	O
//typo3.org/	O
)	O
,	O
which	O
could	O
indicate	O
the	O
attackers	O
are	O
abusing	O
a	O
specific	O
vulnerability	O
in	O
this	O
publishing	O
platform	O
.	O
	
Injected	B-Entity
websites	I-Entity
load	B-Verb
a	B-Entity
remote	I-Entity
JavaScript	I-Entity
into	B-Preposition
the	B-Entity
victim	I-Entity
's	I-Entity
browser	I-Entity
:	O
The	O
script	O
''	O
sitenavigatoin.js	O
''	O
is	O
a	O
Pinlady-style	O
browser	O
and	O
plugin	O
detection	O
script	O
,	O
which	O
in	O
turn	O
,	O
redirects	O
to	O
a	O
PHP	O
script	O
sometimes	O
called	O
main.php	O
or	O
wreq.php	O
.	O
	
Sometimes	O
,	O
the	O
attackers	O
register	O
the	O
.JPG	O
	
extension	O
with	O
the	O
PHP	O
handler	O
on	O
the	O
server	O
,	O
using	B-Verb
''	B-Entity
JPG	I-Entity
''	I-Entity
files	I-Entity
to	I-Entity
run	I-Entity
PHP	I-Entity
scripts	I-Entity
:	O
The	B-Entity
main	I-Entity
exploitation	I-Entity
script	I-Entity
''	I-Entity
wreq.php	I-Entity
''	I-Entity
,	I-Entity
''	I-Entity
main.php	I-Entity
''	I-Entity
or	I-Entity
''	I-Entity
main.jpg	I-Entity
''	I-Entity
performs	B-Verb
a	B-Entity
numbers	I-Entity
of	I-Entity
tasks	I-Entity
.	O
	
We	O
have	O
located	O
several	O
versions	O
of	O
this	O
script	O
which	O
attempt	O
various	O
exploitation	O
mechanisms	O
.	O
	
One	B-Entity
version	I-Entity
of	I-Entity
this	I-Entity
script	I-Entity
attempts	O
to	O
exploit	O
Internet	O
Explorer	O
versions	O
6	O
,	O
7	O
and	O
8	O
:	O
Unfortunately	O
,	O
the	O
Internet	O
Explorer	O
exploits	O
have	O
not	O
yet	O
been	O
retrieved	O
.	O
	
Another	O
more	O
recent	O
version	O
attempts	O
to	O
exploit	O
Oracle	O
Sun	O
Java	O
and	O
Adobe	O
Flash	O
Player	O
:	O
Although	O
the	O
Flash	O
Player	O
exploits	O
could	O
n't	O
be	O
retrieved	O
,	O
we	O
did	O
manage	O
to	O
obtain	O
the	O
Java	O
exploits	O
:	O
The	O
Java	O
files	O
exploit	O
a	O
popular	O
vulnerability	O
,	O
CVE-2012-1723	O
,	O
in	O
various	O
configurations	O
.	O
	
The	O
payload	O
dropped	O
by	O
these	O
Java	O
exploits	O
is	O
the	O
following	O
:	O
The	O
Java	O
exploit	O
use	O
a	O
special	O
loader	O
that	O
attempts	O
to	O
inject	B-Verb
the	B-Entity
final	I-Entity
Epic	I-Entity
backdoor	I-Entity
payload	I-Entity
into	B-Preposition
explorer.exe	B-Entity
.	O
	
The	B-Entity
backdoor	I-Entity
extracted	B-Verb
from	B-Preposition
the	B-Entity
Java	I-Entity
exploits	I-Entity
has	B-Verb
the	B-Entity
following	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
hardcoded	I-Entity
inside	I-Entity
:	O
This	O
C	O
&	O
C	O
is	O
still	O
online	O
at	O
the	O
moment	O
although	O
it	O
redirects	O
to	O
a	O
currently	O
suspended	O
page	O
at	O
''	O
hxxp	O
:	O
//busandcoachdirectory.com	O
[	O
.	O
	
]	O
au	O
''	O
.	O
	
For	O
a	O
full	O
list	O
of	O
C	O
&	O
C	O
servers	O
,	O
please	O
see	O
the	O
Appendix	O
.	O
	
The	O
Epic	O
Turla	O
attackers	O
are	O
extremely	O
dynamic	O
in	O
using	O
exploits	O
or	O
different	O
methods	O
depending	O
on	O
what	O
is	O
available	O
at	O
the	O
moment	O
.	O
	
Most	O
recently	O
,	O
we	O
observed	O
them	O
using	O
yet	O
another	O
technique	O
coupled	O
with	O
watering	O
hole	O
attacks	O
.	O
	
This	O
takes	O
advantage	O
of	O
social	O
engineering	O
to	O
trick	B-Verb
the	B-Entity
user	I-Entity
into	B-Preposition
running	B-Entity
a	I-Entity
fake	I-Entity
Flash	I-Entity
Player	I-Entity
(	I-Entity
MD5	I-Entity
:	O
030f5fdb78bfc1ce7b459d3cc2cf1877	O
)	O
:	O
In	O
at	O
least	O
one	O
case	O
,	O
they	O
tried	O
to	O
trick	O
the	O
user	O
into	O
downloading	O
and	O
running	B-Verb
a	B-Entity
fake	I-Entity
Microsoft	I-Entity
Security	I-Entity
Essentials	I-Entity
app	I-Entity
(	I-Entity
MD5	I-Entity
:	I-Entity
89b0f1a3a667e5cd43f5670e12dba411	I-Entity
)	I-Entity
:	O
The	O
fake	O
application	O
is	O
signed	O
by	O
a	O
valid	O
digital	O
certificate	O
from	O
Sysprint	O
AG	O
:	O
This	O
file	O
was	O
distributed	O
from	O
the	O
Ministry	O
of	O
Foreign	O
Affairs	O
of	O
Tajikistan	O
's	O
website	O
,	O
at	B-Preposition
''	B-Entity
hxxp	I-Entity
:	I-Entity
//mfa	I-Entity
[	I-Entity
.	I-Entity
]	I-Entity
tj/upload/security.php	I-Entity
''	I-Entity
.	O
	
The	O
file	O
is	O
a	O
.NET	O
	
application	O
that	O
contains	O
an	O
encrypted	O
resource	O
.	O
	
This	O
drops	O
the	O
malicious	O
file	O
with	O
the	O
MD5	O
7731d42b043865559258464fe1c98513	O
.	O
	
This	O
is	O
an	O
Epic	O
backdoor	O
which	O
connects	B-Verb
to	B-Preposition
the	B-Entity
following	I-Entity
C	I-Entity
&	I-Entity
Cs	I-Entity
,	O
with	O
a	O
generic	O
internal	O
ID	O
of	O
1156fd22-	O
3443-4344-c4ffff	O
:	O
A	O
full	O
list	O
with	O
all	O
the	O
C	O
&	O
C	O
server	O
URLs	O
that	O
we	O
recovered	O
from	O
the	O
samples	O
can	O
be	O
found	O
in	O
the	O
technical	O
Appendix	O
.	O
	
The	O
Epic	O
backdoors	O
are	O
commanded	O
by	O
a	B-Entity
huge	I-Entity
network	I-Entity
of	I-Entity
hacked	I-Entity
servers	I-Entity
that	I-Entity
deliver	I-Entity
command	I-Entity
and	I-Entity
control	I-Entity
functionality	I-Entity
.	O
	
The	O
huge	O
network	O
commanded	O
by	O
the	O
Epic	O
Turla	O
attackers	O
serves	O
multiple	O
purposes	O
.	O
	
For	O
instance	O
,	O
the	O
motherships	O
function	O
as	O
both	O
exploitation	O
sites	O
and	O
command	B-Entity
and	I-Entity
control	I-Entity
panels	I-Entity
for	I-Entity
the	I-Entity
malware	I-Entity
.	O
	
Here	O
's	O
how	O
the	O
big	O
picture	O
looks	O
like	O
:	O
The	B-Entity
first	I-Entity
level	I-Entity
of	I-Entity
command	I-Entity
and	I-Entity
control	I-Entity
proxies	I-Entity
generally	O
talk	O
to	O
a	O
second	O
level	O
of	O
proxies	O
,	O
which	O
in	O
turn	O
,	O
talk	O
to	O
the	O
''	O
mothership	O
''	O
server	O
.	O
	
The	O
mothership	O
server	O
is	O
generally	O
a	O
VPS	O
,	O
which	O
runs	O
the	O
Control	O
panel	O
software	O
used	O
to	O
interact	O
with	O
the	O
victims	O
.	O
	
The	B-Entity
attackers	I-Entity
operate	B-Verb
the	B-Entity
mothership	I-Entity
using	B-Preposition
a	B-Entity
network	I-Entity
of	I-Entity
proxies	I-Entity
and	I-Entity
VPN	I-Entity
servers	I-Entity
for	B-Preposition
anonymity	B-Entity
reasons	I-Entity
.	O
	
The	O
mothership	O
also	O
work	B-Verb
as	B-Preposition
the	B-Entity
exploitation	I-Entity
servers	I-Entity
used	I-Entity
in	I-Entity
the	I-Entity
watering	I-Entity
hole	I-Entity
attacks	I-Entity
,	O
delivering	O
Java	O
,	O
IE	O
or	O
fake	O
applications	O
to	O
the	O
victim	O
.	O
	
We	O
were	O
able	O
to	O
get	O
a	O
copy	O
of	O
one	O
of	O
the	O
motherships	O
,	O
which	O
provided	O
some	O
insight	O
into	O
the	O
operation	O
.	O
	
It	B-Entity
runs	B-Verb
a	B-Entity
control	I-Entity
panel	I-Entity
which	O
is	O
password	O
protected	O
:	O
Once	O
logged	O
into	O
the	O
Control	O
panel	O
,	O
the	B-Entity
attackers	I-Entity
can	O
see	O
a	O
general	O
overview	O
of	O
the	O
system	O
including	O
the	O
number	O
of	O
interesting	O
potential	O
targets	O
:	O
A	O
very	O
interesting	O
file	O
on	O
the	O
servers	O
is	O
task.css	O
,	O
where	O
the	O
attackers	O
define	O
the	O
IP	O
ranges	O
they	O
are	O
interested	O
in	O
.	O
	
To	O
change	O
the	O
file	O
,	O
they	O
are	O
using	O
the	O
''	O
Task	O
editor	O
''	O
from	O
the	O
menu	O
.	O
	
Depending	O
on	O
the	O
''	O
tasks	O
''	O
,	O
they	O
will	O
decide	O
whether	O
to	O
infect	O
the	O
visitors	O
or	O
not	O
.	O
	
In	O
this	O
case	O
,	O
we	O
found	O
they	O
targeted	O
two	O
ranges	O
belonging	O
to	O
:	O
It	O
should	O
be	O
noted	O
though	O
,	O
the	O
fact	O
that	O
the	B-Entity
attackers	I-Entity
were	O
targeting	O
these	O
ranges	O
does	O
n't	O
necessarily	O
mean	O
they	O
also	O
got	O
infected	O
.	O
	
Some	O
other	O
unknown	O
IPs	O
were	O
also	O
observed	O
in	O
the	O
targeting	O
schedules	O
.	O
	
There	O
is	O
also	O
an	O
''	O
except.css	O
''	O
file	O
where	O
attackers	O
log	O
the	O
reasons	O
they	O
did	O
n't	O
try	O
to	O
exploit	O
certain	O
visitors	O
.	O
	
There	O
are	O
three	O
possible	O
values	O
:	O
These	O
are	O
the	O
''	O
do	O
n't	O
meet	O
the	O
conditions	O
''	O
reasons	O
observed	O
in	O
the	O
logs	O
:	O
For	O
this	O
first	O
stage	O
of	O
the	O
attack	O
,	O
the	B-Entity
threat	I-Entity
actor	I-Entity
uses	B-Verb
a	B-Entity
custom	I-Entity
backdoor	I-Entity
.	O
	
In	O
some	O
cases	O
,	O
the	B-Entity
backdoor	I-Entity
is	O
packaged	O
together	O
with	O
the	O
CVE-2013-5065	O
EoP	O
exploit	O
and	O
heavily	O
obfuscated	O
.	O
	
This	O
makes	O
the	O
analysis	O
more	O
difficult	O
.	O
	
The	O
CVE-2013-5065	O
exploit	O
allows	O
the	B-Entity
backdoor	I-Entity
to	O
achieve	B-Verb
administrator	B-Entity
privileges	I-Entity
on	I-Entity
the	I-Entity
system	I-Entity
and	O
run	O
unrestricted	O
.	O
	
This	O
exploit	O
only	O
works	O
on	O
unpatched	O
Microsoft	O
Windows	O
XP	O
systems	O
.	O
	
Other	O
known	O
detection	O
names	O
for	O
the	O
backdoor	O
is	O
Trojan.Wipbot	O
(	O
Symantec	O
)	O
or	O
Tavdig	O
.	O
	
The	B-Entity
main	I-Entity
backdoor	I-Entity
is	O
about	O
60KB	O
in	O
size	O
and	O
implements	B-Verb
a	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
protocol	I-Entity
on	B-Preposition
top	B-Entity
of	I-Entity
normal	I-Entity
HTTP	I-Entity
requests	I-Entity
.	O
	
The	B-Entity
communication	I-Entity
protocol	I-Entity
uses	I-Entity
requests	I-Entity
in	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
replies	I-Entity
,	O
which	O
the	O
malware	O
decrypts	O
and	O
processes	O
.	O
	
The	B-Entity
replies	I-Entity
are	B-Verb
sent	I-Verb
back	I-Verb
to	B-Preposition
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
through	I-Entity
the	I-Entity
same	I-Entity
channel	I-Entity
.	O
	
The	O
malware	O
behavior	O
is	O
defined	O
by	O
a	O
configuration	O
block	O
.	O
	
The	O
configuration	O
block	O
usually	O
contains	B-Verb
two	B-Entity
hard-coded	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
URLs	I-Entity
.	O
	
He	O
have	O
also	O
seen	O
one	O
case	O
where	O
the	O
configuration	O
block	O
contains	O
just	O
one	O
URL	O
.	O
	
The	O
configuration	O
can	O
also	O
be	O
updated	O
on	O
the	O
fly	O
by	O
the	O
attackers	O
,	O
via	B-Preposition
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
.	O
	
The	O
backdoor	O
attempts	O
to	O
identify	O
the	O
following	O
processes	O
and	O
,	O
if	O
found	O
,	O
it	B-Entity
will	O
terminate	O
itself	O
:	O
It	O
contains	O
an	O
internal	O
unique	O
ID	O
,	O
which	O
is	O
used	O
to	O
identify	B-Verb
the	B-Entity
victim	I-Entity
to	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
.	O
	
Most	O
samples	O
,	O
especially	O
old	O
ones	O
,	O
have	O
the	O
ID	O
1156fd22-3443-4344-c4ffff	O
.	O
	
Once	O
a	O
victim	O
is	O
confirmed	O
as	O
''	O
interesting	O
''	O
,	O
the	B-Entity
attackers	I-Entity
upload	B-Verb
another	B-Entity
Epic	I-Entity
backdoor	I-Entity
which	O
has	O
a	O
unique	O
ID	O
used	O
to	O
control	O
this	O
specific	O
victim	O
.	O
	
During	O
the	O
first	O
C	O
&	O
C	O
call	O
,	O
the	B-Entity
backdoor	I-Entity
sends	B-Verb
a	B-Entity
pack	I-Entity
with	B-Preposition
the	B-Entity
victim	I-Entity
's	I-Entity
system	I-Entity
information	I-Entity
.	O
	
All	B-Entity
further	I-Entity
information	I-Entity
sent	I-Entity
to	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
is	B-Verb
encrypted	I-Verb
with	B-Preposition
a	B-Entity
public	I-Entity
key	I-Entity
framework	I-Entity
,	O
making	O
decryption	O
impossible	O
.	O
	
The	B-Entity
commands	I-Entity
from	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
are	B-Verb
encrypted	I-Verb
in	O
a	O
simpler	O
manner	O
and	O
can	O
be	O
decrypted	O
if	O
intercepted	O
because	O
the	O
secret	O
key	O
is	O
hardcoded	O
in	O
the	O
malware	O
.	O
	
Through	O
monitoring	O
,	O
we	O
were	O
able	O
to	O
capture	O
a	O
large	O
amount	O
of	O
commands	O
sent	O
to	O
the	O
victims	O
by	O
the	O
attackers	O
,	O
providing	O
an	O
unique	O
view	O
into	O
this	O
operation	O
.	O
	
Here	O
's	O
a	O
look	O
at	O
one	O
of	O
the	O
encrypted	O
server	O
replies	O
:	O
Once	O
a	O
victim	O
is	O
infected	O
and	O
''	O
checks	O
in	O
''	O
with	O
the	O
server	O
,	O
the	B-Entity
attackers	I-Entity
send	B-Verb
a	B-Entity
template	I-Entity
of	I-Entity
commands	I-Entity
:	O
Next	O
,	O
the	O
attackers	O
try	O
to	O
move	O
through	O
the	O
victim	O
's	O
network	O
using	O
pre-defined	O
or	O
collected	O
passwords	O
:	O
Listing	O
all	O
.doc	O
	
files	O
recursively	O
is	O
also	O
a	O
common	O
''	O
theme	O
''	O
:	O
In	O
total	O
,	O
we	O
have	O
decoded	O
several	O
hundreds	O
of	O
these	O
command	O
packages	O
delivered	O
to	O
the	O
victims	O
,	O
providing	O
an	O
unique	O
insight	O
into	O
the	O
inner	O
workings	O
of	O
the	O
attackers	O
.	O
	
In	O
addition	O
to	O
generic	O
searches	O
,	O
some	O
very	O
specific	O
lookups	O
have	O
been	O
observed	O
as	O
well	O
.	O
	
These	O
include	O
searches	O
for	O
:	O
In	O
this	O
case	O
,	O
the	B-Entity
attackers	I-Entity
were	O
interested	O
to	O
find	O
e-mails	O
related	O
to	O
''	O
NATO	O
''	O
,	O
''	O
Energy	O
Dialogue	O
within	O
European	O
Unition	O
''	O
and	O
so	O
on	O
.	O
	
For	O
some	O
of	O
the	O
C	O
&	O
C	O
servers	O
,	O
the	B-Entity
attackers	I-Entity
implemented	B-Verb
RSA	B-Entity
encryption	I-Entity
for	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
logs	I-Entity
,	O
which	O
makes	O
it	O
impossible	O
to	O
decrypt	O
them	O
.	O
	
This	O
scheme	O
was	O
implemented	O
in	O
April	O
2014	O
.	O
	
Once	O
a	O
victim	O
is	O
compromised	O
,	O
the	B-Entity
attackers	I-Entity
upload	B-Verb
several	B-Entity
tools	I-Entity
that	O
are	O
used	O
for	O
lateral	O
movement	O
.	O
	
One	O
such	O
tool	O
observed	O
in	O
the	O
attacks	O
and	O
saved	O
as	O
''	O
C	O
:	O
\Documents	O
and	O
Settings\All	O
users\Start	O
Menu\Programs\Startup\winsvclg.exe	O
''	O
is	O
:	O
This	O
is	O
a	O
keylogger	O
tool	O
that	O
creates	B-Verb
%	B-Entity
temp	I-Entity
%	I-Entity
\~DFD3O8.tmp	I-Entity
.	O
	
Note	O
:	O
the	O
filename	O
can	O
change	O
across	O
victims	O
.	O
	
On	O
one	O
Central	O
Asian	O
government	O
's	O
Ministry	O
of	O
Foreign	O
Affairs	O
victim	O
system	O
,	O
the	O
filename	O
used	O
was	O
''	O
adobe32updt.exe	O
''	O
.	O
	
In	O
addition	O
to	O
these	O
custom	O
tools	O
,	O
we	O
observed	O
the	O
usage	O
of	O
standard	O
administration	O
utilities	O
.	O
	
For	O
instance	O
,	O
another	O
tool	O
often	O
uploaded	O
by	O
the	O
attackers	O
to	O
the	O
victim	O
's	O
machine	O
is	O
''	O
winrs.exe	O
''	O
:	O
This	O
is	O
an	O
UPX	O
packed	O
binary	O
,	O
which	O
contains	O
the	O
genuine	O
''	O
dnsquery.exe	O
''	O
tool	O
from	O
Microsoft	O
,	O
unpacked	O
MD5	O
:	O
c0c03b71684eb0545ef9182f5f9928ca	O
.	O
	
In	O
several	O
cases	O
,	O
an	O
interesting	O
update	O
has	O
been	O
observed	O
--	O
a	O
malware	O
from	O
a	O
different	O
,	O
yet	O
related	O
family	O
.	O
	
This	B-Entity
backdoor	I-Entity
is	O
more	O
sophisticated	O
and	O
belongs	O
to	O
the	O
next	O
level	O
of	O
cyber-espionage	O
tools	O
called	O
the	O
''	O
Carbon	O
system	O
''	O
or	O
Cobra	O
by	O
the	O
Turla	O
attackers	O
.	O
	
Several	O
plugins	O
for	O
the	O
''	O
Carbon	O
system	O
''	O
are	O
known	O
to	O
exist	O
.	O
	
Note	O
:	O
the	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
servers	I-Entity
www.losguayaberos	I-Entity
[	I-Entity
.	O
	
]	O
com	O
and	O
thebesttothbrushes	O
[	O
.	O
	
]	O
com	O
have	O
been	O
sinkholed	O
by	O
Kaspersky	O
Lab	O
.	O
	
Other	O
packages	O
delivered	O
to	O
the	O
victims	O
include	O
:	O
These	O
top	O
level	O
packages	O
deploy	O
both	O
updated	O
Epic	O
backdoors	O
and	O
Turla	O
Carbon	O
system	O
backdoors	O
to	O
confirmed	O
victims	O
,	O
effectively	O
linking	O
the	O
Epic	O
and	O
Turla	O
Carbon	O
operations	O
together	O
.	O
	
The	O
Turla	O
Carbon	O
dropper	O
from	O
these	O
packages	O
has	O
the	O
following	O
properties	O
:	O
This	O
is	O
called	O
internally	O
by	O
the	O
authors	O
''	O
Carbon	O
System	O
''	O
,	O
part	O
of	O
the	O
''	O
Cobra	O
''	O
project	O
,	O
as	O
it	O
can	O
be	O
seen	O
from	O
the	O
debug	O
path	O
inside	O
:	O
This	O
acts	O
as	O
a	O
dropper	O
for	O
the	O
following	O
modules	O
,	O
both	O
32	O
and	O
64	O
bit	O
:	O
The	O
Carbon	O
system	O
is	O
in	O
essence	O
an	O
extensible	O
platform	O
,	O
very	O
similar	O
to	O
other	O
attack	O
platforms	O
such	O
as	O
the	O
Tilded	O
platform	O
or	O
the	O
Flame	O
platform	O
.	O
	
The	O
plugins	O
for	O
the	O
Carbon	O
system	O
can	O
be	O
easily	O
recognized	O
as	O
they	O
always	O
feature	O
at	O
least	O
two	O
exports	O
named	O
:	O
Several	O
Epic	O
backdoors	O
appear	O
to	O
have	O
been	O
designed	O
to	O
work	O
as	O
Carbon	O
system	O
plugins	O
as	O
well	O
-	O
they	O
require	O
a	O
specialized	O
loader	O
to	O
start	O
in	O
victim	O
systems	O
that	O
do	O
not	O
have	O
the	O
Carbon	O
system	O
deployed	O
.	O
	
Some	O
modules	O
have	O
artifacts	O
which	O
indicate	O
the	O
Carbon	O
system	O
is	O
already	O
at	O
version	O
3.x	O
,	O
although	O
the	O
exact	O
Carbon	O
system	O
version	O
is	O
very	O
rarely	O
seen	O
in	O
samples	O
:	O
The	O
author	O
of	O
the	O
Carbon	O
module	O
above	O
can	O
be	O
also	O
seen	O
in	O
the	O
code	O
,	O
as	O
''	O
gilg	O
''	O
,	O
which	O
also	O
authored	O
several	O
other	O
Turla	O
modules	O
.	O
	
We	O
are	O
planning	O
to	O
cover	O
the	O
Turla	O
Carbon	O
system	O
with	O
more	O
details	O
in	O
a	O
future	O
report	O
.	O
	
The	O
payload	O
recovered	O
from	O
one	O
of	O
the	O
mothership	O
servers	O
(	O
at	O
newsforum.servehttp	O
[	O
.	O
	
]	O
com/wordpress/wp-includes/css/img/upload.php	O
,	O
MD5	O
:	O
4dc22c1695d1f275c3b6e503a1b171f5	O
,	O
Compiled	O
:	O
Thu	O
Sep	O
06	O
14:09:55	O
2012	O
)	O
contains	O
two	O
modules	O
,	O
a	O
loader/injector	O
and	O
a	O
backdoor	O
.	O
	
Internally	O
,	O
the	O
backdoor	O
is	O
named	O
''	O
Zagruzchick.dll	O
''	O
:	O
The	O
word	O
''	O
Zagruzchick	O
''	O
means	O
''	O
boot	O
loader	O
''	O
in	O
Russian	O
.	O
	
The	O
Control	O
panel	O
for	O
the	O
Epic	O
motherships	O
also	O
sets	O
the	O
language	O
to	O
codepage	O
''	O
1251	O
''	O
:	O
Codepage	O
1251	O
is	O
commonly	O
used	O
to	O
render	O
Cyrillic	O
characters	O
.	O
	
There	O
are	O
other	O
indications	O
that	O
the	O
attackers	O
are	O
not	O
native	O
English	O
language	O
speakers	O
:	O
The	O
sample	O
e9580b6b13822090db018c320e80865f	O
that	O
was	O
delivered	O
to	O
several	O
Epic	O
victims	O
as	O
an	O
upgraded	O
backdoor	O
,	O
has	O
the	O
compilation	O
code	O
page	O
language	O
set	O
to	O
''	O
LANGRUSSIAN	O
''	O
.	O
	
The	O
threat	O
actor	O
behind	O
the	O
''	O
Epic	O
''	O
operation	O
uses	O
mainly	O
hacked	O
servers	O
to	O
host	O
their	O
proxies	O
.	O
	
The	O
hacked	O
servers	O
are	O
controlled	O
through	O
the	O
use	O
of	O
a	O
PHP	O
webshell	O
.	O
	
This	O
shell	O
is	O
password	O
protected	O
;	O
the	O
password	O
is	O
checked	O
against	O
an	O
MD5	O
hash	O
:	O
The	O
MD5	O
''	O
af3e8be26c63c4dd066935629cf9bac8	O
''	O
has	O
been	O
solved	O
by	O
Kaspersky	O
Lab	O
as	O
the	O
password	O
''	O
kenpachi	O
''	O
.	O
	
In	O
February	O
2014	O
we	O
observed	O
the	O
Miniduke	O
threat	O
actor	O
using	O
the	O
same	O
backdoor	O
on	O
their	O
hacked	O
servers	O
,	O
although	O
using	O
a	O
much	O
stronger	O
password	O
.	O
	
Once	O
again	O
,	O
it	O
is	O
also	O
interesting	O
to	O
point	O
out	O
the	O
usage	O
of	O
Codepage	O
1251	O
in	O
the	O
webshell	O
,	O
which	O
is	O
used	O
to	O
render	O
Cyrillic	O
characters	O
.	O
	
There	O
appears	O
to	O
be	O
several	O
links	O
between	O
Turla	O
and	O
Miniduke	O
,	O
but	O
we	O
will	O
leave	O
that	O
for	O
a	O
future	O
blogpost	O
.	O
	
On	O
some	O
of	O
the	O
C	O
&	O
C	O
servers	O
used	O
in	O
the	O
Epic	O
attacks	O
,	O
we	O
were	O
able	O
to	O
identify	O
detailed	O
victim	O
statistics	O
,	O
which	O
were	O
saved	O
for	O
debugging	O
purposes	O
by	O
the	O
attackers	O
.	O
	
This	O
is	O
the	O
country	O
distribution	O
for	O
the	O
top	O
20	O
affected	O
countries	O
by	O
victim	O
's	O
IP	O
:	O
According	O
to	O
the	O
public	O
information	O
available	O
for	O
the	O
victims	O
'	O
IPs	O
,	O
targets	O
of	O
''	O
Epic	O
''	O
belong	O
to	O
the	O
following	O
categories	O
:	O
When	O
G-Data	O
published	O
their	O
Turla	O
paper	O
,	O
there	O
were	O
few	O
details	O
publicly	O
available	O
on	O
how	O
victims	O
get	O
infected	O
with	O
this	O
malware	O
campaign	O
.	O
	
Our	O
analysis	O
indicates	O
this	O
is	O
a	O
sophisticated	O
multi-stage	O
infection	O
;	O
which	O
begins	O
with	O
Epic	O
Turla	O
.	O
	
This	O
is	O
used	O
to	O
gain	O
a	O
foothold	O
and	O
validate	B-Verb
the	B-Entity
high	I-Entity
profile	I-Entity
victim	I-Entity
.	O
	
If	O
the	O
victim	O
is	O
interesting	O
,	O
they	O
get	O
upgraded	O
to	O
the	O
Turla	O
Carbon	O
system	O
.	O
	
Most	O
recently	O
,	O
we	O
observed	O
this	O
attack	O
against	O
a	O
Kaspersky	O
Lab	O
user	O
on	O
August	O
5	O
,	O
2014	O
,	O
indicating	O
the	O
operation	O
remains	O
fresh	O
and	O
ongoing	O
.	O
	
Note	O
:	O
A	O
full	O
analysis	O
of	O
the	O
Epic	O
attacks	O
is	O
available	O
to	O
the	O
Kaspersky	O
Intelligent	O
Services	O
customers	O
.	O
	
Contact	O
:	O
intelreports	O
@	O
kaspersky.com	O
We	O
would	O
like	O
to	O
add	O
the	O
following	O
at	O
the	O
end	O
of	O
the	O
blogpost	O
,	O
right	O
before	O
the	O
detection	O
names	O
:	O
If	O
you	O
'd	O
like	O
to	O
read	O
more	O
about	O
Turla/Uroburos	O
,	O
here	O
's	O
a	O
few	O
recommendations	O
:	O
Downloaders	O
,	O
injectors	O
,	O
infostealers	O
Example	O
md5s	O
of	O
files	O
detected	O
with	O
Kaspersky	O
's	O
Virus.Win32.Pioneer.dx	O
and	O
Symantec	O
's	O
Infostealer.Nemim	O
!	O
inf	O
:	O
To	O
ensure	O
only	O
single	O
instance	O
of	O
the	O
module	O
is	O
running	O
,	O
the	B-Entity
module	I-Entity
verifies	B-Verb
if	B-Preposition
system	B-Entity
mutex	I-Entity
named	I-Entity
«132DF6E»	I-Entity
exists	I-Entity
.	O
	
If	O
it	O
exists	O
the	O
module	O
exits	O
,	O
if	B-Preposition
not	B-Entity
­the	I-Entity
module	I-Entity
creates	B-Verb
one	B-Entity
.	O
	
The	B-Entity
module	I-Entity
implements	B-Verb
a	B-Entity
method	I-Entity
to	O
resist	O
running	O
in	O
virtual	O
environment	O
.	O
	
It	O
gets	O
CPU	O
name	O
and	O
identifier	O
from	O
the	O
registry	O
at	O
HKLM\HARDWARE\DESCRIPTION\	O
System\CentralProcessor\0	O
and	O
collects	O
IP	O
and	O
MAC	O
addresses	O
of	O
local	O
network	O
adapters	O
.	O
	
After	O
that	O
it	O
compiles	O
a	O
string	O
describing	O
the	O
system	O
in	O
the	O
following	O
format	O
:	O
«	O
C	O
P	O
U	O
:	O
%	O
CPUNAME	O
%	O
<	O
br	O
>	O
Net	O
card	O
:	O
%	O
IP	O
%	O
(	O
%	O
MACADDR	O
%	O
)	O
<	O
br	O
>	O
»	O
.	O
	
Next	O
it	O
checks	O
if	O
this	O
string	O
contains	O
one	O
of	O
the	O
following	O
substrings	O
:	O
If	O
any	O
of	O
these	O
strings	O
is	O
found	O
,	O
the	O
module	O
terminates	O
.	O
	
After	O
that	O
,	O
there	O
is	O
a	O
hardcoded	O
value	O
of	O
10	O
,	O
which	O
delays	O
further	O
execution	O
of	O
the	O
module	O
for	O
10	O
seconds	O
.	O
	
Then	O
the	B-Entity
module	I-Entity
attempts	O
to	O
delete	O
some	O
other	O
,	O
prob-	O
ably	O
older	O
,	O
components	O
which	O
might	O
be	O
present	O
on	O
the	O
system	O
.	O
	
The	O
list	O
of	O
deleted	O
files	O
includes	O
the	O
following	O
:	O
The	O
next	O
is	O
step	O
is	O
to	O
check	O
if	O
current	O
directory	O
has	O
a	O
file	O
named	O
«U»	O
.	O
	
If	O
not	O
,	O
the	B-Entity
module	I-Entity
proceeds	B-Verb
with	B-Preposition
network	B-Entity
communication	I-Entity
routine	I-Entity
.	O
	
But	O
if	O
this	O
file	O
is	O
found	O
it	O
does	O
some	O
additional	O
checks	O
.	O
	
If	O
«U»	O
file	O
is	O
older	O
than	O
180	O
days	O
,	O
the	B-Entity
module	I-Entity
wipes	B-Verb
the	B-Entity
file	I-Entity
.	O
	
If	O
not	O
,	O
it	O
triggers	O
a	O
special	O
variable	O
that	O
makes	O
module	O
dormant	O
and	O
dis-	O
ables	B-Verb
further	B-Entity
communication	I-Entity
with	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
.	O
	
After	O
all	O
,	O
if	O
the	O
module	O
is	O
ready	O
and	O
allowed	O
to	O
communicate	B-Verb
with	B-Preposition
C	B-Entity
&	I-Entity
C	I-Entity
server	I-Entity
it	B-Entity
does	B-Verb
that	O
in	O
the	O
following	O
manner	O
.	O
	
1	O
.	O
	
The	B-Entity
module	I-Entity
connects	B-Verb
to	B-Preposition
autolace.twilightparadox.com	B-Entity
(	I-Entity
or	I-Entity
automachine	I-Entity
.	I-Entity
servequake.com	I-Entity
)	I-Entity
and	O
issues	B-Verb
a	B-Entity
HTTP	I-Entity
GET	I-Entity
request	I-Entity
with	B-Preposition
hardcoded	B-Entity
User­Agent	I-Entity
string	I-Entity
:	O
The	O
server	O
response	O
should	O
contain	O
«DEXT87»	O
string	O
which	O
is	O
used	O
to	O
rec-	O
ognize	O
valid	O
response	O
.	O
	
The	B-Entity
malware	I-Entity
locates	B-Verb
«DEXT87»	B-Entity
and	O
reads	B-Verb
the	B-Entity
data	I-Entity
appended	I-Entity
to	I-Entity
it	I-Entity
.	O
	
The	O
appended	O
data	O
should	O
be	O
an	O
IP	O
address	O
in	O
plaintext	O
.	O
	
This	O
is	O
used	O
a	O
real	O
C	O
&	O
C	O
IP	O
address	O
.	O
	
Reading	O
stops	O
when	O
non­digit	O
or	O
dot	O
symbol	O
is	O
found	O
.	O
	
Here	O
is	O
an	O
example	O
of	O
shortest	O
possible	O
valid	O
server	O
response	O
:	O
2	O
.	O
	
If	O
the	O
real	O
C	O
&	O
C	O
IP	O
address	O
is	O
not	O
valid	O
the	O
module	O
may	O
try	B-Verb
to	B-Preposition
send	B-Entity
identical	I-Entity
request	I-Entity
again	O
but	O
using	O
a	O
different	O
HTTP	O
path	O
:	O
If	O
the	O
C	O
&	O
C	O
IP	O
address	O
is	O
valid	O
,	O
the	O
module	O
issues	O
another	O
HTTP	O
request	O
:	O
The	O
server	O
response	O
can	O
be	O
one	O
of	O
the	O
following	O
:	O
Where	O
<	O
DATASIZE	O
>	O
is	O
a	O
decimal	O
integer	O
that	O
represents	O
length	O
of	O
<	O
DATA	O
>	O
field	O
in	O
bytes;	O
<	O
DATA	O
>	O
is	O
a	O
binary	O
data	O
separated	O
from	O
<	O
DATASIZE	O
>	O
field	O
by	O
semicolon	O
.	O
	
Please	O
note	O
,	O
that	O
after	O
receiving	O
<	O
DATA	O
>	O
,	O
it	O
is	O
XORed	O
with	O
byte	O
value	O
0x55	O
and	O
saved	B-Verb
to	B-Preposition
a	B-Entity
disk	I-Entity
in	I-Entity
a	I-Entity
file	I-Entity
named	I-Entity
«ctfmon.exe»	I-Entity
(	I-Entity
current	I-Entity
directory	I-Entity
is	O
used	O
)	O
.	O
	
Upon	O
successful	O
receiving	O
of	O
the	O
file	O
it	B-Entity
is	B-Verb
started	I-Verb
in	B-Preposition
a	B-Entity
new	I-Entity
process	I-Entity
.	O
	
This	O
module	O
is	O
relatively	O
large	O
(	O
455Kb	O
)	O
and	O
comes	B-Verb
as	B-Preposition
a	B-Entity
part	I-Entity
of	I-Entity
WinRar	I-Entity
SFX	I-Entity
file	I-Entity
that	O
drops	B-Verb
and	I-Verb
starts	I-Verb
the	B-Entity
module	I-Entity
from	B-Preposition
%	B-Entity
APPDATA	I-Entity
%	I-Entity
\Microsoft\Display\DmaUp3	I-Entity
.	I-Entity
exe	I-Entity
.	O
	
The	B-Entity
main	I-Entity
purpose	I-Entity
of	I-Entity
the	I-Entity
module	I-Entity
is	O
to	O
collect	O
various	O
secrets	O
stored	O
on	O
a	O
local	O
system	O
.	O
	
This	B-Entity
module	I-Entity
is	O
designed	O
not	O
to	O
run	O
on	O
Windows	O
with	O
system	O
default	O
codepage	O
set	O
to	O
Korean	O
.	O
	
From	O
the	O
very	O
beginning	O
this	O
module	O
checks	O
if	O
«bdagent.exe»	O
process	O
is	O
running	O
on	O
current	O
system	O
.	O
	
Bdagent.exe	O
is	O
a	O
name	O
for	O
BitDefender	O
Antivirus	O
component	O
.	O
	
If	O
it	O
is	O
running	O
,	O
it	B-Entity
uses	B-Verb
simple	B-Entity
AV	I-Entity
heuristics	I-Entity
evasion	I-Entity
technique	I-Entity
.	O
	
The	O
code	O
starts	O
a	O
thread	O
that	O
simulates	B-Verb
keystrokes	B-Entity
of	I-Entity
ESC	I-Entity
keyboard	I-Entity
key	I-Entity
and	O
then	O
shows	O
a	O
system	O
modal	O
message	O
box	O
.	O
	
Pushing	O
ESC	O
key	O
closes	O
the	O
modal	O
message	O
box	O
.	O
	
Right	O
after	O
that	O
keystroke	O
generation	O
thread	O
is	O
terminated	O
and	O
the	O
module	O
continues	O
normal	O
execution	O
as	O
if	O
«bdagent.exe»	O
was	O
not	O
running	O
.	O
	
Next	O
the	O
module	O
makes	O
sure	O
only	O
one	O
instance	O
of	O
current	O
code	O
is	O
running	O
by	O
checking	O
if	O
system	O
mutex	O
object	O
named	O
«920111215»	O
exists	O
.	O
	
After	O
that	O
,	O
the	O
mod-	O
ule	O
collects	O
information	O
about	O
current	O
system	O
which	O
includes	O
the	O
following	O
:	O
If	O
the	O
module	O
reveals	O
that	O
current	O
System	O
default	O
codepage	O
is	O
0412	O
(	O
Korean	O
)	O
it	O
terminates	O
.	O
	
There	O
is	O
one	O
interesting	O
specifics	O
in	O
Microsoft	O
IntelliForms	O
which	O
reveals	O
attack-	O
er	O
's	O
interests	O
.	O
	
IntelliForms	O
technology	O
keeps	O
login/password	O
information	O
in	O
the	O
registry	O
in	O
encrypted	O
form	O
.	O
	
However	O
,	O
there	O
is	O
no	O
clear	O
information	O
about	O
the	O
corre-	O
sponding	O
website	O
which	O
requires	O
given	O
login	O
and	O
password	O
.	O
	
The	O
only	O
information	O
Intelliforms	O
offers	O
about	O
the	O
place	O
where	O
given	O
login/password	O
should	O
be	O
used	O
is	O
a	O
hash	O
of	O
the	O
webpage	O
URL	O
.	O
	
So	O
far	O
,	O
the	B-Entity
attackers	I-Entity
can	O
steal	O
logins	O
and	O
pass-	O
words	O
but	O
to	O
understand	O
where	O
they	O
are	O
from	O
they	O
must	O
guess	O
the	O
string	O
which	O
produced	O
given	O
hash	O
.	O
	
They	O
have	O
implemented	O
this	O
logics	O
in	O
the	O
malware	O
.	O
	
When	O
IntelliForms	O
information	O
is	O
stolen	O
the	O
malware	O
tries	O
to	O
check	O
the	O
list	O
of	O
known	O
login	O
page	O
URLs	O
to	O
recover	O
the	O
originating	O
webpage	O
address	O
.	O
	
Here	O
is	O
the	O
list	O
of	O
URLs	O
that	O
are	O
checked	O
by	O
the	O
malware	O
:	O
The	O
list	O
of	O
targeted	O
services	O
includes	O
some	O
local	O
services	O
specifically	O
popular	O
in	O
:	O
The	B-Entity
module	I-Entity
uses	B-Verb
several	B-Entity
simple	I-Entity
XOR­based	I-Entity
algorithms	I-Entity
to	O
encrypt	O
embedded	O
string	O
data	O
.	O
	
String	O
encryption/decryption	O
functions	O
use	O
the	O
following	O
keys	O
:	O
The	O
module	O
works	O
with	O
all	O
Firefox	O
versions	O
prior	O
to	O
Mozilla	O
Firefox	O
12.0	O
.	O
	
Depend-	O
ing	O
on	O
version	O
of	O
Firefox	O
,	O
it	O
can	O
read	O
Firefox	O
database	O
directly	O
to	O
dump	O
stored	O
se-	O
crets	O
or	O
utilize	O
one	O
Firefox	O
libraries	O
to	O
access	O
the	O
configuration	O
data	O
.	O
	
In	O
addition	O
it	O
makes	O
use	O
of	O
the	O
following	O
Mozilla	O
Firefox	O
libraries	O
depending	O
on	O
Firefox	O
version	O
:	O
When	O
stealing	O
secrets	O
from	O
Firefox	O
and	O
Chrome	O
it	O
uses	O
built­in	O
SQLite	O
library	O
code	O
.	O
	
The	O
module	O
is	O
linked	O
with	O
SQLite	O
version	O
3.7.5	O
release	O
candidate	O
2	O
,	O
release	O
hash	O
ed759d5a9edb3bba5f48f243df47be29e3fe8cd7	O
dated	O
as	O
2011­01­28	O
17:03:50	O
.	O
	
After	O
stealing	B-Verb
secrets	B-Entity
from	I-Entity
local	I-Entity
system	I-Entity
the	I-Entity
malware	I-Entity
executes	B-Verb
some	B-Entity
kind	I-Entity
of	I-Entity
embedded	I-Entity
script	I-Entity
.	O
	
It	O
is	O
logging	O
all	O
actions	O
to	O
inform	O
the	O
operator	O
what	O
exactly	O
was	O
executed	O
by	O
this	O
variant	O
of	O
the	O
malware	O
.	O
	
The	O
result	O
of	O
this	O
execution	O
is	O
appended	O
to	O
the	O
stolen	O
data	O
and	O
uploaded	B-Verb
to	B-Preposition
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
.	O
	
The	B-Entity
module	I-Entity
uploads	B-Verb
all	B-Entity
collected	I-Entity
information	I-Entity
to	B-Preposition
one	B-Entity
of	I-Entity
the	I-Entity
following	I-Entity
URLs	I-Entity
via	B-Preposition
POST	B-Entity
request	I-Entity
:	O
It	O
's	O
the	O
first	O
time	O
we	O
see	O
.pn	O
	
domain	O
used	O
in	O
malware	O
.	O
	
This	O
top	O
level	O
country	O
code	O
domain	O
is	O
quite	O
exotic	O
and	O
is	O
assigned	O
to	O
Pitcairn	O
Islands	O
,	O
which	O
is	O
Overseas	O
ter-	O
ritory	O
of	O
the	O
United	O
Kingdom	O
in	O
the	O
Pacific	O
.	O
	
As	O
of	O
2013	O
estimated	O
population	O
of	O
Pitcairn	O
Islands	O
is	O
only	O
56	O
people	O
.	O
	
An	O
official	O
.pn	O
	
domain	O
costs	O
$	O
100/year	O
from	O
the	O
registry	O
,	O
however	O
.eu.pn	O
	
domains	O
seem	O
to	O
be	O
given	O
away	O
for	O
free	O
.	O
	
The	O
malware	O
uses	O
fixed	O
User­Agent	O
string	O
:	O
The	B-Entity
data	I-Entity
is	B-Verb
uploaded	I-Verb
as	B-Preposition
a	B-Entity
POST	I-Entity
request	I-Entity
binary	O
in	O
the	O
following	O
format	O
:	O
where	O
<	O
UserId	O
>	O
is	O
hardcoded	O
identifier	O
(	O
i.e	O
.	O
	
«user2»	O
in	O
current	O
sample	O
)	O
;	O
<	O
UniqueMachineId	O
>	O
is	O
a	O
32	O
characters	O
long	O
hex	O
string	O
which	O
derived	O
from	O
net-	O
work	O
card	O
MAC	O
address;	O
<	O
EncryptionKey	O
>	O
is	O
symmetrical	O
encryption	O
key	O
used	O
to	O
encrypt	O
<	O
UserId	O
>	O
and	O
<	O
GeneralSysInfo	O
>	O
values	O
.	O
	
The	O
malware	O
uses	O
text	O
protocol	O
,	O
which	O
is	O
why	O
potentially	O
binary	O
values	O
of	O
<	O
UserId	O
>	O
and	O
<	O
GeneralSysInfo	O
>	O
are	O
ad-	O
ditionally	O
encoded	O
using	O
Base64	O
algorithm	O
.	O
	
<	O
GeneralSysInfo	O
>	O
field	O
contains	O
only	O
basic	O
information	O
about	O
the	O
system	O
,	O
i.e	O
.	O
	
:	O
If	O
the	O
server	O
reply	O
contains	O
a	O
keyword	O
«minmei»	O
it	O
continues	O
sending	O
additional	O
in-	O
formation	O
.	O
	
«Minmei»	O
may	O
be	O
a	O
reference	O
to	O
a	O
popular	O
Japanese	O
anime	O
and	O
manga	O
known	O
as	O
«The	O
Super	O
Dimension	O
Fortress	O
Macross»	O
.	O
	
A	O
quote	O
from	O
Wikipedia	O
:	O
«Born	O
in	O
Yokohama	O
Chinatown	O
,	O
Japan	O
(	O
though	O
she	O
is	O
of	O
partial	O
Chinese	O
descent	O
)	O
as	O
Linn	O
Minmei	O
,	O
Minmay	O
moved	O
in	O
with	O
her	O
uncle	O
Shaochin	O
(	O
少江	O
)	O
and	O
aunt	O
Feic-	O
hun	O
(	O
慧中	O
)	O
on	O
South	O
Ataria	O
Island	O
in	O
hopes	O
of	O
finding	O
the	O
path	O
to	O
fulfill	O
her	O
dream	O
of	O
becoming	O
a	O
star.»	O
The	O
trojan	O
iterates	O
through	O
running	O
processes	O
and	O
looks	O
for	O
security	O
software	O
basing	O
on	O
executable	O
filenames	O
from	O
the	O
list	O
below	O
.	O
	
If	O
the	O
process	O
is	O
found	O
it	O
keeps	O
a	O
record	O
of	O
the	O
software	O
name	O
using	O
short	O
AV	O
Identifier	O
string	O
from	O
the	O
fol-	O
lowing	O
table	O
of	O
rules	O
The	O
malware	O
uses	O
a	O
trick	O
to	O
evade	O
running	O
on	O
a	O
VMware	O
.	O
	
First	O
,	O
it	O
checks	O
if	O
cur-	O
rent	O
process	O
is	O
running	O
in	O
WOW64	O
environment	O
.	O
	
If	O
yes	O
it	O
does	O
additional	O
port	O
I/O	O
specific	O
to	O
VMWare	O
virtual	O
machine	O
(	O
the	O
VMware	O
hypervisor	O
port	O
:	O
0x5658;	O
VMware	O
hypervisor	O
magic	O
value	O
:	O
0x564D5868	O
)	O
.	O
	
Another	B-Entity
method	I-Entity
to	I-Entity
detect	I-Entity
VM	I-Entity
en-	I-Entity
vironment	I-Entity
is	O
to	O
check	O
local	O
network	O
adapter	O
's	O
IP	O
address	O
.	O
	
If	O
it	O
belongs	O
to	O
subnet	O
192.168.100	O
.	O
	
*	O
then	O
the	O
malware	O
believes	O
it	O
's	O
running	O
in	O
a	O
VM	O
.	O
	
If	O
VM	O
is	O
detected	O
the	O
process	O
instantly	O
terminates	O
.	O
	
Next	O
the	B-Entity
malware	I-Entity
submits	I-Entity
collected	I-Entity
information	I-Entity
to	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
using	B-Verb
HTTP	B-Entity
GET	I-Entity
request	I-Entity
and	O
the	O
following	O
URL	O
format	O
:	O
http	O
:	O
//	O
<	O
C2DOMAIN	O
>	O
/bin/readi.php	O
?	O
a1=	O
%	O
STEPID	O
%	O
&	O
a2=	O
%	O
HOSTID	O
%	O
&	O
a3=	O
%	O
SYSINFO	O
%	O
&	O
a4=	O
%	O
AVSOFTID	O
%	O
,	O
where	O
%	O
C2DOMAIN	O
%	O
is	O
one	O
of	O
the	O
following	O
C	O
&	O
C	O
domains	O
:	O
%	O
STEPID	O
%	O
is	O
special	O
text	O
string	O
indicating	O
stage	O
of	O
malware	O
operation	O
.	O
	
This	O
string	O
varies	O
depending	O
on	O
the	O
local	O
system	O
language	O
and	O
may	O
be	O
one	O
of	O
the	O
following	O
:	O
%	O
HOSTID	O
%	O
is	O
a	O
special	O
value	O
generated	O
from	O
local	O
network	O
card	O
MAC	O
address;	O
%	O
SYSINFO	O
%	O
is	O
a	O
string	O
with	O
general	O
system	O
information	O
(	O
please	O
see	O
description	O
above	O
)	O
;	O
%	O
AVSOFTID	O
%	O
is	O
a	O
string	O
that	O
contains	O
indexes	O
of	O
AV	O
software	O
names	O
in	O
internal	O
table	O
of	O
AV	O
Identifiers	O
(	O
please	O
see	O
the	O
table	O
above	O
)	O
.	O
	
Igfxext.exe	O
can	O
download	B-Verb
a	B-Entity
file	I-Entity
and	O
drop	B-Verb
it	B-Entity
to	B-Preposition
%	B-Entity
APPDATA	I-Entity
%	I-Entity
\microsoft\dis-	I-Entity
play\ctfmon.exe	I-Entity
(	I-Entity
md5=	I-Entity
e8bfb82b0dd5cef46116d61f62c25060	I-Entity
)	I-Entity
.	O
	
After	O
execution	O
,	O
the	B-Entity
downloaded	I-Entity
file	I-Entity
drops	B-Verb
SMAGENT.EXE	B-Entity
(	I-Entity
md5	I-Entity
0306f9ae-	I-Entity
7786570139f78e78bc940597	I-Entity
)	I-Entity
to	B-Preposition
%	B-Entity
APPDATA	I-Entity
%	I-Entity
\MICROSOFT\DISPLAY	I-Entity
and	I-Entity
ex-	I-Entity
ecutes	I-Entity
it	I-Entity
.	O
	
This	O
component	O
is	O
a	O
virus	O
,	O
and	O
is	O
used	O
to	O
selectively	O
infiltrate	B-Verb
into	B-Preposition
other	B-Entity
computers	I-Entity
via	B-Preposition
USB	B-Entity
or	I-Entity
network	I-Entity
shares	I-Entity
.	O
	
A	O
large	O
number	O
of	O
files	O
are	O
detected	O
by	O
Kaspersky	O
Lab	O
scanners	O
as	O
Virus.Win32	O
.	O
	
Pioneer.dx	O
.	O
	
These	O
files	O
are	O
all	O
legitimate	O
files	O
that	O
have	O
been	O
infected	O
by	O
another	O
Darkhotel	O
component	O
.	O
	
All	B-Entity
of	I-Entity
these	I-Entity
infected	I-Entity
files	I-Entity
drop	B-Verb
a	B-Entity
63kb	I-Entity
self	I-Entity
injecting	I-Entity
compo-	I-Entity
nent	I-Entity
.	O
	
This	B-Entity
malware	I-Entity
is	O
63kb	O
in	O
size	O
.	O
	
It	B-Entity
is	B-Verb
bound	I-Verb
to	B-Preposition
a	B-Entity
variety	I-Entity
of	I-Entity
other	I-Entity
software	I-Entity
packages	I-Entity
that	I-Entity
vary	I-Entity
in	I-Entity
name	I-Entity
,	O
but	O
the	O
host	O
package	O
is	O
consistently	O
detected	O
as	O
''	O
Virus.Win32	O
.	O
	
Pioneer.dx	O
''	O
.	O
	
The	B-Entity
igfxext.exe	I-Entity
component	I-Entity
is	B-Verb
dropped	I-Verb
to	B-Preposition
disk	B-Entity
and	I-Entity
run	I-Entity
.	O
	
It	O
spawns	O
an-	O
other	O
suspended	O
process	O
with	O
its	O
own	O
igfxext.exe	O
image	O
,	O
but	O
decrypts	O
a	O
smaller	O
32kb	O
executable	O
(	O
cf1319d94f33380622ba000b7d8ad6e9	O
,	O
Trojan­Downloader	O
.	O
	
Win32.Agent.xwge	O
)	O
from	O
its	O
.data	O
	
section	O
in	O
memory	O
with	O
a	O
simple	O
xor	O
0xbb	O
.	O
	
The	O
running	O
process	O
overwrites	O
the	O
igfxext.exe	O
image	O
in	O
the	O
suspended	O
process	O
with	O
this	O
smaller	O
chunk	O
of	O
code	O
.	O
	
It	O
then	O
resumes	O
the	O
thread	O
in	O
the	O
new	O
process	O
.	O
	
This	O
smaller	O
code	O
section	O
maintains	O
similar	O
functionality	O
to	O
the	O
''	O
worm	O
''	O
compo-	O
nent	O
:	O
Host	O
package	O
files	O
detected	O
as	O
''	O
Virus.Win32.Pioneer.dx	O
''	O
are	O
infected	O
legitimate	O
files	O
,	O
that	O
do	O
not	O
have	O
any	O
self­propagation	O
routines	O
.	O
	
It	O
is	O
signed	O
with	O
the	O
familiar	O
''	O
''	O
digital	O
certificate	O
.	O
	
This	O
sample	O
is	O
started	O
by	O
code	O
running	O
within	O
svchost.exe	O
on	O
WinXP	O
SP3	O
.	O
	
It	B-Entity
drops	B-Verb
a	B-Entity
keylogger	I-Entity
.	O
	
The	O
debug	O
path	O
inside	O
:	O
The	O
dropper	O
above	O
maintains	O
,	O
drops	B-Verb
and	O
installs	O
this	O
kernel	O
mode	O
keylogger	O
:	O
Likely	O
,	O
it	O
was	O
developed	O
as	O
a	O
part	O
of	O
a	O
mid­to­late	O
2009	O
project	O
:	O
This	O
driver	O
package	O
is	O
built	O
to	O
look	B-Verb
like	B-Preposition
a	B-Entity
legitimate	I-Entity
low	I-Entity
level	I-Entity
Microsoft	I-Entity
system	I-Entity
device	I-Entity
.	O
	
It	B-Entity
is	B-Verb
installed	I-Verb
as	B-Preposition
a	B-Entity
system	I-Entity
kernel	I-Entity
driver	I-Entity
''	I-Entity
Ndiskpro	I-Entity
''	I-Entity
service	I-Entity
,	O
described	O
as	O
a	O
''	O
Microcode	O
Update	O
Device	O
''	O
.	O
	
It	O
is	O
somewhat	O
surprising	O
that	O
there	O
is	O
no	O
rootkit	O
functionality	O
hiding	O
this	O
service	O
:	O
When	O
loaded	O
,	O
the	O
NDISKPRO.SYS	O
driver	O
hooks	O
both	O
INT	O
0x01	O
and	O
INT	O
0xff	O
,	O
and	O
retrieves	B-Verb
keystroke	B-Entity
data	I-Entity
directly	O
from	O
port	O
0x60	O
,	O
the	O
motherboard	O
keyboard	O
con-	O
troller	O
itself	O
.	O
	
Here	O
we	O
see	O
the	O
local	O
port	O
variables	O
assigned	O
values	O
And	O
here	O
,	O
the	O
ports	O
are	O
directly	O
being	O
read	O
with	O
READPORTUCHAR	O
(	O
0x64	O
)	O
and	O
then	O
READPORTUCHAR	O
(	O
0x60	O
)	O
:	O
It	O
buffers	O
,	O
then	O
communicates	B-Verb
the	B-Entity
data	I-Entity
to	O
the	O
running	O
user	O
mode	O
component	O
.	O
	
This	O
component	O
then	O
encrypts	B-Verb
and	O
writes	O
the	O
retrieved	O
values	O
ondisk	O
to	O
a	O
ran-	O
domly	O
named	O
.tmp	O
,	O
file	O
like	O
ffffz07131101.tmp	O
.	O
	
This	O
file	O
is	O
located	O
in	O
the	O
same	O
directory	O
as	O
the	O
original	O
dropper	O
,	O
which	O
maintains	O
persistence	O
across	O
reboots	O
with	O
a	O
simple	O
addition	O
to	O
the	O
HKCU	O
run	O
key	O
.	O
	
Here	O
is	O
debug	O
output	O
demonstrating	O
this	O
component	O
's	O
data	O
retrieval	O
when	O
the	O
letter	O
''	O
D	O
''	O
is	O
repeatedly	O
pressed	O
on	O
the	O
keyboard	O
.	O
	
Keyscan	O
make	O
and	O
break	O
codes	O
are	O
''	O
0x20	O
''	O
and	O
''	O
0xA0	O
''	O
and	O
for	O
the	O
key	O
press	O
and	O
key	O
release	O
for	O
the	O
''	O
D	O
''	O
key	O
.	O
	
The	O
''	O
0x1D	O
''	O
value	O
from	O
port	O
0x64	O
that	O
you	O
see	O
below	O
is	O
basically	O
an	O
indication	O
that	O
the	O
output	O
buffer	O
is	O
full	O
and	O
the	O
keyboard	O
is	O
locked	O
,	O
so	O
it	O
is	O
safe	O
for	O
the	O
driver	O
to	O
access	O
the	O
key	O
value	O
in	O
port	O
0x60	O
:	O
These	O
debug	O
messages	O
and	O
code	O
style	O
are	O
duplicates	O
of	O
what	O
chpie	O
posted	O
in	O
the	O
past	O
.	O
	
This	B-Entity
keylogger	I-Entity
module	I-Entity
encrypts	I-Entity
and	I-Entity
stores	I-Entity
gathered	B-Verb
data	B-Entity
in	B-Preposition
a	B-Entity
log	I-Entity
file	I-Entity
,	O
as	O
men-	O
tioned	O
previously	O
.	O
	
Its	O
encryption	O
algorithm	O
is	O
similar	O
to	O
RC4	O
.	O
	
Interesting	O
part	O
is	O
that	O
the	B-Entity
module	I-Entity
randomly	O
generates	O
the	O
key	O
and	O
stores	O
it	O
in	O
an	O
unexpected	O
place	O
:	O
in	O
the	O
middle	O
of	O
the	O
log	O
file	O
name	O
.	O
	
Hence	O
,	O
the	O
numeric	O
part	O
of	O
the	O
filename	O
is	O
used	O
as	O
a	O
seed	O
for	O
the	O
pseudorandom	O
number	O
generator	O
.	O
	
Rand	O
function	O
is	O
statically	O
linked	O
to	O
insure	O
same	O
results	O
on	O
different	O
computers	O
.	O
	
Here	O
is	O
the	O
commented	O
RC4	O
encryption	O
code	O
:	O
In	O
this	O
day	O
and	O
age	O
of	O
interconnected	O
cloud	O
services	O
and	O
distributed	O
content	O
delivery	O
networks	O
(	O
CDNs	O
)	O
,	O
it	O
is	O
important	O
for	O
both	O
CDN	O
service	O
providers	O
and	O
security	O
professionals	O
alike	O
to	O
recognize	O
and	O
understand	O
the	O
risks	O
that	O
these	O
systems	O
can	O
introduce	O
within	O
an	O
modern	O
enterprise	O
.	O
	
For	O
organizations	O
within	O
both	O
public	O
and	O
private	O
sectors	O
that	O
leverage	O
CDN	O
platforms	O
to	O
dynamically	O
deliver	O
web	O
content	O
,	O
it	O
is	O
important	O
that	O
the	O
content	O
is	O
also	O
routinely	O
monitored	O
.	O
	
Otherwise	O
,	O
malicious	O
third-party	O
content	O
can	O
be	B-Verb
loaded	I-Verb
into	B-Preposition
a	B-Entity
target	I-Entity
organization	I-Entity
's	I-Entity
website	I-Entity
without	B-Preposition
their	B-Entity
knowledge	I-Entity
,	O
delivering	O
untold	O
risks	O
to	O
unwitting	O
visitors	O
.	O
	
The	O
ThreatConnect	O
Intelligence	O
Research	O
Team	O
(	O
TCIRT	O
)	O
recently	O
observed	O
a	O
targeted	O
cross-site	O
scripting	O
(	O
XSS	O
)	O
''	O
drive-by	O
''	O
attack	O
that	O
leveraged	O
a	O
single	O
content	O
delivery	O
network	O
resource	O
to	O
distribute	O
a	O
malicious	O
Java	O
applet	O
via	O
nearly	O
all	O
of	O
the	O
major	O
official	O
Government	O
of	O
Afghanistan	O
websites	O
.	O
	
The	O
compromised	O
CDN	O
resource	O
in	O
question	O
is	O
a	O
JavaScript	O
file	O
hosted	O
at	O
[	O
http	O
:	O
]	O
//cdn.afghanistan	O
[	O
.	O
	
]	O
af/scripts/gop-script.js	O
The	O
domain	O
cdn.afghanistan	O
[	O
.	O
	
]	O
af	O
is	O
a	O
legitimate	O
CDN	O
site	O
used	O
by	O
the	O
Afghan	O
Ministry	O
of	O
Communications	O
and	O
IT	O
(	O
MCIT	O
)	O
to	O
host	O
web	O
content	O
that	O
is	O
displayed	O
and	O
used	O
on	O
many	O
official	O
gov.af	O
websites	O
.	O
	
The	O
javascript	O
URL	O
(	O
[	O
http	O
:	O
]	O
//cdn.afghanistan	O
[	O
.	O
	
]	O
af/scripts/gop-script.js	O
)	O
is	O
called	O
from	O
numerous	O
official	O
Afghan	O
Government	O
websites	O
,	O
including	O
the	O
following	O
:	O
It	O
is	O
likely	O
that	O
this	O
javascript	O
URL	O
itself	O
is	O
normally	O
legitimate	O
,	O
but	O
the	B-Entity
attackers	I-Entity
obtained	B-Verb
access	B-Entity
to	I-Entity
the	I-Entity
file	I-Entity
and	O
prepended	O
the	O
following	O
malicious	O
JavaScript	O
functions	O
to	O
the	O
beginning	O
of	O
the	O
script	O
:	O
Note	O
that	O
the	O
gov.af	O
websites	O
would	O
not	O
need	O
to	O
be	O
compromised	O
individually	O
for	O
this	O
attack	O
to	O
be	B-Verb
delivered	I-Verb
to	B-Preposition
visitors	B-Entity
of	I-Entity
the	I-Entity
sites	I-Entity
,	O
because	O
it	B-Entity
is	B-Verb
the	B-Entity
backend	I-Entity
CDN	I-Entity
infrastructure	I-Entity
that	I-Entity
is	I-Entity
serving	I-Entity
up	I-Entity
the	I-Entity
malicious	I-Entity
script	I-Entity
.	O
	
Judging	O
by	O
the	O
last	O
modified	O
timestamp	O
on	O
the	O
HTTP	O
response	O
of	O
gop-script.js	O
,	O
which	O
is	O
Tue	O
,	O
16	O
Dec	O
2014	O
08:07:06	O
GMT	O
,	O
this	O
malicious	O
CDN	O
compromise	O
was	O
very	O
recent	O
in	O
nature	O
.	O
	
In	O
fact	O
,	O
it	O
occurred	O
on	O
the	O
very	O
same	O
day	O
that	O
China	O
's	O
Prime	O
Minister	O
Li	O
Keqiang	O
would	O
meet	O
with	O
Abdullah	O
Abdullah	O
,	O
the	O
Chief	O
Executive	O
Officer	O
of	O
Afghanistan	O
in	O
Astana	O
Kazakhstan	O
,	O
they	O
would	O
discuss	O
infrastructure	O
development	O
and	O
bilateral	O
cooperation	O
issues	O
.	O
	
Looking	O
at	O
the	O
EXIF	O
metadata	O
of	O
the	O
image	O
of	O
Keqiang	O
meeting	O
with	O
Abdullah	O
that	O
is	O
hosted	O
on	O
the	O
Chinese	O
embassy	O
website	O
we	O
note	O
a	O
Tue	O
,	O
16	O
December	O
2014	O
07:43:31	O
modify	O
time	O
as	O
well	O
as	O
the	O
www.news	O
[	O
.	O
	
]	O
cn	O
watermark	O
in	O
the	O
bottom	O
righthand	O
corner	O
.	O
	
This	O
indicates	O
that	O
the	O
image	O
of	O
Keqiang	O
and	O
Abdullah	O
was	O
likely	O
taken	O
and	O
edited	O
sometime	O
prior	O
to	O
07:43:31	O
.	O
	
While	O
it	O
is	O
ambiguous	O
as	O
to	O
which	O
timezone	O
the	O
edits	O
actually	O
took	O
place	O
in	O
(	O
Kazakhstan	O
or	O
China	O
)	O
we	O
assume	O
the	O
date	O
timestamp	O
references	O
GMT	O
because	O
the	O
press	O
release	O
states	O
''	O
In	O
the	O
afternoon	O
of	O
December	O
15	O
local	O
time…	O
''	O
If	O
we	O
assume	O
the	O
photograph	O
and	O
afternoon	O
meeting	O
took	O
place	O
sometime	O
prior	O
to	O
13:43	O
Alma-Ata	O
standard	O
time	O
(	O
+0600	O
)	O
this	O
would	O
closely	O
correspond	O
with	O
a	O
07:43	O
GMT	O
time	O
stamp	O
.	O
	
The	O
modification	O
of	O
the	O
gop-script.js	O
by	O
the	O
attackers	O
at	O
08:07:06	O
GMT	O
likely	O
tracks	O
extremely	O
close	O
to	O
a	O
window	O
of	O
a	O
few	O
hours	O
in	O
which	O
Keqiang	O
met	O
with	O
Abdullah	O
.	O
	
It	O
is	O
worth	O
mentioning	O
that	O
a	O
similar	O
scenario	O
occurred	O
on	O
June	O
20th	O
when	O
security	O
researcher	O
PhysicalDrive0	O
observed	O
a	O
malicious	O
Java	O
file	O
hosted	O
on	O
the	O
Embassy	O
of	O
Greece	O
in	O
Beijing	O
.	O
	
At	O
the	O
time	O
,	O
a	O
Chinese	O
delegation	O
led	O
by	O
Keqiang	O
was	O
visiting	O
Greek	O
Prime	O
Minister	O
Antonis	O
Samaras	O
in	O
Athens	O
.	O
	
Security	O
researcher	O
R136a1	O
aka	O
''	O
thegoldenmessenger	O
''	O
released	O
a	O
followup	O
blog	O
with	O
detailed	O
analysis	O
of	O
the	O
Greek	O
embassy	O
compromise	O
.	O
	
While	O
these	O
two	O
separate	O
events	O
are	O
not	O
directly	O
related	O
,	O
additional	O
research	O
into	O
the	O
status	O
of	O
ministerial	O
and	O
official	O
government	O
websites	O
on	O
or	O
around	O
the	O
dates	O
of	O
notable	O
Chinese	O
delegations	O
and	O
or	O
bilateral	O
meetings	O
may	O
yield	O
additional	O
patterns	O
of	O
interest	O
.	O
	
Upon	O
closer	O
inspection	O
of	O
the	O
prepended	O
malicious	O
JavaScript	O
code	O
,	O
one	O
will	O
notice	O
the	O
similarity	O
in	O
the	O
update.javaplug-in	O
[	O
.	O
	
]	O
com	O
naming	O
convention	O
and	O
URL	O
structure	O
to	O
the	O
C2	O
domain	O
java-se	O
[	O
.	O
	
]	O
com	O
found	O
in	O
the	O
Palo	O
Alto	O
Networks	O
blog	O
post	O
Attacks	O
on	O
East	O
Asia	O
using	O
Google	O
Code	O
for	O
Command	O
and	O
Control	O
and	O
associated	O
with	O
Operation	O
Poisoned	O
Hurricane	O
.	O
	
However	O
,	O
the	O
malicious	O
document.write	O
driveby	O
URLs	O
listed	O
above	O
both	O
result	O
in	O
403	O
Forbidden	O
errors	O
as	O
of	O
December	O
18	O
,	O
2014	O
.	O
	
While	O
the	O
403	O
Forbidden	O
errors	O
may	O
seem	O
like	O
an	O
analytic	O
dead	O
end	O
,	O
the	O
TCIRT	O
also	O
identified	O
a	O
malicious	O
Java	O
applet	O
submission	O
to	O
VirusTotal	O
that	O
confirms	O
the	O
nature	O
of	O
this	O
malicious	O
activity	O
.	O
	
This	O
Java	O
applet	O
,	O
SHA1	O
:	O
388E6F41462774268491D1F121F333618C6A2C9A	O
,	O
has	O
no	O
antivirus	O
detections	O
as	O
of	O
December	O
21st	O
.	O
	
The	O
applet	O
contains	O
its	O
malicious	O
class	O
file	O
at	O
the	O
path	O
''	O
jre7u61windows/x86/Update.class	O
''	O
.	O
	
This	B-Entity
class	I-Entity
file	I-Entity
downloads	I-Entity
and	O
decodes	B-Verb
an	B-Entity
XOR	I-Entity
0xC8	I-Entity
encoded	I-Entity
Windows	I-Entity
PE	I-Entity
executable	I-Entity
payload	I-Entity
from	B-Preposition
[	B-Entity
http	I-Entity
:	I-Entity
]	I-Entity
//mfa.gov	I-Entity
[	I-Entity
.	I-Entity
]	I-Entity
af/content/images/icon35.png	I-Entity
,	O
hosted	O
on	O
the	O
official	O
Afghan	O
Ministry	O
of	O
Foreign	O
Affairs	O
site	O
,	O
which	O
was	O
also	O
affected	O
by	O
the	O
gop-script	O
XSS	O
.	O
	
Using	O
historic	O
context	O
archived	O
within	O
ThreatConnect	O
,	O
the	O
TCIRT	O
concluded	O
that	O
this	O
Java	O
applet	O
is	O
from	O
the	O
same	O
source	O
code	O
as	O
the	O
applet	O
SHA1	O
:	O
ADC162DD909283097E72FC50B7AB0E04AB8A2BCC	O
,	O
which	O
was	O
previously	O
observed	O
by	O
the	O
TCIRT	O
at	O
the	O
Operation	O
Poisoned	O
Hurricane	O
related	O
URL	O
[	O
http	O
:	O
]	O
//jre7.java-se	O
[	O
.	O
	
]	O
com/java.jar	O
on	O
August	O
15	O
,	O
2014	O
.	O
	
This	O
applet	O
has	O
the	O
same	O
class	O
path	O
,	O
and	O
downloads	B-Verb
an	B-Entity
XOR	I-Entity
0xFF	I-Entity
encoded	I-Entity
payload	I-Entity
executable	I-Entity
from	B-Preposition
the	B-Entity
URL	I-Entity
[	I-Entity
https	I-Entity
:	I-Entity
]	I-Entity
//amco-	I-Entity
triton.co	I-Entity
[	I-Entity
.	I-Entity
]	I-Entity
jp/js/dl/in.jpg	I-Entity
.	O
	
Additional	O
indicators	O
and	O
context	O
associated	O
with	O
this	O
particular	O
Java	O
driveby	O
activity	O
can	O
be	O
found	O
in	O
the	O
ThreatConnect	O
Common	O
Community	O
Incident	O
20140815A	O
:	O
The	B-Entity
XOR	I-Entity
0xC8	I-Entity
encoded	I-Entity
payload	I-Entity
downloaded	I-Entity
from	I-Entity
[	I-Entity
http	I-Entity
:	I-Entity
]	I-Entity
//mfa.gov	I-Entity
[	I-Entity
.	I-Entity
]	I-Entity
af/content/images/icon35.png	I-Entity
decodes	B-Verb
into	B-Preposition
the	B-Entity
Windows	I-Entity
PE	I-Entity
executable	I-Entity
SHA1	I-Entity
:	O
This	O
executable	O
is	O
a	O
self-extracting	O
(	O
SFX	O
)	O
Microsoft	O
Cabinet	O
executable	O
that	O
is	O
digitally	O
signed	O
with	O
a	O
valid	O
certificate	O
from	O
''	O
OnAndOn	O
Information	O
System	O
Co.	O
,	O
Ltd.	O
''	O
,	O
serial	O
number	O
''	O
1F	O
F7	O
D8	O
64	O
18	O
1C	O
55	O
5E	O
70	O
CF	O
DD	O
3A	O
59	O
34	O
C4	O
7D	O
''	O
.	O
	
This	O
same	O
certificate	O
was	O
also	O
used	O
to	O
sign	O
the	O
Java	O
applet	O
that	O
downloaded	O
this	O
malware	O
.	O
	
This	B-Entity
executable	I-Entity
drops	B-Verb
the	B-Entity
following	I-Entity
files	I-Entity
:	O
Malicious	O
DLL	O
that	O
loads	O
into	O
the	O
above	O
dllhost.exe	O
,	O
using	O
a	O
similar	O
DLL	O
sideloading	O
technique	O
to	O
that	O
most	O
commonly	O
associated	O
with	O
the	O
PlugX	O
backdoor	O
.	O
	
This	B-Entity
backdoor	I-Entity
connects	B-Verb
to	B-Preposition
the	B-Entity
faux	I-Entity
Oracle	I-Entity
Java	I-Entity
themed	I-Entity
command	I-Entity
and	I-Entity
control	I-Entity
(	I-Entity
C2	I-Entity
)	I-Entity
domain	I-Entity
oracle0876634.javaplug-in	I-Entity
[	I-Entity
.	I-Entity
]	I-Entity
com	I-Entity
.	O
	
Note	O
that	O
javaplug-in	O
[	O
.	O
	
]	O
com	O
is	O
the	O
same	O
root	O
domain	O
found	O
in	O
the	O
compromised	O
version	O
of	O
[	O
http	O
:	O
]	O
//cdn.afghanistan	O
[	O
.	O
	
]	O
af/scripts/gop-script.js	O
as	O
[	O
http	O
:	O
]	O
//update.javaplug-	O
in	O
[	O
.	O
	
]	O
com/o/j.js	O
,	O
confirming	O
that	O
this	O
Java	O
malware	O
is	O
in	O
fact	O
directly	O
associated	O
with	O
the	O
Afghan	O
MCIT	O
CDN	O
XSS	O
compromise	O
.	O
	
Full	O
indicators	O
of	O
this	O
activity	O
and	O
a	O
YARA	O
rule	O
to	O
detect	O
the	O
malware	O
certificate	O
can	O
be	O
found	O
in	O
the	O
ThreatConnect	O
Common	O
Community	O
under	O
Incident	O
20141217A	O
:	O
Afghan	O
Government	O
Java	O
Driveby	O
and	O
signature	O
APTOnAndOncert.yara	O
.	O
	
As	O
the	O
US	O
and	O
NATO	O
reduce	O
their	O
troop	O
levels	O
in	O
Afghanistan	O
,	O
China	O
is	O
posturing	O
to	O
fill	O
the	O
gap	O
of	O
influence	O
that	O
the	O
west	O
is	O
leaving	O
behind	O
.	O
	
With	O
plans	O
to	O
facilitate	O
multilateral	O
peace	O
talks	O
with	O
the	O
Taliban	O
and	O
establish	O
major	O
transportation	O
projects	O
which	O
aim	O
to	O
bolster	O
the	O
Afghan	O
economy	O
,	O
Beijing	O
has	O
been	O
eyeing	O
Afghanistan	O
as	O
part	O
of	O
its	O
broader	O
South	O
Asian	O
strategy	O
.	O
	
By	O
exploiting	O
and	O
co-opting	O
Afghan	O
network	O
infrastructure	O
that	O
is	O
used	O
by	O
multiple	O
ministerial	O
level	O
websites	O
,	O
Chinese	O
intelligence	O
services	O
would	O
be	O
able	O
to	O
widely	O
distribute	O
malicious	O
payloads	O
to	O
a	O
variety	O
of	O
global	O
targets	O
using	O
Afghanistan	O
's	O
government	O
websites	O
as	O
a	O
topical	O
and	O
trusted	O
distribution	O
platform	O
,	O
exploiting	B-Verb
a	B-Entity
single	I-Entity
hidden	I-Entity
entry	I-Entity
point	I-Entity
.	O
	
This	O
being	O
a	O
variant	O
of	O
a	O
typical	O
''	O
watering-hole	O
''	O
attack	O
,	O
the	O
attackers	O
will	O
most	O
likely	O
infect	O
victims	O
outside	O
the	O
Afghan	O
government	O
who	O
happened	O
to	O
be	O
browsing	O
any	O
one	O
of	O
the	O
CDN	O
client	O
systems	O
,	O
specifically	O
,	O
partner	O
states	O
involved	O
in	O
the	O
planned	O
troop	O
reduction	O
.	O
	
It	O
is	O
important	O
to	O
consider	O
that	O
corporate	O
enterprises	O
are	O
not	O
immune	O
to	O
this	O
tactic	O
,	O
and	O
this	O
is	O
not	O
just	O
a	O
technique	O
that	O
is	O
used	O
by	O
APT	O
threat	O
actors	O
.	O
	
If	O
an	O
enterprise	O
's	O
website	O
leverages	O
a	O
CDN	O
to	O
speed	O
up	O
content	O
delivery	O
,	O
unintended	O
consequences	O
must	O
be	O
anticipated	O
.	O
	
Fortunately	O
,	O
modern	O
browsers	O
now	O
implement	O
a	O
security	O
concept	O
called	O
''	O
Content	O
Security	O
Policy	O
''	O
.	O
	
As	O
long	O
as	O
the	O
server	O
's	O
response	O
headers	O
are	O
configured	O
properly	O
,	O
third	O
party	O
content	O
may	O
be	O
restricted	O
to	O
originating	O
from	O
a	O
narrow	O
whitelist	O
.	O
	
Just	O
as	O
attackers	O
distribute	O
malicious	O
content	O
to	O
users	O
en	O
masse	O
or	O
CDN	O
services	O
distribute	O
web	O
content	O
to	O
users	O
,	O
security	O
professionals	O
must	O
be	O
able	O
to	O
quickly	O
distribute	O
actionable	O
Threat	O
Intelligence	O
in	O
formats	O
readable	O
by	O
both	O
humans	O
and	O
machines	O
.	O
	
ThreatConnect	O
is	O
the	O
industry	O
's	O
first	O
comprehensive	O
Threat	O
Intelligence	O
Platform	O
that	O
enables	O
enterprises	O
to	O
orchestrate	O
the	O
aggregation	O
of	O
Threat	O
Intelligence	O
from	O
multiple	O
sources	O
,	O
use	O
integrated	O
analytics	O
and	O
a	O
robust	O
API	O
that	O
gives	O
enterprises	O
the	O
control	O
to	O
action	O
their	O
own	O
Threat	O
Intelligence	O
,	O
in	O
the	O
cloud	O
and	O
on	O
premises	O
.	O
	
Register	O
for	O
a	O
free	O
account	O
now	O
to	O
view	O
the	O
Common	O
Community	O
shares	O
and	O
more	O
.	O
	
by	O
John	O
Scott-Railton	O
and	O
Seth	O
Hardy	O
With	O
the	O
collaboration	O
of	O
Cyber	O
Arabs	O
.	O
	
Media	O
coverage	O
:	O
Associated	O
Press	O
,	O
Forbes	O
This	O
report	O
describes	O
a	O
malware	O
attack	O
with	O
circumstantial	O
links	O
to	O
the	O
Islamic	O
State	O
in	O
Iraq	O
and	O
Syria	O
.	O
	
In	O
the	O
interest	O
of	O
highlighting	O
a	O
developing	O
threat	O
,	O
this	O
post	O
analyzes	O
the	O
attack	O
and	O
provides	O
a	O
list	O
of	O
Indicators	O
of	O
Compromise	O
.	O
	
A	O
Syrian	O
citizen	O
media	O
group	O
critical	O
of	O
Islamic	O
State	O
of	O
Iraq	O
and	O
Syria	O
(	O
ISIS	O
)	O
was	O
recently	O
targeted	O
in	O
a	O
customized	O
digital	O
attack	O
designed	O
to	O
unmask	O
their	O
location	O
.	O
	
The	O
Syrian	O
group	O
,	O
Raqqah	O
is	O
being	O
Slaughtered	O
Silently	O
(	O
RSS	O
)	O
,	O
focuses	O
its	O
advocacy	O
on	O
documenting	O
human	O
rights	O
abuses	O
by	O
ISIS	O
elements	O
occupying	O
the	O
city	O
of	O
Ar-	O
Raqah	O
.	O
	
In	O
response	O
,	O
ISIS	O
forces	O
in	O
the	O
city	O
have	O
reportedly	O
targeted	O
the	O
group	O
with	O
house	O
raids	O
,	O
kidnappings	O
,	O
and	O
an	O
alleged	O
assassination	O
.	O
	
The	O
group	O
also	O
faces	O
online	O
threats	O
from	O
ISIS	O
and	O
its	O
supporters	O
,	O
including	O
taunts	O
that	O
ISIS	O
is	O
spying	O
on	O
the	O
group	O
.	O
	
Though	O
we	O
are	O
unable	O
to	O
conclusively	O
attribute	O
the	O
attack	O
to	O
ISIS	O
or	O
its	O
supporters	O
,	O
a	O
link	O
to	O
ISIS	O
is	O
plausible	O
.	O
	
The	O
malware	O
used	O
in	O
the	O
attack	O
differs	O
substantially	O
from	O
campaigns	O
linked	O
to	O
the	O
Syrian	O
regime	O
,	O
and	O
the	O
attack	O
is	O
focused	O
against	O
a	O
group	O
that	O
is	O
an	O
active	O
target	O
of	O
ISIS	O
forces	O
.	O
	
As	O
the	O
Syrian	O
Civil	O
War	O
continues	O
,	O
Syrian	O
citizen	O
journalists	O
and	O
nonviolent	O
activists	O
operate	O
in	O
an	O
increasingly	O
unsafe	O
environment	O
.	O
	
The	O
regime	O
has	O
never	O
welcomed	O
their	O
work	O
,	O
and	O
has	O
often	O
targeted	O
them	O
for	O
arrest	O
and	O
detention	O
,	O
and	O
a	O
multi-year	O
hacking	O
campaign	O
(	O
see	O
Pro-Regime	O
/	O
Regime	O
Linked	O
Groups	O
)	O
.	O
	
Additionally	O
,	O
not	O
all	O
elements	O
of	O
the	O
Syrian	O
opposition	O
have	O
uniformly	O
supported	O
nonviolent	O
activists	O
and	O
citizen	O
journalists	O
.	O
	
More	O
recently	O
,	O
in	O
areas	O
like	O
Raqqah	O
,	O
nonviolent	O
activists	O
face	O
a	O
new	O
and	O
exceptionally	O
grave	O
threat	O
:	O
ISIS	O
.	O
	
A	O
growing	O
number	O
of	O
reports	O
suggest	O
that	O
ISIS	O
is	O
systematically	O
targeting	O
groups	O
that	O
document	O
atrocities	O
,	O
or	O
that	O
communicate	O
with	O
Western	O
media	O
and	O
aid	O
organizations	O
,	O
sometimes	O
under	O
the	O
pretext	O
of	O
finding	O
''	O
spies	O
''	O
.	O
	
Ar-Raqqah	O
,	O
the	O
city	O
in	O
which	O
the	O
case	O
study	O
is	O
located	O
,	O
is	O
situated	O
in	O
northern	O
Syria	O
and	O
continues	O
to	O
be	O
a	O
key	O
conflict	O
flashpoint	O
of	O
the	O
Syrian	O
Civil	O
War	O
.	O
	
In	O
the	O
spring	O
of	O
2013	O
,	O
Islamists	O
and	O
Free	O
Syrian	O
Army	O
(	O
FSA	O
)	O
fighters	O
took	O
over	O
Ar-	O
Raqqah	O
from	O
regime	O
forces	O
.	O
	
As	O
ISIS	O
gained	O
momentum	O
,	O
they	O
consolidated	O
their	O
control	O
over	O
the	O
city	O
,	O
edging	O
out	O
FSA-	O
affiliated	O
groups	O
through	O
attacks	O
,	O
summary	O
executions	O
,	O
and	O
kidnappings	O
against	O
a	O
range	O
of	O
groups	O
,	O
including	O
ethnic	O
and	O
religious	O
minorities	O
.	O
	
During	O
2014	O
,	O
there	O
were	O
a	O
number	O
of	O
reports-many	O
unconfirmed-that	O
ISIS	O
confiscated	O
smartphones	O
and	O
laptops	O
from	O
captured	O
activists	O
.	O
	
According	O
to	O
Syrians	O
who	O
experienced	O
these	O
searches	O
and	O
spoke	O
with	O
one	O
of	O
the	O
reports	O
'	O
authors	O
,	O
ISIS	O
sometimes	O
extracts	O
data	O
from	O
confiscated	O
smartphones	O
and	O
laptops	O
to	O
collect	O
information	O
about	O
people	O
and	O
groups	O
they	O
are	O
targeting	O
,	O
as	O
well	O
as	O
to	O
seek	O
evidence	O
of	O
''	O
un-Islamic	O
''	O
activities	O
.	O
	
As	O
ISIS	O
cements	O
their	O
control	O
of	O
Ar-Raqqah	O
and	O
other	O
territories	O
,	O
reports	O
have	O
emerged	O
recently	O
(	O
though	O
not	O
all	O
of	O
them	O
confirmed	O
)	O
suggesting	O
that	O
elements	O
within	O
ISIS	O
are	O
growing	O
increasingly	O
sophisticated	O
at	O
imposing	O
control	O
and	O
targeting	O
opponents	O
using	O
digital	O
methods	O
.	O
	
Reports	O
about	O
ISIS	O
targeting	O
Internet	O
cafés	O
have	O
grown	O
increasingly	O
common	O
,	O
and	O
in	O
some	O
cases	O
reports	O
point	O
to	O
the	O
possible	O
use	O
of	O
keyloggers	O
as	O
well	O
as	O
unspecified	O
''	O
IP	O
sniffers	O
''	O
to	O
track	O
behaviour	O
in	O
Internet	O
cafes	O
.	O
	
Nonviolent	O
activists	O
and	O
citizen	O
journalists	O
based	O
in	O
Ar-Raqqah	O
have	O
provided	O
the	O
outside	O
world	O
with	O
much	O
of	O
what	O
we	O
know	O
about	O
how	O
ISIS	O
treats	O
the	O
population	O
.	O
	
These	O
activists	O
and	O
journalists	O
face	O
mortal	O
danger	O
for	O
their	O
actions	O
,	O
and	O
reports	O
have	O
emerged	O
of	O
their	O
detention	O
and	O
torture	O
at	O
the	O
hands	O
of	O
ISIS	O
.	O
	
As	O
ISIS	O
continues	O
to	O
use	B-Verb
social	B-Entity
media	I-Entity
to	O
push	O
the	O
message	O
that	O
it	O
is	O
welcomed	O
by	O
the	O
population	O
of	O
Ar-Raqqah	O
,	O
groups	O
like	O
Raqqah	O
is	O
being	O
Slaughtered	O
Silently	O
(	O
RSS	O
)	O
provide	O
a	O
compelling	O
counter	O
narrative	O
.	O
	
RSS	O
has	O
n't	O
escaped	O
ISIS	O
'	O
notice	O
,	O
and	O
the	O
group	O
has	O
been	O
targeted	O
for	O
kidnappings	O
,	O
house	O
raids	O
,	O
and	O
at	O
least	O
one	O
alleged	O
targeted	O
killing	O
.	O
	
At	O
the	O
time	O
of	O
writing	O
,	O
ISIS	O
is	O
allegedly	O
holding	O
several	O
citizen	O
journalists	O
in	O
Ar-Raqqah	O
.	O
	
In	O
addition	O
,	O
RSS	O
is	O
targeted	O
online	O
by	O
ISIS	O
supporters	O
with	O
harassment	O
,	O
including	O
threats	O
to	O
the	O
physical	O
safety	O
of	O
its	O
members	O
.	O
	
For	O
example	O
,	O
ISIS	O
supporters	O
have	O
claimed	O
that	O
ISIS	O
has	O
established	O
a	O
system	O
of	O
CCTV	O
cameras	O
in	O
Ar-Raqqah	O
to	O
observe	O
residents	O
'	O
movements	O
.	O
	
While	O
this	O
claim	O
may	O
be	O
a	O
bluff	O
or	O
exaggeration	O
,	O
at	O
least	O
one	O
ISIS	O
supporter	O
has	O
indicated	O
on	O
social	O
media	O
that	O
this	O
system	O
could	O
be	O
used	O
to	O
look	O
for	O
members	O
of	O
RSS	O
.	O
	
This	B-Entity
section	I-Entity
describes	B-Verb
a	B-Entity
highly	I-Entity
targeted	I-Entity
attack	I-Entity
sent	B-Verb
to	B-Preposition
an	B-Entity
e-mail	I-Entity
address	I-Entity
belonging	I-Entity
to	I-Entity
RSS	I-Entity
.	O
	
The	O
Citizen	O
Lab	O
analyzed	O
this	O
attack	O
with	O
the	O
consent	O
of	O
RSS	O
,	O
which	O
requested	O
that	O
their	O
name	O
be	O
used	O
in	O
this	O
report	O
.	O
	
The	O
attack	O
took	O
the	B-Entity
form	I-Entity
of	I-Entity
an	I-Entity
unsolicited	I-Entity
e-mail	I-Entity
containing	I-Entity
a	I-Entity
download	I-Entity
link	I-Entity
to	I-Entity
a	I-Entity
decoy	I-Entity
file	I-Entity
.	O
	
The	O
file	O
contained	O
custom	O
malware	O
that	O
profiled	O
the	O
victim	O
's	O
computer	O
and	O
beaconed	O
its	O
IP	O
address	O
to	O
an	O
e-mail	O
account	O
under	O
the	O
attacker	O
's	O
control	O
.	O
	
The	O
unsolicited	O
message	O
below	O
was	O
sent	O
to	O
RSS	O
at	O
the	O
end	O
of	O
November	O
2014	O
from	O
a	O
Gmail	O
email	O
address	O
.	O
	
The	O
message	O
was	O
carefully	O
worded	O
,	O
and	O
contained	O
references	O
specific	O
to	O
the	O
work	O
and	O
interests	O
of	O
RSS	O
.	O
	
Thank	O
you	O
for	O
your	O
efforts	O
to	O
deliver	O
a	O
true	O
picture	O
of	O
the	O
reality	O
of	O
life	O
in	O
Raqqah	O
.	O
	
As	O
Syrians	O
residing	O
in	O
Canada	O
we	O
are	O
working	O
with	O
media	O
because	O
we	O
believe	O
in	O
the	O
importance	O
of	O
shedding	O
light	O
on	O
the	O
realities	O
of	O
life	O
in	O
Syria	O
,	O
and	O
Raqqah	O
in	O
particular	O
.	O
	
We	O
are	O
preparing	O
a	O
lengthy	O
news	O
report	O
on	O
the	O
realities	O
of	O
life	O
in	O
Raqqah	O
.	O
	
We	O
are	O
sharing	O
some	O
information	O
with	O
you	O
with	O
the	O
hope	O
that	O
you	O
will	O
correct	O
it	O
in	O
case	O
it	O
contains	O
errors	O
.	O
	
We	O
have	O
prepared	O
a	O
map	O
of	O
the	O
city	O
of	O
Raqqah	O
,	O
in	O
addition	O
to	O
a	O
preliminary	O
report	O
.	O
	
We	O
hope	O
that	O
you	O
have	O
a	O
look	O
at	O
it	O
with	O
them	O
and	O
inform	O
us	O
of	O
any	O
errors	O
.	O
	
We	O
also	O
hope	O
that	O
if	O
you	O
happen	O
to	O
be	O
on	O
Facebook	O
,	O
you	O
could	O
provide	O
us	O
with	O
the	O
account	O
of	O
the	O
person	O
responsible	O
for	O
the	O
campaign	O
,	O
if	O
you	O
do	O
n't	O
mind	O
,	O
so	O
that	O
we	O
can	O
communicate	O
with	O
him	O
directly	O
.	O
	
You	O
can	O
see	O
a	O
preliminary	O
copy	O
of	O
the	O
report	O
on	O
this	O
linkhttp	O
:	O
//tempsend	O
[	O
DOT	O
]	O
com/	O
[	O
Redacted	O
]	O
With	O
all	O
respect	O
[	O
Name	O
Redacted	O
]	O
We	O
are	O
unsure	O
why	O
the	O
attacker	O
specifically	O
mentions	O
Canada	O
in	O
the	O
email	O
lure	O
.	O
	
However	O
,	O
it	O
is	O
well	O
known	O
that	O
Syria's	O
extensive	O
diaspora	O
(	O
including	O
in	O
Canada	O
)	O
regularly	O
engages	O
in	O
advocacy	O
,	O
sometimes	O
in	O
coordination	O
with	O
groups	O
within	O
Syria	O
.	O
	
Thus	O
,	O
the	O
message	O
is	O
not	O
on	O
its	O
face	O
implausible	O
.	O
	
However	O
,	O
we	O
note	O
that	O
the	O
attacker	O
also	O
attempts	O
to	O
social	O
engineer	O
the	O
identity	O
of	O
individuals	O
working	O
with	O
RSS	O
,	O
by	O
requesting	O
a	O
personal	O
Facebook	O
page	O
.	O
	
The	O
custom	O
malware	O
used	O
in	O
this	O
attack	O
infects	O
a	O
user	O
who	O
views	O
the	O
decoy	O
''	O
slideshow	O
,	O
''	O
and	O
beacons	O
home	O
with	O
the	O
IP	O
address	O
of	O
the	O
victim	O
's	O
computer	O
and	O
details	O
about	O
his	O
or	O
her	O
system	O
each	O
time	O
the	O
computer	O
restarts	O
.	O
	
Unlike	O
Syrian	O
regime-linked	O
malware	O
,	O
it	B-Entity
contains	B-Verb
no	B-Entity
Remote	I-Entity
Access	I-Entity
Trojan	I-Entity
(	I-Entity
RAT	I-Entity
)	I-Entity
functionality	I-Entity
,	O
suggesting	O
it	O
is	O
intended	O
for	O
identifying	O
and	O
locating	O
a	O
target	O
.	O
	
Further	O
,	O
because	O
the	B-Entity
malware	I-Entity
sends	B-Verb
data	B-Entity
captured	B-Verb
by	O
the	O
malware	O
to	O
an	O
e-mail	O
address	O
,	O
it	O
does	O
not	O
require	O
that	O
the	B-Entity
attackers	I-Entity
maintain	B-Verb
a	B-Entity
command-and-control	I-Entity
server	I-Entity
online	I-Entity
.	O
	
This	O
functionality	O
would	O
be	O
especially	O
useful	O
to	O
an	O
adversary	O
unsure	O
of	O
whether	O
it	O
can	O
maintain	O
uninterrupted	O
Internet	O
connectivity	O
.	O
	
Accessing	B-Entity
the	I-Entity
link	I-Entity
provided	I-Entity
in	I-Entity
the	I-Entity
malicious	I-Entity
e-mail	I-Entity
sends	B-Verb
the	B-Entity
user	I-Entity
to	I-Entity
a	I-Entity
.zip	I-Entity
	
file	O
hosted	O
on	O
file-sharing	O
site	O
tempsend.com	O
.	O
	
At	O
the	O
time	O
of	O
writing	O
the	O
file	O
had	O
been	O
downloaded	O
only	O
10	O
times	O
This	O
file	O
is	O
a	O
self-extracting	O
archive	O
with	O
an	O
icon	O
intended	O
to	O
suggest	O
to	O
the	O
victim	O
that	O
it	O
is	O
itself	O
a	O
slideshow	O
.	O
	
When	O
run	O
,	O
the	B-Entity
file	I-Entity
opens	B-Verb
a	B-Entity
slideshow	I-Entity
of	I-Entity
Google	I-Entity
Earth	I-Entity
screen	I-Entity
captures	I-Entity
to	I-Entity
the	I-Entity
victim	I-Entity
,	O
displaying	O
a	O
series	O
of	O
locations	O
in	O
Syria	O
,	O
and	O
highlighting	O
an	O
''	O
ISIS	O
HQ	O
''	O
and	O
other	O
images	O
showing	O
the	O
alleged	O
locations	O
of	O
US	O
airstrikes	O
.	O
	
Examples	O
of	O
images	O
in	O
the	O
slideshow	O
as	O
follows	O
:	O
When	O
opened	O
,	O
the	B-Entity
''	I-Entity
slideshow.zip	I-Entity
''	I-Entity
file	I-Entity
writes	B-Verb
and	I-Verb
executes	I-Verb
several	B-Entity
files	I-Entity
:	O
''	O
AdobeR1.exe	O
''	O
is	O
malicious	O
,	O
while	O
''	O
pictures.exe	O
''	O
is	O
the	O
genuine	O
slideshow	O
displayed	O
to	O
the	O
victim	O
.	O
	
When	O
the	O
slideshow	O
is	O
closed	O
both	O
AdobeR1.exe	O
and	O
pictures.exe	O
are	O
deleted	O
.	O
	
The	O
AdobeR1	O
file	O
writes	O
a	O
series	O
of	O
executable	O
files	O
that	O
perform	B-Verb
information	B-Entity
collection	I-Entity
and	I-Entity
communication	I-Entity
functions	I-Entity
,	O
including	O
:	O
The	O
program	O
sequence	O
of	O
data	O
collection	O
and	O
sending	O
is	O
somewhat	O
unusual	O
,	O
with	O
each	O
program	O
performing	O
a	O
single	O
task	O
and	O
communicating	O
via	O
markers	O
left	O
in	O
the	O
registry	O
.	O
	
Programs	O
appear	O
to	O
make	O
use	O
of	O
the	O
Visual	O
C++	O
Runtime	O
Library	O
.	O
	
First	O
,	O
the	O
program	O
nvidrv	O
adds	O
itself	O
to	O
autorun	O
:	O
It	O
also	O
creates	B-Verb
a	B-Entity
series	I-Entity
of	I-Entity
registry	I-Entity
keys	I-Entity
that	O
the	O
individual	O
programs	O
use	O
to	O
communicate	O
:	O
Registry	O
keys	O
and	O
programs	O
using	O
them	O
:	O
It	B-Entity
then	O
runs	B-Verb
GooglUpd	B-Entity
,	O
which	O
cleans	O
up	O
the	O
program	O
files	O
if	O
they	O
exist	O
,	O
and	O
runs	B-Verb
AdbrRader	B-Entity
.	O
	
AdbrRader	B-Entity
(	I-Entity
communicating	I-Entity
through	I-Entity
registry	I-Entity
key	I-Entity
''	I-Entity
2	I-Entity
''	I-Entity
)	I-Entity
writes	B-Verb
the	B-Entity
file	I-Entity
vgadmysadm.tmp	I-Entity
with	B-Preposition
the	B-Entity
name	I-Entity
of	I-Entity
another	I-Entity
registry	I-Entity
key	I-Entity
''	I-Entity
2	I-Entity
''	I-Entity
with	I-Entity
startup	I-Entity
info	I-Entity
.	O
	
Next	O
,	O
nvidrv	O
runs	O
GoogleUpate	O
,	O
which	O
collects	B-Verb
system	B-Entity
information	I-Entity
and	O
writes	O
it	O
to	O
:	O
Then	O
nvidrv	B-Entity
runs	B-Verb
nvisdvr	B-Entity
(	I-Entity
registry	I-Entity
key	I-Entity
''	I-Entity
4	I-Entity
''	I-Entity
)	I-Entity
that	I-Entity
collects	I-Entity
a	I-Entity
list	I-Entity
of	I-Entity
running	I-Entity
processes	I-Entity
,	O
which	O
are	O
written	O
to	O
:	O
Finally	O
,	O
nvidrv	O
runs	O
svhosts	O
,	O
which	O
tests	B-Verb
Internet	B-Entity
connectivity	I-Entity
by	B-Preposition
doing	B-Entity
a	I-Entity
DNS	I-Entity
query	I-Entity
for	I-Entity
windowsupdate.microsoft.com	I-Entity
.	O
	
It	B-Entity
then	O
runs	O
rundl132	O
if	O
it	O
has	O
not	O
before	O
,	O
by	O
checking	O
whether	O
registry	O
key	O
name	O
''	O
6	O
''	O
is	O
present	O
.	O
	
It	B-Entity
sets	B-Verb
the	B-Entity
key	I-Entity
to	I-Entity
''	I-Entity
0	I-Entity
''	I-Entity
and	I-Entity
runs	I-Entity
it	I-Entity
.	O
	
Next	O
,	O
''	O
rundl132.exe	O
''	O
performs	O
an	O
HTTP	O
GET	O
request	O
to	O
myexternalip.com	O
and	O
collects	O
the	O
external	O
IP	O
of	O
the	O
infected	O
machine	O
:	O
Next	O
,	O
rundl132	O
writes	O
:	O
Then	O
rundl132	O
writes	O
the	O
external	O
IP	O
to	O
:	O
Finally	O
,	O
rundl132	O
runs	O
AdobeIns	O
,	O
which	O
zips	O
the	O
contents	O
of	O
the	O
win32.tmp	O
folder	O
.	O
	
Program	O
''	O
AdobeIns.exe	O
''	O
takes	O
the	B-Entity
files	I-Entity
written	I-Entity
by	I-Entity
the	I-Entity
other	I-Entity
programs	I-Entity
and	O
zips	O
them	O
in	O
an	O
encrypted	O
,	O
password-	O
protected	O
file	O
:	O
Data	O
is	O
transmitted	O
by	O
e-mail	O
to	O
an	O
account	O
presumably	O
controlled	O
by	O
the	O
attacker	O
.	O
	
AdobeIns	O
connects	O
to	O
an	O
account	O
at	O
the	O
online	O
e-mail	O
provider	O
inbox.com	O
via	O
smtp	O
using	O
hardcoded	O
credentials	O
.	O
	
The	B-Entity
malware	I-Entity
then	O
sends	B-Verb
an	B-Entity
e-mail	I-Entity
to	I-Entity
the	I-Entity
same	I-Entity
inbox	I-Entity
containing	I-Entity
the	I-Entity
text	I-Entity
''	I-Entity
Hello	I-Entity
''	I-Entity
and	I-Entity
with	I-Entity
mxtd	I-Entity
file	I-Entity
attached	I-Entity
.	O
	
SMTP	O
traffic	O
generated	O
by	O
the	O
malware	O
to	O
inbox.com	O
(	O
with	O
redactions	O
)	O
The	O
malware	O
seen	O
in	O
this	O
case	O
study	O
is	O
unusual	O
as	O
it	O
relies	O
on	O
a	O
half-dozen	O
separate	O
executable	O
files	O
,	O
each	O
with	O
a	O
single	O
task	O
,	O
and	O
each	O
communicating	O
via	O
markers	O
dropped	O
in	O
the	O
Registry	O
.	O
	
The	B-Entity
malware	I-Entity
is	O
also	O
interesting	O
because	O
it	O
does	O
not	O
provide	O
remote	O
access	O
,	O
but	O
only	O
sends	B-Verb
an	B-Entity
e-mail	I-Entity
containing	I-Entity
the	I-Entity
victim	I-Entity
's	I-Entity
IP	I-Entity
address	I-Entity
and	I-Entity
miscellaneous	I-Entity
system	I-Entity
information	I-Entity
.	O
	
The	O
malware	O
resends	O
the	O
information	O
each	O
time	O
the	O
computer	O
is	O
restarted	O
,	O
but	O
it	O
does	O
not	O
refresh	O
the	O
sent	O
information	O
on	O
restart	O
(	O
which	O
may	O
be	O
a	O
bug	O
)	O
.	O
	
This	O
behaviour	O
strongly	O
suggests	O
that	O
the	O
function	O
of	O
this	O
malware	O
is	O
to	O
serve	O
as	O
a	O
beacon	O
.	O
	
The	O
system	O
information	O
could	O
be	O
used	O
to	O
identify	O
processes	O
to	O
exploit	O
in	O
the	O
future	O
,	O
however	O
since	O
the	O
attacker	O
has	O
already	O
triggered	O
the	O
execution	O
of	O
a	O
file	O
on	O
the	O
victim	O
's	O
system	O
,	O
it	O
is	O
surprising	O
that	O
more	O
was	O
not	O
taken	O
,	O
or	O
that	O
a	O
RAT	O
(	O
custom	O
or	O
widely	O
available	O
)	O
was	O
not	O
used	O
.	O
	
A	O
RAT	O
would	O
have	O
provided	O
much	O
greater	O
access	O
alongside	O
IP	O
information	O
By	O
not	O
providing	O
remote	O
access	O
and	O
other	O
RAT	O
functionality	O
,	O
the	O
program	O
looks	O
less	O
like	O
malware	O
,	O
and	O
may	O
attract	O
less	O
attention	O
from	O
endpoint	O
protection	O
tools	O
and	O
scanners	O
.	O
	
Detections	O
were	O
low	O
when	O
the	O
file	O
was	O
first	O
submitted	O
to	O
VirusTotal	O
,	O
for	O
example	O
.	O
	
It	O
registered	O
only	O
6/55	O
detections	O
by	O
anti	O
virus	O
scanners	O
,	O
or	O
a	O
10	O
%	O
detection	O
rate	O
.	O
	
Transmitting	B-Verb
the	B-Entity
malware	I-Entity
via	B-Preposition
e-mail	B-Entity
also	O
provides	O
a	O
degree	O
of	O
obscurity	O
,	O
and	O
has	O
the	O
additional	O
advantage	O
of	O
providing	O
a	O
layer	O
of	O
abstraction	O
between	O
the	O
attacker	O
and	O
the	O
target	O
:	O
there	O
is	O
no	O
need	O
to	O
maintain	B-Verb
a	B-Entity
RAT	I-Entity
command-and-control	I-Entity
server	I-Entity
.	O
	
The	O
malware	O
transmits	O
autonomously	O
,	O
leaving	O
the	O
material	O
in	O
an	O
inbox	O
for	O
the	O
attacker	O
to	O
collect	O
at	O
a	O
later	O
time	O
.	O
	
The	O
malware	O
has	O
no	O
obfuscation	O
processes	O
and	O
is	O
not	O
highly	O
technical	O
in	O
its	O
development	O
or	O
interaction	O
with	O
Windows	O
.	O
	
Nevertheless	O
,	O
we	O
believe	O
that	O
the	O
author	O
of	O
the	O
program	O
is	O
aware	O
of	O
certain	O
techniques	O
to	O
reduce	O
the	O
visibility	O
of	O
malware	O
on	O
a	O
network	O
,	O
including	O
transmitting	B-Verb
data	B-Entity
via	B-Preposition
encrypted	B-Entity
e-mail	I-Entity
communications	I-Entity
.	O
	
However	O
,	O
the	O
attacker	O
has	O
not	O
correctly	O
implemented	O
encrypted	O
e-mail	O
:	O
the	O
malware	O
will	O
not	O
attempt	O
to	O
use	O
a	O
TLS	O
connection	O
in	O
certain	O
cases	O
.	O
	
As	O
a	O
result	O
,	O
account	B-Entity
login	I-Entity
credentials	I-Entity
may	O
be	O
readily	O
available	O
in	O
network	O
traffic	O
.	O
	
In	O
addition	O
,	O
the	B-Entity
malware	I-Entity
uses	O
the	O
old	O
PKWARE	O
implementation	O
of	O
zip	O
encryption	O
,	O
which	O
is	O
not	O
particularly	O
secure	O
.	O
	
The	O
password	O
for	O
the	O
zipped	O
file	O
is	O
also	O
present	O
in	O
the	O
binary	O
without	O
encryption	O
or	O
obfuscation	O
.	O
	
Citizen	O
Lab	O
researchers	O
have	O
developed	O
the	O
Targeted	O
Threat	O
Index	O
(	O
TTI	O
)	O
as	O
a	O
tool	O
to	O
standardize	O
information	O
about	O
the	O
sophistication	O
of	O
targeted	O
threats	O
against	O
civil	O
society	O
groups	O
in	O
our	O
research	O
.	O
	
The	O
index	O
captures	O
information	O
about	O
the	O
level	O
of	O
social	O
engineering	O
used	O
(	O
''	O
Targeting	O
Sophistication	O
''	O
)	O
,	O
and	O
adds	O
a	O
Technical	O
Sophistication	O
value	O
for	O
the	O
attack	O
as	O
a	O
multiplier	O
.	O
	
This	O
attack	O
,	O
which	O
has	O
little	O
technical	O
sophistication	O
(	O
i.e.	O
,	O
it	O
uses	O
no	O
exploits	O
,	O
code	O
obfuscation	O
,	O
or	O
techniques	O
to	O
frustrate	O
reversing	O
,	O
etc	O
.	O
	
)	O
,	O
nevertheless	O
has	O
carefully	O
developed	O
social	O
engineering	O
in	O
the	O
seeding	O
materials	O
and	O
bait	O
document	O
.	O
	
Taken	O
together	O
it	O
rates	O
a	O
3	O
for	O
Targeting	O
Sophistication	O
and	O
a	O
1.25	O
for	O
Technical	O
Sophistication	O
by	O
our	O
metric	O
,	O
yielding	O
a	O
TTI	O
score	O
of	O
3.75	O
.	O
	
Citizen	O
Lab	O
research	O
using	O
the	O
TTI	O
has	O
found	O
that	O
,	O
despite	O
low	O
levels	O
of	O
technical	O
sophistication	O
,	O
with	O
well-crafted	O
social	O
engineering	O
malware	O
attacks	O
remain	O
highly	O
effective	O
against	O
civil	O
society	O
groups	O
.	O
	
More	O
information	O
is	O
available	O
about	O
the	O
TTI	O
in	O
a	O
recent	O
Usenix	O
Security	O
paper	O
.	O
	
There	O
are	O
at	O
least	O
three	O
possible	O
sources	O
for	O
this	O
malware	O
attack	O
:	O
We	O
evaluate	O
each	O
of	O
these	O
possibilities	O
in	O
turn	O
,	O
drawing	O
on	O
the	O
information	O
available	O
to	O
us	O
after	O
almost	O
three	O
years	O
of	O
tracking	O
regime-linked	O
malware	O
.	O
	
Pro-regime	O
malware	O
actors	O
have	O
continually	O
targeted	O
the	O
Syrian	O
opposition	O
with	O
waves	O
of	O
malware	O
since	O
at	O
least	O
late	O
2011	O
.	O
	
Those	O
campaigns	O
have	O
been	O
extensively	O
reported	O
on	O
by	O
a	O
range	O
of	O
groups	O
,	O
including	O
Kaspersky	O
,	O
FireEye	O
,	O
Citizen	O
Lab	O
,	O
the	O
Electronic	O
Frontier	O
Foundation	O
,	O
and	O
many	O
others	O
.	O
	
Regime-linked	O
malware	O
has	O
a	O
number	O
of	O
common	O
features	O
that	O
typically	O
serve	O
as	O
distinguishing	O
characteristics	O
:	O
Social	O
engineering	O
focusing	O
on	O
the	O
needs	O
and	O
interests	O
of	O
the	O
opposition	O
.	O
	
Although	O
targeted	O
,	O
the	B-Entity
malware	I-Entity
seeding	I-Entity
often	O
aims	O
at	O
classes	O
of	O
people	O
(	O
e.g.	O
,	O
people	O
interested	O
in	O
'shocking	O
'	O
news	O
about	O
a	O
fighter	O
,	O
or	O
'leaked	O
'	O
information	O
about	O
the	O
Assad	O
regime	O
)	O
rather	O
than	O
carefully	O
written	O
spear	O
phishing	O
targeting	O
a	O
single	O
individual	O
or	O
small	O
group	O
.	O
	
Use	O
of	O
widely	O
available	O
RATs	O
(	O
njRAT	O
,	O
Xtreme	O
Rat	O
,	O
ShadowTech	O
Rat	O
,	O
DarkComet	O
RAT	O
,	O
and	O
Blackshades	O
RAT	O
,	O
among	O
others	O
)	O
.	O
	
At	O
least	O
one	O
command-and-control	O
server	O
located	O
within	O
Syrian	O
IP	O
space	O
(	O
often	O
from	O
a	O
limited	O
range	O
of	O
addresses	O
)	O
.	O
	
Frequent	O
use	O
of	O
Dynamic	O
DNS	O
providers	O
like	O
no-ip	O
.	O
	
Use	O
of	O
''	O
crypters	O
''	O
to	O
obscure	O
the	O
binary	O
.	O
	
These	O
characteristics	O
are	O
not	O
all	O
present	O
in	O
every	O
sample	O
,	O
but	O
we	O
have	O
typically	O
found	O
one	O
or	O
more	O
in	O
almost	O
every	O
binary	O
we	O
have	O
examined	O
that	O
is	O
Syrian	O
regime-linked	O
.	O
	
This	B-Entity
malware	I-Entity
attack	I-Entity
differs	B-Verb
from	B-Preposition
known	B-Entity
regime-linked	I-Entity
groups	I-Entity
in	I-Entity
each	I-Entity
of	I-Entity
these	I-Entity
elements	I-Entity
.	O
	
Not	O
only	O
is	O
it	O
exceptionally	O
targeted	O
,	O
but	O
it	O
is	O
also	O
not	O
a	O
commonly	O
available	O
RAT	O
.	O
	
Nor	O
does	O
it	O
have	O
RAT	O
functionality	O
.	O
	
The	O
function	O
of	O
the	O
malware	O
appears	O
to	O
be	O
:	O
identify	O
and	O
unmask	B-Verb
the	B-Entity
IP	I-Entity
address	I-Entity
of	I-Entity
target	I-Entity
(	I-Entity
s	I-Entity
)	I-Entity
,	O
and	O
resend	O
them	O
to	O
the	O
attacker	O
with	O
each	O
reboot	O
.	O
	
In	O
addition	O
,	O
data	B-Entity
is	B-Verb
sent	I-Verb
to	B-Preposition
an	B-Entity
Internet	I-Entity
e-mail	I-Entity
address	I-Entity
,	O
and	O
no	O
crypter	O
is	O
used	O
to	O
obscure	O
the	O
binary	O
.	O
	
We	O
are	O
aware	O
of	O
only	O
one	O
previous	O
case	O
in	O
Syria	O
in	O
which	O
e-mail	O
was	O
used	O
to	O
transmit	O
data	O
,	O
and	O
that	O
we	O
believed	O
was	O
regime	O
linked	O
.	O
	
That	O
incident	O
,	O
observed	O
in	O
2012	O
,	O
also	O
used	B-Verb
hardcoded	B-Entity
e-mail	I-Entity
to	O
exfiltrate	B-Verb
.	O
	
However	O
,	O
that	O
malware	O
had	O
substantially	O
more	O
functionality	O
than	O
this	O
case	O
:	O
not	O
only	O
did	O
it	O
drop	B-Verb
a	B-Entity
second	I-Entity
stage	I-Entity
from	B-Preposition
a	B-Entity
compromised	I-Entity
site	I-Entity
,	O
but	O
was	O
also	O
included	O
a	O
mechanism	O
for	O
exfiltrating	O
credentials	O
from	O
Facebook	O
and	O
hooking	O
programs	O
like	O
Skype	O
.	O
	
The	O
lack	O
of	O
overlap	O
in	O
Tactics	O
,	O
Techniques	O
,	O
and	O
Procedures	O
(	O
TTPs	O
)	O
between	O
this	O
attack	O
and	O
prior	O
attacks	O
does	O
not	O
rule	O
out	O
Syrian	O
regime-linked	O
attackers	O
.	O
	
It	O
is	O
possible	O
that	O
regime-linked	O
groups	O
are	O
trying	O
a	O
new	O
approach	O
.	O
	
However	O
,	O
given	O
that	O
known	O
regime-linked	O
groups	O
continued	O
to	O
remain	O
active	O
during	O
the	O
same	O
date	O
range	O
using	O
familiar	O
TTPs	O
,	O
this	O
scenario	O
seems	O
unlikely	O
.	O
	
In	O
addition	O
,	O
it	B-Entity
would	O
be	O
strange	O
for	O
regime-linked	O
malware	O
groups	O
to	O
undertake	O
significant	O
effort	O
to	O
prepare	O
and	O
send	O
an	O
implant	O
that	O
has	O
significantly	O
less	O
functionality	O
than	O
what	O
they	O
commonly	O
use	O
.	O
	
Taken	O
together	O
,	O
we	O
find	O
this	O
evidence	O
supports	O
the	O
hypothesis	O
that	O
familiar	O
regime-linked	O
groups	O
did	O
not	O
conduct	O
the	O
attack	O
.	O
	
RSS	O
operates	O
in	O
territory	O
controlled	O
by	O
ISIS	O
,	O
and	O
has	O
faced	O
extensive	O
targeting	O
by	O
ISIS	O
.	O
	
Currently	O
,	O
they	O
appear	O
to	O
be	O
directly	O
targeted	O
by	O
ISIS	O
for	O
kidnappings	O
and	O
other	O
retaliation	O
,	O
including	O
executions	O
.	O
	
In	O
addition	O
,	O
ISIS	O
supporters	O
have	O
explicitly	O
suggested	O
that	O
the	O
group	O
is	O
under	O
surveillance	O
and	O
actively	O
hunted	O
.	O
	
Together	O
this	O
evidence	O
suggests	O
that	O
ISIS	O
has	O
a	O
strong	O
motivation	O
for	O
using	O
social	O
engineering	O
and/or	O
malware	O
to	O
locate	O
the	O
members	O
of	O
RSS	O
.	O
	
We	O
think	O
there	O
are	O
several	O
features	O
of	O
the	O
malware	O
attack	O
that	O
align	O
with	O
the	O
needs	O
and	O
constraints	O
of	O
ISIS	O
and	O
its	O
supporters	O
in	O
Ar-Raqqah	O
,	O
more	O
so	O
than	O
other	O
groups	O
,	O
as	O
we	O
understand	O
them	O
.	O
	
For	O
example	O
:	O
The	O
malware	O
beacons	O
location	O
but	O
does	O
not	O
provide	O
RAT	O
functionality	O
.	O
	
The	O
seeding	O
attempts	O
to	O
obtain	O
a	O
'private	O
'	O
Facebook	O
identity	O
from	O
RSS	O
through	O
social	O
engineering	O
.	O
	
The	B-Entity
malware	I-Entity
exfiltrates	O
to	O
an	O
online	O
e-mail	O
account	O
,	O
thus	O
not	O
requiring	O
the	O
attacker	O
to	O
maintain	B-Verb
a	B-Entity
command-and-	I-Entity
control	I-Entity
server	I-Entity
online	I-Entity
.	O
	
The	O
social	O
media	O
activity	O
of	O
members	O
of	O
RSS	O
is	O
often	O
highly	O
public	O
.	O
	
Their	O
location	O
and	O
exact	O
membership	O
,	O
however	O
,	O
is	O
secret	O
.	O
	
We	O
speculate	O
that	O
if	O
an	O
attacker	O
were	O
interested	O
in	O
maintaining	O
long-term	O
surveillance	O
of	O
the	O
activities	O
of	O
RSS	O
they	O
could	O
have	O
employed	O
a	O
RAT	O
.	O
	
However	O
,	O
if	O
the	O
attacker	O
were	O
interested	O
in	O
unmasking	O
the	O
location	O
of	O
its	O
targets	O
so	O
they	O
could	O
be	O
physically	O
tracked	O
down	O
,	O
collecting	B-Verb
IP	B-Entity
data	I-Entity
and	I-Entity
system	I-Entity
info	I-Entity
would	O
be	O
a	O
more	O
reasonable	O
approach	O
.	O
	
ISIS	O
or	O
its	O
supporters	O
clearly	O
have	O
a	O
strong	O
interest	O
in	O
the	O
(	O
rudimentary	O
)	O
location	O
tracking	O
of	O
the	O
members	O
of	O
RSS	O
that	O
this	O
malware	O
provides	O
.	O
	
Internet	O
connectivity	O
in	O
Raqqah	O
is	O
extremely	O
limited	O
,	O
and	O
some	O
of	O
it	O
is	O
under	O
ISIS	O
control	O
.	O
	
Knowing	O
the	O
IP	O
address	O
of	O
a	O
target	O
could	O
quickly	O
narrow	O
down	O
targets	O
to	O
specific	O
locations	O
,	O
and	O
specific	O
Internet	O
services	O
,	O
or	O
Internet	O
cafes	O
in	O
Raqqah	O
.	O
	
Given	O
that	O
the	O
identities	O
and	O
locations	O
of	O
RSS	O
members	O
are	O
closely	O
guarded	O
,	O
such	O
information	O
would	O
hold	O
significant	O
intelligence	O
value	O
for	O
ISIS	O
.	O
	
Armed	O
with	O
this	O
kind	O
of	O
information	O
,	O
ISIS	O
could	O
physically	O
harm	O
people	O
within	O
Raqqah	O
(	O
and	O
it	O
is	O
also	O
possible	O
that	O
they	O
have	O
the	O
ability	O
to	O
operate	O
in	O
some	O
capacity	O
in	O
border	O
areas	O
of	O
Turkey	O
)	O
.	O
	
Little	O
is	O
publicly	O
known	O
about	O
the	O
technical	O
capabilities	O
of	O
ISIS	O
and	O
its	O
supporters	O
;	O
however	O
,	O
reports	O
have	O
begun	O
to	O
emerge	O
suggesting	O
that	O
ISIS	O
is	O
interested	O
in	O
expanding	O
its	O
abilities	O
.	O
	
In	O
addition	O
,	O
ISIS	O
has	O
reportedly	O
gained	O
the	O
support	O
of	O
at	O
least	O
one	O
individual	O
with	O
some	O
experience	O
with	O
social	O
engineering	O
and	O
hacking	O
:	O
Junaid	O
Hussain	O
(	O
aka	O
TriCk	O
)	O
,	O
a	O
former	O
member	O
of	O
teamp0ison	O
hacking	O
team	O
.	O
	
While	O
Mr.	O
Hussain	O
and	O
associates	O
have	O
reportedly	O
made	O
threats	O
against	O
Western	O
governments	O
,	O
it	O
is	O
possible	O
that	O
he	O
or	O
others	O
working	O
with	O
ISIS	O
have	O
quietly	O
supported	O
an	O
effort	O
to	O
identify	O
the	O
targeted	O
organization	O
,	O
which	O
is	O
a	O
highly	O
visible	O
thorn	O
in	O
the	O
side	O
of	O
ISIS	O
.	O
	
It	O
is	O
possible	O
that	O
the	O
attack	O
is	O
the	O
product	O
of	O
actors	O
working	O
for	O
unknown	O
purposes	O
and	O
targeting	O
RSS	O
.	O
	
Given	O
the	O
activities	O
of	O
RSS	O
,	O
however	O
,	O
it	O
is	O
unclear	O
who	O
this	O
might	O
be	O
.	O
	
It	O
is	O
not	O
possible	O
,	O
for	O
example	O
,	O
to	O
reject	O
the	O
theory	O
that	O
some	O
unknown	O
group	O
within	O
the	O
FSA	O
,	O
or	O
other	O
groups	O
opposing	O
the	O
Assad	O
regime	O
are	O
responsible	O
.	O
	
Citizen	O
journalists	O
in	O
Ar-Raqqah	O
were	O
previously	O
critical	O
of	O
arbitrary	O
arrests	O
carried	O
out	O
by	O
non-ISIS	O
groups	O
in	O
2013	O
.	O
	
However	O
,	O
it	O
is	O
unclear	O
why	O
those	O
groups	O
,	O
which	O
no	O
longer	O
control	O
Ar-Raqqah	O
,	O
would	O
be	O
interested	O
in	O
RSS	O
in	O
November	O
2014	O
.	O
	
It	O
is	O
likely	O
that	O
third	O
party	O
actors	O
,	O
including	O
several	O
intelligence	O
services	O
,	O
are	O
closely	O
monitoring	O
various	O
actors	O
in	O
the	O
conflict	O
through	O
a	O
range	O
of	O
electronic	O
means	O
.	O
	
However	O
,	O
there	O
is	O
little	O
reason	O
to	O
suggest	O
that	O
they	O
would	O
use	O
a	O
tailored	O
but	O
technically	O
rudimentary	O
attack	O
to	O
target	O
RSS	O
in	O
particular	O
.	O
	
After	O
considering	O
each	O
possibility	O
,	O
we	O
find	O
strong	O
but	O
inconclusive	O
circumstantial	O
evidence	O
to	O
support	O
a	O
link	O
to	O
ISIS	O
.	O
	
However	O
,	O
we	O
are	O
unable	O
to	O
connect	O
this	O
attack	O
directly	O
to	O
ISIS	O
,	O
Mr.	O
Hussain	O
,	O
or	O
other	O
ISIS	O
supporters	O
.	O
	
If	O
indeed	O
ISIS	O
or	O
its	O
supporters	O
are	O
responsible	O
,	O
it	O
seems	O
reasonable	O
that	O
such	O
an	O
offensive	O
capability	O
may	O
still	O
be	O
in	O
development	O
.	O
	
We	O
hope	O
that	O
publishing	O
this	O
report	O
will	O
draw	O
attention	O
to	O
a	O
new	O
and	O
concerning	O
threat	O
that	O
includes	O
ISIS	O
critics	O
among	O
its	O
targets	O
.	O
	
If	O
ISIS	O
is	O
responsible	O
,	O
while	O
this	O
attack	O
targets	O
in-country	O
impediments	O
to	O
ISIS	O
objectives	O
,	O
other	O
targets	O
may	O
include	O
ideological	O
or	O
military	O
adversaries	O
abroad	O
.	O
	
Whether	O
or	O
not	O
ISIS	O
is	O
responsible	O
,	O
this	O
attack	O
is	O
likely	O
the	O
work	O
of	O
a	O
non-regime	O
threat	O
actor	O
who	O
may	O
be	O
just	O
beginning	O
to	O
field	O
a	O
still-rudimentary	O
capability	O
in	O
the	O
Syrian	O
conflict	O
.	O
	
The	O
entry	O
costs	O
for	O
engaging	O
in	O
malware	O
attacks	O
in	O
a	O
conflict	O
like	O
the	O
Syrian	O
Civil	O
War	O
are	O
low	O
,	O
and	O
made	O
lower	O
by	O
the	O
fact	O
that	O
the	O
rule	O
of	O
law	O
is	O
nonexistent	O
for	O
large	O
parts	O
of	O
the	O
country	O
.	O
	
In	O
still	O
other	O
parts	O
(	O
under	O
regime	O
control	O
)	O
,	O
malware	O
attacks	O
appear	O
to	O
be	O
state	O
sanctioned	O
.	O
	
Citizen	O
Lab	O
research	O
into	O
targeted	O
digital	O
threats	O
against	O
civil	O
society	O
confirms	O
that	O
civil	O
society	O
groups	O
face	O
grave	O
threats	O
from	O
targeted	O
malware	O
attacks	O
,	O
despite	O
being	O
under-resourced	O
to	O
defend	O
against	O
them	O
.	O
	
The	O
case	O
highlighted	O
here	O
is	O
no	O
exception	O
:	O
lack	O
of	O
IT	O
and	O
security	O
resources	O
have	O
made	O
it	O
difficult	O
for	O
the	O
Syrian	O
opposition	O
to	O
address	O
targeted	O
and	O
persistent	O
digital	O
threats	O
against	O
them	O
.	O
	
In	O
addition	O
,	O
if	O
ISIS	O
is	O
indeed	O
responsible	O
,	O
this	O
case	O
suggests	O
how	O
easy	O
it	O
is	O
for	O
belligerents	O
in	O
a	O
conflict	O
to	O
begin	O
fielding	O
basic	O
offensive	O
digital	O
capabilities	O
,	O
and	O
how	O
quickly	O
the	O
capabilities	O
can	O
be	O
pointed	O
at	O
unarmed	O
civil	O
society	O
groups	O
.	O
	
This	O
attack	O
was	O
exceptionally	O
targeted	O
,	O
and	O
clearly	O
reflected	O
the	O
work	O
of	O
an	O
actor	O
familiar	O
with	O
the	O
operations	O
of	O
the	O
targeted	O
organization	O
.	O
	
As	O
most	O
organizations	O
working	O
on	O
issues	O
surrounding	O
Syria	O
are	O
aware	O
,	O
malware	O
delivered	O
with	O
good	O
social	O
engineering	O
is	O
a	O
constant	O
source	O
of	O
danger	O
.	O
	
This	O
particular	O
attack	O
can	O
be	O
prevented	O
by	O
not	O
opening	O
files	O
sent	O
by	O
unknown	O
persons	O
.	O
	
However	O
,	O
many	O
attacks	O
in	O
Syria	O
come	O
from	O
hijacked	O
accounts	O
and	O
impersonate	O
people	O
known	O
to	O
the	O
targets	O
.	O
	
Social	O
engineering	O
remains	O
an	O
unsolved	O
problem	O
,	O
and	O
continues	O
to	O
compromise	O
groups	O
throughout	O
the	O
Syrian	O
opposition	O
and	O
their	O
supporters	O
.	O
	
This	O
attack	O
reaffirms	O
the	O
dangers	O
posed	O
by	O
social	O
engineering	O
attacks	O
,	O
whether	O
they	O
deliver	O
phishing	O
campaigns	O
or	O
malware	O
.	O
	
The	O
circumstantial	O
evidence	O
of	O
ISIS	O
involvement	O
suggests	O
that	O
groups	O
working	O
on	O
topics	O
that	O
ISIS	O
considers	O
a	O
threat	O
,	O
and	O
their	O
partner	O
organizations	O
and	O
supporters	O
,	O
should	O
urgently	O
examine	O
their	O
security	O
policies	O
and	O
assess	O
the	O
possible	O
risks	O
to	O
their	O
operations	O
,	O
and	O
the	O
consequences	O
of	O
exposure	O
of	O
sensitive	O
information	O
to	O
ISIS	O
.	O
	
Even	O
if	O
the	O
link	O
to	O
ISIS	O
turns	O
out	O
to	O
be	O
incorrect	O
,	O
it	O
is	O
possible	O
that	O
this	O
will	O
be	O
a	O
threat	O
in	O
the	O
future	O
.	O
	
Individuals	O
and	O
groups	O
at	O
risk	O
can	O
also	O
consult	O
materials	O
in	O
Arabic	O
provided	O
by	O
Cyber	O
Arabs	O
including	O
a	O
series	O
of	O
very	O
accessible	O
videos	O
on	O
digital	O
security	O
.	O
	
The	B-Entity
malware	I-Entity
files	B-Verb
Files	B-Entity
dropped	B-Verb
by	O
the	O
malware	O
Collected	O
Information	O
Files	O
(	O
unencrypted	O
)	O
Exfiltrated	O
file	O
(	O
encrypted	O
)	O
Registry	O
Keys	O
Acknowledgements	O
:	O
We	O
are	O
grateful	O
to	O
Cyber	O
Arabs	O
and	O
the	O
Institute	O
for	O
War	O
and	O
Peace	O
Reporting	O
for	O
their	O
critical	O
work	O
and	O
assistance	O
.	O
	
Special	O
thanks	O
to	O
:	O
several	O
anonymous	O
Syrians	O
,	O
Masashi	O
Crete-Nishihata	O
,	O
Sarah	O
McKune	O
,	O
Morgan	O
Marquis-Boire	O
,	O
Ron	O
Deibert	O
,	O
Bill	O
Marczak	O
,	O
Nart	O
Villeneuve	O
,	O
Irene	O
Poetranto	O
,	O
and	O
Kristen	O
Dennesen	O
.	O
	
Support	O
for	O
this	O
research	O
is	O
provided	O
by	O
grants	O
from	O
the	O
John	O
D.	O
and	O
Catherine	O
T.	O
MacArthur	O
Foundation	O
and	O
the	O
Ford	O
Foundation	O
.	O
	
In	O
February	O
2014	O
,	O
the	O
experts	O
of	O
the	O
G	O
DATA	O
SecurityLabs	O
published	O
an	O
analysis	O
of	O
Uroburos	O
,	O
the	O
rootkit	O
with	O
Russian	O
roots	O
.	O
	
We	O
explained	O
that	O
a	O
link	O
exists	O
between	O
Uroburos	O
and	O
the	O
Agent.BTZ	O
malware	O
,	O
which	O
was	O
responsible	O
for	O
''	O
the	O
most	O
significant	O
breach	O
of	O
U.S.	O
military	O
computers	O
ever	O
.	O
	
''	O
Nine	O
months	O
later	O
,	O
after	O
the	O
buzz	O
around	O
Uroburos	O
,	O
aka	O
Snake	O
or	O
Turla	O
,	O
we	O
now	O
identified	O
a	O
new	O
generation	O
of	O
Agent.BTZ	O
.	O
	
We	O
dubbed	O
it	O
ComRAT	O
and	O
,	O
by	O
now	O
,	O
analyzed	O
two	O
versions	O
of	O
the	O
threat	O
(	O
v3.25	O
and	O
v3.26	O
)	O
.	O
	
As	O
reported	O
earlier	O
this	O
year	O
,	O
Agent.BTZ	B-Entity
used	B-Verb
the	B-Entity
same	I-Entity
encoding	I-Entity
key	I-Entity
and	I-Entity
the	I-Entity
installation	I-Entity
log	I-Entity
file	I-Entity
name	I-Entity
as	B-Preposition
Uroburos	B-Entity
.	O
	
ComRAT	O
,	O
in	O
its	O
version	O
3.25	O
,	O
shows	O
the	O
same	O
behavior	O
.	O
	
Furthermore	O
,	O
the	B-Entity
attackers	I-Entity
also	O
shared	B-Verb
a	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
domain	I-Entity
.	O
	
The	O
latest	O
version	O
of	O
ComRAT	O
known	O
to	O
us	O
(	O
v3.26	O
)	O
uses	O
a	O
new	O
key	O
and	O
does	O
not	O
create	O
the	O
installation	O
log	O
file	O
,	O
in	O
order	O
to	O
complicate	O
the	O
analysis	O
and	O
to	O
disguise	O
the	O
link	O
between	O
the	O
two	O
cases	O
.	O
	
Another	O
very	O
interesting	O
fact	O
:	O
the	O
attackers	O
use	O
COM	O
Object	O
hijacking	O
,	O
the	O
same	O
persistence	O
mechanism	O
as	O
COMpfun	O
,	O
which	O
we	O
described	O
recently	O
.	O
	
Taken	O
everything	O
into	O
consideration	O
,	O
the	O
indications	O
we	O
saw	O
during	O
our	O
analyzes	O
lead	O
to	O
the	O
supposition	O
that	O
the	O
group	O
behind	O
Agent.BTZ	O
and	O
Uroburos	O
is	O
still	O
active	O
and	O
is	O
pursuing	O
the	O
Agent.BTZ	O
path	O
once	O
more	O
to	O
improve	O
and	O
change	O
the	O
RAT	O
.	O
	
The	O
analyzed	O
file	O
is	O
the	O
latest	O
version	O
we	O
identified	O
:	O
v3.26	O
.	O
	
The	O
version	O
identification	O
is	O
described	O
in	O
the	O
chapter	O
''	O
Log	O
files	O
''	O
.	O
	
The	O
major	O
difference	O
between	O
this	O
version	O
and	O
the	O
older	O
version	O
(	O
s	O
)	O
will	O
be	O
described	O
there	O
.	O
	
The	O
first	O
task	O
of	O
the	O
malware	O
is	O
to	O
install	B-Verb
the	B-Entity
file	I-Entity
credprov.tlb	I-Entity
in	I-Entity
%	I-Entity
APPDATA	I-Entity
%	I-Entity
\Microsoft\	I-Entity
.	O
	
This	O
file	O
is	O
the	O
main	O
payload	O
of	O
the	O
malware	O
.	O
	
The	B-Entity
dropper	I-Entity
executes	B-Verb
the	B-Entity
following	I-Entity
command	I-Entity
in	B-Preposition
order	I-Preposition
to	I-Preposition
install	B-Entity
a	I-Entity
second	I-Entity
file	I-Entity
:	O
The	O
second	O
file	O
is	O
shdocw.tlp	O
.	O
	
The	O
two	O
files	O
are	O
Microsoft	O
Windows	O
dynamic	O
libraries	O
.	O
	
To	O
be	B-Verb
started	I-Verb
during	B-Preposition
the	B-Entity
boot	I-Entity
process	I-Entity
of	I-Entity
the	I-Entity
infected	I-Entity
machine	I-Entity
,	O
the	B-Entity
malware	I-Entity
creates	B-Verb
the	B-Entity
following	I-Entity
registry	I-Entity
key	I-Entity
:	O
This	O
registry	O
key	O
is	O
used	O
to	O
associate	O
the	O
library	O
shdocvw.tlp	O
to	O
the	O
object	O
42aedc87-2188-41fd-b9a3-0c966feabec1	O
as	O
previously	O
explained	O
in	O
the	O
article	O
about	O
COMpfun	O
.	O
	
The	O
purpose	O
is	O
to	O
load	B-Verb
the	B-Entity
library	I-Entity
into	B-Preposition
each	B-Entity
and	I-Entity
every	I-Entity
process	I-Entity
executed	I-Entity
on	I-Entity
the	I-Entity
infected	I-Entity
system	I-Entity
.	O
	
If	O
the	O
version	O
of	O
the	O
malware	O
is	O
older	O
than	O
3.26	O
,	O
the	B-Entity
dropper	I-Entity
creates	B-Verb
an	B-Entity
additional	I-Entity
file	I-Entity
called	I-Entity
winview.ocx	I-Entity
.	O
	
We	O
noticed	O
that	O
the	O
file	O
name	O
is	O
still	O
the	O
same	O
as	O
the	O
file	O
name	O
used	O
by	O
Agent.BTZ	O
in	O
the	O
past	O
.	O
	
The	O
file	O
is	O
xored	O
with	O
the	O
following	O
obfuscation	O
key	O
(	O
used	O
by	O
both	O
,	O
Uroburos	O
and	O
Agent.BTZ	O
)	O
:	O
Here	O
is	O
the	O
decoded	O
log	O
file	O
content	O
:	O
We	O
can	O
notice	O
that	O
the	O
malware	O
checks	O
if	O
an	O
older	O
version	O
is	O
installed	O
on	O
the	O
system	O
and	O
if	O
this	O
is	O
the	O
case	O
,	O
the	B-Entity
dropper	I-Entity
removes	B-Verb
the	B-Entity
older	I-Entity
version	I-Entity
.	O
	
In	O
contrast	O
to	O
this	O
,	O
in	O
our	O
Uroburos	O
analysis	O
,	O
we	O
found	O
out	O
that	O
Uroburos	O
does	O
not	O
install	O
itself	O
in	O
case	O
a	O
version	O
of	O
Agent.BTZ	O
was	O
found	O
on	O
a	O
system	O
.	O
	
During	O
the	O
startup	O
of	O
the	O
infected	O
machine	O
,	O
the	B-Entity
shdocvw.tlp	I-Entity
library	I-Entity
is	B-Verb
loaded	I-Verb
into	B-Preposition
all	B-Entity
processes	I-Entity
.	O
	
If	O
the	O
process	O
is	O
explorer.exe	O
,	O
this	B-Entity
library	I-Entity
will	O
load	B-Verb
the	B-Entity
other	I-Entity
library	I-Entity
called	I-Entity
credprov.tlb	I-Entity
.	O
	
This	O
library	O
is	O
the	O
real	O
payload	O
.	O
	
Its	O
features	O
are	O
common	O
for	O
a	O
Remote	O
Administration	O
Tool	O
(	O
RAT	O
)	O
:	O
ComRAT	B-Entity
's	I-Entity
communication	I-Entity
to	I-Entity
the	I-Entity
command	I-Entity
and	I-Entity
control	I-Entity
server	I-Entity
is	B-Verb
performed	I-Verb
by	O
the	O
browser	O
process	O
and	O
not	O
by	O
explorer.exe	O
in	O
order	O
to	O
avoid	O
being	O
blocked	O
by	O
a	O
firewall	O
on	O
the	O
system	O
or	O
any	O
additional	O
security	O
products	O
.	O
	
The	B-Entity
communication	I-Entity
between	I-Entity
the	I-Entity
processes	I-Entity
is	B-Verb
performed	I-Verb
by	O
named	O
pipe	O
.	O
	
Two	O
log	O
files	O
are	O
created	O
during	O
the	O
malware	O
execution	O
:	O
mskfp32.ocx	O
and	O
msvcrtd.tlb	O
.	O
	
If	O
the	O
malware	O
version	O
is	O
older	O
than	O
3.26	O
,	O
the	O
xored	O
key	O
is	O
the	O
same	O
as	O
the	O
dropper	O
key	O
.	O
	
Concerning	O
the	O
version	O
3.26	O
,	O
the	O
malware	O
uses	O
a	O
new	O
non-ASCII	O
key	O
.	O
	
Here	O
is	O
an	O
example	O
of	O
decoded	O
log	O
file	O
for	O
the	O
version	O
3.26	O
:	O
We	O
can	O
identify	O
the	O
version	O
of	O
the	O
malware	O
thanks	O
to	O
the	O
PVer	O
flag	O
.	O
	
The	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
server	I-Entity
information	I-Entity
is	B-Verb
stored	I-Verb
in	B-Preposition
the	B-Entity
registry	I-Entity
,	O
not	O
in	O
an	O
XML	O
,	O
and	O
encoded	O
:	O
For	O
example	O
,	O
in	O
the	O
analyzed	O
sample	O
the	O
CC	O
is	O
:	O
weather-online.hopto.org	O
.	O
	
This	O
domain	O
is	O
far	O
from	O
unknown	O
,	O
as	O
it	O
has	O
been	O
mentioned	O
in	O
BAE	O
System	O
's	O
Uroburos	O
(	O
aka	O
Snake	O
)	O
analysis	O
paper	O
as	O
C	O
&	O
C	O
server	O
domain	O
for	O
the	O
Uroburos	O
malware	O
.	O
	
Another	O
connection	O
between	O
the	O
cases	O
.	O
	
If	O
the	O
malware	O
version	O
in	O
lower	O
than	O
3.26	O
,	O
the	B-Entity
XML	I-Entity
log	I-Entity
file	I-Entity
contains	B-Verb
the	B-Entity
command	I-Entity
and	I-Entity
control	I-Entity
server	I-Entity
information	I-Entity
:	O
Let	O
us	O
summarize	O
the	O
similarities	O
and	O
differences	O
between	O
Agent.BTZ	O
,	O
Uroburos	O
and	O
ComRAT	O
as	O
far	O
as	O
we	O
can	O
:	O
Some	O
parts	O
of	O
the	O
code	O
are	O
exactly	O
the	O
same	O
(	O
appears	O
to	O
be	O
copy	O
&	O
paste	O
)	O
.	O
	
That	O
is	O
the	O
reason	O
why	O
the	B-Entity
sample	I-Entity
is	B-Verb
detected	I-Verb
as	B-Preposition
Uroburos	B-Entity
(	I-Entity
aka	I-Entity
Turla	I-Entity
)	I-Entity
.	O
	
The	O
same	O
code	O
was	O
used	O
by	O
Agent.BTZ	O
and	O
also	O
the	O
dll	O
loaded	O
into	O
userland	O
during	O
the	O
Uroburos	O
analysis	O
.	O
	
Command	O
and	O
control	O
server	O
domains	O
are	O
shared	O
between	O
Uroburos	O
and	O
ComRAT	O
.	O
	
In	O
version	O
3.26	O
,	O
the	O
author	O
changed	O
the	O
key	O
and	O
remove	O
the	O
known	O
file	O
name	O
.	O
	
This	O
action	O
can	O
be	O
an	O
indication	O
for	O
the	O
developer	O
's	O
effort	O
to	O
hide	O
this	O
connection	O
.	O
	
The	O
main	O
difference	O
is	O
the	O
design	O
.	O
	
Agent.BTZ	O
is	O
a	O
common	O
RAT	O
,	O
a	O
simple	O
library	O
executed	O
on	O
an	O
infected	O
machine	O
.	O
	
ComRAT	O
is	O
more	O
complex	O
and	O
cleverer	O
.	O
	
The	B-Entity
malware	I-Entity
is	B-Verb
loaded	I-Verb
into	B-Preposition
each	B-Entity
and	I-Entity
every	I-Entity
process	I-Entity
of	I-Entity
the	I-Entity
infected	I-Entity
machine	I-Entity
and	I-Entity
the	I-Entity
main	I-Entity
part	I-Entity
(	I-Entity
payload	I-Entity
)	I-Entity
of	I-Entity
the	I-Entity
malware	I-Entity
is	B-Verb
only	I-Verb
executed	I-Verb
in	B-Preposition
explorer.exe	B-Entity
.	O
	
Furthermore	O
,	O
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
communication	I-Entity
blends	B-Verb
into	B-Preposition
the	B-Entity
usual	I-Entity
browser	I-Entity
traffic	I-Entity
and	I-Entity
the	I-Entity
malware	I-Entity
communicates	B-Verb
to	B-Preposition
the	B-Entity
browser	I-Entity
by	I-Entity
named	I-Entity
pipe	I-Entity
.	O
	
It	O
is	O
by	O
far	O
a	O
more	O
complex	O
userland	O
design	O
than	O
Agent.BTZ	O
.	O
	
These	O
differences	O
,	O
mainly	O
the	O
more	O
complex	O
design	O
,	O
lead	O
us	O
to	O
give	O
this	O
malware	O
a	O
new	O
name	O
.	O
	
The	O
analyzed	O
dropper	O
of	O
v3.25	O
has	O
a	O
compilation	O
date	O
of	O
February	O
6th	O
2014	O
.	O
	
The	O
more	O
recent	O
dropper	O
of	O
v3.26	O
,	O
which	O
has	O
all	O
the	O
mentioned	O
changes	O
implemented	O
,	O
reveals	O
a	O
compilation	O
date	O
of	O
January	O
3rd	O
2013	O
.	O
	
We	O
suspect	O
that	O
this	O
date	O
is	O
spoofed	O
in	O
order	O
to	O
disguise	O
that	O
this	O
is	O
in	O
fact	O
a	O
newer	O
version	O
.	O
	
This	O
analysis	O
shows	O
that	O
even	O
after	O
the	O
Uroburos	O
publication	O
in	O
February	O
2014	O
,	O
the	O
group	O
behind	O
this	O
piece	O
of	O
malware	O
seems	O
to	O
be	O
still	O
active	O
.	O
	
In	O
any	O
case	O
,	O
the	O
ComRAT	O
developers	O
implemented	O
new	O
mechanisms	O
,	O
changed	O
keys	O
,	O
removed	B-Verb
log	B-Entity
files	I-Entity
to	O
hide	O
their	O
activities	O
and	O
tried	O
to	O
disguise	O
the	O
connections	O
between	O
the	O
RAT	O
ComRAT	O
,	O
the	O
rootkit	O
Uroburos	O
and	O
the	O
RAT	O
Agent.BTZ	O
as	O
much	O
as	O
possible	O
.	O
	
However	O
,	O
we	O
can	O
still	O
follow	O
the	O
evolution	O
of	O
the	O
malware	O
by	O
comparing	O
the	O
versions	O
.	O
	
The	O
persistence	O
mechanism	O
discovered	O
in	O
October	O
2014	O
makes	O
it	O
possible	O
to	O
intrude	O
into	O
a	O
system	O
in	O
a	O
really	O
discreet	O
manner	O
and	O
we	O
estimate	O
that	O
other	O
actors	O
will	O
use	O
the	O
same	O
persistence	O
mechanism	O
in	O
the	O
near	O
future	O
.	O
	
We	O
will	O
definitely	O
keep	O
our	O
ears	O
and	O
eyes	O
open	O
and	O
continue	O
analyzing	O
.	O
	
Cyber	O
espionage	O
has	O
been	O
a	O
hot	O
topic	O
through	O
the	O
last	O
years	O
.	O
	
Computer	O
attacks	O
known	O
as	O
''	O
APT	O
''	O
(	O
Advanced	O
Persistent	O
Threat	O
)	O
have	O
become	O
widely	O
reported	O
and	O
emphasized	O
by	O
the	O
media	O
,	O
damages	O
are	O
now	O
considered	O
as	O
real	O
and	O
strategic	O
trends	O
are	O
moving	O
in	O
cyber	O
defense	O
.	O
	
AIRBUS	O
Defence	O
&	O
Space	O
–	O
CyberSecurity	O
unit	O
responds	O
to	O
such	O
attacks	O
for	O
its	O
customers	O
every	O
day	O
,	O
developing	B-Verb
a	B-Entity
complete	I-Entity
range	I-Entity
of	I-Entity
solutions	I-Entity
.	O
	
Today	O
,	O
we	O
decided	O
to	O
release	O
publicly	O
information	O
on	O
a	O
specific	O
group	O
of	O
APT	O
attackers	O
known	O
as	O
''	O
Pitty	O
Tiger	O
''	O
.	O
	
This	O
information	O
comes	O
directly	O
from	O
investigations	O
led	O
by	O
our	O
Threat	O
Intelligence	O
.	O
	
Pitty	O
Tiger	O
is	O
a	O
group	O
of	O
attackers	O
that	O
have	O
been	O
active	O
since	O
at	O
least	O
2011	O
.	O
	
They	O
have	O
targeted	O
private	O
companies	O
in	O
several	O
sectors	O
,	O
such	O
as	O
defense	O
and	O
telecommunications	O
,	O
but	O
also	O
at	O
least	O
one	O
government	O
.	O
	
We	O
have	O
been	O
able	O
to	O
track	O
down	O
this	O
group	O
of	O
attackers	O
and	O
can	O
provide	O
detailed	O
information	O
about	O
them	O
.	O
	
We	O
were	O
able	O
to	O
collect	O
and	O
reveal	O
their	O
''	O
malware	O
arsenal	O
''	O
.	O
	
We	O
also	O
analyzed	O
their	O
technical	O
organization	O
.	O
	
Our	O
investigations	O
indicate	O
that	O
Pitty	O
Tiger	O
has	O
not	O
used	O
any	O
0day	O
vulnerability	O
so	O
far	O
,	O
rather	O
they	O
prefer	O
using	O
custom	O
malware	O
,	O
developed	O
for	O
the	O
group	O
's	O
exclusive	O
usage	O
.	O
	
Our	O
discoveries	O
indicate	O
that	O
Pitty	O
Tiger	O
is	O
a	O
group	O
of	O
attackers	O
with	O
the	O
ability	O
to	O
stay	B-Verb
under	B-Preposition
the	B-Entity
radar	I-Entity
,	O
yet	O
still	O
not	O
as	O
mature	O
as	O
other	O
groups	O
of	O
attackers	O
we	O
monitor	O
.	O
	
Pitty	O
Tiger	O
is	O
probably	O
not	O
a	O
state-sponsored	O
group	O
of	O
attackers	O
.	O
	
They	O
lack	O
the	O
experience	O
and	O
financial	O
support	O
that	O
one	O
would	O
expect	O
from	O
state-sponsored	O
attackers	O
.	O
	
We	O
suppose	O
this	O
group	O
is	O
opportunistic	O
and	O
sells	B-Verb
its	B-Entity
services	I-Entity
to	B-Preposition
probable	B-Entity
competitors	I-Entity
of	I-Entity
their	I-Entity
targets	I-Entity
in	I-Entity
the	I-Entity
private	I-Entity
sector	I-Entity
.	O
	
We	O
have	O
been	O
able	O
to	O
leverage	O
several	O
attackers	O
profiles	O
,	O
showing	O
that	O
the	O
Pitty	O
Tiger	O
group	O
is	O
fairly	O
small	O
compared	O
to	O
other	O
APT	O
groups	O
,	O
which	O
is	O
probably	O
why	O
we	O
saw	O
them	O
work	O
on	O
a	O
very	O
limited	O
amount	O
of	O
targets	O
.	O
	
At	O
the	O
end	O
of	O
this	O
report	O
,	O
we	O
provide	O
indicators	O
of	O
compromise	O
to	O
help	O
people	O
detect	O
current	O
Pitty	O
Tiger	O
attacks	O
.	O
	
APT	O
attacks	O
follow	O
what	O
we	O
call	O
the	O
''	O
APT	O
kill	O
chain	O
''	O
.	O
	
The	O
kill	O
chain	O
describes	O
briefly	O
the	O
way	O
attackers	O
do	O
perform	O
their	O
actions	O
.	O
	
It	O
can	O
be	O
summarized	O
by	O
the	O
following	O
scheme	O
:	O
The	O
reconnaissance	O
phase	O
commences	O
when	O
an	O
attacker	O
selects	O
a	O
new	O
target	O
and	O
involves	O
the	O
acquisition	O
of	O
information	O
about	O
that	O
target	O
.	O
	
There	O
is	O
very	O
little	O
information	O
available	O
about	O
this	O
phase	O
,	O
and	O
there	O
is	O
little	O
data	O
about	O
it	O
.	O
	
The	O
only	O
way	O
to	O
collect	O
information	O
about	O
this	O
phase	O
would	O
be	O
to	O
already	O
monitor	O
all	O
attackers	O
'	O
actions	O
at	O
this	O
step	O
,	O
which	O
is	O
hardly	O
feasible	O
.	O
	
The	O
longer	O
the	O
attackers	O
spend	O
time	O
in	O
attempting	O
to	O
understand	O
their	O
target	O
and	O
its	O
online	O
presence	O
,	O
the	O
easier	O
it	O
will	O
be	O
to	O
find	O
efficient	O
ways	O
to	O
penetrate	O
that	O
company	O
's	O
systems	O
.	O
	
This	O
reconnaissance	O
phase	O
is	O
both	O
about	O
finding	O
information	O
to	O
break	O
into	O
the	O
targeted	O
network	O
successfully	O
and	O
about	O
searching	O
for	O
data	O
which	O
could	O
help	O
to	O
accelerate	O
sensitive	O
information	O
isolation	O
(	O
like	O
the	O
name	O
of	O
a	O
key	O
employee	O
for	O
example	O
)	O
.	O
	
This	O
phase	O
mostly	O
relies	O
on	O
open	O
sources	O
from	O
the	O
Internet	O
:	O
social	O
networks	O
,	O
press	O
releases	O
,	O
white	O
papers	O
,	O
corporate	O
websites	O
,	O
search	O
engines	O
,	O
but	O
also	O
on	O
some	O
active	O
tools	O
like	O
vulnerability	O
scanners	O
etc	O
.	O
	
At	O
this	O
stage	O
,	O
the	O
APT	O
attackers	O
have	O
a	O
solid	O
knowledge	O
of	O
their	O
target	O
and	O
its	O
key	O
employees	O
.	O
	
The	O
attackers	O
have	O
everything	O
they	O
need	O
to	O
start	O
looking	O
for	O
an	O
entry	O
point	O
to	O
the	O
company	O
's	O
network	O
and	O
establish	O
one	O
or	O
several	O
permanent	O
backdoors	O
into	O
the	O
environment	O
.	O
	
The	B-Entity
attackers	I-Entity
mostly	O
rely	O
on	O
two	O
techniques	O
here	O
to	O
infect	O
one	O
or	O
several	O
computers	O
,	O
usually	O
workstations	O
,	O
inside	O
the	O
target	O
's	O
network	O
:	O
spear	O
phishing	O
and	O
drive-by	O
downloads	O
.	O
	
Spear	B-Entity
phishing	I-Entity
can	O
be	B-Verb
described	I-Verb
as	B-Preposition
targeted	B-Entity
e-mail	I-Entity
phishing	I-Entity
.	O
	
In	O
a	O
spear	O
phishing	O
scheme	O
,	O
attackers	O
send	O
very	O
few	O
e-mails	O
to	O
targeted	O
people	O
.	O
	
In	O
fact	O
,	O
they	B-Entity
can	O
even	O
send	O
just	O
a	O
single	O
e-mail	O
.	O
	
The	O
trick	O
is	O
to	O
target	B-Verb
the	B-Entity
right	I-Entity
victim	I-Entity
and	O
provide	O
it	O
with	O
the	O
right	O
content	O
,	O
so	O
that	O
they	O
will	O
click	O
on	O
a	O
link	O
leading	O
to	O
drive-by	O
download	O
of	O
a	O
malware	O
,	O
or	O
open	O
an	O
attached	O
file	O
which	O
will	O
infect	O
their	O
computer	O
.	O
	
Some	O
groups	O
of	O
attackers	O
also	O
use	B-Verb
''	B-Entity
watering	I-Entity
hole	I-Entity
''	I-Entity
techniques	I-Entity
to	O
successfully	O
compromise	O
their	O
targets	O
.	O
	
To	O
build	O
a	O
watering	O
hole	O
attack	O
,	O
attackers	O
do	O
compromise	O
the	O
website	O
of	O
a	O
third	O
party	O
,	O
generally	O
a	O
supplier	O
of	O
the	O
target	O
,	O
which	O
is	O
typically	O
visited	O
by	O
a	O
specific	O
group	O
of	O
professionals	O
and	O
very	O
likely	O
by	O
the	O
target	O
.	O
	
Every	O
visitor	O
of	O
the	O
compromised	O
third	O
party	O
is	O
then	O
infected	O
.	O
	
The	O
method	O
has	O
one	O
major	O
drawback	O
:	O
it	B-Entity
will	O
also	O
infect	O
third	O
parties	O
who	O
visit	O
the	O
website	O
.	O
	
Attackers	O
have	O
developed	O
ways	O
to	O
avoid	O
this	O
.	O
	
If	O
their	O
reconnaissance	O
phase	O
has	O
been	O
done	O
effectively	O
,	O
they	O
already	O
know	O
all	O
IP	O
ranges	O
used	O
by	O
the	O
target	O
company	O
.	O
	
It	O
just	O
takes	O
a	O
few	O
lines	O
of	O
code	O
in	O
the	O
infecting	O
script	O
to	O
only	O
compromise	B-Verb
visitors	B-Entity
coming	I-Entity
from	I-Entity
the	I-Entity
target	I-Entity
IP	I-Entity
ranges	I-Entity
.	O
	
Direct	B-Entity
attacks	I-Entity
against	I-Entity
servers	I-Entity
of	I-Entity
the	I-Entity
target	I-Entity
can	O
also	O
be	O
a	O
way	O
to	O
penetrate	O
the	O
target	O
's	O
network	O
.	O
	
Attackers	O
have	O
gained	B-Verb
access	B-Entity
to	I-Entity
one	I-Entity
or	I-Entity
several	I-Entity
machines	I-Entity
inside	B-Preposition
the	B-Entity
target	I-Entity
's	I-Entity
corporate	I-Entity
network	I-Entity
.	O
	
They	O
need	O
to	O
install	O
several	O
different	O
backdoors	O
in	O
order	O
to	O
be	O
able	O
to	O
always	O
access	O
the	O
network	O
.	O
	
In	O
case	O
one	O
backdoor	O
falls	O
,	O
there	O
will	O
be	O
others	O
.	O
	
As	O
soon	O
as	O
the	O
attackers	O
are	O
sure	O
they	O
have	O
enough	O
access	O
,	O
they	O
start	O
looking	O
for	O
two	O
things	O
:	O
intellectual	O
property	O
(	O
or	O
anything	O
else	O
they	O
want	O
to	O
know	O
or	O
steal	O
)	O
in	O
alignment	O
with	O
predefined	O
mission	O
objectives	O
,	O
and	O
a	O
means	O
of	O
privilege	O
escalation	O
to	O
facilitate	O
lateral	O
movement	O
within	O
the	O
compromised	O
environment	O
.	O
	
It	O
generally	O
does	O
not	O
take	O
long	O
before	O
the	O
attackers	O
gain	O
domain	O
administrator	O
privileges	O
and	O
dump	B-Verb
all	B-Entity
the	I-Entity
Active	I-Entity
Directory	I-Entity
content	I-Entity
.	O
	
They	B-Entity
use	O
lateral	O
moves	O
between	O
machines	O
inside	O
the	O
network	O
,	O
and	O
look	O
for	O
everything	O
they	O
need	O
.	O
	
This	O
step	O
is	O
very	O
hard	O
to	O
detect	O
,	O
since	O
they	O
only	O
use	B-Verb
valid	B-Entity
credentials	I-Entity
and	I-Entity
legitimate	I-Entity
administration	I-Entity
tools	I-Entity
such	I-Entity
as	I-Entity
PsExec	I-Entity
.	O
	
Data	O
exfiltration	O
is	O
the	O
last	O
step	O
before	O
the	O
attackers	O
loop	O
to	O
the	O
lateral	O
moves	O
step	O
,	O
in	O
a	O
never-ending	O
circle	O
of	O
prolonged	O
access	O
and	O
information	O
theft	O
.	O
	
They	B-Entity
generally	O
create	O
archive	O
files	O
containing	O
the	O
content	O
they	O
want	O
to	O
exfiltrate	O
,	O
which	O
are	O
then	O
sent	B-Verb
to	B-Preposition
the	B-Entity
attackers	I-Entity
by	B-Preposition
using	B-Entity
a	I-Entity
remote	I-Entity
administration	I-Entity
tool	I-Entity
(	I-Entity
RAT	I-Entity
)	I-Entity
or	I-Entity
transfer	I-Entity
protocols	I-Entity
such	I-Entity
as	I-Entity
FTP	I-Entity
and	I-Entity
HTTP	I-Entity
.	O
	
This	O
phase	O
is	O
not	O
the	O
end	O
of	O
an	O
APT	O
attack	O
.	O
	
The	O
attackers	O
loop	O
to	O
the	O
access	O
strengthening/lateral	O
moves	O
stage	O
and	O
generally	O
keep	O
stealing	O
more	O
information	O
and	O
stay	B-Verb
inside	B-Preposition
the	B-Entity
network	I-Entity
for	B-Preposition
more	B-Entity
data	I-Entity
gathering	I-Entity
.	O
	
For	O
more	O
information	O
about	O
all	O
the	O
APT	O
phases	O
,	O
please	O
refer	O
to	O
our	O
APT	O
Kill	O
Chain	O
blog	O
post	O
serie	O
.	O
	
During	O
our	O
regular	O
investigations	O
on	O
APT	O
cases	O
,	O
one	O
particular	O
variant	O
of	O
malware	O
caught	O
our	O
attention	O
,	O
because	O
we	O
had	O
not	O
faced	O
it	O
before	O
.	O
	
We	O
decided	O
to	O
spend	O
some	O
time	O
to	O
investigate	O
around	O
this	O
malware	O
and	O
found	O
out	O
that	O
it	O
was	O
used	O
exclusively	O
by	O
a	O
single	O
group	O
of	O
attackers	O
.	O
	
This	O
malware	O
family	O
is	O
known	O
as	O
''	O
PittyTiger	O
''	O
by	O
the	O
anti-virus	O
research	O
community	O
.	O
	
We	O
discovered	O
this	O
malware	O
sample	O
in	O
June	O
2014	O
,	O
leading	B-Verb
to	B-Preposition
a	B-Entity
command	I-Entity
&	I-Entity
control	I-Entity
(	I-Entity
c	I-Entity
&	I-Entity
c	I-Entity
)	I-Entity
server	I-Entity
still	O
in	O
activity	O
.	O
	
Our	O
researches	O
around	O
this	O
particular	O
malware	O
family	O
revealed	O
the	O
''	O
Pitty	O
Tiger	O
''	O
group	O
has	O
been	O
active	O
since	O
2011	O
,	O
yet	O
we	O
found	O
other	O
publications	O
which	O
could	O
probably	O
be	O
attributed	O
to	O
the	O
same	O
group	O
of	O
attacker	O
back	O
in	O
2010	O
.	O
	
This	O
group	O
uses	O
other	O
malware	O
and	O
tools	O
during	O
their	O
APT	O
operations	O
,	O
in	O
addition	O
to	O
the	O
PittyTiger	O
RAT	O
.	O
	
A	O
variant	O
of	O
the	O
infamous	O
Gh0st	O
RAT	O
dubbed	O
''	O
Paladin	O
''	O
has	O
been	O
used	O
repeatedly	O
by	O
the	O
PT	O
group	O
,	O
together	O
with	O
other	O
RATs	O
which	O
seem	O
to	O
be	O
developed	O
exclusively	O
for	O
the	O
PT	O
group	O
:	O
''	O
MM	O
RAT	O
''	O
(	O
aka	O
Troj/Goldsun-B	O
)	O
,	O
and	O
''	O
CT	O
RAT	O
''	O
.	O
	
Another	O
variant	O
of	O
Gh0st	O
RAT	O
named	O
''	O
Leo	O
''	O
has	O
been	O
found	O
inactive	O
on	O
a	O
c	O
&	O
c	O
server	O
.	O
	
We	O
also	O
found	O
another	O
malware	O
,	O
named	O
''	O
Troj/ReRol.A	O
''	O
.	O
	
This	O
one	O
is	O
also	O
used	O
by	O
the	O
group	O
to	O
infect	O
workstations	O
,	O
collect	B-Verb
system	B-Entity
information	I-Entity
,	O
and	O
install	B-Verb
more	B-Entity
malware	I-Entity
on	I-Entity
the	I-Entity
infected	I-Entity
computer	I-Entity
.	O
	
It	O
acts	O
as	O
a	O
first	O
stage	O
downloader	O
and	O
system	O
data	O
collector	O
often	O
used	B-Verb
in	B-Preposition
the	B-Entity
initial	I-Entity
compromise	I-Entity
of	I-Entity
the	I-Entity
Pitty	I-Entity
Tiger	I-Entity
campaigns	I-Entity
,	I-Entity
generally	I-Entity
embedded	I-Entity
in	I-Entity
Microsoft	I-Entity
Office	I-Entity
documents	I-Entity
.	O
	
Thanks	O
to	O
server	O
's	O
misconfigurations	O
,	O
we	O
managed	O
to	O
get	B-Verb
information	B-Entity
from	B-Preposition
three	B-Entity
c	I-Entity
&	I-Entity
c	I-Entity
servers	I-Entity
used	B-Verb
by	O
this	O
group	O
of	O
attackers	O
,	O
which	O
provided	O
us	O
with	O
insight	O
from	O
the	O
end	O
of	O
2013	O
to	O
the	O
beginning	O
of	O
July	O
2014	O
.	O
	
Our	O
investigation	O
has	O
been	O
focused	O
on	O
the	O
data	O
we	O
could	O
get	O
from	O
these	O
c	O
&	O
c	O
servers	O
but	O
also	O
on	O
the	O
Pitty	O
Tiger	O
environment	O
.	O
	
This	O
whitepaper	O
aims	O
to	O
expose	O
the	O
view	O
we	O
have	O
on	O
the	O
group	O
,	O
especially	O
on	O
their	O
infrastructure	O
and	O
capabilities	O
.	O
	
We	O
hope	O
this	O
publication	O
will	O
bring	O
further	O
counter	O
analysis	O
from	O
the	O
research	O
community	O
to	O
enrich	O
the	O
global	O
common	O
threat	O
knowledge	O
.	O
	
Pitty	O
Tiger	O
,	O
like	O
most	O
other	O
APT	O
groups	O
,	O
use	O
spear	O
phishing	O
e-mails	O
extensively	O
in	O
order	O
to	O
gain	O
an	O
initial	O
foothold	O
within	O
the	O
targeted	O
environment	O
.	O
	
We	O
have	O
been	O
able	O
to	O
find	B-Verb
a	B-Entity
spear	I-Entity
phishing	I-Entity
e-mail	I-Entity
crafted	I-Entity
by	I-Entity
the	I-Entity
attackers	I-Entity
.	O
	
This	O
e-mail	O
spoofed	O
the	O
identity	O
of	O
an	O
employee	O
of	O
a	O
targeted	O
company	O
:	O
The	O
attached	O
file	O
is	O
a	O
Microsoft	O
Office	O
Word	O
document	O
triggering	O
CVE-2014-1761	O
to	O
infect	B-Verb
the	B-Entity
computer	I-Entity
it	B-Entity
is	B-Verb
sent	I-Verb
to	B-Preposition
:	O
While	O
this	O
example	O
looks	O
very	O
''	O
amateur	O
''	O
for	O
a	O
spear	O
phishing	O
attempt	O
,	O
we	O
suppose	O
the	O
group	O
has	O
conducted	O
more	O
advanced	O
spear	O
phishing	O
campaigns	O
,	O
based	O
on	O
the	O
fact	O
that	O
we	O
found	O
infected	O
Word	O
documents	O
showing	O
content	O
stolen	O
from	O
victims	O
of	O
the	O
group	O
.	O
	
These	O
documents	O
were	O
infecting	O
the	O
system	O
with	O
Troj/ReRol.A	O
malware	O
,	O
which	O
we	O
will	O
detail	O
later	O
in	O
this	O
report	O
.	O
	
This	O
could	O
mean	O
that	O
the	O
Pitty	O
Tiger	O
group	O
is	O
using	O
stolen	O
material	O
as	O
spear	O
phishing	O
content	O
either	O
to	O
target	B-Verb
other	B-Entity
persons	I-Entity
in	I-Entity
the	I-Entity
compromised	I-Entity
company	I-Entity
,	O
or	O
to	O
target	O
other	O
persons	O
in	O
a	O
competitor's	O
company	O
,	O
or	O
more	O
generally	O
to	O
compromise	B-Verb
another	B-Entity
target	I-Entity
.	O
	
Pitty	O
Tiger	O
also	O
seem	O
to	O
use	O
fake	O
Microsoft	O
Office	O
Excel	O
content	O
,	O
yet	O
we	O
could	O
only	O
find	O
empty	O
content	O
delivering	O
once	O
again	O
the	O
Troj/ReRol.A	O
malware	O
.	O
	
Although	O
we	O
have	O
not	O
been	O
able	O
to	O
find	O
evidences	O
of	O
any	O
attack	O
aimed	O
at	O
exploiting	O
vulnerabilities	O
on	O
the	O
group	O
's	O
targets	O
servers	O
,	O
we	O
have	O
been	O
able	O
to	O
record	O
several	O
vulnerability	O
scanning	O
launched	O
from	O
one	O
c	O
&	O
c	O
server	O
straight	O
to	O
the	O
targets	O
.	O
	
The	O
attackers	O
have	O
been	O
using	O
different	O
vulnerability	O
scanners	O
aimed	O
at	O
their	O
targets	O
.	O
	
While	O
some	O
targets	O
have	O
been	O
scanned	O
with	O
''	O
generic	O
''	O
vulnerability	O
scanning	O
tools	O
like	O
HScan	O
or	O
Fluxay	O
and	O
port	O
scanners	O
like	O
Nmap	O
,	O
some	O
other	O
targets	O
have	O
been	O
scanned	O
for	O
very	O
specific	O
vulnerabilities	O
,	O
like	O
a	O
ZyWALL	O
vulnerability	O
or	O
a	O
FORTINET	O
product	O
.	O
	
We	O
have	O
also	O
been	O
able	O
to	O
testify	O
that	O
the	O
Pitty	O
Tiger	O
group	O
has	O
successfully	O
collected	B-Verb
information	B-Entity
on	B-Preposition
some	B-Entity
of	I-Entity
their	I-Entity
targets	I-Entity
by	B-Preposition
exploiting	B-Entity
the	I-Entity
HeartBleed	I-Entity
bug	I-Entity
.	O
	
This	O
vulnerability	O
which	O
exists	O
on	O
some	O
old	O
versions	O
of	O
OpenSSL	O
allows	O
attackers	B-Entity
to	O
collect	B-Verb
data	B-Entity
from	I-Entity
chunks	I-Entity
of	I-Entity
memory	I-Entity
from	B-Preposition
the	B-Entity
targeted	I-Entity
machine	I-Entity
.	O
	
It	O
allowed	O
the	B-Entity
Pitty	I-Entity
Tiger	I-Entity
group	I-Entity
to	B-Preposition
get	B-Entity
admin	I-Entity
credentials	I-Entity
from	B-Preposition
at	B-Entity
least	I-Entity
one	I-Entity
target	I-Entity
,	O
for	O
example	O
.	O
	
Running	O
automated	O
vulnerability	O
scanners	O
on	O
whole	O
ranges	O
of	O
IP	O
addresses	O
used	O
by	O
the	O
targets	O
or	O
on	O
several	O
domains	O
is	O
a	O
very	O
noisy	O
way	O
to	O
collect	B-Verb
information	B-Entity
and	O
find	O
server	O
vulnerabilities	O
.	O
	
We	O
would	O
advocate	O
that	O
this	O
method	O
is	O
unwise	O
when	O
you	O
want	O
to	O
stay	O
furtive	O
,	O
and	O
doing	O
it	O
from	O
a	O
c	O
&	O
c	O
server	O
is	O
very	O
surprising	O
,	O
to	O
say	O
the	O
least	O
.	O
	
While	O
the	O
Pitty	O
Tiger	O
group	O
is	O
experienced	O
on	O
some	O
aspects	O
on	O
its	O
running	O
APT	O
campaigns	O
,	O
it	O
definitely	O
lacks	O
some	O
maturity	O
here	O
.	O
	
One	O
of	O
the	O
favorite	O
methods	O
used	O
by	O
the	O
Pitty	O
Tiger	O
group	O
to	O
infect	O
users	O
is	O
to	O
use	B-Verb
a	B-Entity
Microsoft	I-Entity
Office	I-Entity
Word	I-Entity
document	I-Entity
which	O
exploits	O
a	O
specific	O
vulnerability	O
.	O
	
The	O
payload	O
infecting	O
the	O
system	O
is	O
malware	O
known	O
as	O
''	O
Troj/ReRol.A	O
''	O
.	O
	
It	O
is	O
generally	O
the	O
first	O
step	O
of	O
the	O
initial	O
compromise	O
for	O
Pitty	O
Tiger	O
campaigns	O
.	O
	
We	O
have	O
been	O
able	O
to	O
find	O
one	O
such	O
document	O
used	O
by	O
that	O
group	O
of	O
attacker	O
,	O
exploiting	O
CVE-	O
2012-0158	O
,	O
an	O
old	O
critical	O
vulnerability	O
impacting	O
Microsoft	O
Office	O
and	O
corrected	O
by	O
Microsoft's	O
MS12-027	O
fix	O
in	O
April	O
2012	O
.	O
	
This	O
vulnerability	O
affects	O
Microsoft	O
Office	O
versions	O
up	O
to	O
Office	O
2010	O
.	O
	
We	O
also	O
found	O
one	O
RTF	O
document	O
embedding	O
CVE-2014-1761	O
,	O
which	O
is	O
a	O
more	O
recent	O
exploit	O
.	O
	
We	O
discovered	O
several	O
different	O
documents	O
spreading	O
this	O
malware	O
by	O
triggering	O
CVE-2012-0158	O
vulnerability	O
,	O
yet	O
we	O
could	O
not	O
share	O
them	O
in	O
this	O
report	O
,	O
since	O
these	O
documents	O
contain	O
information	O
about	O
victims	O
of	O
the	O
Pitty	O
Tiger	O
group	O
.	O
	
The	O
discovery	O
of	O
this	O
''	O
old	O
''	O
vulnerability	O
exploitation	O
in	O
June	O
2014	O
could	O
mean	O
that	O
the	O
Pitty	O
Tiger	O
group	O
has	O
no	O
direct	O
access	O
to	O
0day	O
exploits	O
,	O
or	O
not	O
enough	O
budgets	O
to	O
buy	O
some	O
.	O
	
It	O
could	O
also	O
mean	O
they	O
use	O
their	O
low	O
range	O
exploit	O
by	O
default	O
because	O
it	O
is	O
working	O
on	O
their	O
targets	O
and	O
is	O
sufficient	O
to	O
compromise	O
their	O
workstations	O
.	O
	
The	O
Word	O
document	O
we	O
initially	O
found	O
was	O
probably	O
a	O
''	O
test	O
''	O
document	O
used	O
by	O
the	O
group	O
.	O
	
When	O
opened	O
,	O
it	O
shows	O
a	O
single	O
line	O
written	O
in	O
Chinese	O
language	O
,	O
which	O
can	O
be	O
translated	O
as	O
''	O
Hello	O
!	O
''	O
When	O
successfully	O
triggered	O
,	O
the	O
exploit	O
infects	O
the	O
host	O
by	O
dropping	O
and	O
executing	O
a	O
file	O
named	O
''	O
svohost.exe	O
''	O
in	O
the	O
temporary	O
folder	O
of	O
the	O
currently	O
logged-in	O
user	O
:	O
This	O
binary	O
is	O
''	O
Troj/ReRol.A	O
''	O
according	O
to	O
Sophos	O
naming	O
convention	O
.	O
	
It	O
immediately	O
triggers	O
alarms	O
on	O
our	O
sandbox	O
:	O
The	O
binary	O
drops	O
a	O
copy	O
of	O
itself	O
in	O
the	O
Application	O
Data	O
folder	O
of	O
the	O
currently	O
logged-in	O
user	O
:	O
The	O
malware	O
initiates	O
a	O
communication	O
to	O
time.windows.com	O
to	O
check	O
for	O
connectivity	O
,	O
and	O
then	O
communicates	O
with	O
the	O
c	O
&	O
c	O
server	O
at	O
mac.avstore.com.tw	O
.	O
	
Very	O
few	O
variants	O
of	O
Troj/ReRol.A	O
are	O
public	O
.	O
	
The	O
variants	O
we	O
have	O
seen	O
did	O
use	O
that	O
same	O
User-	O
Agent	O
:	O
The	B-Entity
persistence	I-Entity
mechanism	I-Entity
used	B-Verb
by	O
the	B-Entity
malware	I-Entity
is	B-Verb
the	B-Entity
creation	I-Entity
of	I-Entity
a	I-Entity
registry	I-Entity
key	I-Entity
named	I-Entity
''	I-Entity
Shell	I-Entity
''	I-Entity
containing	I-Entity
the	I-Entity
path	I-Entity
to	B-Preposition
the	B-Entity
malware	I-Entity
on	B-Preposition
the	B-Entity
infected	I-Entity
system	I-Entity
:	O
The	O
payload	O
of	O
this	O
malware	O
is	O
used	O
to	O
collect	B-Verb
information	B-Entity
on	B-Preposition
the	B-Entity
newly	I-Entity
infected	I-Entity
host	I-Entity
,	O
and	O
send	B-Verb
it	B-Entity
back	B-Preposition
to	I-Preposition
the	B-Entity
c	I-Entity
&	I-Entity
c	I-Entity
server	I-Entity
.	O
	
It	B-Entity
can	O
also	O
download	B-Verb
and	O
execute	B-Verb
binaries	B-Entity
.	O
	
The	B-Entity
data	I-Entity
sent	I-Entity
in	I-Entity
the	I-Entity
POST	I-Entity
request	I-Entity
has	O
a	O
0x11	O
bytes	O
header	O
consisting	O
of	O
a	O
fixed-value	O
byte	O
(	O
0xc3	O
)	O
followed	O
by	O
a	O
0x10	O
bytes	O
encryption	O
key	O
.	O
	
The	B-Entity
data	I-Entity
following	I-Entity
the	I-Entity
header	I-Entity
is	B-Verb
encrypted	I-Verb
using	B-Preposition
RC4	B-Entity
with	B-Preposition
the	B-Entity
previous	I-Entity
key	I-Entity
.	O
	
Once	B-Preposition
the	B-Entity
data	I-Entity
is	O
deciphered	O
,	O
the	O
last	O
byte	O
of	O
the	O
clear	O
text	O
should	O
also	O
be	O
0xc3	O
.	O
	
We	O
have	O
been	O
able	O
to	O
decrypt	O
the	O
communications	O
and	O
confirmed	O
what	O
is	O
transmitted	O
to	O
the	O
c	O
&	O
c	O
server	O
.	O
	
Here	O
is	B-Verb
an	B-Entity
anonymized	I-Entity
sample	I-Entity
of	I-Entity
communication	I-Entity
showing	I-Entity
information	I-Entity
collected	I-Entity
by	I-Entity
the	I-Entity
malware	I-Entity
:	O
This	O
information	O
is	O
very	O
useful	O
for	O
an	O
attacker	O
:	O
it	B-Entity
shows	B-Verb
all	B-Entity
software	I-Entity
installed	I-Entity
on	I-Entity
the	I-Entity
system	I-Entity
,	O
and	O
running	B-Verb
services	B-Entity
.	O
	
Once	O
this	O
data	O
has	O
been	O
transferred	O
to	O
the	O
c	O
&	O
c	O
server	O
,	O
it	O
responds	O
by	O
sending	B-Verb
additional	B-Entity
malware	I-Entity
to	O
execute	O
on	O
the	O
machine	O
.	O
	
The	O
c	O
&	O
c	O
part	O
consists	O
of	O
two	O
files	O
:	O
The	B-Entity
dr.asp	I-Entity
registers	B-Verb
the	B-Entity
following	I-Entity
keywords	I-Entity
:	O
These	O
two	O
binaries	O
were	O
no	O
longer	O
available	O
on	O
the	O
server	O
.	O
	
However	O
,	O
we	O
found	O
various	B-Entity
files	I-Entity
which	O
could	O
have	O
been	O
used	O
as	O
''	O
32.exe	O
''	O
in	O
the	O
past	O
:	O
The	O
322.exe	O
file	O
is	O
a	O
legitimate	O
,	O
Chinese	O
,	O
calc.exe	O
tool	O
.	O
	
It	O
might	O
have	O
been	O
used	O
by	O
the	O
attackers	O
to	O
perform	O
tests	O
.	O
	
The	O
3	O
others	O
binaries	O
are	O
RATs	O
,	O
which	O
will	O
be	O
detailed	O
in	O
the	O
next	O
parts	O
.	O
	
This	O
RAT	O
is	O
the	O
origin	O
of	O
the	O
attackers	O
'	O
group	O
name	O
.	O
	
''	O
PittyTiger	O
''	O
is	O
a	O
mutex	O
used	O
by	O
the	O
malware	O
.	O
	
''	O
Pitty	O
Tiger	O
''	O
is	O
also	O
a	O
string	O
transmitted	O
in	O
the	O
network	O
communications	O
of	O
the	O
RAT	O
,	O
as	O
you	O
will	O
see	O
in	O
this	O
chapter	O
.	O
	
The	O
malware	O
,	O
when	O
running	O
in	O
our	O
sandbox	O
,	O
triggers	B-Verb
the	B-Entity
following	I-Entity
alarms	I-Entity
:	O
The	O
binary	O
drops	O
two	O
files	O
in	O
''	O
C	O
:	O
\Windows\System32	O
''	O
:	O
The	O
''	O
qmgrxp.exe	O
''	O
binary	O
is	O
a	O
simple	O
copy	O
of	O
the	O
original	O
binary	O
.	O
	
It	B-Entity
drops	B-Verb
the	B-Entity
''	I-Entity
packet64.dll	I-Entity
''	I-Entity
,	O
and	O
injects	O
it	O
in	O
''	O
explorer.exe	O
''	O
.	O
	
When	O
executed	O
,	O
a	B-Entity
mutex	I-Entity
called	I-Entity
''	I-Entity
PittyTiger	I-Entity
''	I-Entity
is	B-Verb
created	I-Verb
.	O
	
Persistence	O
is	O
achieved	O
by	O
adding	O
the	O
path	O
to	O
the	O
binary	O
to	O
the	O
WinlogonUserInit	O
key	O
:	O
The	O
''	O
packet64.dll	O
''	O
is	O
the	O
main	O
payload	O
of	O
the	O
RAT	O
.	O
	
After	O
being	O
injected	O
,	O
it	B-Entity
starts	O
sending	O
its	O
Hello	O
packet	O
to	O
its	O
c	O
&	O
c	O
server	O
:	O
All	O
the	O
requests	O
sent	O
to	O
the	O
c	O
&	O
c	O
contains	O
the	O
string	O
''	O
/FC001/	O
''	O
followed	O
by	O
the	O
bot	O
id	O
.	O
	
This	O
id	O
consists	O
of	O
the	O
infected	O
computer	O
name	O
followed	O
by	O
a	O
dash	O
and	O
the	O
lower	O
word	O
of	O
the	O
disk	O
serial	O
id	O
.	O
	
The	B-Entity
data	I-Entity
sent	O
is	O
simply	O
encoded	O
using	O
base64	O
,	O
there	O
is	O
no	O
cipher	O
at	O
all	O
.	O
	
The	O
hello	O
packet	O
,	O
once	O
decoded	O
,	O
looks	O
like	O
the	O
following	O
:	O
Our	O
sample	O
had	O
3	O
c	O
&	O
c	O
servers	O
configured	O
:	O
The	B-Entity
following	I-Entity
commands	I-Entity
are	B-Verb
implemented	I-Verb
:	O
Regarding	O
the	O
controller	O
part	O
,	O
we	O
found	O
two	O
different	O
versions	O
:	O
The	O
interface	O
handling	O
both	O
Pitty	O
TIGER	O
and	O
CT	O
connections	O
is	O
very	O
interesting	O
.	O
	
We	O
have	O
been	O
able	O
to	O
confirm	O
that	O
the	O
author	O
of	O
those	O
two	O
families	O
of	O
malware	O
is	O
the	O
same	O
person	O
,	O
as	O
will	O
be	O
seen	O
in	O
the	O
next	O
chapter	O
about	O
''	O
CT	O
RAT	O
''	O
.	O
	
This	O
remote	O
administration	O
tool	O
is	O
often	O
used	O
by	O
the	O
Pitty	O
Tiger	O
group	O
.	O
	
We	O
have	O
been	O
able	O
to	O
acquire	O
both	O
the	O
client	O
and	O
the	O
server	O
parts	O
.	O
	
We	O
found	O
two	O
instances	O
of	O
the	O
same	O
binary	O
with	O
different	O
names	O
–	O
32mm.exe	O
and	O
mm32.exe	O
.	O
	
This	O
RAT	O
seems	O
to	O
be	O
an	O
evolution	O
of	O
PittyTiger	O
,	O
since	O
a	O
specific	O
server	O
binary	O
we	O
found	O
could	O
handle	O
both	O
requests	O
from	O
CT	O
and	O
PittyTiger	O
,	O
and	O
was	O
indicated	O
as	O
compatible	O
with	O
PittyTiger	O
.	O
	
Moreover	O
,	O
the	O
same	O
commands	O
are	O
implemented	O
in	O
both	O
RATs	O
.	O
	
Unsurprisingly	O
,	O
when	O
running	O
in	O
our	O
sandbox	O
,	O
the	O
RAT	O
triggers	O
the	O
same	O
alarms	O
as	O
PittyTiger	O
:	O
The	O
binary	O
drops	O
two	O
files	O
in	O
''	O
C	O
:	O
\Program	O
Files\Internet	O
Explorer	O
''	O
:	O
The	O
''	O
ieupdate.exe	O
''	O
is	O
a	O
simple	O
binary	O
to	O
inject	O
the	O
DLL	O
into	O
''	O
explorer.exe	O
''	O
.	O
	
Persistence	B-Entity
is	B-Verb
achieved	I-Verb
via	B-Preposition
the	B-Entity
following	I-Entity
registry	I-Entity
key	I-Entity
:	O
After	O
injection	O
,	O
the	O
RAT	O
sends	O
a	O
first	O
login	O
packet	O
to	O
its	O
c	O
&	O
c	O
:	O
The	B-Entity
RAT	I-Entity
communication	I-Entity
is	B-Verb
performed	I-Verb
through	B-Preposition
HTTP	B-Entity
requests	I-Entity
.	O
	
The	B-Entity
data	I-Entity
is	B-Verb
sent	I-Verb
encrypted	I-Verb
with	B-Preposition
RC4	B-Entity
,	O
and	O
base64-encoded	O
.	O
	
The	O
RC4	O
key	O
is	O
the	O
Unicode	O
form	O
of	O
the	O
requested	O
URL	O
.	O
	
The	O
Login	O
packet	O
contains	O
the	O
following	O
string	O
,	O
after	O
decoding	O
and	O
deciphering	O
:	O
It	O
contains	O
the	O
computer	O
name	O
,	O
the	O
user	O
name	O
,	O
the	O
internal	O
IP	O
address	O
,	O
the	B-Entity
OS	I-Entity
version	I-Entity
,	O
the	O
RAT	O
internal	O
version	O
and	O
the	O
Language	O
ID	O
of	O
the	O
system	O
.	O
	
The	B-Entity
RAT	I-Entity
can	O
then	O
receive	B-Verb
commands	B-Entity
from	B-Preposition
its	B-Entity
c	I-Entity
&	I-Entity
c	I-Entity
.	O
	
Usual	O
RAT	O
features	O
are	O
implemented	O
:	O
Regarding	O
the	O
configuration	O
,	O
our	O
sample	O
communicates	O
with	O
''	O
sop.avstore.com.tw	O
''	O
,	O
and	O
contains	O
the	O
string	O
''	O
Nov	O
13	O
2013	O
''	O
,	O
which	O
should	O
be	O
a	O
version	O
identifier	O
.	O
	
The	O
c	O
&	O
c	O
part	O
is	O
a	O
Windows	O
binary	O
written	O
in	O
.NET	O
	
.	O
	
We	O
found	O
2	O
versions	O
:	O
The	O
About	O
form	O
gives	O
the	O
name	O
of	O
the	O
developer	O
(	O
s	O
)	O
:	O
The	O
version	O
of	O
the	O
controller	O
which	O
can	O
handle	O
both	O
PittyTiger	O
and	O
CT	O
shows	O
the	O
same	O
author	O
(	O
s	O
)	O
:	O
As	O
these	O
screenshots	O
show	O
,	O
the	O
switch	O
between	O
PittyTiger	O
and	O
CT	O
was	O
probably	O
in	O
the	O
last	O
semester	O
of	O
2013	O
.	O
	
The	O
text	O
can	O
be	O
translated	O
,	O
thanks	O
to	O
Google	O
Translate	O
,	O
as	O
:	O
Further	O
discussion	O
about	O
this	O
author	O
is	O
provided	O
in	O
subsequent	O
sections	O
.	O
	
We	O
named	O
this	O
malware	O
''	O
MM	O
RAT	O
''	O
at	O
the	O
beginning	O
of	O
our	O
investigation	O
,	O
before	O
we	O
found	O
an	O
existing	O
name	O
for	O
it	O
,	O
''	O
Troj/Goldsun-B	O
''	O
according	O
to	O
Sophos	O
.	O
	
This	O
is	O
another	O
remote	O
administration	O
tool	O
often	O
used	O
by	O
the	O
Pitty	O
Tiger	O
crew	O
.	O
	
We	O
have	O
been	O
able	O
to	O
acquire	O
both	O
a	O
client	O
and	O
server	O
part	O
for	O
it	O
.	O
	
The	O
binary	O
we	O
found	O
is	O
named	O
3200.exe	O
,	O
and	O
triggers	O
the	O
following	O
alarms	O
in	O
our	O
sandbox	O
:	O
The	B-Entity
''	I-Entity
release.tmp	I-Entity
''	I-Entity
file	I-Entity
is	B-Verb
dropped	I-Verb
on	B-Preposition
the	B-Entity
system	I-Entity
:	O
The	O
binary	O
is	O
also	O
copied	O
to	O
the	O
user	O
's	O
''	O
Application	O
Data	O
''	O
directory	O
,	O
and	O
injects	O
the	O
''	O
release.tmp	O
''	O
file	O
in	O
''	O
explorer.exe	O
''	O
.	O
	
Persistence	O
is	O
achieved	O
by	O
adding	O
the	O
path	O
to	O
the	O
binary	O
to	O
the	O
Winlogon	O
Shell	O
key	O
:	O
The	O
RAT	O
embeds	O
its	O
own	O
DNS	O
server	O
IP	O
addresses	O
to	O
make	O
the	O
c	O
&	O
c	O
domain	O
names	O
resolutions	O
.	O
	
These	O
addresses	O
are	O
listed	O
below	O
:	O
It	B-Entity
starts	O
resolving	O
its	O
domains	O
after	O
injection	O
,	O
and	O
immediately	O
sends	O
requests	O
.	O
	
First	O
requests	O
are	O
used	O
to	O
check	B-Verb
for	B-Preposition
updates	B-Entity
(	O
GET	O
request	O
on	O
/httpdocs/update/update.ini	O
)	O
.	O
	
A	O
Hello	O
packet	O
is	O
then	O
sent	O
:	O
The	O
bot	O
then	O
repeatedly	O
sends	O
GET	O
requests	O
on	O
''	O
/httpdocs/mm/	O
<	O
botid	O
>	O
/ComMand.sec	O
''	O
to	O
retrieve	B-Verb
remote	B-Entity
commands	I-Entity
.	O
	
The	O
communication	O
protocol	O
is	O
quite	O
simple	O
:	O
GET	O
requests	O
are	O
used	O
to	O
receive	O
data	O
from	O
the	O
c	O
&	O
c	O
,	O
and	O
POST	B-Entity
requests	I-Entity
to	B-Preposition
send	B-Entity
data	I-Entity
.	O
	
In	O
POST	O
commands	O
,	O
the	O
CGI	O
name	O
represents	O
the	O
command	O
.	O
	
The	O
following	O
features	O
are	O
implemented	O
:	O
The	O
following	O
CGI	O
files	O
can	O
be	O
requested	O
by	O
the	O
bot	O
:	O
The	O
configuration	O
is	O
stored	O
locally	O
in	O
a	O
file	O
called	O
''	O
schmup.sys	O
''	O
.	O
	
The	B-Entity
file	I-Entity
is	B-Verb
ciphered	I-Verb
using	B-Preposition
RC4	B-Entity
,	O
using	O
the	O
MD5	O
hash	O
of	O
''	O
rEdstArs	O
''	O
as	O
the	O
key	O
.	O
	
Our	O
sample	O
uses	O
''	O
mca.avstore.com.tw	O
''	O
,	O
''	O
star.yamn.net	O
''	O
and	O
''	O
bz.kimoo.com.tw	O
''	O
as	O
c	O
&	O
c	O
servers	O
.	O
	
It	O
contains	O
the	O
''	O
1.6.0	O
''	O
version	O
number	O
,	O
and	O
uses	O
the	O
password	O
''	O
9ol.8ik	O
,	O
''	O
to	O
authenticate	O
with	O
the	O
bots	O
.	O
	
Unlike	O
others	O
c	O
&	O
c	O
binaries	O
,	O
the	O
c	O
&	O
c	O
part	O
of	O
this	O
RAT	O
does	O
not	O
have	O
a	O
graphical	O
interface	O
,	O
but	O
can	O
be	O
remotely	O
requested	O
to	O
manage	O
the	O
bots	O
.	O
	
Furthermore	O
,	O
no	O
authentication	O
is	O
required	O
to	O
send	O
commands	O
to	O
the	O
c	O
&	O
c	O
(	O
but	O
you	O
need	O
to	O
know	B-Verb
the	B-Entity
configured	I-Entity
password	I-Entity
to	B-Preposition
interact	B-Entity
with	I-Entity
the	I-Entity
bots	I-Entity
)	I-Entity
.	O
	
The	O
management	O
protocol	O
is	O
the	O
same	O
as	O
the	O
bots	O
protocol	O
,	O
with	O
different	O
CGI	O
files	O
:	O
The	B-Entity
bots	I-Entity
'	I-Entity
answers	I-Entity
to	I-Entity
remote	I-Entity
commands	I-Entity
can	O
be	O
retrieved	O
by	O
requesting	O
the	O
''	O
Reply.sec	O
''	O
file	O
(	O
e.g	O
.	O
	
GET	B-Entity
/httpdocs/mm/	I-Entity
<	I-Entity
botid	I-Entity
>	I-Entity
/Reply.sec	I-Entity
)	I-Entity
These	I-Entity
network	I-Entity
patterns	I-Entity
might	O
ring	O
bells	O
in	O
some	O
researcher	O
's	O
minds	O
.	O
	
The	O
network	O
communication	O
used	O
by	O
this	O
binary	O
are	O
the	O
same	O
as	O
those	O
used	O
by	O
the	O
Enfal	O
malware	O
,	O
which	O
has	O
been	O
used	O
in	O
the	O
past	O
by	O
the	O
Lurid	O
group	O
(	O
APT	O
attackers	O
)	O
and	O
by	O
other	O
threat	O
actors	O
in	O
China	O
.	O
	
An	O
examination	O
of	O
the	O
code	O
did	O
not	O
reveal	O
code	O
similarities	O
with	O
the	O
Enfal	O
malware	O
.	O
	
We	O
do	O
not	O
currently	O
know	O
why	O
this	O
malware	O
uses	O
the	O
same	O
patterns	O
to	O
communicate	O
.	O
	
This	O
is	O
another	O
remote	O
administration	O
tool	O
used	O
by	O
the	O
Pitty	O
Tiger	O
group	O
.	O
	
We	O
have	O
been	O
able	O
to	O
get	O
both	O
a	O
client	O
and	O
server	O
part	O
of	O
it	O
.	O
	
The	O
binary	O
we	O
found	O
was	O
dropped	O
by	O
a	B-Entity
malicious	I-Entity
Word	I-Entity
document	I-Entity
.	O
	
The	O
following	O
alarms	O
are	O
triggered	O
in	O
the	O
sandbox	O
:	O
The	B-Entity
shellcode	I-Entity
contained	I-Entity
in	I-Entity
the	I-Entity
Word	I-Entity
file	I-Entity
drops	B-Verb
the	B-Entity
following	I-Entity
file	I-Entity
,	O
and	O
executes	B-Verb
it	B-Entity
:	O
This	O
one	O
drops	O
in	O
turn	O
the	O
following	O
file	O
:	O
This	O
tmp	O
file	O
is	O
then	O
copied	O
to	O
''	O
C	O
:	O
\Windows\system32\Nwsapagentex.dll	O
''	O
and	O
registered	B-Verb
as	B-Preposition
a	B-Entity
service	I-Entity
called	I-Entity
''	I-Entity
Nwsapagent	I-Entity
''	I-Entity
.	O
	
This	B-Entity
malware	I-Entity
is	B-Verb
a	B-Entity
variant	I-Entity
of	I-Entity
the	I-Entity
infamous	I-Entity
Gh0st	I-Entity
RAT	I-Entity
.	O
	
Our	O
specific	O
sample	O
uses	O
''	O
ssss0	O
''	O
instead	O
of	O
the	O
usual	O
''	O
Gh0st	O
''	O
header	O
for	O
network	O
communications	O
.	O
	
The	O
commands	O
ID	O
used	O
in	O
the	O
communication	O
protocol	O
have	O
also	O
changed	O
,	O
but	O
the	O
features	O
are	O
quite	O
the	O
same	O
.	O
	
The	O
configuration	O
is	O
directly	O
embedded	O
in	O
the	O
binary	O
,	O
and	O
deciphered	O
at	O
runtime	O
.	O
	
Up	O
to	O
5	O
c	O
&	O
c	O
servers	O
can	O
be	O
configured	O
,	O
but	O
our	O
sample	O
only	O
had	O
one	O
:	O
''	O
ey.avstore.com.tw:53	O
''	O
.	O
	
''	O
EY	O
''	O
could	O
stand	O
for	O
''	O
Ernst	O
&	O
Young	O
''	O
.	O
	
It	O
would	O
not	O
be	O
very	O
surprising	O
,	O
since	O
a	O
lot	O
of	O
different	O
attack	O
groups	O
do	O
use	O
anti-virus	O
vendors	O
or	O
other	O
big	O
company	O
's	O
names	O
to	O
try	O
to	O
look	O
more	O
legitimate	O
.	O
	
Pitty	O
Tiger	O
is	O
no	O
exception	O
,	O
as	O
detailed	O
later	O
in	O
this	O
report	O
.	O
	
We	O
also	O
found	O
two	B-Entity
c	I-Entity
&	I-Entity
c	I-Entity
binaries	I-Entity
,	O
claiming	O
to	O
be	O
versions	O
2.1	O
and	O
2.2	O
of	O
the	O
Paladin	O
RAT	O
controller	O
.	O
	
Version	O
2.1	O
answers	O
to	O
the	O
''	O
ssss0	O
''	O
header	O
,	O
while	O
version	O
2.2	O
uses	O
the	O
classical	O
''	O
Gh0st	O
''	O
header	O
.	O
	
Additionally	O
to	O
the	O
Paladin	O
RAT	O
,	O
we	O
found	O
another	O
variant	O
of	O
Gh0st	O
RAT	O
,	O
named	O
''	O
Leo	O
''	O
.	O
	
Although	O
we	O
have	O
found	O
it	O
on	O
a	O
c	O
&	O
c	O
server	O
of	O
the	O
group	O
,	O
there	O
is	O
no	O
evidence	O
that	O
is	O
has	O
been	O
used	O
by	O
the	O
group	O
,	O
in	O
opposition	O
to	O
Paladin	O
which	O
is	O
used	O
often	O
by	O
Pitty	O
Tiger	O
.	O
	
Moreover	O
,	O
the	O
built	O
malware	O
we	O
found	O
in	O
the	O
same	O
folder	O
was	O
configured	O
to	O
connect	B-Verb
to	B-Preposition
a	B-Entity
local	I-Entity
IP	I-Entity
address	I-Entity
,	O
probably	O
for	O
testing	O
purposes	O
.	O
	
Our	O
investigation	O
has	O
focused	O
on	O
three	O
particular	O
c	O
&	O
c	O
servers	O
used	O
by	O
the	O
group	O
.	O
	
These	O
c	O
&	O
c	O
servers	O
,	O
unlike	O
the	O
other	O
c	O
&	O
cs	O
used	O
by	O
the	O
group	O
,	O
have	O
been	O
misconfigured	O
.	O
	
Once	O
parsed	O
and	O
dumped	O
,	O
it	O
provided	O
us	O
with	O
more	O
insight	O
.	O
	
We	O
found	O
several	O
domains	O
used	O
by	O
the	O
Pitty	O
Tiger	O
group	O
,	O
the	O
most	O
interesting	O
ones	O
being	O
detailed	O
in	O
this	O
chapter	O
.	O
	
Pitty	O
Tiger	O
,	O
like	O
other	O
APT	O
attackers	O
,	O
often	O
use	O
anti-virus	O
''	O
familiar	O
names	O
''	O
when	O
registering	O
domains	O
or	O
creating	O
subdomains	O
.	O
	
Some	O
examples	O
can	O
be	O
avstore.com.tw	O
,	O
sophos.skypetm.com.tw	O
,	O
symantecs.com.tw	O
,	O
trendmicro.org.tw	O
etc	O
.	O
	
The	O
registration	O
information	O
for	O
this	O
domain	O
has	O
been	O
the	O
same	O
since	O
2013-06-04	O
:	O
This	O
information	O
has	O
been	O
used	O
to	O
register	O
another	O
domain	O
,	O
skypetm.com.tw	O
,	O
which	O
has	O
also	O
been	O
used	O
by	O
the	O
Pitty	O
Tiger	O
group	O
.	O
	
Our	O
research	O
also	O
led	O
us	O
to	O
the	O
discovery	O
of	O
four	O
different	O
malware	O
families	O
connected	O
to	O
subdomains	O
of	O
avstore.com.tw	O
:	O
This	O
domain	O
has	O
shown	O
two	O
different	O
WHOIS	O
entries	O
through	O
time	O
:	O
The	O
most	O
recent	O
registration	O
information	O
is	O
also	O
used	O
for	O
avstore.com.tw	O
.	O
	
Six	O
malware	O
families	O
have	O
been	O
identified	O
as	O
communicating	O
with	O
subdomains	O
of	O
skypetm.com.tw	O
:	O
Avstore.com.tw	O
and	O
skypetm.com.tw	O
have	O
4	O
malware	O
families	O
in	O
common	O
,	O
communicating	O
to	O
subdomains	O
of	O
both	O
domains	O
:	O
Some	O
domains	O
registered	O
by	O
the	O
group	O
are	O
very	O
old	O
.	O
	
There	O
is	O
an	O
increase	O
in	O
the	O
registrations	O
from	O
2010	O
on	O
.	O
	
All	O
the	O
e-mail	O
addresses	O
used	O
are	O
connected	O
to	O
the	O
Pitty	O
Tiger	O
group	O
.	O
	
Mapping	O
the	O
victims	O
of	O
such	O
a	O
targeted	O
campaign	O
is	O
not	O
an	O
easy	O
task	O
.	O
	
We	O
have	O
found	O
the	O
Pitty	O
Tiger	O
group	O
to	O
be	O
very	O
active	O
against	O
one	O
particular	O
private	O
company	O
from	O
the	O
defense	O
industry	O
and	O
one	O
academic	O
network	O
of	O
a	O
government	O
,	O
,	O
yet	O
we	O
think	O
it	O
was	O
done	O
to	O
be	O
used	O
as	O
a	O
proxy	O
for	O
some	O
of	O
the	O
group	O
's	O
operations	O
.	O
	
We	O
have	O
also	O
found	O
some	O
connections	O
from	O
other	O
companies	O
to	O
the	O
c	O
&	O
c	O
servers	O
,	O
yet	O
we	O
did	O
not	O
find	O
evidence	O
that	O
they	O
were	O
real	O
victims	O
.	O
	
These	O
alleged	O
victims	O
do	O
work	O
in	O
different	O
sectors	O
and	O
are	O
located	O
mostly	O
in	O
European	O
countries	O
.	O
	
It	O
might	O
be	O
surprising	O
to	O
see	O
a	O
company	O
specialized	O
in	O
web	O
development	O
here	O
,	O
yet	O
it	B-Entity
has	O
built	O
websites	O
for	O
interesting	O
potential	O
targets	O
.	O
	
We	O
suspect	O
Pitty	O
Tiger	O
to	O
use	O
this	O
compromise	O
to	O
spear	O
phish	O
other	O
companies	O
which	O
are	O
in	O
commercial	O
relation	O
with	O
this	O
web	O
development	O
company	O
.	O
	
We	O
have	O
to	O
mention	O
that	O
we	O
only	O
had	O
access	O
to	O
three	O
of	O
the	O
several	O
attackers	O
'	O
servers	O
.	O
	
Therefore	O
,	O
we	O
suppose	O
the	O
Pitty	O
Tiger	O
group	O
could	O
have	O
more	O
targets	O
than	O
what	O
we	O
could	O
confirm	O
.	O
	
We	O
also	O
found	O
a	O
lot	O
of	O
vulnerability	O
scanners	O
launched	O
by	O
the	O
attackers	O
at	O
different	O
targets	O
,	O
yet	O
there	O
was	O
no	O
sign	O
of	O
compromise	O
.	O
	
During	O
the	O
course	O
of	O
our	O
investigations	O
,	O
we	O
discovered	O
a	O
RAR	O
archive	O
on	O
the	O
attacker	O
's	O
server	O
containing	O
5	O
Word	O
documents	O
and	O
one	O
small	O
C	O
source	O
code	O
.	O
	
These	O
documents	O
belong	O
to	O
the	O
defense	O
company	O
which	O
has	O
been	O
compromised	O
.	O
	
According	O
to	O
the	O
name	O
of	O
the	O
files	O
and	O
the	O
general	O
feel	O
of	O
the	O
archive	O
,	O
we	O
do	O
think	O
it	O
was	O
extracted	O
by	O
the	O
attackers	O
to	O
''	O
show	O
''	O
someone	O
what	O
kind	O
of	O
data	O
they	O
could	O
get	O
from	O
the	O
compromise	O
of	O
that	O
particular	O
target	O
.	O
	
The	O
documents	O
were	O
still	O
exhibiting	O
comments	O
from	O
various	O
users	O
,	O
showing	O
it	O
was	O
an	O
ongoing	O
work	O
and	O
not	O
old	O
documents	O
.	O
	
Interestingly	O
enough	O
,	O
we	O
saw	O
a	O
part	O
of	O
these	O
documents	O
appear	O
on	O
Virus-Total	O
,	O
with	O
an	O
additional	O
''	O
gift	O
''	O
from	O
the	O
attackers	O
,	O
a	O
payload	O
dropping	O
a	O
malware	O
.	O
	
There	O
are	O
only	O
two	O
options	O
we	O
can	O
think	O
of	O
here	O
:	O
	O
Someone	O
from	O
the	O
same	O
company	O
has	O
been	O
targeted	O
with	O
this	O
document	O
.	O
	
	O
Someone	O
from	O
another	O
company	O
has	O
been	O
targeted	O
with	O
this	O
document	O
.	O
	
This	O
other	O
company	O
could	O
be	O
a	O
partner	O
or	O
competitor	O
.	O
	
Since	O
we	O
were	O
unable	O
to	O
determine	O
the	O
intended	O
use	O
of	O
this	O
specific	O
document	O
,	O
we	O
can	O
only	O
suppose	O
that	O
it	O
could	O
be	O
used	O
to	O
provide	O
commercial	O
advantages	O
to	O
competitors	O
of	O
that	O
company	O
,	O
or	O
used	O
by	O
a	O
foreign	O
state	O
.	O
	
During	O
our	O
investigation	O
,	O
we	O
found	O
out	O
interesting	O
information	O
about	O
the	O
Pitty	O
Tiger	O
group	O
itself	O
.	O
	
After	O
analyzing	O
the	O
various	O
collected	O
elements	O
,	O
we	O
have	O
tried	O
to	O
draw	O
a	O
portrait	O
of	O
this	O
particular	O
threat	O
.	O
	
We	O
have	O
been	O
able	O
to	O
get	B-Verb
all	B-Entity
the	I-Entity
RDP	I-Entity
connections	I-Entity
logs	I-Entity
to	B-Preposition
one	B-Entity
c	I-Entity
&	I-Entity
c	I-Entity
server	I-Entity
:	O
These	O
connections	O
are	O
either	O
VPS	O
or	O
dynamic	O
IP	O
addresses	O
,	O
mostly	O
from	O
China	O
.	O
	
A	O
computer	O
named	O
CHMXY-PC	O
connected	O
to	O
the	O
c	O
&	O
c	O
via	O
RDP	O
with	O
IP	O
address	O
58.61.40.5	O
.	O
	
The	O
IP	O
is	O
in	O
an	O
ADSL	O
dynamic	O
pool	O
in	O
the	O
Gangzhou	O
area	O
(	O
Guangdong	O
province	O
)	O
:	O
A	O
few	O
connections	O
to	O
the	O
c	O
&	O
c	O
were	O
done	O
by	O
a	O
computer	O
named	O
TIEWEISHIPC	O
with	O
IP	O
address	O
27.16.139.143	O
.	O
	
This	O
IP	O
address	O
belongs	O
to	O
an	O
ADSL	O
dynamic	O
pool	O
in	O
the	O
Wuhan	O
area	O
(	O
Hubei's	O
provincial	O
capital	O
)	O
.	O
	
Some	O
connections	O
to	O
the	O
c	O
&	O
c	O
originated	O
from	O
a	O
computer	O
named	O
FLY-THINK	O
with	O
several	O
IP	O
addresses	O
,	O
all	O
located	O
in	O
Fuqing	O
(	O
Fujian	O
province	O
)	O
.	O
	
The	O
IP	O
addresses	O
are	O
in	O
an	O
ADSL	O
dynamic	O
pool	O
:	O
Most	O
of	O
the	O
connections	O
to	O
the	O
c	O
&	O
c	O
server	O
were	O
coming	O
from	O
a	O
computer	O
named	O
50PZ80C-	O
1DFDCB8	O
with	O
several	O
IP	O
addresses	O
.	O
	
There	O
are	O
11	O
IP	O
addresses	O
from	O
Chinese	O
dynamic	O
ADSL	O
ranges	O
:	O
9	O
from	O
Fuqing	O
(	O
Fujian	O
province	O
)	O
,	O
one	O
from	O
Fuzhou	O
(	O
Fujian	O
's	O
province	O
capital	O
)	O
and	O
one	O
from	O
Nanchang	O
(	O
Jiangxi	O
's	O
province	O
capital	O
)	O
.	O
	
The	O
last	O
one	O
came	O
from	O
a	O
VPS	O
instance	O
located	O
in	O
Los	O
Angeles	O
(	O
California	O
,	O
USA	O
)	O
but	O
purchased	O
by	O
a	O
China	O
based	O
VPS	O
provider	O
XeVPS	O
which	O
belong	O
to	O
the	O
AS38197	O
(	O
Sun	O
Network	O
Hong	O
Kong	O
Limited	O
)	O
.	O
	
The	O
two	O
computers	O
FLY-THINK	O
and	O
50PZ80C-1DFDCB8	O
have	O
used	O
distinct	O
IP	O
addresses	O
to	O
connect	O
to	O
the	O
c	O
&	O
c	O
,	O
yet	O
some	O
of	O
these	O
IP	O
addresses	O
come	O
from	O
the	O
same	O
IP	O
range	O
:	O
We	O
mapped	O
these	O
RDP	O
connections	O
to	O
have	O
a	O
graphical	O
view	O
:	O
We	O
found	O
that	O
a	O
member	O
of	O
this	O
group	O
of	O
attackers	O
used	O
some	O
tools	O
on	O
his	O
own	O
system	O
,	O
for	O
testing	O
purposes	O
.	O
	
This	O
information	O
was	O
still	O
available	O
when	O
we	O
got	O
access	O
to	O
the	O
c	O
&	O
c	O
server	O
.	O
	
He	O
launched	O
some	O
tests	O
with	O
the	O
CT	O
RAT	O
we	O
exposed	O
earlier	O
:	O
Here	O
we	O
can	O
see	O
a	O
user	O
''	O
Toot	O
''	O
from	O
a	O
machine	O
named	O
''	O
toot-2a601225a8	O
''	O
logging	O
in	O
the	O
CT	O
RAT	O
and	O
executing	B-Verb
some	B-Entity
commands	I-Entity
.	O
	
The	O
c	O
&	O
c	O
IP	O
address	O
,	O
198.100.113.27	O
,	O
can	O
be	O
seen	O
there	O
.	O
	
Other	O
log	O
files	O
showed	O
that	O
''	O
Toot	O
''	O
is	O
using	O
virtual	O
machines	O
for	O
his	O
tests	O
.	O
	
We	O
can	O
also	O
see	O
the	O
system	O
:	O
Microsoft	O
Windows	O
XP	O
SP3	O
.	O
	
The	O
''	O
P	O
''	O
field	O
is	O
the	O
language	O
ID	O
.	O
	
1028	O
means	O
''	O
Chinese	O
traditional	O
''	O
.	O
	
We	O
have	O
also	O
seen	O
tests	O
run	O
by	O
''	O
toot	O
''	O
with	O
a	O
language	O
ID	O
of	O
2052	O
,	O
which	O
is	O
''	O
Chinese	O
simplified	O
''	O
.	O
	
The	O
''	O
M	O
''	O
field	O
is	O
probably	O
used	O
for	O
versioning	O
.	O
	
It	O
is	O
a	O
hardcoded	O
string	O
in	O
the	O
binary	O
.	O
	
After	O
these	O
tests	O
,	O
we	O
could	O
see	O
some	O
real	O
connections	O
to	O
a	O
victim	O
using	O
this	O
RAT	O
.	O
	
Here	O
is	O
a	O
follow-up	O
of	O
the	B-Entity
commands	I-Entity
launched	B-Verb
by	O
the	O
bot	O
controller	O
,	O
in	O
a	O
standard	O
command-line	O
shell	O
:	O
The	O
attacker	O
goes	O
on	O
like	O
this	O
,	O
using	O
his	O
tools	O
,	O
and	O
then	O
ends	O
the	O
communication	O
with	O
this	O
RAT	O
on	O
that	O
computer	O
.	O
	
Please	O
note	O
that	O
at	O
this	O
point	O
,	O
the	O
attacker	O
has	O
at	O
least	O
the	O
privileges	O
of	O
a	O
local	O
administrator	O
,	O
since	O
he	O
is	O
allowed	O
to	O
write	O
content	O
in	O
the	O
system32	O
folder	O
of	O
a	O
Windows	O
XP	O
system	O
.	O
	
He	O
could	O
also	O
gain	B-Verb
the	B-Entity
credentials	I-Entity
to	B-Preposition
a	B-Entity
sensitive	I-Entity
e-mail	I-Entity
account	I-Entity
.	O
	
In	O
addition	O
to	O
all	O
information	O
already	O
shown	O
,	O
we	O
saw	O
Toot	O
connect	B-Verb
to	B-Preposition
an	B-Entity
account	I-Entity
on	B-Preposition
a	B-Entity
cloud	I-Entity
service	I-Entity
named	I-Entity
''	I-Entity
Baidu	I-Entity
Drive	I-Entity
''	I-Entity
.	O
	
The	O
e-mail	O
address	O
linked	O
to	O
this	O
account	O
is	O
dyanmips	O
@	O
qq.com	O
(	O
QQ-ID	O
:	O
2589315828	O
)	O
.	O
	
We	O
could	O
find	O
traces	O
of	O
two	O
other	O
e-mail	O
accounts	O
associated	O
to	O
Toot	O
,	O
ciscodyanmips	O
@	O
qq.com	O
(	O
QQ	O
ID	O
:	O
204156335	O
)	O
and	O
ciscodynamips	O
@	O
qq.com	O
(	O
QQ	O
ID	O
:	O
1878836793	O
)	O
.	O
	
We	O
did	O
not	O
find	O
more	O
information	O
about	O
user	O
''	O
Toot	O
''	O
,	O
yet	O
we	O
miss	O
Chinese	O
language	O
capabilities	O
.	O
	
The	O
controller	O
part	O
of	O
CT	O
RAT/PittyTiger	O
RAT	O
revealed	O
the	O
following	O
''	O
about	O
''	O
information	O
,	O
once	O
translated	O
from	O
Chinese	O
to	O
English	O
language	O
:	O
CT	O
console	O
(	O
compatible	O
pittytiger	O
)	O
v1.3	O
2013.12	O
by	O
Trees	O
and	O
snow	O
We	O
believe	O
this	O
translation	O
of	O
the	O
author	O
's	O
name	O
might	O
not	O
be	O
accurate	O
due	O
to	O
the	O
use	O
of	O
automated	O
translation	O
tools	O
.	O
	
Moreover	O
,	O
we	O
have	O
strong	O
suspicions	O
that	O
there	O
is	O
not	O
a	O
single	O
individual	O
nicknamed	O
''	O
Trees	O
and	O
snow	O
''	O
but	O
rather	O
two	O
programmers	O
nicknamed	O
''	O
Trees	O
''	O
and	O
''	O
Snow	O
''	O
.	O
	
''	O
Trees	O
''	O
could	O
also	O
be	O
''	O
Cold	O
''	O
.	O
	
We	O
noticed	O
that	O
the	O
symbol	O
for	O
this	O
word	O
is	O
translated	O
differently	O
according	O
to	O
the	O
context	O
it	O
is	O
used	O
in	O
.	O
	
Once	O
again	O
,	O
we	O
lack	O
Chinese	O
language	O
skills	O
.	O
	
We	O
identify	O
the	O
two	O
nicknames	O
on	O
the	O
current	O
campaign	O
as	O
Automn	O
Snow	O
(	O
秋雪	O
)	O
and	O
Cold	O
Air	O
Kiss	O
(	O
风吻寒	O
)	O
.	O
	
While	O
we	O
are	O
confident	O
that	O
these	O
people	O
are	O
indeed	O
the	O
developers	O
of	O
both	O
PittyTiger	O
and	O
CT	O
RAT	O
malware	O
,	O
we	O
are	O
not	O
sure	O
they	O
belong	O
to	O
the	O
PittyTiger	O
group	O
.	O
	
These	O
developers	O
might	O
just	O
have	O
been	O
hired	O
to	O
develop	O
these	O
RATs	O
.	O
	
They	O
might	O
also	O
just	O
be	O
selling	O
it	O
to	O
the	O
PittyTiger	O
group	O
.	O
	
There	O
is	O
no	O
trace	O
of	O
usage	O
from	O
other	O
attacking	O
groups	O
,	O
we	O
believe	O
the	O
PittyTiger	O
RAT	O
is	O
exclusively	O
used	O
by	O
this	O
group	O
of	O
attackers	O
.	O
	
According	O
to	O
indicators	O
we	O
gathered	O
and	O
threat	O
activities	O
profiling	O
we	O
have	O
some	O
hypothesis	O
on	O
the	O
way	O
the	O
group	O
is	O
conducting	O
its	O
operations	O
.	O
	
We	O
have	O
strong	O
evidence	O
of	O
a	O
bot	O
operator	O
position	O
.	O
	
We	O
identify	O
one	O
nickname	O
for	O
this	O
position	O
,	O
the	O
user	O
known	O
as	O
TooT	O
.	O
	
As	O
we	O
did	O
not	O
see	O
other	O
nickname	O
,	O
we	O
think	O
that	O
TooT	O
is	O
one	O
person	O
and	O
not	O
a	O
group	O
of	O
persons	O
.	O
	
We	O
also	O
identified	O
a	O
malware	O
development	O
position	O
.	O
	
We	O
identified	O
two	O
nicknames	O
for	O
this	O
position	O
on	O
the	O
current	O
campaign	O
,	O
Automn	O
Snow	O
(	O
秋雪	O
)	O
and	O
Cold	O
Air	O
Kiss	O
(	O
风吻寒	O
)	O
.	O
	
Yet	O
we	O
are	O
unsure	O
that	O
they	O
belong	O
to	O
the	O
group	O
,	O
they	O
might	O
just	O
be	O
a	O
third	O
party	O
providing	O
or	O
selling	O
their	O
malware	O
.	O
	
We	O
have	O
a	O
strong	O
suspicion	O
of	O
a	O
coordinator	O
position	O
,	O
which	O
coordinates	O
the	O
bot	O
operator	O
,	O
provides	O
him	O
with	O
some	O
logistics	O
support	O
(	O
weaponized	O
document	O
,	O
tools…	O
)	O
and	O
reviews	O
the	O
programmers	O
work	O
.	O
	
This	O
position	O
could	O
imply	B-Verb
a	B-Entity
communication	I-Entity
channel	I-Entity
with	B-Preposition
another	B-Entity
manager	I-Entity
.	O
	
We	O
named	O
this	O
position	O
'Chen	O
'	O
,	O
in	O
relation	O
with	O
several	O
references	O
of	O
this	O
common	O
Chinese	O
name	O
in	O
c	O
&	O
c	O
WHOIS	O
and	O
other	O
investigation	O
materials	O
.	O
	
We	O
have	O
some	O
suspicion	O
of	O
a	O
customer	O
relationship	O
manager	O
position	O
that	O
may	O
act	O
as	O
an	O
interface	O
between	O
a	O
customer	O
and	O
Chen	O
.	O
	
We	O
named	O
this	O
position	O
'Lilly	O
'	O
.	O
	
The	O
c	O
&	O
c	O
servers	O
used	O
by	O
the	B-Entity
attackers	I-Entity
revealed	B-Verb
a	B-Entity
lot	I-Entity
of	I-Entity
interesting	I-Entity
files	I-Entity
stored	I-Entity
in	I-Entity
various	I-Entity
folders	I-Entity
:	O
This	O
is	O
quite	O
the	O
usual	O
arsenal	O
for	O
a	O
group	O
of	O
APT	O
attackers	O
:	O
What	O
is	O
rare	O
to	O
find	O
is	O
the	O
controller	O
part	O
of	O
those	O
tools	O
.	O
	
We	O
have	O
been	O
lucky	O
enough	O
to	O
get	O
the	O
controller	O
part	O
of	O
Pitty	O
Tiger	O
and	O
CT	O
RAT	O
,	O
and	O
even	O
to	O
get	O
a	O
kind	O
of	O
hybrid	O
controller	O
made	O
for	O
CT	O
RAT	O
but	O
also	O
supporting	O
Pitty	O
Tiger	O
.	O
	
We	O
suppose	O
that	O
the	O
CT	O
RAT	O
is	O
the	O
new	O
evolution	O
of	O
Pitty	O
Tiger	O
and	O
that	O
it	O
will	O
replace	O
Pitty	O
Tiger	O
in	O
the	O
following	O
months	O
.	O
	
The	O
presence	O
of	O
a	O
Chinese	O
version	O
of	O
''	O
calc.exe	O
''	O
,	O
the	O
official	O
calculator	O
provided	O
in	O
Microsoft	O
Windows	O
,	O
is	O
interesting	O
.	O
	
Not	O
only	O
is	O
it	O
one	O
more	O
indicator	O
of	O
a	O
probable	O
Chinese	O
origin	O
,	O
but	O
also	O
an	O
indicator	O
that	O
this	O
server	O
was	O
probably	O
used	O
as	O
a	O
test	O
base	O
,	O
in	O
addition	O
to	O
being	O
operational	O
and	O
controlling	O
infected	O
machines	O
from	O
different	O
targets	O
.	O
	
In	O
addition	O
to	O
those	O
tools	O
,	O
we	O
found	O
some	O
interesting	O
scripts	O
.	O
	
A	O
script	O
named	O
ipc.bat	O
uses	O
a	O
file	O
named	O
user.txt	O
to	O
try	O
to	O
brute-force	O
a	O
shared	O
folder	O
access	O
:	O
The	O
user.txt	O
file	O
contains	O
thousands	O
of	O
lines	O
,	O
each	O
one	O
being	O
a	O
couple	O
of	O
one	O
particular	O
username	O
and	O
one	O
password	O
attempt	O
:	O
This	O
user.txt	O
file	O
has	O
been	O
anonymized	O
,	O
yet	O
we	O
wanted	O
to	O
give	O
you	O
the	O
feel	O
for	O
it	O
.	O
	
This	O
file	O
is	O
67320	O
lines	O
long	O
,	O
and	O
uses	O
5610	O
different	O
passwords	O
for	O
each	O
of	O
12	O
users	O
contained	O
in	O
this	O
file	O
.	O
	
The	O
user	O
names	O
are	O
clearly	O
the	O
result	O
from	O
a	O
user	O
enumeration	O
and	O
are	O
dedicated	O
to	O
a	O
particular	O
French	O
victim	O
.	O
	
The	O
passwords	O
listed	O
in	O
this	O
file	O
are	O
either	O
build	O
from	O
several	O
campaigns	O
or	O
from	O
the	O
current	O
campaign	O
.	O
	
A	O
lot	O
of	O
passwords	O
are	O
related	O
to	O
the	O
targeted	O
company	O
and	O
might	O
be	O
previous	O
passwords	O
from	O
users	O
.	O
	
We	O
have	O
also	O
discovered	O
a	O
pack	O
of	O
files	O
which	O
can	O
be	O
used	O
to	O
trigger	O
an	O
Internet	O
Explorer	O
vulnerability	O
(	O
CVE-2014-0322	O
)	O
.	O
	
The	O
date	O
of	O
these	O
files	O
,	O
namely	O
Tope.swf	O
and	O
index.html	O
,	O
was	O
2014/02/18	O
,	O
a	O
few	O
days	O
after	O
the	O
revelation	O
of	O
existing	O
exploits	O
in	O
the	O
wild	O
used	O
in	O
APT	O
attacks	O
.	O
	
We	O
do	O
not	O
know	O
if	O
the	O
Pitty	O
Tiger	O
group	O
used	O
this	O
exploit	O
or	O
not	O
,	O
but	O
found	O
no	O
trace	O
indicating	O
they	O
did	O
.	O
	
A	O
lot	O
of	O
different	O
attackers	O
seem	O
to	O
have	O
used	O
that	O
vulnerability	O
since	O
.	O
	
Determining	O
who	O
is	O
exactly	O
behind	O
an	O
APT	O
campaign	O
is	O
difficult	O
.	O
	
We	O
tried	O
to	O
extract	O
different	O
technical	O
indicators	O
,	O
together	O
with	O
contextual	O
elements	O
.	O
	
Information	O
relating	O
to	O
the	O
tools	O
used	O
by	O
the	O
attackers	O
has	O
been	O
leveraged	O
for	O
attribution	O
:	O
The	O
IP	O
addresses	O
used	O
for	O
the	O
hosting	O
of	O
the	O
c	O
&	O
c	O
domains	O
are	O
mainly	O
located	O
in	O
Taipei	O
(	O
Taïwan	O
)	O
and	O
Hong	O
Kong	O
City	O
(	O
Hong	O
Kong	O
Special	O
Administrative	O
Region	O
,	O
PRC	O
)	O
:	O
Most	O
RDP	O
connections	O
to	O
the	O
c	O
&	O
c	O
infrastructure	O
come	O
from	O
Chinese	O
IP	O
ranges	O
in	O
Fuqing	O
(	O
Fujian	O
province	O
,	O
PRC	O
)	O
.	O
	
Yet	O
some	O
IP	O
addresses	O
in	O
the	O
USA	O
and	O
in	O
Hong	O
Kong	O
have	O
also	O
been	O
found	O
;	O
All	O
the	O
items	O
listed	O
in	O
this	O
chapter	O
are	O
strong	O
indicators	O
that	O
the	O
attackers	O
might	O
be	O
Chinese	O
.	O
	
Pitty	O
Tiger	O
is	O
a	O
group	O
of	O
attackers	O
that	O
have	O
been	O
active	O
since	O
at	O
least	O
2011	O
.	O
	
Pitty	O
Tiger	O
is	O
effective	O
and	O
mature	O
in	O
the	O
use	O
of	O
targeted	O
malware	O
,	O
the	O
use	O
of	O
known	O
exploits	O
to	O
infect	O
computers	O
with	O
their	O
malware	O
and	O
the	O
creation	O
of	O
an	O
infrastructure	O
to	O
efficiently	O
conduct	O
APT	O
attacks	O
.	O
	
They	O
are	O
quite	O
unprofessional	O
in	O
their	O
way	O
of	O
using	O
their	O
infrastructure	O
:	O
they	O
do	O
launch	O
vulnerability	O
scanners	O
directly	O
from	O
a	O
c	O
&	O
c	O
server	O
and	O
also	O
use	O
their	O
connection	O
for	O
personal	O
activities	O
(	O
downloading	O
pornographic	O
material	O
for	O
example	O
,	O
as	O
we	O
have	O
seen	O
a	O
whole	O
folder	O
on	O
a	O
c	O
&	O
c	O
server	O
full	O
of	O
xxx	O
torrent	O
links	O
)	O
.	O
	
Pitty	O
Tiger	O
is	O
probably	O
not	O
a	O
state-sponsored	O
group	O
of	O
attackers	O
.	O
	
The	O
attackers	O
lack	O
the	O
experience	O
and	O
financial	O
support	O
that	O
one	O
would	O
expect	O
from	O
state-sponsored	O
attackers	O
.	O
	
We	O
suppose	O
this	O
group	O
is	O
opportunistic	O
and	O
sells	B-Verb
its	B-Entity
services	I-Entity
to	B-Preposition
probable	B-Entity
competitors	I-Entity
of	I-Entity
their	I-Entity
targets	I-Entity
in	I-Entity
the	I-Entity
private	I-Entity
sector	I-Entity
.	O
	
One	O
governmental	O
network	O
has	O
been	O
targeted	O
by	O
the	O
group	O
,	O
yet	O
we	O
do	O
not	O
have	O
any	O
evidence	O
of	O
the	O
purpose	O
of	O
this	O
attack	O
.	O
	
We	O
suppose	O
this	O
particular	O
attack	O
has	O
been	O
executed	O
to	O
provide	O
a	O
usable	O
bounce	O
for	O
the	O
group	O
.	O
	
The	O
campaign	O
we	O
studied	O
has	O
been	O
largely	O
focused	O
on	O
one	O
particular	O
target	O
.	O
	
We	O
suspect	O
the	O
Pitty	O
Tiger	O
group	O
to	O
work	O
according	O
to	O
an	O
opportunistic	O
business	O
model	O
:	O
this	O
group	O
might	O
offer	O
its	O
services	O
to	O
third	O
parties	O
from	O
the	O
private	O
sector	O
.	O
	
This	O
group	O
seems	O
to	O
be	O
very	O
small	O
compared	O
to	O
other	O
APT	O
groups	O
.	O
	
We	O
have	O
leveraged	O
several	O
profiles	O
and	O
could	O
identify	O
some	O
attackers	O
to	O
a	O
certain	O
extent	O
.	O
	
We	O
believe	O
this	O
group	O
might	O
keep	O
working	O
as	O
it	O
is	O
now	O
,	O
with	O
limited	O
budgets	O
,	O
or	O
grow	O
to	O
extend	O
its	O
attacking	O
campaign	O
capabilities	O
.	O
	
This	O
list	O
of	O
indicators	O
is	O
provided	O
in	O
order	O
to	O
help	O
people	O
detect	O
Pitty	O
Tiger	O
APT	O
campaign	O
.	O
	
Domains	O
used	O
by	O
the	O
Pitty	O
Tiger	O
group	O
:	O
(	O
please	O
note	O
several	O
subdomains	O
are	O
used	O
,	O
as	O
seen	O
in	O
the	O
report	O
)	O
A	O
few	O
days	O
ago	O
we	O
detected	O
a	O
watering	O
hole	O
campaign	O
in	O
a	O
website	O
owned	O
by	O
one	O
big	O
industrial	O
company	O
.	O
	
The	O
website	O
is	O
related	O
to	O
software	O
used	O
for	O
simulation	O
and	O
system	O
engineering	O
in	O
a	O
wide	O
range	O
of	O
industries	O
,	O
including	O
automotive	O
,	O
aerospace	O
,	O
and	O
manufacturing	O
.	O
	
The	B-Entity
attackers	I-Entity
were	O
able	O
to	O
compromise	O
the	O
website	O
and	O
include	B-Verb
code	B-Entity
that	O
loaded	B-Verb
a	B-Entity
malicious	I-Entity
Javascript	I-Entity
file	I-Entity
from	B-Preposition
a	B-Entity
remote	I-Entity
server	I-Entity
.	O
	
This	O
Javascript	O
file	O
is	O
a	O
framework	O
for	O
reconnaissance	O
that	O
the	O
attackers	O
call	O
''	O
Scanbox	O
''	O
and	O
includes	O
some	O
of	O
the	O
techniques	O
we	O
described	O
in	O
a	O
previous	O
blog	O
post	O
:	O
The	O
Scanbox	O
framework	O
first	O
configures	B-Verb
the	B-Entity
remote	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
that	O
it	O
will	O
use	O
and	O
collects	O
a	O
small	O
amount	O
of	O
information	O
about	O
the	O
victim	O
that	O
is	O
visiting	O
the	O
compromised	O
website	O
including	O
:	O
Resulting	O
in	O
something	O
like	O
this	O
:	O
Before	O
sending	B-Verb
the	B-Entity
information	I-Entity
to	I-Entity
the	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
server	I-Entity
,	O
Scanbox	O
encodes	O
and	O
encrypts	B-Verb
the	B-Entity
data	I-Entity
with	B-Preposition
the	B-Entity
following	I-Entity
function	I-Entity
:	O
Producing	O
the	O
following	O
request	O
:	O
If	O
we	O
decrypt	O
the	O
data	O
it	O
translates	O
to	O
:	O
After	O
the	O
first	O
request	O
,	O
the	O
framework	O
contains	O
several	O
plugins	O
to	O
extract	B-Verb
different	B-Entity
information	I-Entity
from	B-Preposition
the	B-Entity
victim	I-Entity
.	O
	
While	B-Preposition
the	B-Entity
user	I-Entity
is	I-Entity
browsing	I-Entity
the	I-Entity
compromised	I-Entity
website	I-Entity
,	O
all	O
keystrokes	O
are	O
being	O
recorded	O
and	O
sent	B-Verb
to	B-Preposition
the	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
periodically	I-Entity
.	O
	
It	O
will	O
also	O
send	B-Verb
keystrokes	B-Entity
when	B-Preposition
the	B-Entity
user	I-Entity
submits	I-Entity
web	I-Entity
forms	I-Entity
that	I-Entity
can	I-Entity
potentially	I-Entity
include	I-Entity
passwords	I-Entity
and	I-Entity
other	I-Entity
sensitive	I-Entity
data	I-Entity
.	O
	
As	O
we	O
have	O
seen	O
,	O
this	O
is	O
a	O
very	O
powerful	O
framework	O
that	O
gives	O
attackers	O
a	O
lot	O
of	O
insight	O
into	O
the	O
potential	O
targets	O
that	O
will	O
help	O
them	O
launching	O
future	O
attacks	O
against	O
them	O
.	O
	
We	O
have	O
also	O
seen	O
several	O
Metasploit-produced	O
exploits	O
that	O
target	O
different	O
versions	O
of	O
Java	O
in	O
the	O
same	O
IP	O
address	O
that	O
hosts	O
the	O
Scanbox	O
framework	O
(	O
122.10.9	O
[	O
.	O
	
]	O
109	O
)	O
.	O
	
We	O
recommend	O
you	O
look	O
for	O
this	O
type	O
of	O
activity	O
against	O
the	O
following	O
machines	O
in	O
your	O
network	O
:	O
Recently	O
,	O
research	O
was	O
published	O
identifying	O
a	O
Tor	O
exit	O
node	O
,	O
located	O
in	O
Russia	O
,	O
that	O
was	O
consistently	O
and	O
maliciously	O
modifying	B-Verb
any	B-Entity
uncompressed	I-Entity
Windows	I-Entity
executables	I-Entity
downloaded	I-Entity
through	I-Entity
it	I-Entity
.	O
	
Naturally	O
this	O
piqued	O
our	O
interest	O
,	O
so	O
we	O
decided	O
to	O
peer	O
down	O
the	O
rabbit	O
hole	O
.	O
	
Suffice	O
to	O
say	O
,	O
the	O
hole	O
was	O
a	O
lot	O
deeper	O
than	O
we	O
expected	O
!	O
In	O
fact	O
,	O
it	O
went	O
all	O
the	O
way	O
back	O
to	O
the	O
notorious	O
Russian	O
APT	O
family	O
MiniDuke	O
,	O
known	O
to	O
have	O
been	O
used	O
in	O
targeted	O
attacks	O
against	O
NATO	O
and	O
European	O
government	O
agencies	O
.	O
	
The	O
malware	O
used	O
in	O
this	O
case	O
is	O
,	O
however	O
,	O
not	O
a	O
version	O
of	O
MiniDuke	O
.	O
	
It	O
is	O
instead	O
a	O
separate	O
,	O
distinct	O
family	O
of	O
malware	O
that	O
we	O
have	O
since	O
taken	O
to	O
calling	O
OnionDuke	O
.	O
	
But	O
lets	O
start	O
from	O
the	O
beginning	O
.	O
	
When	O
a	O
user	O
attempts	O
to	O
download	B-Verb
an	B-Entity
executable	I-Entity
via	B-Preposition
the	B-Entity
malicious	I-Entity
Tor	I-Entity
exit	I-Entity
node	I-Entity
,	O
what	O
they	O
actually	O
receive	O
is	O
an	O
executable	O
''	O
wrapper	O
''	O
that	O
embeds	O
both	O
the	O
original	O
executable	O
and	O
a	O
second	O
,	O
malicious	O
executable	O
.	O
	
By	O
using	O
a	O
separate	O
wrapper	O
,	O
the	O
malicious	O
actors	O
are	O
able	O
to	O
bypass	O
any	O
integrity	O
checks	O
the	O
original	O
binary	O
might	O
contain	O
.	O
	
Upon	O
execution	O
,	O
the	O
wrapper	O
will	O
proceed	O
to	O
write	B-Verb
to	B-Preposition
disk	B-Entity
and	O
execute	B-Verb
the	B-Entity
original	I-Entity
executable	I-Entity
,	O
thereby	O
tricking	O
the	O
user	O
into	O
believing	O
that	O
everything	O
went	O
fine	O
.	O
	
However	O
,	O
the	O
wrapper	O
will	O
also	O
write	B-Verb
to	B-Preposition
disk	B-Entity
and	O
execute	B-Verb
the	B-Entity
second	I-Entity
executable	I-Entity
.	O
	
In	O
all	O
the	O
cases	O
we	O
have	O
observed	O
,	O
this	O
malicious	O
executable	O
has	O
been	O
the	O
same	O
binary	O
(	O
SHA1	O
:	O
a75995f94854dea8799650a2f4a97980b71199d2	O
,	O
detected	O
as	O
Trojan-Dropper	O
:	O
W32/OnionDuke.A	O
)	O
.	O
	
This	O
executable	O
is	O
a	O
dropper	O
containing	O
a	O
PE	O
resource	O
that	O
pretends	O
to	O
be	O
an	O
embedded	O
GIF	O
image	O
file	O
.	O
	
In	O
reality	O
,	O
the	O
resource	O
is	O
actually	O
an	O
encrypted	O
dynamically	O
linked	O
library	O
(	O
DLL	O
)	O
file	O
.	O
	
The	B-Entity
dropper	I-Entity
will	O
proceed	O
to	O
decrypt	O
this	O
DLL	O
,	O
write	B-Verb
it	B-Entity
to	B-Preposition
disk	B-Entity
and	O
execute	O
it	O
.	O
	
Once	O
executed	O
,	O
the	O
DLL	O
file	O
(	O
SHA1	O
:	O
b491c14d8cfb48636f6095b7b16555e9a575d57f	O
,	O
detected	O
as	O
Backdoor	O
:	O
W32/OnionDuke.B	O
)	O
will	O
decrypt	O
an	O
embedded	O
configuration	O
(	O
shown	O
below	O
)	O
and	O
attempt	O
to	O
connect	B-Verb
to	B-Preposition
hardcoded	B-Entity
C	I-Entity
&	I-Entity
C	I-Entity
URLs	I-Entity
specified	I-Entity
in	I-Entity
the	I-Entity
configuration	I-Entity
data	I-Entity
.	O
	
From	O
these	O
C	O
&	O
Cs	O
the	O
malware	O
may	O
receive	B-Verb
instructions	B-Entity
to	O
download	B-Verb
and	O
execute	B-Verb
additional	B-Entity
malicious	I-Entity
components	I-Entity
.	O
	
It	O
should	O
be	O
noted	O
,	O
that	O
we	O
believe	O
all	O
five	O
domains	O
contacted	O
by	O
the	O
malware	O
are	O
innocent	O
websites	O
compromised	O
by	O
the	O
malware	O
operators	O
,	O
not	O
dedicated	O
malicious	O
servers	O
.	O
	
Through	O
our	O
research	O
,	O
we	O
have	O
also	O
been	O
able	O
to	O
identify	O
multiple	O
other	O
components	O
of	O
the	O
OnionDuke	O
malware	O
family	O
.	O
	
We	O
have	O
,	O
for	O
instance	O
,	O
observed	O
components	O
dedicated	O
to	O
stealing	B-Verb
login	B-Entity
credentials	I-Entity
from	B-Preposition
the	B-Entity
victim	I-Entity
machine	I-Entity
and	I-Entity
components	I-Entity
dedicated	I-Entity
to	I-Entity
gathering	I-Entity
further	I-Entity
information	I-Entity
on	I-Entity
the	I-Entity
compromised	I-Entity
system	I-Entity
like	I-Entity
the	I-Entity
presence	I-Entity
of	I-Entity
antivirus	I-Entity
software	I-Entity
or	I-Entity
a	I-Entity
firewall	I-Entity
.	O
	
Some	O
of	O
these	O
components	O
have	O
been	O
observed	O
being	B-Verb
downloaded	I-Verb
and	O
executed	B-Verb
by	O
the	O
original	O
backdoor	O
process	O
but	O
for	O
other	O
components	O
,	O
we	O
have	O
yet	O
to	O
identify	O
the	O
infection	O
vector	O
.	O
	
Most	O
of	O
these	O
components	O
do	O
n't	O
embed	O
their	O
own	O
C	O
&	O
C	O
information	O
but	O
rather	O
communicate	O
with	O
their	O
controllers	O
through	O
the	O
original	O
backdoor	O
process	O
.	O
	
One	O
component	O
,	O
however	O
,	O
is	O
an	O
interesting	O
exception	O
.	O
	
This	O
DLL	O
file	O
(	O
SHA1	O
d433f281cf56015941a1c2cb87066ca62ea1db37	O
,	O
detected	O
as	O
Backdoor	O
:	O
W32/OnionDuke.A	O
)	O
contains	O
among	O
its	O
configuration	O
data	O
a	O
different	O
hardcoded	O
C	O
&	O
C	O
domain	O
,	O
overpict.com	O
and	O
also	O
evidence	O
suggesting	O
that	O
this	O
component	O
may	O
abuse	B-Verb
Twitter	B-Entity
as	B-Preposition
an	B-Entity
additional	I-Entity
C	I-Entity
&	I-Entity
C	I-Entity
channel	I-Entity
.	O
	
What	O
makes	O
the	O
overpict.com	O
domain	O
interesting	O
,	O
is	O
it	O
was	O
originally	O
registered	O
in	O
2011	O
with	O
the	O
alias	O
of	O
''	O
John	O
Kasai	O
''	O
.	O
	
Within	O
a	O
two-week	O
window	O
,	O
''	O
John	O
Kasai	O
''	O
also	O
registered	O
the	O
following	O
domains	O
:	O
airtravelabroad.com	O
,	O
beijingnewsblog.net	O
,	O
grouptumbler.com	O
,	O
leveldelta.com	O
,	O
nasdaqblog.net	O
,	O
natureinhome.com	O
,	O
nestedmail.com	O
,	O
nostressjob.com	O
,	O
nytunion.com	O
,	O
oilnewsblog.com	O
,	O
sixsquare.net	O
and	O
ustradecomp.com	O
.	O
	
This	O
is	O
significant	O
because	O
the	O
domains	O
leveldelta.com	O
and	O
grouptumbler.com	O
have	O
previously	O
been	O
identified	O
as	O
C	O
&	O
C	O
domains	O
used	O
by	O
MiniDuke	O
.	O
	
This	O
strongly	O
suggests	O
that	O
although	O
OnionDuke	O
and	O
MiniDuke	O
are	O
two	O
separate	O
families	O
of	O
malware	O
,	O
the	O
actors	O
behind	O
them	O
are	O
connected	O
through	O
the	O
use	O
of	O
shared	O
infrastructure	O
.	O
	
Based	O
on	O
compilation	O
timestamps	O
and	O
discovery	O
dates	O
of	O
samples	O
we	O
have	O
observed	O
,	O
we	O
believe	O
the	O
OnionDuke	O
operators	O
have	O
been	O
infecting	O
downloaded	O
executables	O
at	O
least	O
since	O
the	O
end	O
of	O
October	O
2013	O
.	O
	
We	O
also	O
have	O
evidence	O
suggesting	O
that	O
,	O
at	O
least	O
since	O
February	O
of	O
2014	O
,	O
OnionDuke	O
has	O
not	O
only	O
been	O
spread	O
by	O
modifying	O
downloaded	O
executables	O
but	O
also	O
by	O
infecting	B-Verb
executables	B-Entity
in	B-Preposition
.torrent	B-Entity
files	I-Entity
containing	I-Entity
pirated	I-Entity
software	I-Entity
.	O
	
However	O
,	O
it	O
would	O
seem	O
that	O
the	O
OnionDuke	O
family	O
is	O
much	O
older	O
,	O
both	O
based	O
on	O
older	O
compilation	O
timestamps	O
and	O
also	O
on	O
the	O
fact	O
that	O
some	O
of	O
the	O
embedded	O
configuration	O
data	O
make	O
reference	O
to	O
an	O
apparent	O
version	O
number	O
of	O
4	O
suggesting	O
that	O
at	O
least	O
three	O
earlier	O
versions	O
of	O
the	O
family	O
exist	O
.	O
	
During	O
our	O
research	O
,	O
we	O
have	O
also	O
uncovered	O
strong	O
evidence	O
suggesting	O
that	O
OnionDuke	O
has	O
been	O
used	O
in	O
targeted	O
attacks	O
against	O
European	O
government	O
agencies	O
,	O
although	O
we	O
have	O
so	O
far	O
been	O
unable	O
to	O
identify	O
the	O
infection	O
vector	O
(	O
s	O
)	O
.	O
	
Interestingly	O
,	O
this	O
would	O
suggest	O
two	O
very	O
different	O
targeting	O
strategies	O
.	O
	
On	O
one	O
hand	O
is	O
the	O
''	O
shooting	O
a	O
fly	O
with	O
a	O
cannon	O
''	O
mass-infection	O
strategy	O
through	O
modified	O
binaries	O
and	O
,	O
on	O
the	O
other	O
,	O
the	O
more	O
surgical	O
targeting	O
traditionally	O
associated	O
with	O
APT	O
operations	O
.	O
	
In	O
any	O
case	O
,	O
although	O
much	O
is	O
still	O
shrouded	O
in	O
mystery	O
and	O
speculation	O
,	O
one	O
thing	O
is	O
certain	O
.	O
	
While	O
using	O
Tor	O
may	O
help	O
you	O
stay	O
anonymous	O
,	O
it	O
does	O
at	O
the	O
same	O
time	O
paint	O
a	O
huge	O
target	O
on	O
your	O
back	O
.	O
	
It	O
's	O
never	O
a	O
good	O
idea	O
to	O
download	O
binaries	O
via	O
Tor	O
(	O
or	O
anything	O
else	O
)	O
without	O
encryption	O
.	O
	
The	O
problem	O
with	O
Tor	O
is	O
that	O
you	O
have	O
no	O
idea	O
who	O
is	O
maintaining	O
the	O
exit	O
node	O
you	O
are	O
using	O
and	O
what	O
their	O
motives	O
are	O
.	O
	
VPNs	O
(	O
such	O
as	O
our	O
Freedome	O
VPN	O
)	O
will	O
encrypt	O
your	O
connection	O
all	O
the	O
way	O
through	O
the	O
Tor	O
network	O
,	O
so	O
the	O
maintainers	O
of	O
Tor	O
exit	O
nodes	O
will	O
not	O
see	O
your	O
traffic	O
and	O
ca	O
n't	O
tamper	O
with	O
it	O
.	O
	
Samples	O
:	O
	
